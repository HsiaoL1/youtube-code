var Tv=n=>{throw TypeError(n)};var lm=(n,e,t)=>e.has(n)||Tv("Cannot "+t);var $=(n,e,t)=>(lm(n,e,"read from private field"),t?t.call(n):e.get(n)),We=(n,e,t)=>e.has(n)?Tv("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Le=(n,e,t,r)=>(lm(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),ct=(n,e,t)=>(lm(n,e,"access private method"),t);var nd=(n,e,t,r)=>({set _(s){Le(n,e,s,t)},get _(){return $(n,e,r)}});function BS(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function Xp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var um={exports:{}},uu={},cm={exports:{}},ft={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bv;function DA(){if(bv)return ft;bv=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function g(P){return P===null||typeof P!="object"?null:(P=m&&P[m]||P["@@iterator"],typeof P=="function"?P:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,E={};function S(P,B,de){this.props=P,this.context=B,this.refs=E,this.updater=de||y}S.prototype.isReactComponent={},S.prototype.setState=function(P,B){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,B,"setState")},S.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function A(){}A.prototype=S.prototype;function I(P,B,de){this.props=P,this.context=B,this.refs=E,this.updater=de||y}var R=I.prototype=new A;R.constructor=I,v(R,S.prototype),R.isPureReactComponent=!0;var k=Array.isArray,C=Object.prototype.hasOwnProperty,V={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function N(P,B,de){var pe,ge={},we=null,Ie=null;if(B!=null)for(pe in B.ref!==void 0&&(Ie=B.ref),B.key!==void 0&&(we=""+B.key),B)C.call(B,pe)&&!_.hasOwnProperty(pe)&&(ge[pe]=B[pe]);var Ge=arguments.length-2;if(Ge===1)ge.children=de;else if(1<Ge){for(var Ze=Array(Ge),vt=0;vt<Ge;vt++)Ze[vt]=arguments[vt+2];ge.children=Ze}if(P&&P.defaultProps)for(pe in Ge=P.defaultProps,Ge)ge[pe]===void 0&&(ge[pe]=Ge[pe]);return{$$typeof:n,type:P,key:we,ref:Ie,props:ge,_owner:V.current}}function F(P,B){return{$$typeof:n,type:P.type,key:B,ref:P.ref,props:P.props,_owner:P._owner}}function O(P){return typeof P=="object"&&P!==null&&P.$$typeof===n}function q(P){var B={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(de){return B[de]})}var H=/\/+/g;function ie(P,B){return typeof P=="object"&&P!==null&&P.key!=null?q(""+P.key):B.toString(36)}function oe(P,B,de,pe,ge){var we=typeof P;(we==="undefined"||we==="boolean")&&(P=null);var Ie=!1;if(P===null)Ie=!0;else switch(we){case"string":case"number":Ie=!0;break;case"object":switch(P.$$typeof){case n:case e:Ie=!0}}if(Ie)return Ie=P,ge=ge(Ie),P=pe===""?"."+ie(Ie,0):pe,k(ge)?(de="",P!=null&&(de=P.replace(H,"$&/")+"/"),oe(ge,B,de,"",function(vt){return vt})):ge!=null&&(O(ge)&&(ge=F(ge,de+(!ge.key||Ie&&Ie.key===ge.key?"":(""+ge.key).replace(H,"$&/")+"/")+P)),B.push(ge)),1;if(Ie=0,pe=pe===""?".":pe+":",k(P))for(var Ge=0;Ge<P.length;Ge++){we=P[Ge];var Ze=pe+ie(we,Ge);Ie+=oe(we,B,de,Ze,ge)}else if(Ze=g(P),typeof Ze=="function")for(P=Ze.call(P),Ge=0;!(we=P.next()).done;)we=we.value,Ze=pe+ie(we,Ge++),Ie+=oe(we,B,de,Ze,ge);else if(we==="object")throw B=String(P),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return Ie}function ce(P,B,de){if(P==null)return P;var pe=[],ge=0;return oe(P,pe,"","",function(we){return B.call(de,we,ge++)}),pe}function ae(P){if(P._status===-1){var B=P._result;B=B(),B.then(function(de){(P._status===0||P._status===-1)&&(P._status=1,P._result=de)},function(de){(P._status===0||P._status===-1)&&(P._status=2,P._result=de)}),P._status===-1&&(P._status=0,P._result=B)}if(P._status===1)return P._result.default;throw P._result}var ue={current:null},W={transition:null},Z={ReactCurrentDispatcher:ue,ReactCurrentBatchConfig:W,ReactCurrentOwner:V};function ne(){throw Error("act(...) is not supported in production builds of React.")}return ft.Children={map:ce,forEach:function(P,B,de){ce(P,function(){B.apply(this,arguments)},de)},count:function(P){var B=0;return ce(P,function(){B++}),B},toArray:function(P){return ce(P,function(B){return B})||[]},only:function(P){if(!O(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},ft.Component=S,ft.Fragment=t,ft.Profiler=s,ft.PureComponent=I,ft.StrictMode=r,ft.Suspense=d,ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,ft.act=ne,ft.cloneElement=function(P,B,de){if(P==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+P+".");var pe=v({},P.props),ge=P.key,we=P.ref,Ie=P._owner;if(B!=null){if(B.ref!==void 0&&(we=B.ref,Ie=V.current),B.key!==void 0&&(ge=""+B.key),P.type&&P.type.defaultProps)var Ge=P.type.defaultProps;for(Ze in B)C.call(B,Ze)&&!_.hasOwnProperty(Ze)&&(pe[Ze]=B[Ze]===void 0&&Ge!==void 0?Ge[Ze]:B[Ze])}var Ze=arguments.length-2;if(Ze===1)pe.children=de;else if(1<Ze){Ge=Array(Ze);for(var vt=0;vt<Ze;vt++)Ge[vt]=arguments[vt+2];pe.children=Ge}return{$$typeof:n,type:P.type,key:ge,ref:we,props:pe,_owner:Ie}},ft.createContext=function(P){return P={$$typeof:o,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},P.Provider={$$typeof:i,_context:P},P.Consumer=P},ft.createElement=N,ft.createFactory=function(P){var B=N.bind(null,P);return B.type=P,B},ft.createRef=function(){return{current:null}},ft.forwardRef=function(P){return{$$typeof:u,render:P}},ft.isValidElement=O,ft.lazy=function(P){return{$$typeof:h,_payload:{_status:-1,_result:P},_init:ae}},ft.memo=function(P,B){return{$$typeof:c,type:P,compare:B===void 0?null:B}},ft.startTransition=function(P){var B=W.transition;W.transition={};try{P()}finally{W.transition=B}},ft.unstable_act=ne,ft.useCallback=function(P,B){return ue.current.useCallback(P,B)},ft.useContext=function(P){return ue.current.useContext(P)},ft.useDebugValue=function(){},ft.useDeferredValue=function(P){return ue.current.useDeferredValue(P)},ft.useEffect=function(P,B){return ue.current.useEffect(P,B)},ft.useId=function(){return ue.current.useId()},ft.useImperativeHandle=function(P,B,de){return ue.current.useImperativeHandle(P,B,de)},ft.useInsertionEffect=function(P,B){return ue.current.useInsertionEffect(P,B)},ft.useLayoutEffect=function(P,B){return ue.current.useLayoutEffect(P,B)},ft.useMemo=function(P,B){return ue.current.useMemo(P,B)},ft.useReducer=function(P,B,de){return ue.current.useReducer(P,B,de)},ft.useRef=function(P){return ue.current.useRef(P)},ft.useState=function(P){return ue.current.useState(P)},ft.useSyncExternalStore=function(P,B,de){return ue.current.useSyncExternalStore(P,B,de)},ft.useTransition=function(){return ue.current.useTransition()},ft.version="18.3.1",ft}var wv;function Zp(){return wv||(wv=1,cm.exports=DA()),cm.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Av;function PA(){if(Av)return uu;Av=1;var n=Zp(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(u,d,c){var h,m={},g=null,y=null;c!==void 0&&(g=""+c),d.key!==void 0&&(g=""+d.key),d.ref!==void 0&&(y=d.ref);for(h in d)r.call(d,h)&&!i.hasOwnProperty(h)&&(m[h]=d[h]);if(u&&u.defaultProps)for(h in d=u.defaultProps,d)m[h]===void 0&&(m[h]=d[h]);return{$$typeof:e,type:u,key:g,ref:y,props:m,_owner:s.current}}return uu.Fragment=t,uu.jsx=o,uu.jsxs=o,uu}var Iv;function OA(){return Iv||(Iv=1,um.exports=PA()),um.exports}var b=OA(),D=Zp();const ve=Xp(D),Jp=BS({__proto__:null,default:ve},[D]);var sd={},dm={exports:{}},vn={},fm={exports:{}},hm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rv;function NA(){return Rv||(Rv=1,(function(n){function e(W,Z){var ne=W.length;W.push(Z);e:for(;0<ne;){var P=ne-1>>>1,B=W[P];if(0<s(B,Z))W[P]=Z,W[ne]=B,ne=P;else break e}}function t(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var Z=W[0],ne=W.pop();if(ne!==Z){W[0]=ne;e:for(var P=0,B=W.length,de=B>>>1;P<de;){var pe=2*(P+1)-1,ge=W[pe],we=pe+1,Ie=W[we];if(0>s(ge,ne))we<B&&0>s(Ie,ge)?(W[P]=Ie,W[we]=ne,P=we):(W[P]=ge,W[pe]=ne,P=pe);else if(we<B&&0>s(Ie,ne))W[P]=Ie,W[we]=ne,P=we;else break e}}return Z}function s(W,Z){var ne=W.sortIndex-Z.sortIndex;return ne!==0?ne:W.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,u=o.now();n.unstable_now=function(){return o.now()-u}}var d=[],c=[],h=1,m=null,g=3,y=!1,v=!1,E=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(W){for(var Z=t(c);Z!==null;){if(Z.callback===null)r(c);else if(Z.startTime<=W)r(c),Z.sortIndex=Z.expirationTime,e(d,Z);else break;Z=t(c)}}function k(W){if(E=!1,R(W),!v)if(t(d)!==null)v=!0,ae(C);else{var Z=t(c);Z!==null&&ue(k,Z.startTime-W)}}function C(W,Z){v=!1,E&&(E=!1,A(N),N=-1),y=!0;var ne=g;try{for(R(Z),m=t(d);m!==null&&(!(m.expirationTime>Z)||W&&!q());){var P=m.callback;if(typeof P=="function"){m.callback=null,g=m.priorityLevel;var B=P(m.expirationTime<=Z);Z=n.unstable_now(),typeof B=="function"?m.callback=B:m===t(d)&&r(d),R(Z)}else r(d);m=t(d)}if(m!==null)var de=!0;else{var pe=t(c);pe!==null&&ue(k,pe.startTime-Z),de=!1}return de}finally{m=null,g=ne,y=!1}}var V=!1,_=null,N=-1,F=5,O=-1;function q(){return!(n.unstable_now()-O<F)}function H(){if(_!==null){var W=n.unstable_now();O=W;var Z=!0;try{Z=_(!0,W)}finally{Z?ie():(V=!1,_=null)}}else V=!1}var ie;if(typeof I=="function")ie=function(){I(H)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,ce=oe.port2;oe.port1.onmessage=H,ie=function(){ce.postMessage(null)}}else ie=function(){S(H,0)};function ae(W){_=W,V||(V=!0,ie())}function ue(W,Z){N=S(function(){W(n.unstable_now())},Z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){v||y||(v=!0,ae(C))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(W){switch(g){case 1:case 2:case 3:var Z=3;break;default:Z=g}var ne=g;g=Z;try{return W()}finally{g=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,Z){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var ne=g;g=W;try{return Z()}finally{g=ne}},n.unstable_scheduleCallback=function(W,Z,ne){var P=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?P+ne:P):ne=P,W){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=ne+B,W={id:h++,callback:Z,priorityLevel:W,startTime:ne,expirationTime:B,sortIndex:-1},ne>P?(W.sortIndex=ne,e(c,W),t(d)===null&&W===t(c)&&(E?(A(N),N=-1):E=!0,ue(k,ne-P))):(W.sortIndex=B,e(d,W),v||y||(v=!0,ae(C))),W},n.unstable_shouldYield=q,n.unstable_wrapCallback=function(W){var Z=g;return function(){var ne=g;g=Z;try{return W.apply(this,arguments)}finally{g=ne}}}})(hm)),hm}var Lv;function MA(){return Lv||(Lv=1,fm.exports=NA()),fm.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _v;function FA(){if(_v)return vn;_v=1;var n=Zp(),e=MA();function t(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(a,l){o(a,l),o(a+"Capture",l)}function o(a,l){for(s[a]=l,a=0;a<l.length;a++)r.add(l[a])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},m={};function g(a){return d.call(m,a)?!0:d.call(h,a)?!1:c.test(a)?m[a]=!0:(h[a]=!0,!1)}function y(a,l,f,p){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return p?!1:f!==null?!f.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function v(a,l,f,p){if(l===null||typeof l>"u"||y(a,l,f,p))return!0;if(p)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function E(a,l,f,p,x,T,L){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=p,this.attributeNamespace=x,this.mustUseProperty=f,this.propertyName=a,this.type=l,this.sanitizeURL=T,this.removeEmptyString=L}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){S[a]=new E(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];S[l]=new E(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){S[a]=new E(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){S[a]=new E(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){S[a]=new E(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){S[a]=new E(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){S[a]=new E(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){S[a]=new E(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){S[a]=new E(a,5,!1,a.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function I(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(A,I);S[l]=new E(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(A,I);S[l]=new E(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(A,I);S[l]=new E(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){S[a]=new E(a,1,!1,a.toLowerCase(),null,!1,!1)}),S.xlinkHref=new E("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){S[a]=new E(a,1,!1,a.toLowerCase(),null,!0,!0)});function R(a,l,f,p){var x=S.hasOwnProperty(l)?S[l]:null;(x!==null?x.type!==0:p||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(v(l,f,x,p)&&(f=null),p||x===null?g(l)&&(f===null?a.removeAttribute(l):a.setAttribute(l,""+f)):x.mustUseProperty?a[x.propertyName]=f===null?x.type===3?!1:"":f:(l=x.attributeName,p=x.attributeNamespace,f===null?a.removeAttribute(l):(x=x.type,f=x===3||x===4&&f===!0?"":""+f,p?a.setAttributeNS(p,l,f):a.setAttribute(l,f))))}var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C=Symbol.for("react.element"),V=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),q=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),ie=Symbol.for("react.suspense"),oe=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),ae=Symbol.for("react.lazy"),ue=Symbol.for("react.offscreen"),W=Symbol.iterator;function Z(a){return a===null||typeof a!="object"?null:(a=W&&a[W]||a["@@iterator"],typeof a=="function"?a:null)}var ne=Object.assign,P;function B(a){if(P===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);P=l&&l[1]||""}return`
`+P+a}var de=!1;function pe(a,l){if(!a||de)return"";de=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(re){var p=re}Reflect.construct(a,[],l)}else{try{l.call()}catch(re){p=re}a.call(l.prototype)}else{try{throw Error()}catch(re){p=re}a()}}catch(re){if(re&&p&&typeof re.stack=="string"){for(var x=re.stack.split(`
`),T=p.stack.split(`
`),L=x.length-1,M=T.length-1;1<=L&&0<=M&&x[L]!==T[M];)M--;for(;1<=L&&0<=M;L--,M--)if(x[L]!==T[M]){if(L!==1||M!==1)do if(L--,M--,0>M||x[L]!==T[M]){var G=`
`+x[L].replace(" at new "," at ");return a.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",a.displayName)),G}while(1<=L&&0<=M);break}}}finally{de=!1,Error.prepareStackTrace=f}return(a=a?a.displayName||a.name:"")?B(a):""}function ge(a){switch(a.tag){case 5:return B(a.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return a=pe(a.type,!1),a;case 11:return a=pe(a.type.render,!1),a;case 1:return a=pe(a.type,!0),a;default:return""}}function we(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case _:return"Fragment";case V:return"Portal";case F:return"Profiler";case N:return"StrictMode";case ie:return"Suspense";case oe:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case q:return(a.displayName||"Context")+".Consumer";case O:return(a._context.displayName||"Context")+".Provider";case H:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ce:return l=a.displayName||null,l!==null?l:we(a.type)||"Memo";case ae:l=a._payload,a=a._init;try{return we(a(l))}catch{}}return null}function Ie(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return we(l);case 8:return l===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Ge(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ze(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function vt(a){var l=Ze(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),p=""+a[l];if(!a.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,T=f.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return x.call(this)},set:function(L){p=""+L,T.call(this,L)}}),Object.defineProperty(a,l,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(L){p=""+L},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function er(a){a._valueTracker||(a._valueTracker=vt(a))}function Ht(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var f=l.getValue(),p="";return a&&(p=Ze(a)?a.checked?"true":"false":a.value),a=p,a!==f?(l.setValue(a),!0):!1}function fr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function cn(a,l){var f=l.checked;return ne({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??a._wrapperState.initialChecked})}function ys(a,l){var f=l.defaultValue==null?"":l.defaultValue,p=l.checked!=null?l.checked:l.defaultChecked;f=Ge(l.value!=null?l.value:f),a._wrapperState={initialChecked:p,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function Xe(a,l){l=l.checked,l!=null&&R(a,"checked",l,!1)}function zt(a,l){Xe(a,l);var f=Ge(l.value),p=l.type;if(f!=null)p==="number"?(f===0&&a.value===""||a.value!=f)&&(a.value=""+f):a.value!==""+f&&(a.value=""+f);else if(p==="submit"||p==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?Mr(a,l.type,f):l.hasOwnProperty("defaultValue")&&Mr(a,l.type,Ge(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function nr(a,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var p=l.type;if(!(p!=="submit"&&p!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,f||l===a.value||(a.value=l),a.defaultValue=l}f=a.name,f!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,f!==""&&(a.name=f)}function Mr(a,l,f){(l!=="number"||fr(a.ownerDocument)!==a)&&(f==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+f&&(a.defaultValue=""+f))}var qt=Array.isArray;function U(a,l,f,p){if(a=a.options,l){l={};for(var x=0;x<f.length;x++)l["$"+f[x]]=!0;for(f=0;f<a.length;f++)x=l.hasOwnProperty("$"+a[f].value),a[f].selected!==x&&(a[f].selected=x),x&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Ge(f),l=null,x=0;x<a.length;x++){if(a[x].value===f){a[x].selected=!0,p&&(a[x].defaultSelected=!0);return}l!==null||a[x].disabled||(l=a[x])}l!==null&&(l.selected=!0)}}function Y(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(t(91));return ne({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function se(a,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(t(92));if(qt(f)){if(1<f.length)throw Error(t(93));f=f[0]}l=f}l==null&&(l=""),f=l}a._wrapperState={initialValue:Ge(f)}}function Te(a,l){var f=Ge(l.value),p=Ge(l.defaultValue);f!=null&&(f=""+f,f!==a.value&&(a.value=f),l.defaultValue==null&&a.defaultValue!==f&&(a.defaultValue=f)),p!=null&&(a.defaultValue=""+p)}function Ee(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function fe(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _e(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?fe(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var et,tt=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,f,p,x){MSApp.execUnsafeLocalFunction(function(){return a(l,f,p,x)})}:a})(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(et=et||document.createElement("div"),et.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=et.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function At(a,l){if(l){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=l;return}}a.textContent=l}var Wt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},en=["Webkit","ms","Moz","O"];Object.keys(Wt).forEach(function(a){en.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),Wt[l]=Wt[a]})});function Fr(a,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||Wt.hasOwnProperty(a)&&Wt[a]?(""+l).trim():l+"px"}function zr(a,l){a=a.style;for(var f in l)if(l.hasOwnProperty(f)){var p=f.indexOf("--")===0,x=Fr(f,l[f],p);f==="float"&&(f="cssFloat"),p?a.setProperty(f,x):a[f]=x}}var Jn=ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tn(a,l){if(l){if(Jn[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(t(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(t(61))}if(l.style!=null&&typeof l.style!="object")throw Error(t(62))}}function vs(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xs=null;function dn(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var js=null,$n=null,fn=null;function Rn(a){if(a=Yl(a)){if(typeof js!="function")throw Error(t(280));var l=a.stateNode;l&&(l=vc(l),js(a.stateNode,a.type,l))}}function ga(a){$n?fn?fn.push(a):fn=[a]:$n=a}function Je(){if($n){var a=$n,l=fn;if(fn=$n=null,Rn(a),l)for(a=0;a<l.length;a++)Rn(l[a])}}function St(a,l){return a(l)}function It(){}var yr=!1;function Wr(a,l,f){if(yr)return a(l,f);yr=!0;try{return St(a,l,f)}finally{yr=!1,($n!==null||fn!==null)&&(It(),Je())}}function Yr(a,l){var f=a.stateNode;if(f===null)return null;var p=vc(f);if(p===null)return null;f=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(t(231,l,typeof f));return f}var j=!1;if(u)try{var z={};Object.defineProperty(z,"passive",{get:function(){j=!0}}),window.addEventListener("test",z,z),window.removeEventListener("test",z,z)}catch{j=!1}function te(a,l,f,p,x,T,L,M,G){var re=Array.prototype.slice.call(arguments,3);try{l.apply(f,re)}catch(ye){this.onError(ye)}}var he=!1,Ae=null,ze=!1,Qe=null,Me={onError:function(a){he=!0,Ae=a}};function Be(a,l,f,p,x,T,L,M,G){he=!1,Ae=null,te.apply(Me,arguments)}function Pe(a,l,f,p,x,T,L,M,G){if(Be.apply(this,arguments),he){if(he){var re=Ae;he=!1,Ae=null}else throw Error(t(198));ze||(ze=!0,Qe=re)}}function Ne(a){var l=a,f=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(f=l.return),a=l.return;while(a)}return l.tag===3?f:null}function it(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function pt(a){if(Ne(a)!==a)throw Error(t(188))}function wr(a){var l=a.alternate;if(!l){if(l=Ne(a),l===null)throw Error(t(188));return l!==a?null:a}for(var f=a,p=l;;){var x=f.return;if(x===null)break;var T=x.alternate;if(T===null){if(p=x.return,p!==null){f=p;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===f)return pt(x),a;if(T===p)return pt(x),l;T=T.sibling}throw Error(t(188))}if(f.return!==p.return)f=x,p=T;else{for(var L=!1,M=x.child;M;){if(M===f){L=!0,f=x,p=T;break}if(M===p){L=!0,p=x,f=T;break}M=M.sibling}if(!L){for(M=T.child;M;){if(M===f){L=!0,f=T,p=x;break}if(M===p){L=!0,p=T,f=x;break}M=M.sibling}if(!L)throw Error(t(189))}}if(f.alternate!==p)throw Error(t(190))}if(f.tag!==3)throw Error(t(188));return f.stateNode.current===f?a:l}function Nt(a){return a=wr(a),a!==null?Tt(a):null}function Tt(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=Tt(a);if(l!==null)return l;a=a.sibling}return null}var Qt=e.unstable_scheduleCallback,Vs=e.unstable_cancelCallback,ya=e.unstable_shouldYield,es=e.unstable_requestPaint,Rt=e.unstable_now,_l=e.unstable_getCurrentPriorityLevel,Gs=e.unstable_ImmediatePriority,Es=e.unstable_UserBlockingPriority,Ks=e.unstable_NormalPriority,uo=e.unstable_LowPriority,xt=e.unstable_IdlePriority,jt=null,Ur=null;function va(a){if(Ur&&typeof Ur.onCommitFiberRoot=="function")try{Ur.onCommitFiberRoot(jt,a,void 0,(a.current.flags&128)===128)}catch{}}var Lt=Math.clz32?Math.clz32:Lf,gi=Math.log,Ju=Math.LN2;function Lf(a){return a>>>=0,a===0?32:31-(gi(a)/Ju|0)|0}var ec=64,tc=4194304;function kl(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function rc(a,l){var f=a.pendingLanes;if(f===0)return 0;var p=0,x=a.suspendedLanes,T=a.pingedLanes,L=f&268435455;if(L!==0){var M=L&~x;M!==0?p=kl(M):(T&=L,T!==0&&(p=kl(T)))}else L=f&~x,L!==0?p=kl(L):T!==0&&(p=kl(T));if(p===0)return 0;if(l!==0&&l!==p&&(l&x)===0&&(x=p&-p,T=l&-l,x>=T||x===16&&(T&4194240)!==0))return l;if((p&4)!==0&&(p|=f&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=p;0<l;)f=31-Lt(l),x=1<<f,p|=a[f],l&=~x;return p}function Xw(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zw(a,l){for(var f=a.suspendedLanes,p=a.pingedLanes,x=a.expirationTimes,T=a.pendingLanes;0<T;){var L=31-Lt(T),M=1<<L,G=x[L];G===-1?((M&f)===0||(M&p)!==0)&&(x[L]=Xw(M,l)):G<=l&&(a.expiredLanes|=M),T&=~M}}function _f(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Jg(){var a=ec;return ec<<=1,(ec&4194240)===0&&(ec=64),a}function kf(a){for(var l=[],f=0;31>f;f++)l.push(a);return l}function Cl(a,l,f){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-Lt(l),a[l]=f}function Jw(a,l){var f=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var p=a.eventTimes;for(a=a.expirationTimes;0<f;){var x=31-Lt(f),T=1<<x;l[x]=0,p[x]=-1,a[x]=-1,f&=~T}}function Cf(a,l){var f=a.entangledLanes|=l;for(a=a.entanglements;f;){var p=31-Lt(f),x=1<<p;x&l|a[p]&l&&(a[p]|=l),f&=~x}}var Mt=0;function e0(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var t0,Df,r0,n0,s0,Pf=!1,nc=[],yi=null,vi=null,xi=null,Dl=new Map,Pl=new Map,Ei=[],e1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function i0(a,l){switch(a){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":vi=null;break;case"mouseover":case"mouseout":xi=null;break;case"pointerover":case"pointerout":Dl.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pl.delete(l.pointerId)}}function Ol(a,l,f,p,x,T){return a===null||a.nativeEvent!==T?(a={blockedOn:l,domEventName:f,eventSystemFlags:p,nativeEvent:T,targetContainers:[x]},l!==null&&(l=Yl(l),l!==null&&Df(l)),a):(a.eventSystemFlags|=p,l=a.targetContainers,x!==null&&l.indexOf(x)===-1&&l.push(x),a)}function t1(a,l,f,p,x){switch(l){case"focusin":return yi=Ol(yi,a,l,f,p,x),!0;case"dragenter":return vi=Ol(vi,a,l,f,p,x),!0;case"mouseover":return xi=Ol(xi,a,l,f,p,x),!0;case"pointerover":var T=x.pointerId;return Dl.set(T,Ol(Dl.get(T)||null,a,l,f,p,x)),!0;case"gotpointercapture":return T=x.pointerId,Pl.set(T,Ol(Pl.get(T)||null,a,l,f,p,x)),!0}return!1}function a0(a){var l=xa(a.target);if(l!==null){var f=Ne(l);if(f!==null){if(l=f.tag,l===13){if(l=it(f),l!==null){a.blockedOn=l,s0(a.priority,function(){r0(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function sc(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var f=Nf(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);xs=p,f.target.dispatchEvent(p),xs=null}else return l=Yl(f),l!==null&&Df(l),a.blockedOn=f,!1;l.shift()}return!0}function o0(a,l,f){sc(a)&&f.delete(l)}function r1(){Pf=!1,yi!==null&&sc(yi)&&(yi=null),vi!==null&&sc(vi)&&(vi=null),xi!==null&&sc(xi)&&(xi=null),Dl.forEach(o0),Pl.forEach(o0)}function Nl(a,l){a.blockedOn===l&&(a.blockedOn=null,Pf||(Pf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,r1)))}function Ml(a){function l(x){return Nl(x,a)}if(0<nc.length){Nl(nc[0],a);for(var f=1;f<nc.length;f++){var p=nc[f];p.blockedOn===a&&(p.blockedOn=null)}}for(yi!==null&&Nl(yi,a),vi!==null&&Nl(vi,a),xi!==null&&Nl(xi,a),Dl.forEach(l),Pl.forEach(l),f=0;f<Ei.length;f++)p=Ei[f],p.blockedOn===a&&(p.blockedOn=null);for(;0<Ei.length&&(f=Ei[0],f.blockedOn===null);)a0(f),f.blockedOn===null&&Ei.shift()}var co=k.ReactCurrentBatchConfig,ic=!0;function n1(a,l,f,p){var x=Mt,T=co.transition;co.transition=null;try{Mt=1,Of(a,l,f,p)}finally{Mt=x,co.transition=T}}function s1(a,l,f,p){var x=Mt,T=co.transition;co.transition=null;try{Mt=4,Of(a,l,f,p)}finally{Mt=x,co.transition=T}}function Of(a,l,f,p){if(ic){var x=Nf(a,l,f,p);if(x===null)Zf(a,l,p,ac,f),i0(a,p);else if(t1(x,a,l,f,p))p.stopPropagation();else if(i0(a,p),l&4&&-1<e1.indexOf(a)){for(;x!==null;){var T=Yl(x);if(T!==null&&t0(T),T=Nf(a,l,f,p),T===null&&Zf(a,l,p,ac,f),T===x)break;x=T}x!==null&&p.stopPropagation()}else Zf(a,l,p,null,f)}}var ac=null;function Nf(a,l,f,p){if(ac=null,a=dn(p),a=xa(a),a!==null)if(l=Ne(a),l===null)a=null;else if(f=l.tag,f===13){if(a=it(l),a!==null)return a;a=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return ac=a,null}function l0(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_l()){case Gs:return 1;case Es:return 4;case Ks:case uo:return 16;case xt:return 536870912;default:return 16}default:return 16}}var Si=null,Mf=null,oc=null;function u0(){if(oc)return oc;var a,l=Mf,f=l.length,p,x="value"in Si?Si.value:Si.textContent,T=x.length;for(a=0;a<f&&l[a]===x[a];a++);var L=f-a;for(p=1;p<=L&&l[f-p]===x[T-p];p++);return oc=x.slice(a,1<p?1-p:void 0)}function lc(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function uc(){return!0}function c0(){return!1}function Ln(a){function l(f,p,x,T,L){this._reactName=f,this._targetInst=x,this.type=p,this.nativeEvent=T,this.target=L,this.currentTarget=null;for(var M in a)a.hasOwnProperty(M)&&(f=a[M],this[M]=f?f(T):T[M]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?uc:c0,this.isPropagationStopped=c0,this}return ne(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=uc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=uc)},persist:function(){},isPersistent:uc}),l}var fo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ff=Ln(fo),Fl=ne({},fo,{view:0,detail:0}),i1=Ln(Fl),Uf,Bf,Ul,cc=ne({},Fl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jf,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ul&&(Ul&&a.type==="mousemove"?(Uf=a.screenX-Ul.screenX,Bf=a.screenY-Ul.screenY):Bf=Uf=0,Ul=a),Uf)},movementY:function(a){return"movementY"in a?a.movementY:Bf}}),d0=Ln(cc),a1=ne({},cc,{dataTransfer:0}),o1=Ln(a1),l1=ne({},Fl,{relatedTarget:0}),$f=Ln(l1),u1=ne({},fo,{animationName:0,elapsedTime:0,pseudoElement:0}),c1=Ln(u1),d1=ne({},fo,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),f1=Ln(d1),h1=ne({},fo,{data:0}),f0=Ln(h1),m1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},p1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},g1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function y1(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=g1[a])?!!l[a]:!1}function jf(){return y1}var v1=ne({},Fl,{key:function(a){if(a.key){var l=m1[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=lc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?p1[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jf,charCode:function(a){return a.type==="keypress"?lc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?lc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),x1=Ln(v1),E1=ne({},cc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),h0=Ln(E1),S1=ne({},Fl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jf}),T1=Ln(S1),b1=ne({},fo,{propertyName:0,elapsedTime:0,pseudoElement:0}),w1=Ln(b1),A1=ne({},cc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),I1=Ln(A1),R1=[9,13,27,32],Vf=u&&"CompositionEvent"in window,Bl=null;u&&"documentMode"in document&&(Bl=document.documentMode);var L1=u&&"TextEvent"in window&&!Bl,m0=u&&(!Vf||Bl&&8<Bl&&11>=Bl),p0=" ",g0=!1;function y0(a,l){switch(a){case"keyup":return R1.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function v0(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ho=!1;function _1(a,l){switch(a){case"compositionend":return v0(l);case"keypress":return l.which!==32?null:(g0=!0,p0);case"textInput":return a=l.data,a===p0&&g0?null:a;default:return null}}function k1(a,l){if(ho)return a==="compositionend"||!Vf&&y0(a,l)?(a=u0(),oc=Mf=Si=null,ho=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return m0&&l.locale!=="ko"?null:l.data;default:return null}}var C1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x0(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!C1[a.type]:l==="textarea"}function E0(a,l,f,p){ga(p),l=pc(l,"onChange"),0<l.length&&(f=new Ff("onChange","change",null,f,p),a.push({event:f,listeners:l}))}var $l=null,jl=null;function D1(a){U0(a,0)}function dc(a){var l=vo(a);if(Ht(l))return a}function P1(a,l){if(a==="change")return l}var S0=!1;if(u){var Gf;if(u){var Kf="oninput"in document;if(!Kf){var T0=document.createElement("div");T0.setAttribute("oninput","return;"),Kf=typeof T0.oninput=="function"}Gf=Kf}else Gf=!1;S0=Gf&&(!document.documentMode||9<document.documentMode)}function b0(){$l&&($l.detachEvent("onpropertychange",w0),jl=$l=null)}function w0(a){if(a.propertyName==="value"&&dc(jl)){var l=[];E0(l,jl,a,dn(a)),Wr(D1,l)}}function O1(a,l,f){a==="focusin"?(b0(),$l=l,jl=f,$l.attachEvent("onpropertychange",w0)):a==="focusout"&&b0()}function N1(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return dc(jl)}function M1(a,l){if(a==="click")return dc(l)}function F1(a,l){if(a==="input"||a==="change")return dc(l)}function U1(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var ts=typeof Object.is=="function"?Object.is:U1;function Vl(a,l){if(ts(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var f=Object.keys(a),p=Object.keys(l);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var x=f[p];if(!d.call(l,x)||!ts(a[x],l[x]))return!1}return!0}function A0(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function I0(a,l){var f=A0(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=l&&p>=l)return{node:f,offset:l-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=A0(f)}}function R0(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?R0(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function L0(){for(var a=window,l=fr();l instanceof a.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)a=l.contentWindow;else break;l=fr(a.document)}return l}function Hf(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function B1(a){var l=L0(),f=a.focusedElem,p=a.selectionRange;if(l!==f&&f&&f.ownerDocument&&R0(f.ownerDocument.documentElement,f)){if(p!==null&&Hf(f)){if(l=p.start,a=p.end,a===void 0&&(a=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(a,f.value.length);else if(a=(l=f.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var x=f.textContent.length,T=Math.min(p.start,x);p=p.end===void 0?T:Math.min(p.end,x),!a.extend&&T>p&&(x=p,p=T,T=x),x=I0(f,T);var L=I0(f,p);x&&L&&(a.rangeCount!==1||a.anchorNode!==x.node||a.anchorOffset!==x.offset||a.focusNode!==L.node||a.focusOffset!==L.offset)&&(l=l.createRange(),l.setStart(x.node,x.offset),a.removeAllRanges(),T>p?(a.addRange(l),a.extend(L.node,L.offset)):(l.setEnd(L.node,L.offset),a.addRange(l)))}}for(l=[],a=f;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)a=l[f],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var $1=u&&"documentMode"in document&&11>=document.documentMode,mo=null,zf=null,Gl=null,Wf=!1;function _0(a,l,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Wf||mo==null||mo!==fr(p)||(p=mo,"selectionStart"in p&&Hf(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Gl&&Vl(Gl,p)||(Gl=p,p=pc(zf,"onSelect"),0<p.length&&(l=new Ff("onSelect","select",null,l,f),a.push({event:l,listeners:p}),l.target=mo)))}function fc(a,l){var f={};return f[a.toLowerCase()]=l.toLowerCase(),f["Webkit"+a]="webkit"+l,f["Moz"+a]="moz"+l,f}var po={animationend:fc("Animation","AnimationEnd"),animationiteration:fc("Animation","AnimationIteration"),animationstart:fc("Animation","AnimationStart"),transitionend:fc("Transition","TransitionEnd")},Yf={},k0={};u&&(k0=document.createElement("div").style,"AnimationEvent"in window||(delete po.animationend.animation,delete po.animationiteration.animation,delete po.animationstart.animation),"TransitionEvent"in window||delete po.transitionend.transition);function hc(a){if(Yf[a])return Yf[a];if(!po[a])return a;var l=po[a],f;for(f in l)if(l.hasOwnProperty(f)&&f in k0)return Yf[a]=l[f];return a}var C0=hc("animationend"),D0=hc("animationiteration"),P0=hc("animationstart"),O0=hc("transitionend"),N0=new Map,M0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ti(a,l){N0.set(a,l),i(l,[a])}for(var qf=0;qf<M0.length;qf++){var Qf=M0[qf],j1=Qf.toLowerCase(),V1=Qf[0].toUpperCase()+Qf.slice(1);Ti(j1,"on"+V1)}Ti(C0,"onAnimationEnd"),Ti(D0,"onAnimationIteration"),Ti(P0,"onAnimationStart"),Ti("dblclick","onDoubleClick"),Ti("focusin","onFocus"),Ti("focusout","onBlur"),Ti(O0,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kl));function F0(a,l,f){var p=a.type||"unknown-event";a.currentTarget=f,Pe(p,l,void 0,a),a.currentTarget=null}function U0(a,l){l=(l&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],x=p.event;p=p.listeners;e:{var T=void 0;if(l)for(var L=p.length-1;0<=L;L--){var M=p[L],G=M.instance,re=M.currentTarget;if(M=M.listener,G!==T&&x.isPropagationStopped())break e;F0(x,M,re),T=G}else for(L=0;L<p.length;L++){if(M=p[L],G=M.instance,re=M.currentTarget,M=M.listener,G!==T&&x.isPropagationStopped())break e;F0(x,M,re),T=G}}}if(ze)throw a=Qe,ze=!1,Qe=null,a}function Xt(a,l){var f=l[sh];f===void 0&&(f=l[sh]=new Set);var p=a+"__bubble";f.has(p)||(B0(l,a,2,!1),f.add(p))}function Xf(a,l,f){var p=0;l&&(p|=4),B0(f,a,p,l)}var mc="_reactListening"+Math.random().toString(36).slice(2);function Hl(a){if(!a[mc]){a[mc]=!0,r.forEach(function(f){f!=="selectionchange"&&(G1.has(f)||Xf(f,!1,a),Xf(f,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[mc]||(l[mc]=!0,Xf("selectionchange",!1,l))}}function B0(a,l,f,p){switch(l0(l)){case 1:var x=n1;break;case 4:x=s1;break;default:x=Of}f=x.bind(null,l,f,a),x=void 0,!j||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(x=!0),p?x!==void 0?a.addEventListener(l,f,{capture:!0,passive:x}):a.addEventListener(l,f,!0):x!==void 0?a.addEventListener(l,f,{passive:x}):a.addEventListener(l,f,!1)}function Zf(a,l,f,p,x){var T=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var L=p.tag;if(L===3||L===4){var M=p.stateNode.containerInfo;if(M===x||M.nodeType===8&&M.parentNode===x)break;if(L===4)for(L=p.return;L!==null;){var G=L.tag;if((G===3||G===4)&&(G=L.stateNode.containerInfo,G===x||G.nodeType===8&&G.parentNode===x))return;L=L.return}for(;M!==null;){if(L=xa(M),L===null)return;if(G=L.tag,G===5||G===6){p=T=L;continue e}M=M.parentNode}}p=p.return}Wr(function(){var re=T,ye=dn(f),xe=[];e:{var me=N0.get(a);if(me!==void 0){var ke=Ff,Fe=a;switch(a){case"keypress":if(lc(f)===0)break e;case"keydown":case"keyup":ke=x1;break;case"focusin":Fe="focus",ke=$f;break;case"focusout":Fe="blur",ke=$f;break;case"beforeblur":case"afterblur":ke=$f;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=d0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=o1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=T1;break;case C0:case D0:case P0:ke=c1;break;case O0:ke=w1;break;case"scroll":ke=i1;break;case"wheel":ke=I1;break;case"copy":case"cut":case"paste":ke=f1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=h0}var $e=(l&4)!==0,hr=!$e&&a==="scroll",J=$e?me!==null?me+"Capture":null:me;$e=[];for(var K=re,ee;K!==null;){ee=K;var Se=ee.stateNode;if(ee.tag===5&&Se!==null&&(ee=Se,J!==null&&(Se=Yr(K,J),Se!=null&&$e.push(zl(K,Se,ee)))),hr)break;K=K.return}0<$e.length&&(me=new ke(me,Fe,null,f,ye),xe.push({event:me,listeners:$e}))}}if((l&7)===0){e:{if(me=a==="mouseover"||a==="pointerover",ke=a==="mouseout"||a==="pointerout",me&&f!==xs&&(Fe=f.relatedTarget||f.fromElement)&&(xa(Fe)||Fe[Hs]))break e;if((ke||me)&&(me=ye.window===ye?ye:(me=ye.ownerDocument)?me.defaultView||me.parentWindow:window,ke?(Fe=f.relatedTarget||f.toElement,ke=re,Fe=Fe?xa(Fe):null,Fe!==null&&(hr=Ne(Fe),Fe!==hr||Fe.tag!==5&&Fe.tag!==6)&&(Fe=null)):(ke=null,Fe=re),ke!==Fe)){if($e=d0,Se="onMouseLeave",J="onMouseEnter",K="mouse",(a==="pointerout"||a==="pointerover")&&($e=h0,Se="onPointerLeave",J="onPointerEnter",K="pointer"),hr=ke==null?me:vo(ke),ee=Fe==null?me:vo(Fe),me=new $e(Se,K+"leave",ke,f,ye),me.target=hr,me.relatedTarget=ee,Se=null,xa(ye)===re&&($e=new $e(J,K+"enter",Fe,f,ye),$e.target=ee,$e.relatedTarget=hr,Se=$e),hr=Se,ke&&Fe)t:{for($e=ke,J=Fe,K=0,ee=$e;ee;ee=go(ee))K++;for(ee=0,Se=J;Se;Se=go(Se))ee++;for(;0<K-ee;)$e=go($e),K--;for(;0<ee-K;)J=go(J),ee--;for(;K--;){if($e===J||J!==null&&$e===J.alternate)break t;$e=go($e),J=go(J)}$e=null}else $e=null;ke!==null&&$0(xe,me,ke,$e,!1),Fe!==null&&hr!==null&&$0(xe,hr,Fe,$e,!0)}}e:{if(me=re?vo(re):window,ke=me.nodeName&&me.nodeName.toLowerCase(),ke==="select"||ke==="input"&&me.type==="file")var Ke=P1;else if(x0(me))if(S0)Ke=F1;else{Ke=N1;var Ye=O1}else(ke=me.nodeName)&&ke.toLowerCase()==="input"&&(me.type==="checkbox"||me.type==="radio")&&(Ke=M1);if(Ke&&(Ke=Ke(a,re))){E0(xe,Ke,f,ye);break e}Ye&&Ye(a,me,re),a==="focusout"&&(Ye=me._wrapperState)&&Ye.controlled&&me.type==="number"&&Mr(me,"number",me.value)}switch(Ye=re?vo(re):window,a){case"focusin":(x0(Ye)||Ye.contentEditable==="true")&&(mo=Ye,zf=re,Gl=null);break;case"focusout":Gl=zf=mo=null;break;case"mousedown":Wf=!0;break;case"contextmenu":case"mouseup":case"dragend":Wf=!1,_0(xe,f,ye);break;case"selectionchange":if($1)break;case"keydown":case"keyup":_0(xe,f,ye)}var qe;if(Vf)e:{switch(a){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else ho?y0(a,f)&&(rt="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(rt="onCompositionStart");rt&&(m0&&f.locale!=="ko"&&(ho||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&ho&&(qe=u0()):(Si=ye,Mf="value"in Si?Si.value:Si.textContent,ho=!0)),Ye=pc(re,rt),0<Ye.length&&(rt=new f0(rt,a,null,f,ye),xe.push({event:rt,listeners:Ye}),qe?rt.data=qe:(qe=v0(f),qe!==null&&(rt.data=qe)))),(qe=L1?_1(a,f):k1(a,f))&&(re=pc(re,"onBeforeInput"),0<re.length&&(ye=new f0("onBeforeInput","beforeinput",null,f,ye),xe.push({event:ye,listeners:re}),ye.data=qe))}U0(xe,l)})}function zl(a,l,f){return{instance:a,listener:l,currentTarget:f}}function pc(a,l){for(var f=l+"Capture",p=[];a!==null;){var x=a,T=x.stateNode;x.tag===5&&T!==null&&(x=T,T=Yr(a,f),T!=null&&p.unshift(zl(a,T,x)),T=Yr(a,l),T!=null&&p.push(zl(a,T,x))),a=a.return}return p}function go(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function $0(a,l,f,p,x){for(var T=l._reactName,L=[];f!==null&&f!==p;){var M=f,G=M.alternate,re=M.stateNode;if(G!==null&&G===p)break;M.tag===5&&re!==null&&(M=re,x?(G=Yr(f,T),G!=null&&L.unshift(zl(f,G,M))):x||(G=Yr(f,T),G!=null&&L.push(zl(f,G,M)))),f=f.return}L.length!==0&&a.push({event:l,listeners:L})}var K1=/\r\n?/g,H1=/\u0000|\uFFFD/g;function j0(a){return(typeof a=="string"?a:""+a).replace(K1,`
`).replace(H1,"")}function gc(a,l,f){if(l=j0(l),j0(a)!==l&&f)throw Error(t(425))}function yc(){}var Jf=null,eh=null;function th(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var rh=typeof setTimeout=="function"?setTimeout:void 0,z1=typeof clearTimeout=="function"?clearTimeout:void 0,V0=typeof Promise=="function"?Promise:void 0,W1=typeof queueMicrotask=="function"?queueMicrotask:typeof V0<"u"?function(a){return V0.resolve(null).then(a).catch(Y1)}:rh;function Y1(a){setTimeout(function(){throw a})}function nh(a,l){var f=l,p=0;do{var x=f.nextSibling;if(a.removeChild(f),x&&x.nodeType===8)if(f=x.data,f==="/$"){if(p===0){a.removeChild(x),Ml(l);return}p--}else f!=="$"&&f!=="$?"&&f!=="$!"||p++;f=x}while(f);Ml(l)}function bi(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function G0(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return a;l--}else f==="/$"&&l++}a=a.previousSibling}return null}var yo=Math.random().toString(36).slice(2),Ss="__reactFiber$"+yo,Wl="__reactProps$"+yo,Hs="__reactContainer$"+yo,sh="__reactEvents$"+yo,q1="__reactListeners$"+yo,Q1="__reactHandles$"+yo;function xa(a){var l=a[Ss];if(l)return l;for(var f=a.parentNode;f;){if(l=f[Hs]||f[Ss]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(a=G0(a);a!==null;){if(f=a[Ss])return f;a=G0(a)}return l}a=f,f=a.parentNode}return null}function Yl(a){return a=a[Ss]||a[Hs],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function vo(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function vc(a){return a[Wl]||null}var ih=[],xo=-1;function wi(a){return{current:a}}function Zt(a){0>xo||(a.current=ih[xo],ih[xo]=null,xo--)}function Yt(a,l){xo++,ih[xo]=a.current,a.current=l}var Ai={},qr=wi(Ai),hn=wi(!1),Ea=Ai;function Eo(a,l){var f=a.type.contextTypes;if(!f)return Ai;var p=a.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===l)return p.__reactInternalMemoizedMaskedChildContext;var x={},T;for(T in f)x[T]=l[T];return p&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=x),x}function mn(a){return a=a.childContextTypes,a!=null}function xc(){Zt(hn),Zt(qr)}function K0(a,l,f){if(qr.current!==Ai)throw Error(t(168));Yt(qr,l),Yt(hn,f)}function H0(a,l,f){var p=a.stateNode;if(l=l.childContextTypes,typeof p.getChildContext!="function")return f;p=p.getChildContext();for(var x in p)if(!(x in l))throw Error(t(108,Ie(a)||"Unknown",x));return ne({},f,p)}function Ec(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ai,Ea=qr.current,Yt(qr,a),Yt(hn,hn.current),!0}function z0(a,l,f){var p=a.stateNode;if(!p)throw Error(t(169));f?(a=H0(a,l,Ea),p.__reactInternalMemoizedMergedChildContext=a,Zt(hn),Zt(qr),Yt(qr,a)):Zt(hn),Yt(hn,f)}var zs=null,Sc=!1,ah=!1;function W0(a){zs===null?zs=[a]:zs.push(a)}function X1(a){Sc=!0,W0(a)}function Ii(){if(!ah&&zs!==null){ah=!0;var a=0,l=Mt;try{var f=zs;for(Mt=1;a<f.length;a++){var p=f[a];do p=p(!0);while(p!==null)}zs=null,Sc=!1}catch(x){throw zs!==null&&(zs=zs.slice(a+1)),Qt(Gs,Ii),x}finally{Mt=l,ah=!1}}return null}var So=[],To=0,Tc=null,bc=0,jn=[],Vn=0,Sa=null,Ws=1,Ys="";function Ta(a,l){So[To++]=bc,So[To++]=Tc,Tc=a,bc=l}function Y0(a,l,f){jn[Vn++]=Ws,jn[Vn++]=Ys,jn[Vn++]=Sa,Sa=a;var p=Ws;a=Ys;var x=32-Lt(p)-1;p&=~(1<<x),f+=1;var T=32-Lt(l)+x;if(30<T){var L=x-x%5;T=(p&(1<<L)-1).toString(32),p>>=L,x-=L,Ws=1<<32-Lt(l)+x|f<<x|p,Ys=T+a}else Ws=1<<T|f<<x|p,Ys=a}function oh(a){a.return!==null&&(Ta(a,1),Y0(a,1,0))}function lh(a){for(;a===Tc;)Tc=So[--To],So[To]=null,bc=So[--To],So[To]=null;for(;a===Sa;)Sa=jn[--Vn],jn[Vn]=null,Ys=jn[--Vn],jn[Vn]=null,Ws=jn[--Vn],jn[Vn]=null}var _n=null,kn=null,tr=!1,rs=null;function q0(a,l){var f=zn(5,null,null,0);f.elementType="DELETED",f.stateNode=l,f.return=a,l=a.deletions,l===null?(a.deletions=[f],a.flags|=16):l.push(f)}function Q0(a,l){switch(a.tag){case 5:var f=a.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,_n=a,kn=bi(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,_n=a,kn=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(f=Sa!==null?{id:Ws,overflow:Ys}:null,a.memoizedState={dehydrated:l,treeContext:f,retryLane:1073741824},f=zn(18,null,null,0),f.stateNode=l,f.return=a,a.child=f,_n=a,kn=null,!0):!1;default:return!1}}function uh(a){return(a.mode&1)!==0&&(a.flags&128)===0}function ch(a){if(tr){var l=kn;if(l){var f=l;if(!Q0(a,l)){if(uh(a))throw Error(t(418));l=bi(f.nextSibling);var p=_n;l&&Q0(a,l)?q0(p,f):(a.flags=a.flags&-4097|2,tr=!1,_n=a)}}else{if(uh(a))throw Error(t(418));a.flags=a.flags&-4097|2,tr=!1,_n=a}}}function X0(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;_n=a}function wc(a){if(a!==_n)return!1;if(!tr)return X0(a),tr=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!th(a.type,a.memoizedProps)),l&&(l=kn)){if(uh(a))throw Z0(),Error(t(418));for(;l;)q0(a,l),l=bi(l.nextSibling)}if(X0(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"){if(l===0){kn=bi(a.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}a=a.nextSibling}kn=null}}else kn=_n?bi(a.stateNode.nextSibling):null;return!0}function Z0(){for(var a=kn;a;)a=bi(a.nextSibling)}function bo(){kn=_n=null,tr=!1}function dh(a){rs===null?rs=[a]:rs.push(a)}var Z1=k.ReactCurrentBatchConfig;function ql(a,l,f){if(a=f.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(t(309));var p=f.stateNode}if(!p)throw Error(t(147,a));var x=p,T=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===T?l.ref:(l=function(L){var M=x.refs;L===null?delete M[T]:M[T]=L},l._stringRef=T,l)}if(typeof a!="string")throw Error(t(284));if(!f._owner)throw Error(t(290,a))}return a}function Ac(a,l){throw a=Object.prototype.toString.call(l),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function J0(a){var l=a._init;return l(a._payload)}function ey(a){function l(J,K){if(a){var ee=J.deletions;ee===null?(J.deletions=[K],J.flags|=16):ee.push(K)}}function f(J,K){if(!a)return null;for(;K!==null;)l(J,K),K=K.sibling;return null}function p(J,K){for(J=new Map;K!==null;)K.key!==null?J.set(K.key,K):J.set(K.index,K),K=K.sibling;return J}function x(J,K){return J=Oi(J,K),J.index=0,J.sibling=null,J}function T(J,K,ee){return J.index=ee,a?(ee=J.alternate,ee!==null?(ee=ee.index,ee<K?(J.flags|=2,K):ee):(J.flags|=2,K)):(J.flags|=1048576,K)}function L(J){return a&&J.alternate===null&&(J.flags|=2),J}function M(J,K,ee,Se){return K===null||K.tag!==6?(K=rm(ee,J.mode,Se),K.return=J,K):(K=x(K,ee),K.return=J,K)}function G(J,K,ee,Se){var Ke=ee.type;return Ke===_?ye(J,K,ee.props.children,Se,ee.key):K!==null&&(K.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===ae&&J0(Ke)===K.type)?(Se=x(K,ee.props),Se.ref=ql(J,K,ee),Se.return=J,Se):(Se=qc(ee.type,ee.key,ee.props,null,J.mode,Se),Se.ref=ql(J,K,ee),Se.return=J,Se)}function re(J,K,ee,Se){return K===null||K.tag!==4||K.stateNode.containerInfo!==ee.containerInfo||K.stateNode.implementation!==ee.implementation?(K=nm(ee,J.mode,Se),K.return=J,K):(K=x(K,ee.children||[]),K.return=J,K)}function ye(J,K,ee,Se,Ke){return K===null||K.tag!==7?(K=ka(ee,J.mode,Se,Ke),K.return=J,K):(K=x(K,ee),K.return=J,K)}function xe(J,K,ee){if(typeof K=="string"&&K!==""||typeof K=="number")return K=rm(""+K,J.mode,ee),K.return=J,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case C:return ee=qc(K.type,K.key,K.props,null,J.mode,ee),ee.ref=ql(J,null,K),ee.return=J,ee;case V:return K=nm(K,J.mode,ee),K.return=J,K;case ae:var Se=K._init;return xe(J,Se(K._payload),ee)}if(qt(K)||Z(K))return K=ka(K,J.mode,ee,null),K.return=J,K;Ac(J,K)}return null}function me(J,K,ee,Se){var Ke=K!==null?K.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return Ke!==null?null:M(J,K,""+ee,Se);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case C:return ee.key===Ke?G(J,K,ee,Se):null;case V:return ee.key===Ke?re(J,K,ee,Se):null;case ae:return Ke=ee._init,me(J,K,Ke(ee._payload),Se)}if(qt(ee)||Z(ee))return Ke!==null?null:ye(J,K,ee,Se,null);Ac(J,ee)}return null}function ke(J,K,ee,Se,Ke){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return J=J.get(ee)||null,M(K,J,""+Se,Ke);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case C:return J=J.get(Se.key===null?ee:Se.key)||null,G(K,J,Se,Ke);case V:return J=J.get(Se.key===null?ee:Se.key)||null,re(K,J,Se,Ke);case ae:var Ye=Se._init;return ke(J,K,ee,Ye(Se._payload),Ke)}if(qt(Se)||Z(Se))return J=J.get(ee)||null,ye(K,J,Se,Ke,null);Ac(K,Se)}return null}function Fe(J,K,ee,Se){for(var Ke=null,Ye=null,qe=K,rt=K=0,Pr=null;qe!==null&&rt<ee.length;rt++){qe.index>rt?(Pr=qe,qe=null):Pr=qe.sibling;var _t=me(J,qe,ee[rt],Se);if(_t===null){qe===null&&(qe=Pr);break}a&&qe&&_t.alternate===null&&l(J,qe),K=T(_t,K,rt),Ye===null?Ke=_t:Ye.sibling=_t,Ye=_t,qe=Pr}if(rt===ee.length)return f(J,qe),tr&&Ta(J,rt),Ke;if(qe===null){for(;rt<ee.length;rt++)qe=xe(J,ee[rt],Se),qe!==null&&(K=T(qe,K,rt),Ye===null?Ke=qe:Ye.sibling=qe,Ye=qe);return tr&&Ta(J,rt),Ke}for(qe=p(J,qe);rt<ee.length;rt++)Pr=ke(qe,J,rt,ee[rt],Se),Pr!==null&&(a&&Pr.alternate!==null&&qe.delete(Pr.key===null?rt:Pr.key),K=T(Pr,K,rt),Ye===null?Ke=Pr:Ye.sibling=Pr,Ye=Pr);return a&&qe.forEach(function(Ni){return l(J,Ni)}),tr&&Ta(J,rt),Ke}function $e(J,K,ee,Se){var Ke=Z(ee);if(typeof Ke!="function")throw Error(t(150));if(ee=Ke.call(ee),ee==null)throw Error(t(151));for(var Ye=Ke=null,qe=K,rt=K=0,Pr=null,_t=ee.next();qe!==null&&!_t.done;rt++,_t=ee.next()){qe.index>rt?(Pr=qe,qe=null):Pr=qe.sibling;var Ni=me(J,qe,_t.value,Se);if(Ni===null){qe===null&&(qe=Pr);break}a&&qe&&Ni.alternate===null&&l(J,qe),K=T(Ni,K,rt),Ye===null?Ke=Ni:Ye.sibling=Ni,Ye=Ni,qe=Pr}if(_t.done)return f(J,qe),tr&&Ta(J,rt),Ke;if(qe===null){for(;!_t.done;rt++,_t=ee.next())_t=xe(J,_t.value,Se),_t!==null&&(K=T(_t,K,rt),Ye===null?Ke=_t:Ye.sibling=_t,Ye=_t);return tr&&Ta(J,rt),Ke}for(qe=p(J,qe);!_t.done;rt++,_t=ee.next())_t=ke(qe,J,rt,_t.value,Se),_t!==null&&(a&&_t.alternate!==null&&qe.delete(_t.key===null?rt:_t.key),K=T(_t,K,rt),Ye===null?Ke=_t:Ye.sibling=_t,Ye=_t);return a&&qe.forEach(function(CA){return l(J,CA)}),tr&&Ta(J,rt),Ke}function hr(J,K,ee,Se){if(typeof ee=="object"&&ee!==null&&ee.type===_&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case C:e:{for(var Ke=ee.key,Ye=K;Ye!==null;){if(Ye.key===Ke){if(Ke=ee.type,Ke===_){if(Ye.tag===7){f(J,Ye.sibling),K=x(Ye,ee.props.children),K.return=J,J=K;break e}}else if(Ye.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===ae&&J0(Ke)===Ye.type){f(J,Ye.sibling),K=x(Ye,ee.props),K.ref=ql(J,Ye,ee),K.return=J,J=K;break e}f(J,Ye);break}else l(J,Ye);Ye=Ye.sibling}ee.type===_?(K=ka(ee.props.children,J.mode,Se,ee.key),K.return=J,J=K):(Se=qc(ee.type,ee.key,ee.props,null,J.mode,Se),Se.ref=ql(J,K,ee),Se.return=J,J=Se)}return L(J);case V:e:{for(Ye=ee.key;K!==null;){if(K.key===Ye)if(K.tag===4&&K.stateNode.containerInfo===ee.containerInfo&&K.stateNode.implementation===ee.implementation){f(J,K.sibling),K=x(K,ee.children||[]),K.return=J,J=K;break e}else{f(J,K);break}else l(J,K);K=K.sibling}K=nm(ee,J.mode,Se),K.return=J,J=K}return L(J);case ae:return Ye=ee._init,hr(J,K,Ye(ee._payload),Se)}if(qt(ee))return Fe(J,K,ee,Se);if(Z(ee))return $e(J,K,ee,Se);Ac(J,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,K!==null&&K.tag===6?(f(J,K.sibling),K=x(K,ee),K.return=J,J=K):(f(J,K),K=rm(ee,J.mode,Se),K.return=J,J=K),L(J)):f(J,K)}return hr}var wo=ey(!0),ty=ey(!1),Ic=wi(null),Rc=null,Ao=null,fh=null;function hh(){fh=Ao=Rc=null}function mh(a){var l=Ic.current;Zt(Ic),a._currentValue=l}function ph(a,l,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),a===f)break;a=a.return}}function Io(a,l){Rc=a,fh=Ao=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(pn=!0),a.firstContext=null)}function Gn(a){var l=a._currentValue;if(fh!==a)if(a={context:a,memoizedValue:l,next:null},Ao===null){if(Rc===null)throw Error(t(308));Ao=a,Rc.dependencies={lanes:0,firstContext:a}}else Ao=Ao.next=a;return l}var ba=null;function gh(a){ba===null?ba=[a]:ba.push(a)}function ry(a,l,f,p){var x=l.interleaved;return x===null?(f.next=f,gh(l)):(f.next=x.next,x.next=f),l.interleaved=f,qs(a,p)}function qs(a,l){a.lanes|=l;var f=a.alternate;for(f!==null&&(f.lanes|=l),f=a,a=a.return;a!==null;)a.childLanes|=l,f=a.alternate,f!==null&&(f.childLanes|=l),f=a,a=a.return;return f.tag===3?f.stateNode:null}var Ri=!1;function yh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ny(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Qs(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function Li(a,l,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(bt&2)!==0){var x=p.pending;return x===null?l.next=l:(l.next=x.next,x.next=l),p.pending=l,qs(a,f)}return x=p.interleaved,x===null?(l.next=l,gh(p)):(l.next=x.next,x.next=l),p.interleaved=l,qs(a,f)}function Lc(a,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194240)!==0)){var p=l.lanes;p&=a.pendingLanes,f|=p,l.lanes=f,Cf(a,f)}}function sy(a,l){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var x=null,T=null;if(f=f.firstBaseUpdate,f!==null){do{var L={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};T===null?x=T=L:T=T.next=L,f=f.next}while(f!==null);T===null?x=T=l:T=T.next=l}else x=T=l;f={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:p.shared,effects:p.effects},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=l:a.next=l,f.lastBaseUpdate=l}function _c(a,l,f,p){var x=a.updateQueue;Ri=!1;var T=x.firstBaseUpdate,L=x.lastBaseUpdate,M=x.shared.pending;if(M!==null){x.shared.pending=null;var G=M,re=G.next;G.next=null,L===null?T=re:L.next=re,L=G;var ye=a.alternate;ye!==null&&(ye=ye.updateQueue,M=ye.lastBaseUpdate,M!==L&&(M===null?ye.firstBaseUpdate=re:M.next=re,ye.lastBaseUpdate=G))}if(T!==null){var xe=x.baseState;L=0,ye=re=G=null,M=T;do{var me=M.lane,ke=M.eventTime;if((p&me)===me){ye!==null&&(ye=ye.next={eventTime:ke,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var Fe=a,$e=M;switch(me=l,ke=f,$e.tag){case 1:if(Fe=$e.payload,typeof Fe=="function"){xe=Fe.call(ke,xe,me);break e}xe=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=$e.payload,me=typeof Fe=="function"?Fe.call(ke,xe,me):Fe,me==null)break e;xe=ne({},xe,me);break e;case 2:Ri=!0}}M.callback!==null&&M.lane!==0&&(a.flags|=64,me=x.effects,me===null?x.effects=[M]:me.push(M))}else ke={eventTime:ke,lane:me,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ye===null?(re=ye=ke,G=xe):ye=ye.next=ke,L|=me;if(M=M.next,M===null){if(M=x.shared.pending,M===null)break;me=M,M=me.next,me.next=null,x.lastBaseUpdate=me,x.shared.pending=null}}while(!0);if(ye===null&&(G=xe),x.baseState=G,x.firstBaseUpdate=re,x.lastBaseUpdate=ye,l=x.shared.interleaved,l!==null){x=l;do L|=x.lane,x=x.next;while(x!==l)}else T===null&&(x.shared.lanes=0);Ia|=L,a.lanes=L,a.memoizedState=xe}}function iy(a,l,f){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var p=a[l],x=p.callback;if(x!==null){if(p.callback=null,p=f,typeof x!="function")throw Error(t(191,x));x.call(p)}}}var Ql={},Ts=wi(Ql),Xl=wi(Ql),Zl=wi(Ql);function wa(a){if(a===Ql)throw Error(t(174));return a}function vh(a,l){switch(Yt(Zl,l),Yt(Xl,a),Yt(Ts,Ql),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:_e(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=_e(l,a)}Zt(Ts),Yt(Ts,l)}function Ro(){Zt(Ts),Zt(Xl),Zt(Zl)}function ay(a){wa(Zl.current);var l=wa(Ts.current),f=_e(l,a.type);l!==f&&(Yt(Xl,a),Yt(Ts,f))}function xh(a){Xl.current===a&&(Zt(Ts),Zt(Xl))}var sr=wi(0);function kc(a){for(var l=a;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Eh=[];function Sh(){for(var a=0;a<Eh.length;a++)Eh[a]._workInProgressVersionPrimary=null;Eh.length=0}var Cc=k.ReactCurrentDispatcher,Th=k.ReactCurrentBatchConfig,Aa=0,ir=null,Ar=null,Cr=null,Dc=!1,Jl=!1,eu=0,J1=0;function Qr(){throw Error(t(321))}function bh(a,l){if(l===null)return!1;for(var f=0;f<l.length&&f<a.length;f++)if(!ts(a[f],l[f]))return!1;return!0}function wh(a,l,f,p,x,T){if(Aa=T,ir=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Cc.current=a===null||a.memoizedState===null?nA:sA,a=f(p,x),Jl){T=0;do{if(Jl=!1,eu=0,25<=T)throw Error(t(301));T+=1,Cr=Ar=null,l.updateQueue=null,Cc.current=iA,a=f(p,x)}while(Jl)}if(Cc.current=Nc,l=Ar!==null&&Ar.next!==null,Aa=0,Cr=Ar=ir=null,Dc=!1,l)throw Error(t(300));return a}function Ah(){var a=eu!==0;return eu=0,a}function bs(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cr===null?ir.memoizedState=Cr=a:Cr=Cr.next=a,Cr}function Kn(){if(Ar===null){var a=ir.alternate;a=a!==null?a.memoizedState:null}else a=Ar.next;var l=Cr===null?ir.memoizedState:Cr.next;if(l!==null)Cr=l,Ar=a;else{if(a===null)throw Error(t(310));Ar=a,a={memoizedState:Ar.memoizedState,baseState:Ar.baseState,baseQueue:Ar.baseQueue,queue:Ar.queue,next:null},Cr===null?ir.memoizedState=Cr=a:Cr=Cr.next=a}return Cr}function tu(a,l){return typeof l=="function"?l(a):l}function Ih(a){var l=Kn(),f=l.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=a;var p=Ar,x=p.baseQueue,T=f.pending;if(T!==null){if(x!==null){var L=x.next;x.next=T.next,T.next=L}p.baseQueue=x=T,f.pending=null}if(x!==null){T=x.next,p=p.baseState;var M=L=null,G=null,re=T;do{var ye=re.lane;if((Aa&ye)===ye)G!==null&&(G=G.next={lane:0,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),p=re.hasEagerState?re.eagerState:a(p,re.action);else{var xe={lane:ye,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null};G===null?(M=G=xe,L=p):G=G.next=xe,ir.lanes|=ye,Ia|=ye}re=re.next}while(re!==null&&re!==T);G===null?L=p:G.next=M,ts(p,l.memoizedState)||(pn=!0),l.memoizedState=p,l.baseState=L,l.baseQueue=G,f.lastRenderedState=p}if(a=f.interleaved,a!==null){x=a;do T=x.lane,ir.lanes|=T,Ia|=T,x=x.next;while(x!==a)}else x===null&&(f.lanes=0);return[l.memoizedState,f.dispatch]}function Rh(a){var l=Kn(),f=l.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=a;var p=f.dispatch,x=f.pending,T=l.memoizedState;if(x!==null){f.pending=null;var L=x=x.next;do T=a(T,L.action),L=L.next;while(L!==x);ts(T,l.memoizedState)||(pn=!0),l.memoizedState=T,l.baseQueue===null&&(l.baseState=T),f.lastRenderedState=T}return[T,p]}function oy(){}function ly(a,l){var f=ir,p=Kn(),x=l(),T=!ts(p.memoizedState,x);if(T&&(p.memoizedState=x,pn=!0),p=p.queue,Lh(dy.bind(null,f,p,a),[a]),p.getSnapshot!==l||T||Cr!==null&&Cr.memoizedState.tag&1){if(f.flags|=2048,ru(9,cy.bind(null,f,p,x,l),void 0,null),Dr===null)throw Error(t(349));(Aa&30)!==0||uy(f,l,x)}return x}function uy(a,l,f){a.flags|=16384,a={getSnapshot:l,value:f},l=ir.updateQueue,l===null?(l={lastEffect:null,stores:null},ir.updateQueue=l,l.stores=[a]):(f=l.stores,f===null?l.stores=[a]:f.push(a))}function cy(a,l,f,p){l.value=f,l.getSnapshot=p,fy(l)&&hy(a)}function dy(a,l,f){return f(function(){fy(l)&&hy(a)})}function fy(a){var l=a.getSnapshot;a=a.value;try{var f=l();return!ts(a,f)}catch{return!0}}function hy(a){var l=qs(a,1);l!==null&&as(l,a,1,-1)}function my(a){var l=bs();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tu,lastRenderedState:a},l.queue=a,a=a.dispatch=rA.bind(null,ir,a),[l.memoizedState,a]}function ru(a,l,f,p){return a={tag:a,create:l,destroy:f,deps:p,next:null},l=ir.updateQueue,l===null?(l={lastEffect:null,stores:null},ir.updateQueue=l,l.lastEffect=a.next=a):(f=l.lastEffect,f===null?l.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,l.lastEffect=a)),a}function py(){return Kn().memoizedState}function Pc(a,l,f,p){var x=bs();ir.flags|=a,x.memoizedState=ru(1|l,f,void 0,p===void 0?null:p)}function Oc(a,l,f,p){var x=Kn();p=p===void 0?null:p;var T=void 0;if(Ar!==null){var L=Ar.memoizedState;if(T=L.destroy,p!==null&&bh(p,L.deps)){x.memoizedState=ru(l,f,T,p);return}}ir.flags|=a,x.memoizedState=ru(1|l,f,T,p)}function gy(a,l){return Pc(8390656,8,a,l)}function Lh(a,l){return Oc(2048,8,a,l)}function yy(a,l){return Oc(4,2,a,l)}function vy(a,l){return Oc(4,4,a,l)}function xy(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Ey(a,l,f){return f=f!=null?f.concat([a]):null,Oc(4,4,xy.bind(null,l,a),f)}function _h(){}function Sy(a,l){var f=Kn();l=l===void 0?null:l;var p=f.memoizedState;return p!==null&&l!==null&&bh(l,p[1])?p[0]:(f.memoizedState=[a,l],a)}function Ty(a,l){var f=Kn();l=l===void 0?null:l;var p=f.memoizedState;return p!==null&&l!==null&&bh(l,p[1])?p[0]:(a=a(),f.memoizedState=[a,l],a)}function by(a,l,f){return(Aa&21)===0?(a.baseState&&(a.baseState=!1,pn=!0),a.memoizedState=f):(ts(f,l)||(f=Jg(),ir.lanes|=f,Ia|=f,a.baseState=!0),l)}function eA(a,l){var f=Mt;Mt=f!==0&&4>f?f:4,a(!0);var p=Th.transition;Th.transition={};try{a(!1),l()}finally{Mt=f,Th.transition=p}}function wy(){return Kn().memoizedState}function tA(a,l,f){var p=Di(a);if(f={lane:p,action:f,hasEagerState:!1,eagerState:null,next:null},Ay(a))Iy(l,f);else if(f=ry(a,l,f,p),f!==null){var x=nn();as(f,a,p,x),Ry(f,l,p)}}function rA(a,l,f){var p=Di(a),x={lane:p,action:f,hasEagerState:!1,eagerState:null,next:null};if(Ay(a))Iy(l,x);else{var T=a.alternate;if(a.lanes===0&&(T===null||T.lanes===0)&&(T=l.lastRenderedReducer,T!==null))try{var L=l.lastRenderedState,M=T(L,f);if(x.hasEagerState=!0,x.eagerState=M,ts(M,L)){var G=l.interleaved;G===null?(x.next=x,gh(l)):(x.next=G.next,G.next=x),l.interleaved=x;return}}catch{}finally{}f=ry(a,l,x,p),f!==null&&(x=nn(),as(f,a,p,x),Ry(f,l,p))}}function Ay(a){var l=a.alternate;return a===ir||l!==null&&l===ir}function Iy(a,l){Jl=Dc=!0;var f=a.pending;f===null?l.next=l:(l.next=f.next,f.next=l),a.pending=l}function Ry(a,l,f){if((f&4194240)!==0){var p=l.lanes;p&=a.pendingLanes,f|=p,l.lanes=f,Cf(a,f)}}var Nc={readContext:Gn,useCallback:Qr,useContext:Qr,useEffect:Qr,useImperativeHandle:Qr,useInsertionEffect:Qr,useLayoutEffect:Qr,useMemo:Qr,useReducer:Qr,useRef:Qr,useState:Qr,useDebugValue:Qr,useDeferredValue:Qr,useTransition:Qr,useMutableSource:Qr,useSyncExternalStore:Qr,useId:Qr,unstable_isNewReconciler:!1},nA={readContext:Gn,useCallback:function(a,l){return bs().memoizedState=[a,l===void 0?null:l],a},useContext:Gn,useEffect:gy,useImperativeHandle:function(a,l,f){return f=f!=null?f.concat([a]):null,Pc(4194308,4,xy.bind(null,l,a),f)},useLayoutEffect:function(a,l){return Pc(4194308,4,a,l)},useInsertionEffect:function(a,l){return Pc(4,2,a,l)},useMemo:function(a,l){var f=bs();return l=l===void 0?null:l,a=a(),f.memoizedState=[a,l],a},useReducer:function(a,l,f){var p=bs();return l=f!==void 0?f(l):l,p.memoizedState=p.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},p.queue=a,a=a.dispatch=tA.bind(null,ir,a),[p.memoizedState,a]},useRef:function(a){var l=bs();return a={current:a},l.memoizedState=a},useState:my,useDebugValue:_h,useDeferredValue:function(a){return bs().memoizedState=a},useTransition:function(){var a=my(!1),l=a[0];return a=eA.bind(null,a[1]),bs().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,f){var p=ir,x=bs();if(tr){if(f===void 0)throw Error(t(407));f=f()}else{if(f=l(),Dr===null)throw Error(t(349));(Aa&30)!==0||uy(p,l,f)}x.memoizedState=f;var T={value:f,getSnapshot:l};return x.queue=T,gy(dy.bind(null,p,T,a),[a]),p.flags|=2048,ru(9,cy.bind(null,p,T,f,l),void 0,null),f},useId:function(){var a=bs(),l=Dr.identifierPrefix;if(tr){var f=Ys,p=Ws;f=(p&~(1<<32-Lt(p)-1)).toString(32)+f,l=":"+l+"R"+f,f=eu++,0<f&&(l+="H"+f.toString(32)),l+=":"}else f=J1++,l=":"+l+"r"+f.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},sA={readContext:Gn,useCallback:Sy,useContext:Gn,useEffect:Lh,useImperativeHandle:Ey,useInsertionEffect:yy,useLayoutEffect:vy,useMemo:Ty,useReducer:Ih,useRef:py,useState:function(){return Ih(tu)},useDebugValue:_h,useDeferredValue:function(a){var l=Kn();return by(l,Ar.memoizedState,a)},useTransition:function(){var a=Ih(tu)[0],l=Kn().memoizedState;return[a,l]},useMutableSource:oy,useSyncExternalStore:ly,useId:wy,unstable_isNewReconciler:!1},iA={readContext:Gn,useCallback:Sy,useContext:Gn,useEffect:Lh,useImperativeHandle:Ey,useInsertionEffect:yy,useLayoutEffect:vy,useMemo:Ty,useReducer:Rh,useRef:py,useState:function(){return Rh(tu)},useDebugValue:_h,useDeferredValue:function(a){var l=Kn();return Ar===null?l.memoizedState=a:by(l,Ar.memoizedState,a)},useTransition:function(){var a=Rh(tu)[0],l=Kn().memoizedState;return[a,l]},useMutableSource:oy,useSyncExternalStore:ly,useId:wy,unstable_isNewReconciler:!1};function ns(a,l){if(a&&a.defaultProps){l=ne({},l),a=a.defaultProps;for(var f in a)l[f]===void 0&&(l[f]=a[f]);return l}return l}function kh(a,l,f,p){l=a.memoizedState,f=f(p,l),f=f==null?l:ne({},l,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var Mc={isMounted:function(a){return(a=a._reactInternals)?Ne(a)===a:!1},enqueueSetState:function(a,l,f){a=a._reactInternals;var p=nn(),x=Di(a),T=Qs(p,x);T.payload=l,f!=null&&(T.callback=f),l=Li(a,T,x),l!==null&&(as(l,a,x,p),Lc(l,a,x))},enqueueReplaceState:function(a,l,f){a=a._reactInternals;var p=nn(),x=Di(a),T=Qs(p,x);T.tag=1,T.payload=l,f!=null&&(T.callback=f),l=Li(a,T,x),l!==null&&(as(l,a,x,p),Lc(l,a,x))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var f=nn(),p=Di(a),x=Qs(f,p);x.tag=2,l!=null&&(x.callback=l),l=Li(a,x,p),l!==null&&(as(l,a,p,f),Lc(l,a,p))}};function Ly(a,l,f,p,x,T,L){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,T,L):l.prototype&&l.prototype.isPureReactComponent?!Vl(f,p)||!Vl(x,T):!0}function _y(a,l,f){var p=!1,x=Ai,T=l.contextType;return typeof T=="object"&&T!==null?T=Gn(T):(x=mn(l)?Ea:qr.current,p=l.contextTypes,T=(p=p!=null)?Eo(a,x):Ai),l=new l(f,T),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Mc,a.stateNode=l,l._reactInternals=a,p&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=x,a.__reactInternalMemoizedMaskedChildContext=T),l}function ky(a,l,f,p){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,p),l.state!==a&&Mc.enqueueReplaceState(l,l.state,null)}function Ch(a,l,f,p){var x=a.stateNode;x.props=f,x.state=a.memoizedState,x.refs={},yh(a);var T=l.contextType;typeof T=="object"&&T!==null?x.context=Gn(T):(T=mn(l)?Ea:qr.current,x.context=Eo(a,T)),x.state=a.memoizedState,T=l.getDerivedStateFromProps,typeof T=="function"&&(kh(a,l,T,f),x.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(l=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),l!==x.state&&Mc.enqueueReplaceState(x,x.state,null),_c(a,f,x,p),x.state=a.memoizedState),typeof x.componentDidMount=="function"&&(a.flags|=4194308)}function Lo(a,l){try{var f="",p=l;do f+=ge(p),p=p.return;while(p);var x=f}catch(T){x=`
Error generating stack: `+T.message+`
`+T.stack}return{value:a,source:l,stack:x,digest:null}}function Dh(a,l,f){return{value:a,source:null,stack:f??null,digest:l??null}}function Ph(a,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var aA=typeof WeakMap=="function"?WeakMap:Map;function Cy(a,l,f){f=Qs(-1,f),f.tag=3,f.payload={element:null};var p=l.value;return f.callback=function(){Gc||(Gc=!0,Yh=p),Ph(a,l)},f}function Dy(a,l,f){f=Qs(-1,f),f.tag=3;var p=a.type.getDerivedStateFromError;if(typeof p=="function"){var x=l.value;f.payload=function(){return p(x)},f.callback=function(){Ph(a,l)}}var T=a.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(f.callback=function(){Ph(a,l),typeof p!="function"&&(ki===null?ki=new Set([this]):ki.add(this));var L=l.stack;this.componentDidCatch(l.value,{componentStack:L!==null?L:""})}),f}function Py(a,l,f){var p=a.pingCache;if(p===null){p=a.pingCache=new aA;var x=new Set;p.set(l,x)}else x=p.get(l),x===void 0&&(x=new Set,p.set(l,x));x.has(f)||(x.add(f),a=EA.bind(null,a,l,f),l.then(a,a))}function Oy(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function Ny(a,l,f,p,x){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(l=Qs(-1,1),l.tag=2,Li(f,l,1))),f.lanes|=1),a):(a.flags|=65536,a.lanes=x,a)}var oA=k.ReactCurrentOwner,pn=!1;function rn(a,l,f,p){l.child=a===null?ty(l,null,f,p):wo(l,a.child,f,p)}function My(a,l,f,p,x){f=f.render;var T=l.ref;return Io(l,x),p=wh(a,l,f,p,T,x),f=Ah(),a!==null&&!pn?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~x,Xs(a,l,x)):(tr&&f&&oh(l),l.flags|=1,rn(a,l,p,x),l.child)}function Fy(a,l,f,p,x){if(a===null){var T=f.type;return typeof T=="function"&&!tm(T)&&T.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=T,Uy(a,l,T,p,x)):(a=qc(f.type,null,p,l,l.mode,x),a.ref=l.ref,a.return=l,l.child=a)}if(T=a.child,(a.lanes&x)===0){var L=T.memoizedProps;if(f=f.compare,f=f!==null?f:Vl,f(L,p)&&a.ref===l.ref)return Xs(a,l,x)}return l.flags|=1,a=Oi(T,p),a.ref=l.ref,a.return=l,l.child=a}function Uy(a,l,f,p,x){if(a!==null){var T=a.memoizedProps;if(Vl(T,p)&&a.ref===l.ref)if(pn=!1,l.pendingProps=p=T,(a.lanes&x)!==0)(a.flags&131072)!==0&&(pn=!0);else return l.lanes=a.lanes,Xs(a,l,x)}return Oh(a,l,f,p,x)}function By(a,l,f){var p=l.pendingProps,x=p.children,T=a!==null?a.memoizedState:null;if(p.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(ko,Cn),Cn|=f;else{if((f&1073741824)===0)return a=T!==null?T.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,Yt(ko,Cn),Cn|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=T!==null?T.baseLanes:f,Yt(ko,Cn),Cn|=p}else T!==null?(p=T.baseLanes|f,l.memoizedState=null):p=f,Yt(ko,Cn),Cn|=p;return rn(a,l,x,f),l.child}function $y(a,l){var f=l.ref;(a===null&&f!==null||a!==null&&a.ref!==f)&&(l.flags|=512,l.flags|=2097152)}function Oh(a,l,f,p,x){var T=mn(f)?Ea:qr.current;return T=Eo(l,T),Io(l,x),f=wh(a,l,f,p,T,x),p=Ah(),a!==null&&!pn?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~x,Xs(a,l,x)):(tr&&p&&oh(l),l.flags|=1,rn(a,l,f,x),l.child)}function jy(a,l,f,p,x){if(mn(f)){var T=!0;Ec(l)}else T=!1;if(Io(l,x),l.stateNode===null)Uc(a,l),_y(l,f,p),Ch(l,f,p,x),p=!0;else if(a===null){var L=l.stateNode,M=l.memoizedProps;L.props=M;var G=L.context,re=f.contextType;typeof re=="object"&&re!==null?re=Gn(re):(re=mn(f)?Ea:qr.current,re=Eo(l,re));var ye=f.getDerivedStateFromProps,xe=typeof ye=="function"||typeof L.getSnapshotBeforeUpdate=="function";xe||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(M!==p||G!==re)&&ky(l,L,p,re),Ri=!1;var me=l.memoizedState;L.state=me,_c(l,p,L,x),G=l.memoizedState,M!==p||me!==G||hn.current||Ri?(typeof ye=="function"&&(kh(l,f,ye,p),G=l.memoizedState),(M=Ri||Ly(l,f,M,p,me,G,re))?(xe||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(l.flags|=4194308)):(typeof L.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=G),L.props=p,L.state=G,L.context=re,p=M):(typeof L.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{L=l.stateNode,ny(a,l),M=l.memoizedProps,re=l.type===l.elementType?M:ns(l.type,M),L.props=re,xe=l.pendingProps,me=L.context,G=f.contextType,typeof G=="object"&&G!==null?G=Gn(G):(G=mn(f)?Ea:qr.current,G=Eo(l,G));var ke=f.getDerivedStateFromProps;(ye=typeof ke=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(M!==xe||me!==G)&&ky(l,L,p,G),Ri=!1,me=l.memoizedState,L.state=me,_c(l,p,L,x);var Fe=l.memoizedState;M!==xe||me!==Fe||hn.current||Ri?(typeof ke=="function"&&(kh(l,f,ke,p),Fe=l.memoizedState),(re=Ri||Ly(l,f,re,p,me,Fe,G)||!1)?(ye||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(p,Fe,G),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(p,Fe,G)),typeof L.componentDidUpdate=="function"&&(l.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof L.componentDidUpdate!="function"||M===a.memoizedProps&&me===a.memoizedState||(l.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&me===a.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=Fe),L.props=p,L.state=Fe,L.context=G,p=re):(typeof L.componentDidUpdate!="function"||M===a.memoizedProps&&me===a.memoizedState||(l.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&me===a.memoizedState||(l.flags|=1024),p=!1)}return Nh(a,l,f,p,T,x)}function Nh(a,l,f,p,x,T){$y(a,l);var L=(l.flags&128)!==0;if(!p&&!L)return x&&z0(l,f,!1),Xs(a,l,T);p=l.stateNode,oA.current=l;var M=L&&typeof f.getDerivedStateFromError!="function"?null:p.render();return l.flags|=1,a!==null&&L?(l.child=wo(l,a.child,null,T),l.child=wo(l,null,M,T)):rn(a,l,M,T),l.memoizedState=p.state,x&&z0(l,f,!0),l.child}function Vy(a){var l=a.stateNode;l.pendingContext?K0(a,l.pendingContext,l.pendingContext!==l.context):l.context&&K0(a,l.context,!1),vh(a,l.containerInfo)}function Gy(a,l,f,p,x){return bo(),dh(x),l.flags|=256,rn(a,l,f,p),l.child}var Mh={dehydrated:null,treeContext:null,retryLane:0};function Fh(a){return{baseLanes:a,cachePool:null,transitions:null}}function Ky(a,l,f){var p=l.pendingProps,x=sr.current,T=!1,L=(l.flags&128)!==0,M;if((M=L)||(M=a!==null&&a.memoizedState===null?!1:(x&2)!==0),M?(T=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(x|=1),Yt(sr,x&1),a===null)return ch(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(L=p.children,a=p.fallback,T?(p=l.mode,T=l.child,L={mode:"hidden",children:L},(p&1)===0&&T!==null?(T.childLanes=0,T.pendingProps=L):T=Qc(L,p,0,null),a=ka(a,p,f,null),T.return=l,a.return=l,T.sibling=a,l.child=T,l.child.memoizedState=Fh(f),l.memoizedState=Mh,a):Uh(l,L));if(x=a.memoizedState,x!==null&&(M=x.dehydrated,M!==null))return lA(a,l,L,p,M,x,f);if(T){T=p.fallback,L=l.mode,x=a.child,M=x.sibling;var G={mode:"hidden",children:p.children};return(L&1)===0&&l.child!==x?(p=l.child,p.childLanes=0,p.pendingProps=G,l.deletions=null):(p=Oi(x,G),p.subtreeFlags=x.subtreeFlags&14680064),M!==null?T=Oi(M,T):(T=ka(T,L,f,null),T.flags|=2),T.return=l,p.return=l,p.sibling=T,l.child=p,p=T,T=l.child,L=a.child.memoizedState,L=L===null?Fh(f):{baseLanes:L.baseLanes|f,cachePool:null,transitions:L.transitions},T.memoizedState=L,T.childLanes=a.childLanes&~f,l.memoizedState=Mh,p}return T=a.child,a=T.sibling,p=Oi(T,{mode:"visible",children:p.children}),(l.mode&1)===0&&(p.lanes=f),p.return=l,p.sibling=null,a!==null&&(f=l.deletions,f===null?(l.deletions=[a],l.flags|=16):f.push(a)),l.child=p,l.memoizedState=null,p}function Uh(a,l){return l=Qc({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function Fc(a,l,f,p){return p!==null&&dh(p),wo(l,a.child,null,f),a=Uh(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function lA(a,l,f,p,x,T,L){if(f)return l.flags&256?(l.flags&=-257,p=Dh(Error(t(422))),Fc(a,l,L,p)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(T=p.fallback,x=l.mode,p=Qc({mode:"visible",children:p.children},x,0,null),T=ka(T,x,L,null),T.flags|=2,p.return=l,T.return=l,p.sibling=T,l.child=p,(l.mode&1)!==0&&wo(l,a.child,null,L),l.child.memoizedState=Fh(L),l.memoizedState=Mh,T);if((l.mode&1)===0)return Fc(a,l,L,null);if(x.data==="$!"){if(p=x.nextSibling&&x.nextSibling.dataset,p)var M=p.dgst;return p=M,T=Error(t(419)),p=Dh(T,p,void 0),Fc(a,l,L,p)}if(M=(L&a.childLanes)!==0,pn||M){if(p=Dr,p!==null){switch(L&-L){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(p.suspendedLanes|L))!==0?0:x,x!==0&&x!==T.retryLane&&(T.retryLane=x,qs(a,x),as(p,a,x,-1))}return em(),p=Dh(Error(t(421))),Fc(a,l,L,p)}return x.data==="$?"?(l.flags|=128,l.child=a.child,l=SA.bind(null,a),x._reactRetry=l,null):(a=T.treeContext,kn=bi(x.nextSibling),_n=l,tr=!0,rs=null,a!==null&&(jn[Vn++]=Ws,jn[Vn++]=Ys,jn[Vn++]=Sa,Ws=a.id,Ys=a.overflow,Sa=l),l=Uh(l,p.children),l.flags|=4096,l)}function Hy(a,l,f){a.lanes|=l;var p=a.alternate;p!==null&&(p.lanes|=l),ph(a.return,l,f)}function Bh(a,l,f,p,x){var T=a.memoizedState;T===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:x}:(T.isBackwards=l,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=f,T.tailMode=x)}function zy(a,l,f){var p=l.pendingProps,x=p.revealOrder,T=p.tail;if(rn(a,l,p.children,f),p=sr.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Hy(a,f,l);else if(a.tag===19)Hy(a,f,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}if(Yt(sr,p),(l.mode&1)===0)l.memoizedState=null;else switch(x){case"forwards":for(f=l.child,x=null;f!==null;)a=f.alternate,a!==null&&kc(a)===null&&(x=f),f=f.sibling;f=x,f===null?(x=l.child,l.child=null):(x=f.sibling,f.sibling=null),Bh(l,!1,x,f,T);break;case"backwards":for(f=null,x=l.child,l.child=null;x!==null;){if(a=x.alternate,a!==null&&kc(a)===null){l.child=x;break}a=x.sibling,x.sibling=f,f=x,x=a}Bh(l,!0,f,null,T);break;case"together":Bh(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Uc(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function Xs(a,l,f){if(a!==null&&(l.dependencies=a.dependencies),Ia|=l.lanes,(f&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(t(153));if(l.child!==null){for(a=l.child,f=Oi(a,a.pendingProps),l.child=f,f.return=l;a.sibling!==null;)a=a.sibling,f=f.sibling=Oi(a,a.pendingProps),f.return=l;f.sibling=null}return l.child}function uA(a,l,f){switch(l.tag){case 3:Vy(l),bo();break;case 5:ay(l);break;case 1:mn(l.type)&&Ec(l);break;case 4:vh(l,l.stateNode.containerInfo);break;case 10:var p=l.type._context,x=l.memoizedProps.value;Yt(Ic,p._currentValue),p._currentValue=x;break;case 13:if(p=l.memoizedState,p!==null)return p.dehydrated!==null?(Yt(sr,sr.current&1),l.flags|=128,null):(f&l.child.childLanes)!==0?Ky(a,l,f):(Yt(sr,sr.current&1),a=Xs(a,l,f),a!==null?a.sibling:null);Yt(sr,sr.current&1);break;case 19:if(p=(f&l.childLanes)!==0,(a.flags&128)!==0){if(p)return zy(a,l,f);l.flags|=128}if(x=l.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Yt(sr,sr.current),p)break;return null;case 22:case 23:return l.lanes=0,By(a,l,f)}return Xs(a,l,f)}var Wy,$h,Yy,qy;Wy=function(a,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)a.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}},$h=function(){},Yy=function(a,l,f,p){var x=a.memoizedProps;if(x!==p){a=l.stateNode,wa(Ts.current);var T=null;switch(f){case"input":x=cn(a,x),p=cn(a,p),T=[];break;case"select":x=ne({},x,{value:void 0}),p=ne({},p,{value:void 0}),T=[];break;case"textarea":x=Y(a,x),p=Y(a,p),T=[];break;default:typeof x.onClick!="function"&&typeof p.onClick=="function"&&(a.onclick=yc)}tn(f,p);var L;f=null;for(re in x)if(!p.hasOwnProperty(re)&&x.hasOwnProperty(re)&&x[re]!=null)if(re==="style"){var M=x[re];for(L in M)M.hasOwnProperty(L)&&(f||(f={}),f[L]="")}else re!=="dangerouslySetInnerHTML"&&re!=="children"&&re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&re!=="autoFocus"&&(s.hasOwnProperty(re)?T||(T=[]):(T=T||[]).push(re,null));for(re in p){var G=p[re];if(M=x!=null?x[re]:void 0,p.hasOwnProperty(re)&&G!==M&&(G!=null||M!=null))if(re==="style")if(M){for(L in M)!M.hasOwnProperty(L)||G&&G.hasOwnProperty(L)||(f||(f={}),f[L]="");for(L in G)G.hasOwnProperty(L)&&M[L]!==G[L]&&(f||(f={}),f[L]=G[L])}else f||(T||(T=[]),T.push(re,f)),f=G;else re==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,M=M?M.__html:void 0,G!=null&&M!==G&&(T=T||[]).push(re,G)):re==="children"?typeof G!="string"&&typeof G!="number"||(T=T||[]).push(re,""+G):re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&(s.hasOwnProperty(re)?(G!=null&&re==="onScroll"&&Xt("scroll",a),T||M===G||(T=[])):(T=T||[]).push(re,G))}f&&(T=T||[]).push("style",f);var re=T;(l.updateQueue=re)&&(l.flags|=4)}},qy=function(a,l,f,p){f!==p&&(l.flags|=4)};function nu(a,l){if(!tr)switch(a.tailMode){case"hidden":l=a.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Xr(a){var l=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(l)for(var x=a.child;x!==null;)f|=x.lanes|x.childLanes,p|=x.subtreeFlags&14680064,p|=x.flags&14680064,x.return=a,x=x.sibling;else for(x=a.child;x!==null;)f|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=a,x=x.sibling;return a.subtreeFlags|=p,a.childLanes=f,l}function cA(a,l,f){var p=l.pendingProps;switch(lh(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xr(l),null;case 1:return mn(l.type)&&xc(),Xr(l),null;case 3:return p=l.stateNode,Ro(),Zt(hn),Zt(qr),Sh(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(a===null||a.child===null)&&(wc(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,rs!==null&&(Xh(rs),rs=null))),$h(a,l),Xr(l),null;case 5:xh(l);var x=wa(Zl.current);if(f=l.type,a!==null&&l.stateNode!=null)Yy(a,l,f,p,x),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!p){if(l.stateNode===null)throw Error(t(166));return Xr(l),null}if(a=wa(Ts.current),wc(l)){p=l.stateNode,f=l.type;var T=l.memoizedProps;switch(p[Ss]=l,p[Wl]=T,a=(l.mode&1)!==0,f){case"dialog":Xt("cancel",p),Xt("close",p);break;case"iframe":case"object":case"embed":Xt("load",p);break;case"video":case"audio":for(x=0;x<Kl.length;x++)Xt(Kl[x],p);break;case"source":Xt("error",p);break;case"img":case"image":case"link":Xt("error",p),Xt("load",p);break;case"details":Xt("toggle",p);break;case"input":ys(p,T),Xt("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!T.multiple},Xt("invalid",p);break;case"textarea":se(p,T),Xt("invalid",p)}tn(f,T),x=null;for(var L in T)if(T.hasOwnProperty(L)){var M=T[L];L==="children"?typeof M=="string"?p.textContent!==M&&(T.suppressHydrationWarning!==!0&&gc(p.textContent,M,a),x=["children",M]):typeof M=="number"&&p.textContent!==""+M&&(T.suppressHydrationWarning!==!0&&gc(p.textContent,M,a),x=["children",""+M]):s.hasOwnProperty(L)&&M!=null&&L==="onScroll"&&Xt("scroll",p)}switch(f){case"input":er(p),nr(p,T,!0);break;case"textarea":er(p),Ee(p);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(p.onclick=yc)}p=x,l.updateQueue=p,p!==null&&(l.flags|=4)}else{L=x.nodeType===9?x:x.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=fe(f)),a==="http://www.w3.org/1999/xhtml"?f==="script"?(a=L.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof p.is=="string"?a=L.createElement(f,{is:p.is}):(a=L.createElement(f),f==="select"&&(L=a,p.multiple?L.multiple=!0:p.size&&(L.size=p.size))):a=L.createElementNS(a,f),a[Ss]=l,a[Wl]=p,Wy(a,l,!1,!1),l.stateNode=a;e:{switch(L=vs(f,p),f){case"dialog":Xt("cancel",a),Xt("close",a),x=p;break;case"iframe":case"object":case"embed":Xt("load",a),x=p;break;case"video":case"audio":for(x=0;x<Kl.length;x++)Xt(Kl[x],a);x=p;break;case"source":Xt("error",a),x=p;break;case"img":case"image":case"link":Xt("error",a),Xt("load",a),x=p;break;case"details":Xt("toggle",a),x=p;break;case"input":ys(a,p),x=cn(a,p),Xt("invalid",a);break;case"option":x=p;break;case"select":a._wrapperState={wasMultiple:!!p.multiple},x=ne({},p,{value:void 0}),Xt("invalid",a);break;case"textarea":se(a,p),x=Y(a,p),Xt("invalid",a);break;default:x=p}tn(f,x),M=x;for(T in M)if(M.hasOwnProperty(T)){var G=M[T];T==="style"?zr(a,G):T==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&tt(a,G)):T==="children"?typeof G=="string"?(f!=="textarea"||G!=="")&&At(a,G):typeof G=="number"&&At(a,""+G):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(s.hasOwnProperty(T)?G!=null&&T==="onScroll"&&Xt("scroll",a):G!=null&&R(a,T,G,L))}switch(f){case"input":er(a),nr(a,p,!1);break;case"textarea":er(a),Ee(a);break;case"option":p.value!=null&&a.setAttribute("value",""+Ge(p.value));break;case"select":a.multiple=!!p.multiple,T=p.value,T!=null?U(a,!!p.multiple,T,!1):p.defaultValue!=null&&U(a,!!p.multiple,p.defaultValue,!0);break;default:typeof x.onClick=="function"&&(a.onclick=yc)}switch(f){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return Xr(l),null;case 6:if(a&&l.stateNode!=null)qy(a,l,a.memoizedProps,p);else{if(typeof p!="string"&&l.stateNode===null)throw Error(t(166));if(f=wa(Zl.current),wa(Ts.current),wc(l)){if(p=l.stateNode,f=l.memoizedProps,p[Ss]=l,(T=p.nodeValue!==f)&&(a=_n,a!==null))switch(a.tag){case 3:gc(p.nodeValue,f,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&gc(p.nodeValue,f,(a.mode&1)!==0)}T&&(l.flags|=4)}else p=(f.nodeType===9?f:f.ownerDocument).createTextNode(p),p[Ss]=l,l.stateNode=p}return Xr(l),null;case 13:if(Zt(sr),p=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(tr&&kn!==null&&(l.mode&1)!==0&&(l.flags&128)===0)Z0(),bo(),l.flags|=98560,T=!1;else if(T=wc(l),p!==null&&p.dehydrated!==null){if(a===null){if(!T)throw Error(t(318));if(T=l.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(t(317));T[Ss]=l}else bo(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Xr(l),T=!1}else rs!==null&&(Xh(rs),rs=null),T=!0;if(!T)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=f,l):(p=p!==null,p!==(a!==null&&a.memoizedState!==null)&&p&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(sr.current&1)!==0?Ir===0&&(Ir=3):em())),l.updateQueue!==null&&(l.flags|=4),Xr(l),null);case 4:return Ro(),$h(a,l),a===null&&Hl(l.stateNode.containerInfo),Xr(l),null;case 10:return mh(l.type._context),Xr(l),null;case 17:return mn(l.type)&&xc(),Xr(l),null;case 19:if(Zt(sr),T=l.memoizedState,T===null)return Xr(l),null;if(p=(l.flags&128)!==0,L=T.rendering,L===null)if(p)nu(T,!1);else{if(Ir!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(L=kc(a),L!==null){for(l.flags|=128,nu(T,!1),p=L.updateQueue,p!==null&&(l.updateQueue=p,l.flags|=4),l.subtreeFlags=0,p=f,f=l.child;f!==null;)T=f,a=p,T.flags&=14680066,L=T.alternate,L===null?(T.childLanes=0,T.lanes=a,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=L.childLanes,T.lanes=L.lanes,T.child=L.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=L.memoizedProps,T.memoizedState=L.memoizedState,T.updateQueue=L.updateQueue,T.type=L.type,a=L.dependencies,T.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),f=f.sibling;return Yt(sr,sr.current&1|2),l.child}a=a.sibling}T.tail!==null&&Rt()>Co&&(l.flags|=128,p=!0,nu(T,!1),l.lanes=4194304)}else{if(!p)if(a=kc(L),a!==null){if(l.flags|=128,p=!0,f=a.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),nu(T,!0),T.tail===null&&T.tailMode==="hidden"&&!L.alternate&&!tr)return Xr(l),null}else 2*Rt()-T.renderingStartTime>Co&&f!==1073741824&&(l.flags|=128,p=!0,nu(T,!1),l.lanes=4194304);T.isBackwards?(L.sibling=l.child,l.child=L):(f=T.last,f!==null?f.sibling=L:l.child=L,T.last=L)}return T.tail!==null?(l=T.tail,T.rendering=l,T.tail=l.sibling,T.renderingStartTime=Rt(),l.sibling=null,f=sr.current,Yt(sr,p?f&1|2:f&1),l):(Xr(l),null);case 22:case 23:return Jh(),p=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==p&&(l.flags|=8192),p&&(l.mode&1)!==0?(Cn&1073741824)!==0&&(Xr(l),l.subtreeFlags&6&&(l.flags|=8192)):Xr(l),null;case 24:return null;case 25:return null}throw Error(t(156,l.tag))}function dA(a,l){switch(lh(l),l.tag){case 1:return mn(l.type)&&xc(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Ro(),Zt(hn),Zt(qr),Sh(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return xh(l),null;case 13:if(Zt(sr),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(t(340));bo()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return Zt(sr),null;case 4:return Ro(),null;case 10:return mh(l.type._context),null;case 22:case 23:return Jh(),null;case 24:return null;default:return null}}var Bc=!1,Zr=!1,fA=typeof WeakSet=="function"?WeakSet:Set,Oe=null;function _o(a,l){var f=a.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(p){ur(a,l,p)}else f.current=null}function jh(a,l,f){try{f()}catch(p){ur(a,l,p)}}var Qy=!1;function hA(a,l){if(Jf=ic,a=L0(),Hf(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var x=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{f.nodeType,T.nodeType}catch{f=null;break e}var L=0,M=-1,G=-1,re=0,ye=0,xe=a,me=null;t:for(;;){for(var ke;xe!==f||x!==0&&xe.nodeType!==3||(M=L+x),xe!==T||p!==0&&xe.nodeType!==3||(G=L+p),xe.nodeType===3&&(L+=xe.nodeValue.length),(ke=xe.firstChild)!==null;)me=xe,xe=ke;for(;;){if(xe===a)break t;if(me===f&&++re===x&&(M=L),me===T&&++ye===p&&(G=L),(ke=xe.nextSibling)!==null)break;xe=me,me=xe.parentNode}xe=ke}f=M===-1||G===-1?null:{start:M,end:G}}else f=null}f=f||{start:0,end:0}}else f=null;for(eh={focusedElem:a,selectionRange:f},ic=!1,Oe=l;Oe!==null;)if(l=Oe,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Oe=a;else for(;Oe!==null;){l=Oe;try{var Fe=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Fe!==null){var $e=Fe.memoizedProps,hr=Fe.memoizedState,J=l.stateNode,K=J.getSnapshotBeforeUpdate(l.elementType===l.type?$e:ns(l.type,$e),hr);J.__reactInternalSnapshotBeforeUpdate=K}break;case 3:var ee=l.stateNode.containerInfo;ee.nodeType===1?ee.textContent="":ee.nodeType===9&&ee.documentElement&&ee.removeChild(ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Se){ur(l,l.return,Se)}if(a=l.sibling,a!==null){a.return=l.return,Oe=a;break}Oe=l.return}return Fe=Qy,Qy=!1,Fe}function su(a,l,f){var p=l.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var x=p=p.next;do{if((x.tag&a)===a){var T=x.destroy;x.destroy=void 0,T!==void 0&&jh(l,f,T)}x=x.next}while(x!==p)}}function $c(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&a)===a){var p=f.create;f.destroy=p()}f=f.next}while(f!==l)}}function Vh(a){var l=a.ref;if(l!==null){var f=a.stateNode;switch(a.tag){case 5:a=f;break;default:a=f}typeof l=="function"?l(a):l.current=a}}function Xy(a){var l=a.alternate;l!==null&&(a.alternate=null,Xy(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[Ss],delete l[Wl],delete l[sh],delete l[q1],delete l[Q1])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Zy(a){return a.tag===5||a.tag===3||a.tag===4}function Jy(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Zy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Gh(a,l,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?f.nodeType===8?f.parentNode.insertBefore(a,l):f.insertBefore(a,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(a,f)):(l=f,l.appendChild(a)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=yc));else if(p!==4&&(a=a.child,a!==null))for(Gh(a,l,f),a=a.sibling;a!==null;)Gh(a,l,f),a=a.sibling}function Kh(a,l,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?f.insertBefore(a,l):f.appendChild(a);else if(p!==4&&(a=a.child,a!==null))for(Kh(a,l,f),a=a.sibling;a!==null;)Kh(a,l,f),a=a.sibling}var Br=null,ss=!1;function _i(a,l,f){for(f=f.child;f!==null;)ev(a,l,f),f=f.sibling}function ev(a,l,f){if(Ur&&typeof Ur.onCommitFiberUnmount=="function")try{Ur.onCommitFiberUnmount(jt,f)}catch{}switch(f.tag){case 5:Zr||_o(f,l);case 6:var p=Br,x=ss;Br=null,_i(a,l,f),Br=p,ss=x,Br!==null&&(ss?(a=Br,f=f.stateNode,a.nodeType===8?a.parentNode.removeChild(f):a.removeChild(f)):Br.removeChild(f.stateNode));break;case 18:Br!==null&&(ss?(a=Br,f=f.stateNode,a.nodeType===8?nh(a.parentNode,f):a.nodeType===1&&nh(a,f),Ml(a)):nh(Br,f.stateNode));break;case 4:p=Br,x=ss,Br=f.stateNode.containerInfo,ss=!0,_i(a,l,f),Br=p,ss=x;break;case 0:case 11:case 14:case 15:if(!Zr&&(p=f.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){x=p=p.next;do{var T=x,L=T.destroy;T=T.tag,L!==void 0&&((T&2)!==0||(T&4)!==0)&&jh(f,l,L),x=x.next}while(x!==p)}_i(a,l,f);break;case 1:if(!Zr&&(_o(f,l),p=f.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=f.memoizedProps,p.state=f.memoizedState,p.componentWillUnmount()}catch(M){ur(f,l,M)}_i(a,l,f);break;case 21:_i(a,l,f);break;case 22:f.mode&1?(Zr=(p=Zr)||f.memoizedState!==null,_i(a,l,f),Zr=p):_i(a,l,f);break;default:_i(a,l,f)}}function tv(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var f=a.stateNode;f===null&&(f=a.stateNode=new fA),l.forEach(function(p){var x=TA.bind(null,a,p);f.has(p)||(f.add(p),p.then(x,x))})}}function is(a,l){var f=l.deletions;if(f!==null)for(var p=0;p<f.length;p++){var x=f[p];try{var T=a,L=l,M=L;e:for(;M!==null;){switch(M.tag){case 5:Br=M.stateNode,ss=!1;break e;case 3:Br=M.stateNode.containerInfo,ss=!0;break e;case 4:Br=M.stateNode.containerInfo,ss=!0;break e}M=M.return}if(Br===null)throw Error(t(160));ev(T,L,x),Br=null,ss=!1;var G=x.alternate;G!==null&&(G.return=null),x.return=null}catch(re){ur(x,l,re)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)rv(l,a),l=l.sibling}function rv(a,l){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(is(l,a),ws(a),p&4){try{su(3,a,a.return),$c(3,a)}catch($e){ur(a,a.return,$e)}try{su(5,a,a.return)}catch($e){ur(a,a.return,$e)}}break;case 1:is(l,a),ws(a),p&512&&f!==null&&_o(f,f.return);break;case 5:if(is(l,a),ws(a),p&512&&f!==null&&_o(f,f.return),a.flags&32){var x=a.stateNode;try{At(x,"")}catch($e){ur(a,a.return,$e)}}if(p&4&&(x=a.stateNode,x!=null)){var T=a.memoizedProps,L=f!==null?f.memoizedProps:T,M=a.type,G=a.updateQueue;if(a.updateQueue=null,G!==null)try{M==="input"&&T.type==="radio"&&T.name!=null&&Xe(x,T),vs(M,L);var re=vs(M,T);for(L=0;L<G.length;L+=2){var ye=G[L],xe=G[L+1];ye==="style"?zr(x,xe):ye==="dangerouslySetInnerHTML"?tt(x,xe):ye==="children"?At(x,xe):R(x,ye,xe,re)}switch(M){case"input":zt(x,T);break;case"textarea":Te(x,T);break;case"select":var me=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!T.multiple;var ke=T.value;ke!=null?U(x,!!T.multiple,ke,!1):me!==!!T.multiple&&(T.defaultValue!=null?U(x,!!T.multiple,T.defaultValue,!0):U(x,!!T.multiple,T.multiple?[]:"",!1))}x[Wl]=T}catch($e){ur(a,a.return,$e)}}break;case 6:if(is(l,a),ws(a),p&4){if(a.stateNode===null)throw Error(t(162));x=a.stateNode,T=a.memoizedProps;try{x.nodeValue=T}catch($e){ur(a,a.return,$e)}}break;case 3:if(is(l,a),ws(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{Ml(l.containerInfo)}catch($e){ur(a,a.return,$e)}break;case 4:is(l,a),ws(a);break;case 13:is(l,a),ws(a),x=a.child,x.flags&8192&&(T=x.memoizedState!==null,x.stateNode.isHidden=T,!T||x.alternate!==null&&x.alternate.memoizedState!==null||(Wh=Rt())),p&4&&tv(a);break;case 22:if(ye=f!==null&&f.memoizedState!==null,a.mode&1?(Zr=(re=Zr)||ye,is(l,a),Zr=re):is(l,a),ws(a),p&8192){if(re=a.memoizedState!==null,(a.stateNode.isHidden=re)&&!ye&&(a.mode&1)!==0)for(Oe=a,ye=a.child;ye!==null;){for(xe=Oe=ye;Oe!==null;){switch(me=Oe,ke=me.child,me.tag){case 0:case 11:case 14:case 15:su(4,me,me.return);break;case 1:_o(me,me.return);var Fe=me.stateNode;if(typeof Fe.componentWillUnmount=="function"){p=me,f=me.return;try{l=p,Fe.props=l.memoizedProps,Fe.state=l.memoizedState,Fe.componentWillUnmount()}catch($e){ur(p,f,$e)}}break;case 5:_o(me,me.return);break;case 22:if(me.memoizedState!==null){iv(xe);continue}}ke!==null?(ke.return=me,Oe=ke):iv(xe)}ye=ye.sibling}e:for(ye=null,xe=a;;){if(xe.tag===5){if(ye===null){ye=xe;try{x=xe.stateNode,re?(T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(M=xe.stateNode,G=xe.memoizedProps.style,L=G!=null&&G.hasOwnProperty("display")?G.display:null,M.style.display=Fr("display",L))}catch($e){ur(a,a.return,$e)}}}else if(xe.tag===6){if(ye===null)try{xe.stateNode.nodeValue=re?"":xe.memoizedProps}catch($e){ur(a,a.return,$e)}}else if((xe.tag!==22&&xe.tag!==23||xe.memoizedState===null||xe===a)&&xe.child!==null){xe.child.return=xe,xe=xe.child;continue}if(xe===a)break e;for(;xe.sibling===null;){if(xe.return===null||xe.return===a)break e;ye===xe&&(ye=null),xe=xe.return}ye===xe&&(ye=null),xe.sibling.return=xe.return,xe=xe.sibling}}break;case 19:is(l,a),ws(a),p&4&&tv(a);break;case 21:break;default:is(l,a),ws(a)}}function ws(a){var l=a.flags;if(l&2){try{e:{for(var f=a.return;f!==null;){if(Zy(f)){var p=f;break e}f=f.return}throw Error(t(160))}switch(p.tag){case 5:var x=p.stateNode;p.flags&32&&(At(x,""),p.flags&=-33);var T=Jy(a);Kh(a,T,x);break;case 3:case 4:var L=p.stateNode.containerInfo,M=Jy(a);Gh(a,M,L);break;default:throw Error(t(161))}}catch(G){ur(a,a.return,G)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function mA(a,l,f){Oe=a,nv(a)}function nv(a,l,f){for(var p=(a.mode&1)!==0;Oe!==null;){var x=Oe,T=x.child;if(x.tag===22&&p){var L=x.memoizedState!==null||Bc;if(!L){var M=x.alternate,G=M!==null&&M.memoizedState!==null||Zr;M=Bc;var re=Zr;if(Bc=L,(Zr=G)&&!re)for(Oe=x;Oe!==null;)L=Oe,G=L.child,L.tag===22&&L.memoizedState!==null?av(x):G!==null?(G.return=L,Oe=G):av(x);for(;T!==null;)Oe=T,nv(T),T=T.sibling;Oe=x,Bc=M,Zr=re}sv(a)}else(x.subtreeFlags&8772)!==0&&T!==null?(T.return=x,Oe=T):sv(a)}}function sv(a){for(;Oe!==null;){var l=Oe;if((l.flags&8772)!==0){var f=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:Zr||$c(5,l);break;case 1:var p=l.stateNode;if(l.flags&4&&!Zr)if(f===null)p.componentDidMount();else{var x=l.elementType===l.type?f.memoizedProps:ns(l.type,f.memoizedProps);p.componentDidUpdate(x,f.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var T=l.updateQueue;T!==null&&iy(l,T,p);break;case 3:var L=l.updateQueue;if(L!==null){if(f=null,l.child!==null)switch(l.child.tag){case 5:f=l.child.stateNode;break;case 1:f=l.child.stateNode}iy(l,L,f)}break;case 5:var M=l.stateNode;if(f===null&&l.flags&4){f=M;var G=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&f.focus();break;case"img":G.src&&(f.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var re=l.alternate;if(re!==null){var ye=re.memoizedState;if(ye!==null){var xe=ye.dehydrated;xe!==null&&Ml(xe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Zr||l.flags&512&&Vh(l)}catch(me){ur(l,l.return,me)}}if(l===a){Oe=null;break}if(f=l.sibling,f!==null){f.return=l.return,Oe=f;break}Oe=l.return}}function iv(a){for(;Oe!==null;){var l=Oe;if(l===a){Oe=null;break}var f=l.sibling;if(f!==null){f.return=l.return,Oe=f;break}Oe=l.return}}function av(a){for(;Oe!==null;){var l=Oe;try{switch(l.tag){case 0:case 11:case 15:var f=l.return;try{$c(4,l)}catch(G){ur(l,f,G)}break;case 1:var p=l.stateNode;if(typeof p.componentDidMount=="function"){var x=l.return;try{p.componentDidMount()}catch(G){ur(l,x,G)}}var T=l.return;try{Vh(l)}catch(G){ur(l,T,G)}break;case 5:var L=l.return;try{Vh(l)}catch(G){ur(l,L,G)}}}catch(G){ur(l,l.return,G)}if(l===a){Oe=null;break}var M=l.sibling;if(M!==null){M.return=l.return,Oe=M;break}Oe=l.return}}var pA=Math.ceil,jc=k.ReactCurrentDispatcher,Hh=k.ReactCurrentOwner,Hn=k.ReactCurrentBatchConfig,bt=0,Dr=null,vr=null,$r=0,Cn=0,ko=wi(0),Ir=0,iu=null,Ia=0,Vc=0,zh=0,au=null,gn=null,Wh=0,Co=1/0,Zs=null,Gc=!1,Yh=null,ki=null,Kc=!1,Ci=null,Hc=0,ou=0,qh=null,zc=-1,Wc=0;function nn(){return(bt&6)!==0?Rt():zc!==-1?zc:zc=Rt()}function Di(a){return(a.mode&1)===0?1:(bt&2)!==0&&$r!==0?$r&-$r:Z1.transition!==null?(Wc===0&&(Wc=Jg()),Wc):(a=Mt,a!==0||(a=window.event,a=a===void 0?16:l0(a.type)),a)}function as(a,l,f,p){if(50<ou)throw ou=0,qh=null,Error(t(185));Cl(a,f,p),((bt&2)===0||a!==Dr)&&(a===Dr&&((bt&2)===0&&(Vc|=f),Ir===4&&Pi(a,$r)),yn(a,p),f===1&&bt===0&&(l.mode&1)===0&&(Co=Rt()+500,Sc&&Ii()))}function yn(a,l){var f=a.callbackNode;Zw(a,l);var p=rc(a,a===Dr?$r:0);if(p===0)f!==null&&Vs(f),a.callbackNode=null,a.callbackPriority=0;else if(l=p&-p,a.callbackPriority!==l){if(f!=null&&Vs(f),l===1)a.tag===0?X1(lv.bind(null,a)):W0(lv.bind(null,a)),W1(function(){(bt&6)===0&&Ii()}),f=null;else{switch(e0(p)){case 1:f=Gs;break;case 4:f=Es;break;case 16:f=Ks;break;case 536870912:f=xt;break;default:f=Ks}f=gv(f,ov.bind(null,a))}a.callbackPriority=l,a.callbackNode=f}}function ov(a,l){if(zc=-1,Wc=0,(bt&6)!==0)throw Error(t(327));var f=a.callbackNode;if(Do()&&a.callbackNode!==f)return null;var p=rc(a,a===Dr?$r:0);if(p===0)return null;if((p&30)!==0||(p&a.expiredLanes)!==0||l)l=Yc(a,p);else{l=p;var x=bt;bt|=2;var T=cv();(Dr!==a||$r!==l)&&(Zs=null,Co=Rt()+500,La(a,l));do try{vA();break}catch(M){uv(a,M)}while(!0);hh(),jc.current=T,bt=x,vr!==null?l=0:(Dr=null,$r=0,l=Ir)}if(l!==0){if(l===2&&(x=_f(a),x!==0&&(p=x,l=Qh(a,x))),l===1)throw f=iu,La(a,0),Pi(a,p),yn(a,Rt()),f;if(l===6)Pi(a,p);else{if(x=a.current.alternate,(p&30)===0&&!gA(x)&&(l=Yc(a,p),l===2&&(T=_f(a),T!==0&&(p=T,l=Qh(a,T))),l===1))throw f=iu,La(a,0),Pi(a,p),yn(a,Rt()),f;switch(a.finishedWork=x,a.finishedLanes=p,l){case 0:case 1:throw Error(t(345));case 2:_a(a,gn,Zs);break;case 3:if(Pi(a,p),(p&130023424)===p&&(l=Wh+500-Rt(),10<l)){if(rc(a,0)!==0)break;if(x=a.suspendedLanes,(x&p)!==p){nn(),a.pingedLanes|=a.suspendedLanes&x;break}a.timeoutHandle=rh(_a.bind(null,a,gn,Zs),l);break}_a(a,gn,Zs);break;case 4:if(Pi(a,p),(p&4194240)===p)break;for(l=a.eventTimes,x=-1;0<p;){var L=31-Lt(p);T=1<<L,L=l[L],L>x&&(x=L),p&=~T}if(p=x,p=Rt()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*pA(p/1960))-p,10<p){a.timeoutHandle=rh(_a.bind(null,a,gn,Zs),p);break}_a(a,gn,Zs);break;case 5:_a(a,gn,Zs);break;default:throw Error(t(329))}}}return yn(a,Rt()),a.callbackNode===f?ov.bind(null,a):null}function Qh(a,l){var f=au;return a.current.memoizedState.isDehydrated&&(La(a,l).flags|=256),a=Yc(a,l),a!==2&&(l=gn,gn=f,l!==null&&Xh(l)),a}function Xh(a){gn===null?gn=a:gn.push.apply(gn,a)}function gA(a){for(var l=a;;){if(l.flags&16384){var f=l.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var p=0;p<f.length;p++){var x=f[p],T=x.getSnapshot;x=x.value;try{if(!ts(T(),x))return!1}catch{return!1}}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Pi(a,l){for(l&=~zh,l&=~Vc,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var f=31-Lt(l),p=1<<f;a[f]=-1,l&=~p}}function lv(a){if((bt&6)!==0)throw Error(t(327));Do();var l=rc(a,0);if((l&1)===0)return yn(a,Rt()),null;var f=Yc(a,l);if(a.tag!==0&&f===2){var p=_f(a);p!==0&&(l=p,f=Qh(a,p))}if(f===1)throw f=iu,La(a,0),Pi(a,l),yn(a,Rt()),f;if(f===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,_a(a,gn,Zs),yn(a,Rt()),null}function Zh(a,l){var f=bt;bt|=1;try{return a(l)}finally{bt=f,bt===0&&(Co=Rt()+500,Sc&&Ii())}}function Ra(a){Ci!==null&&Ci.tag===0&&(bt&6)===0&&Do();var l=bt;bt|=1;var f=Hn.transition,p=Mt;try{if(Hn.transition=null,Mt=1,a)return a()}finally{Mt=p,Hn.transition=f,bt=l,(bt&6)===0&&Ii()}}function Jh(){Cn=ko.current,Zt(ko)}function La(a,l){a.finishedWork=null,a.finishedLanes=0;var f=a.timeoutHandle;if(f!==-1&&(a.timeoutHandle=-1,z1(f)),vr!==null)for(f=vr.return;f!==null;){var p=f;switch(lh(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&xc();break;case 3:Ro(),Zt(hn),Zt(qr),Sh();break;case 5:xh(p);break;case 4:Ro();break;case 13:Zt(sr);break;case 19:Zt(sr);break;case 10:mh(p.type._context);break;case 22:case 23:Jh()}f=f.return}if(Dr=a,vr=a=Oi(a.current,null),$r=Cn=l,Ir=0,iu=null,zh=Vc=Ia=0,gn=au=null,ba!==null){for(l=0;l<ba.length;l++)if(f=ba[l],p=f.interleaved,p!==null){f.interleaved=null;var x=p.next,T=f.pending;if(T!==null){var L=T.next;T.next=x,p.next=L}f.pending=p}ba=null}return a}function uv(a,l){do{var f=vr;try{if(hh(),Cc.current=Nc,Dc){for(var p=ir.memoizedState;p!==null;){var x=p.queue;x!==null&&(x.pending=null),p=p.next}Dc=!1}if(Aa=0,Cr=Ar=ir=null,Jl=!1,eu=0,Hh.current=null,f===null||f.return===null){Ir=1,iu=l,vr=null;break}e:{var T=a,L=f.return,M=f,G=l;if(l=$r,M.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var re=G,ye=M,xe=ye.tag;if((ye.mode&1)===0&&(xe===0||xe===11||xe===15)){var me=ye.alternate;me?(ye.updateQueue=me.updateQueue,ye.memoizedState=me.memoizedState,ye.lanes=me.lanes):(ye.updateQueue=null,ye.memoizedState=null)}var ke=Oy(L);if(ke!==null){ke.flags&=-257,Ny(ke,L,M,T,l),ke.mode&1&&Py(T,re,l),l=ke,G=re;var Fe=l.updateQueue;if(Fe===null){var $e=new Set;$e.add(G),l.updateQueue=$e}else Fe.add(G);break e}else{if((l&1)===0){Py(T,re,l),em();break e}G=Error(t(426))}}else if(tr&&M.mode&1){var hr=Oy(L);if(hr!==null){(hr.flags&65536)===0&&(hr.flags|=256),Ny(hr,L,M,T,l),dh(Lo(G,M));break e}}T=G=Lo(G,M),Ir!==4&&(Ir=2),au===null?au=[T]:au.push(T),T=L;do{switch(T.tag){case 3:T.flags|=65536,l&=-l,T.lanes|=l;var J=Cy(T,G,l);sy(T,J);break e;case 1:M=G;var K=T.type,ee=T.stateNode;if((T.flags&128)===0&&(typeof K.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(ki===null||!ki.has(ee)))){T.flags|=65536,l&=-l,T.lanes|=l;var Se=Dy(T,M,l);sy(T,Se);break e}}T=T.return}while(T!==null)}fv(f)}catch(Ke){l=Ke,vr===f&&f!==null&&(vr=f=f.return);continue}break}while(!0)}function cv(){var a=jc.current;return jc.current=Nc,a===null?Nc:a}function em(){(Ir===0||Ir===3||Ir===2)&&(Ir=4),Dr===null||(Ia&268435455)===0&&(Vc&268435455)===0||Pi(Dr,$r)}function Yc(a,l){var f=bt;bt|=2;var p=cv();(Dr!==a||$r!==l)&&(Zs=null,La(a,l));do try{yA();break}catch(x){uv(a,x)}while(!0);if(hh(),bt=f,jc.current=p,vr!==null)throw Error(t(261));return Dr=null,$r=0,Ir}function yA(){for(;vr!==null;)dv(vr)}function vA(){for(;vr!==null&&!ya();)dv(vr)}function dv(a){var l=pv(a.alternate,a,Cn);a.memoizedProps=a.pendingProps,l===null?fv(a):vr=l,Hh.current=null}function fv(a){var l=a;do{var f=l.alternate;if(a=l.return,(l.flags&32768)===0){if(f=cA(f,l,Cn),f!==null){vr=f;return}}else{if(f=dA(f,l),f!==null){f.flags&=32767,vr=f;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Ir=6,vr=null;return}}if(l=l.sibling,l!==null){vr=l;return}vr=l=a}while(l!==null);Ir===0&&(Ir=5)}function _a(a,l,f){var p=Mt,x=Hn.transition;try{Hn.transition=null,Mt=1,xA(a,l,f,p)}finally{Hn.transition=x,Mt=p}return null}function xA(a,l,f,p){do Do();while(Ci!==null);if((bt&6)!==0)throw Error(t(327));f=a.finishedWork;var x=a.finishedLanes;if(f===null)return null;if(a.finishedWork=null,a.finishedLanes=0,f===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var T=f.lanes|f.childLanes;if(Jw(a,T),a===Dr&&(vr=Dr=null,$r=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||Kc||(Kc=!0,gv(Ks,function(){return Do(),null})),T=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||T){T=Hn.transition,Hn.transition=null;var L=Mt;Mt=1;var M=bt;bt|=4,Hh.current=null,hA(a,f),rv(f,a),B1(eh),ic=!!Jf,eh=Jf=null,a.current=f,mA(f),es(),bt=M,Mt=L,Hn.transition=T}else a.current=f;if(Kc&&(Kc=!1,Ci=a,Hc=x),T=a.pendingLanes,T===0&&(ki=null),va(f.stateNode),yn(a,Rt()),l!==null)for(p=a.onRecoverableError,f=0;f<l.length;f++)x=l[f],p(x.value,{componentStack:x.stack,digest:x.digest});if(Gc)throw Gc=!1,a=Yh,Yh=null,a;return(Hc&1)!==0&&a.tag!==0&&Do(),T=a.pendingLanes,(T&1)!==0?a===qh?ou++:(ou=0,qh=a):ou=0,Ii(),null}function Do(){if(Ci!==null){var a=e0(Hc),l=Hn.transition,f=Mt;try{if(Hn.transition=null,Mt=16>a?16:a,Ci===null)var p=!1;else{if(a=Ci,Ci=null,Hc=0,(bt&6)!==0)throw Error(t(331));var x=bt;for(bt|=4,Oe=a.current;Oe!==null;){var T=Oe,L=T.child;if((Oe.flags&16)!==0){var M=T.deletions;if(M!==null){for(var G=0;G<M.length;G++){var re=M[G];for(Oe=re;Oe!==null;){var ye=Oe;switch(ye.tag){case 0:case 11:case 15:su(8,ye,T)}var xe=ye.child;if(xe!==null)xe.return=ye,Oe=xe;else for(;Oe!==null;){ye=Oe;var me=ye.sibling,ke=ye.return;if(Xy(ye),ye===re){Oe=null;break}if(me!==null){me.return=ke,Oe=me;break}Oe=ke}}}var Fe=T.alternate;if(Fe!==null){var $e=Fe.child;if($e!==null){Fe.child=null;do{var hr=$e.sibling;$e.sibling=null,$e=hr}while($e!==null)}}Oe=T}}if((T.subtreeFlags&2064)!==0&&L!==null)L.return=T,Oe=L;else e:for(;Oe!==null;){if(T=Oe,(T.flags&2048)!==0)switch(T.tag){case 0:case 11:case 15:su(9,T,T.return)}var J=T.sibling;if(J!==null){J.return=T.return,Oe=J;break e}Oe=T.return}}var K=a.current;for(Oe=K;Oe!==null;){L=Oe;var ee=L.child;if((L.subtreeFlags&2064)!==0&&ee!==null)ee.return=L,Oe=ee;else e:for(L=K;Oe!==null;){if(M=Oe,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:$c(9,M)}}catch(Ke){ur(M,M.return,Ke)}if(M===L){Oe=null;break e}var Se=M.sibling;if(Se!==null){Se.return=M.return,Oe=Se;break e}Oe=M.return}}if(bt=x,Ii(),Ur&&typeof Ur.onPostCommitFiberRoot=="function")try{Ur.onPostCommitFiberRoot(jt,a)}catch{}p=!0}return p}finally{Mt=f,Hn.transition=l}}return!1}function hv(a,l,f){l=Lo(f,l),l=Cy(a,l,1),a=Li(a,l,1),l=nn(),a!==null&&(Cl(a,1,l),yn(a,l))}function ur(a,l,f){if(a.tag===3)hv(a,a,f);else for(;l!==null;){if(l.tag===3){hv(l,a,f);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ki===null||!ki.has(p))){a=Lo(f,a),a=Dy(l,a,1),l=Li(l,a,1),a=nn(),l!==null&&(Cl(l,1,a),yn(l,a));break}}l=l.return}}function EA(a,l,f){var p=a.pingCache;p!==null&&p.delete(l),l=nn(),a.pingedLanes|=a.suspendedLanes&f,Dr===a&&($r&f)===f&&(Ir===4||Ir===3&&($r&130023424)===$r&&500>Rt()-Wh?La(a,0):zh|=f),yn(a,l)}function mv(a,l){l===0&&((a.mode&1)===0?l=1:(l=tc,tc<<=1,(tc&130023424)===0&&(tc=4194304)));var f=nn();a=qs(a,l),a!==null&&(Cl(a,l,f),yn(a,f))}function SA(a){var l=a.memoizedState,f=0;l!==null&&(f=l.retryLane),mv(a,f)}function TA(a,l){var f=0;switch(a.tag){case 13:var p=a.stateNode,x=a.memoizedState;x!==null&&(f=x.retryLane);break;case 19:p=a.stateNode;break;default:throw Error(t(314))}p!==null&&p.delete(l),mv(a,f)}var pv;pv=function(a,l,f){if(a!==null)if(a.memoizedProps!==l.pendingProps||hn.current)pn=!0;else{if((a.lanes&f)===0&&(l.flags&128)===0)return pn=!1,uA(a,l,f);pn=(a.flags&131072)!==0}else pn=!1,tr&&(l.flags&1048576)!==0&&Y0(l,bc,l.index);switch(l.lanes=0,l.tag){case 2:var p=l.type;Uc(a,l),a=l.pendingProps;var x=Eo(l,qr.current);Io(l,f),x=wh(null,l,p,a,x,f);var T=Ah();return l.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,mn(p)?(T=!0,Ec(l)):T=!1,l.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,yh(l),x.updater=Mc,l.stateNode=x,x._reactInternals=l,Ch(l,p,a,f),l=Nh(null,l,p,!0,T,f)):(l.tag=0,tr&&T&&oh(l),rn(null,l,x,f),l=l.child),l;case 16:p=l.elementType;e:{switch(Uc(a,l),a=l.pendingProps,x=p._init,p=x(p._payload),l.type=p,x=l.tag=wA(p),a=ns(p,a),x){case 0:l=Oh(null,l,p,a,f);break e;case 1:l=jy(null,l,p,a,f);break e;case 11:l=My(null,l,p,a,f);break e;case 14:l=Fy(null,l,p,ns(p.type,a),f);break e}throw Error(t(306,p,""))}return l;case 0:return p=l.type,x=l.pendingProps,x=l.elementType===p?x:ns(p,x),Oh(a,l,p,x,f);case 1:return p=l.type,x=l.pendingProps,x=l.elementType===p?x:ns(p,x),jy(a,l,p,x,f);case 3:e:{if(Vy(l),a===null)throw Error(t(387));p=l.pendingProps,T=l.memoizedState,x=T.element,ny(a,l),_c(l,p,null,f);var L=l.memoizedState;if(p=L.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},l.updateQueue.baseState=T,l.memoizedState=T,l.flags&256){x=Lo(Error(t(423)),l),l=Gy(a,l,p,f,x);break e}else if(p!==x){x=Lo(Error(t(424)),l),l=Gy(a,l,p,f,x);break e}else for(kn=bi(l.stateNode.containerInfo.firstChild),_n=l,tr=!0,rs=null,f=ty(l,null,p,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(bo(),p===x){l=Xs(a,l,f);break e}rn(a,l,p,f)}l=l.child}return l;case 5:return ay(l),a===null&&ch(l),p=l.type,x=l.pendingProps,T=a!==null?a.memoizedProps:null,L=x.children,th(p,x)?L=null:T!==null&&th(p,T)&&(l.flags|=32),$y(a,l),rn(a,l,L,f),l.child;case 6:return a===null&&ch(l),null;case 13:return Ky(a,l,f);case 4:return vh(l,l.stateNode.containerInfo),p=l.pendingProps,a===null?l.child=wo(l,null,p,f):rn(a,l,p,f),l.child;case 11:return p=l.type,x=l.pendingProps,x=l.elementType===p?x:ns(p,x),My(a,l,p,x,f);case 7:return rn(a,l,l.pendingProps,f),l.child;case 8:return rn(a,l,l.pendingProps.children,f),l.child;case 12:return rn(a,l,l.pendingProps.children,f),l.child;case 10:e:{if(p=l.type._context,x=l.pendingProps,T=l.memoizedProps,L=x.value,Yt(Ic,p._currentValue),p._currentValue=L,T!==null)if(ts(T.value,L)){if(T.children===x.children&&!hn.current){l=Xs(a,l,f);break e}}else for(T=l.child,T!==null&&(T.return=l);T!==null;){var M=T.dependencies;if(M!==null){L=T.child;for(var G=M.firstContext;G!==null;){if(G.context===p){if(T.tag===1){G=Qs(-1,f&-f),G.tag=2;var re=T.updateQueue;if(re!==null){re=re.shared;var ye=re.pending;ye===null?G.next=G:(G.next=ye.next,ye.next=G),re.pending=G}}T.lanes|=f,G=T.alternate,G!==null&&(G.lanes|=f),ph(T.return,f,l),M.lanes|=f;break}G=G.next}}else if(T.tag===10)L=T.type===l.type?null:T.child;else if(T.tag===18){if(L=T.return,L===null)throw Error(t(341));L.lanes|=f,M=L.alternate,M!==null&&(M.lanes|=f),ph(L,f,l),L=T.sibling}else L=T.child;if(L!==null)L.return=T;else for(L=T;L!==null;){if(L===l){L=null;break}if(T=L.sibling,T!==null){T.return=L.return,L=T;break}L=L.return}T=L}rn(a,l,x.children,f),l=l.child}return l;case 9:return x=l.type,p=l.pendingProps.children,Io(l,f),x=Gn(x),p=p(x),l.flags|=1,rn(a,l,p,f),l.child;case 14:return p=l.type,x=ns(p,l.pendingProps),x=ns(p.type,x),Fy(a,l,p,x,f);case 15:return Uy(a,l,l.type,l.pendingProps,f);case 17:return p=l.type,x=l.pendingProps,x=l.elementType===p?x:ns(p,x),Uc(a,l),l.tag=1,mn(p)?(a=!0,Ec(l)):a=!1,Io(l,f),_y(l,p,x),Ch(l,p,x,f),Nh(null,l,p,!0,a,f);case 19:return zy(a,l,f);case 22:return By(a,l,f)}throw Error(t(156,l.tag))};function gv(a,l){return Qt(a,l)}function bA(a,l,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(a,l,f,p){return new bA(a,l,f,p)}function tm(a){return a=a.prototype,!(!a||!a.isReactComponent)}function wA(a){if(typeof a=="function")return tm(a)?1:0;if(a!=null){if(a=a.$$typeof,a===H)return 11;if(a===ce)return 14}return 2}function Oi(a,l){var f=a.alternate;return f===null?(f=zn(a.tag,l,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=l,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&14680064,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,l=a.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f}function qc(a,l,f,p,x,T){var L=2;if(p=a,typeof a=="function")tm(a)&&(L=1);else if(typeof a=="string")L=5;else e:switch(a){case _:return ka(f.children,x,T,l);case N:L=8,x|=8;break;case F:return a=zn(12,f,l,x|2),a.elementType=F,a.lanes=T,a;case ie:return a=zn(13,f,l,x),a.elementType=ie,a.lanes=T,a;case oe:return a=zn(19,f,l,x),a.elementType=oe,a.lanes=T,a;case ue:return Qc(f,x,T,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case O:L=10;break e;case q:L=9;break e;case H:L=11;break e;case ce:L=14;break e;case ae:L=16,p=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return l=zn(L,f,l,x),l.elementType=a,l.type=p,l.lanes=T,l}function ka(a,l,f,p){return a=zn(7,a,p,l),a.lanes=f,a}function Qc(a,l,f,p){return a=zn(22,a,p,l),a.elementType=ue,a.lanes=f,a.stateNode={isHidden:!1},a}function rm(a,l,f){return a=zn(6,a,null,l),a.lanes=f,a}function nm(a,l,f){return l=zn(4,a.children!==null?a.children:[],a.key,l),l.lanes=f,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function AA(a,l,f,p,x){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kf(0),this.expirationTimes=kf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kf(0),this.identifierPrefix=p,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function sm(a,l,f,p,x,T,L,M,G){return a=new AA(a,l,f,M,G),l===1?(l=1,T===!0&&(l|=8)):l=0,T=zn(3,null,null,l),a.current=T,T.stateNode=a,T.memoizedState={element:p,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},yh(T),a}function IA(a,l,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:p==null?null:""+p,children:a,containerInfo:l,implementation:f}}function yv(a){if(!a)return Ai;a=a._reactInternals;e:{if(Ne(a)!==a||a.tag!==1)throw Error(t(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(mn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(t(171))}if(a.tag===1){var f=a.type;if(mn(f))return H0(a,f,l)}return l}function vv(a,l,f,p,x,T,L,M,G){return a=sm(f,p,!0,a,x,T,L,M,G),a.context=yv(null),f=a.current,p=nn(),x=Di(f),T=Qs(p,x),T.callback=l??null,Li(f,T,x),a.current.lanes=x,Cl(a,x,p),yn(a,p),a}function Xc(a,l,f,p){var x=l.current,T=nn(),L=Di(x);return f=yv(f),l.context===null?l.context=f:l.pendingContext=f,l=Qs(T,L),l.payload={element:a},p=p===void 0?null:p,p!==null&&(l.callback=p),a=Li(x,l,L),a!==null&&(as(a,x,L,T),Lc(a,x,L)),L}function Zc(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function xv(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<l?f:l}}function im(a,l){xv(a,l),(a=a.alternate)&&xv(a,l)}function RA(){return null}var Ev=typeof reportError=="function"?reportError:function(a){console.error(a)};function am(a){this._internalRoot=a}Jc.prototype.render=am.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(t(409));Xc(a,l,null,null)},Jc.prototype.unmount=am.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;Ra(function(){Xc(null,a,null,null)}),l[Hs]=null}};function Jc(a){this._internalRoot=a}Jc.prototype.unstable_scheduleHydration=function(a){if(a){var l=n0();a={blockedOn:null,target:a,priority:l};for(var f=0;f<Ei.length&&l!==0&&l<Ei[f].priority;f++);Ei.splice(f,0,a),f===0&&a0(a)}};function om(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function ed(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Sv(){}function LA(a,l,f,p,x){if(x){if(typeof p=="function"){var T=p;p=function(){var re=Zc(L);T.call(re)}}var L=vv(l,p,a,0,null,!1,!1,"",Sv);return a._reactRootContainer=L,a[Hs]=L.current,Hl(a.nodeType===8?a.parentNode:a),Ra(),L}for(;x=a.lastChild;)a.removeChild(x);if(typeof p=="function"){var M=p;p=function(){var re=Zc(G);M.call(re)}}var G=sm(a,0,!1,null,null,!1,!1,"",Sv);return a._reactRootContainer=G,a[Hs]=G.current,Hl(a.nodeType===8?a.parentNode:a),Ra(function(){Xc(l,G,f,p)}),G}function td(a,l,f,p,x){var T=f._reactRootContainer;if(T){var L=T;if(typeof x=="function"){var M=x;x=function(){var G=Zc(L);M.call(G)}}Xc(l,L,a,x)}else L=LA(f,l,a,x,p);return Zc(L)}t0=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var f=kl(l.pendingLanes);f!==0&&(Cf(l,f|1),yn(l,Rt()),(bt&6)===0&&(Co=Rt()+500,Ii()))}break;case 13:Ra(function(){var p=qs(a,1);if(p!==null){var x=nn();as(p,a,1,x)}}),im(a,1)}},Df=function(a){if(a.tag===13){var l=qs(a,134217728);if(l!==null){var f=nn();as(l,a,134217728,f)}im(a,134217728)}},r0=function(a){if(a.tag===13){var l=Di(a),f=qs(a,l);if(f!==null){var p=nn();as(f,a,l,p)}im(a,l)}},n0=function(){return Mt},s0=function(a,l){var f=Mt;try{return Mt=a,l()}finally{Mt=f}},js=function(a,l,f){switch(l){case"input":if(zt(a,f),l=f.name,f.type==="radio"&&l!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var p=f[l];if(p!==a&&p.form===a.form){var x=vc(p);if(!x)throw Error(t(90));Ht(p),zt(p,x)}}}break;case"textarea":Te(a,f);break;case"select":l=f.value,l!=null&&U(a,!!f.multiple,l,!1)}},St=Zh,It=Ra;var _A={usingClientEntryPoint:!1,Events:[Yl,vo,vc,ga,Je,Zh]},lu={findFiberByHostInstance:xa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kA={bundleType:lu.bundleType,version:lu.version,rendererPackageName:lu.rendererPackageName,rendererConfig:lu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Nt(a),a===null?null:a.stateNode},findFiberByHostInstance:lu.findFiberByHostInstance||RA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rd.isDisabled&&rd.supportsFiber)try{jt=rd.inject(kA),Ur=rd}catch{}}return vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_A,vn.createPortal=function(a,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!om(l))throw Error(t(200));return IA(a,l,null,f)},vn.createRoot=function(a,l){if(!om(a))throw Error(t(299));var f=!1,p="",x=Ev;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onRecoverableError!==void 0&&(x=l.onRecoverableError)),l=sm(a,1,!1,null,null,f,!1,p,x),a[Hs]=l.current,Hl(a.nodeType===8?a.parentNode:a),new am(l)},vn.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=Nt(l),a=a===null?null:a.stateNode,a},vn.flushSync=function(a){return Ra(a)},vn.hydrate=function(a,l,f){if(!ed(l))throw Error(t(200));return td(null,a,l,!0,f)},vn.hydrateRoot=function(a,l,f){if(!om(a))throw Error(t(405));var p=f!=null&&f.hydratedSources||null,x=!1,T="",L=Ev;if(f!=null&&(f.unstable_strictMode===!0&&(x=!0),f.identifierPrefix!==void 0&&(T=f.identifierPrefix),f.onRecoverableError!==void 0&&(L=f.onRecoverableError)),l=vv(l,null,a,1,f??null,x,!1,T,L),a[Hs]=l.current,Hl(a),p)for(a=0;a<p.length;a++)f=p[a],x=f._getVersion,x=x(f._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[f,x]:l.mutableSourceEagerHydrationData.push(f,x);return new Jc(l)},vn.render=function(a,l,f){if(!ed(l))throw Error(t(200));return td(null,a,l,!1,f)},vn.unmountComponentAtNode=function(a){if(!ed(a))throw Error(t(40));return a._reactRootContainer?(Ra(function(){td(null,null,a,!1,function(){a._reactRootContainer=null,a[Hs]=null})}),!0):!1},vn.unstable_batchedUpdates=Zh,vn.unstable_renderSubtreeIntoContainer=function(a,l,f,p){if(!ed(f))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return td(a,l,f,!1,p)},vn.version="18.3.1-next-f1338f8080-20240426",vn}var kv;function $S(){if(kv)return dm.exports;kv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),dm.exports=FA(),dm.exports}var Cv;function UA(){if(Cv)return sd;Cv=1;var n=$S();return sd.createRoot=n.createRoot,sd.hydrateRoot=n.hydrateRoot,sd}var BA=UA();const $A=Xp(BA);var eg=$S();const tg=Xp(eg),jA=BS({__proto__:null,default:tg},[eg]);/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rr(){return rr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},rr.apply(this,arguments)}var Sr;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Sr||(Sr={}));const Dv="popstate";function VA(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:u}=r.location;return Lu("",{pathname:i,search:o,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Xa(s)}return KA(e,t,null,n)}function gt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Qa(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function GA(){return Math.random().toString(36).substr(2,8)}function Pv(n,e){return{usr:n.state,key:n.key,idx:e}}function Lu(n,e,t,r){return t===void 0&&(t=null),rr({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?ha(e):e,{state:t,key:e&&e.key||r||GA()})}function Xa(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ha(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function KA(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,u=Sr.Pop,d=null,c=h();c==null&&(c=0,o.replaceState(rr({},o.state,{idx:c}),""));function h(){return(o.state||{idx:null}).idx}function m(){u=Sr.Pop;let S=h(),A=S==null?null:S-c;c=S,d&&d({action:u,location:E.location,delta:A})}function g(S,A){u=Sr.Push;let I=Lu(E.location,S,A);c=h()+1;let R=Pv(I,c),k=E.createHref(I);try{o.pushState(R,"",k)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;s.location.assign(k)}i&&d&&d({action:u,location:E.location,delta:1})}function y(S,A){u=Sr.Replace;let I=Lu(E.location,S,A);c=h();let R=Pv(I,c),k=E.createHref(I);o.replaceState(R,"",k),i&&d&&d({action:u,location:E.location,delta:0})}function v(S){let A=s.location.origin!=="null"?s.location.origin:s.location.href,I=typeof S=="string"?S:Xa(S);return I=I.replace(/ $/,"%20"),gt(A,"No window.location.(origin|href) available to create URL for href: "+I),new URL(I,A)}let E={get action(){return u},get location(){return n(s,o)},listen(S){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(Dv,m),d=S,()=>{s.removeEventListener(Dv,m),d=null}},createHref(S){return e(s,S)},createURL:v,encodeLocation(S){let A=v(S);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:g,replace:y,go(S){return o.go(S)}};return E}var Ut;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Ut||(Ut={}));const HA=new Set(["lazy","caseSensitive","path","id","index","children"]);function zA(n){return n.index===!0}function Gd(n,e,t,r){return t===void 0&&(t=[]),r===void 0&&(r={}),n.map((s,i)=>{let o=[...t,String(i)],u=typeof s.id=="string"?s.id:o.join("-");if(gt(s.index!==!0||!s.children,"Cannot specify children on an index route"),gt(!r[u],'Found a route id collision on id "'+u+`".  Route id's must be globally unique within Data Router usages`),zA(s)){let d=rr({},s,e(s),{id:u});return r[u]=d,d}else{let d=rr({},s,e(s),{id:u,children:void 0});return r[u]=d,s.children&&(d.children=Gd(s.children,e,o,r)),d}})}function Na(n,e,t){return t===void 0&&(t="/"),Cd(n,e,t,!1)}function Cd(n,e,t,r){let s=typeof e=="string"?ha(e):e,i=bl(s.pathname||"/",t);if(i==null)return null;let o=jS(n);YA(o);let u=null;for(let d=0;u==null&&d<o.length;++d){let c=iI(i);u=nI(o[d],c,r)}return u}function WA(n,e){let{route:t,pathname:r,params:s}=n;return{id:t.id,pathname:r,params:s,data:e[t.id],handle:t.handle}}function jS(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,u)=>{let d={relativePath:u===void 0?i.path||"":u,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};d.relativePath.startsWith("/")&&(gt(d.relativePath.startsWith(r),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(r.length));let c=di([r,d.relativePath]),h=t.concat(d);i.children&&i.children.length>0&&(gt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),jS(i.children,e,h,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:tI(c,i.index),routesMeta:h})};return n.forEach((i,o)=>{var u;if(i.path===""||!((u=i.path)!=null&&u.includes("?")))s(i,o);else for(let d of VS(i.path))s(i,o,d)}),e}function VS(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=VS(r.join("/")),u=[];return u.push(...o.map(d=>d===""?i:[i,d].join("/"))),s&&u.push(...o),u.map(d=>n.startsWith("/")&&d===""?"/":d)}function YA(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:rI(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const qA=/^:[\w-]+$/,QA=3,XA=2,ZA=1,JA=10,eI=-2,Ov=n=>n==="*";function tI(n,e){let t=n.split("/"),r=t.length;return t.some(Ov)&&(r+=eI),e&&(r+=XA),t.filter(s=>!Ov(s)).reduce((s,i)=>s+(qA.test(i)?QA:i===""?ZA:JA),r)}function rI(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function nI(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,s={},i="/",o=[];for(let u=0;u<r.length;++u){let d=r[u],c=u===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",m=Nv({path:d.relativePath,caseSensitive:d.caseSensitive,end:c},h),g=d.route;if(!m&&c&&t&&!r[r.length-1].route.index&&(m=Nv({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},h)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:di([i,m.pathname]),pathnameBase:uI(di([i,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(i=di([i,m.pathnameBase]))}return o}function Nv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=sI(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:r.reduce((c,h,m)=>{let{paramName:g,isOptional:y}=h;if(g==="*"){let E=u[m]||"";o=i.slice(0,i.length-E.length).replace(/(.)\/+$/,"$1")}const v=u[m];return y&&!v?c[g]=void 0:c[g]=(v||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:n}}function sI(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Qa(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,d)=>(r.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function iI(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Qa(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function bl(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const aI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oI=n=>aI.test(n);function lI(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?ha(n):n,i;if(t)if(oI(t))i=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),Qa(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?i=Mv(t.substring(1),"/"):i=Mv(t,e)}else i=e;return{pathname:i,search:cI(r),hash:dI(s)}}function Mv(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function mm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function GS(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mf(n,e){let t=GS(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function pf(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=ha(n):(s=rr({},n),gt(!s.pathname||!s.pathname.includes("?"),mm("?","pathname","search",s)),gt(!s.pathname||!s.pathname.includes("#"),mm("#","pathname","hash",s)),gt(!s.search||!s.search.includes("#"),mm("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,u;if(o==null)u=t;else{let m=e.length-1;if(!r&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),m-=1;s.pathname=g.join("/")}u=m>=0?e[m]:"/"}let d=lI(s,u),c=o&&o!=="/"&&o.endsWith("/"),h=(i||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(c||h)&&(d.pathname+="/"),d}const di=n=>n.join("/").replace(/\/\/+/g,"/"),uI=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),cI=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,dI=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class Kd{constructor(e,t,r,s){s===void 0&&(s=!1),this.status=e,this.statusText=t||"",this.internal=s,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function _u(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const KS=["post","put","patch","delete"],fI=new Set(KS),hI=["get",...KS],mI=new Set(hI),pI=new Set([301,302,303,307,308]),gI=new Set([307,308]),pm={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},yI={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},cu={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},rg=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vI=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),HS="remix-router-transitions";function xI(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!t;gt(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let s;if(n.mapRouteProperties)s=n.mapRouteProperties;else if(n.detectErrorBoundary){let j=n.detectErrorBoundary;s=z=>({hasErrorBoundary:j(z)})}else s=vI;let i={},o=Gd(n.routes,s,void 0,i),u,d=n.basename||"/",c=n.dataStrategy||bI,h=n.patchRoutesOnNavigation,m=rr({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},n.future),g=null,y=new Set,v=null,E=null,S=null,A=n.hydrationData!=null,I=Na(o,n.history.location,d),R=!1,k=null;if(I==null&&!h){let j=Tn(404,{pathname:n.history.location.pathname}),{matches:z,route:te}=Wv(o);I=z,k={[te.id]:j}}I&&!n.hydrationData&&It(I,o,n.history.location.pathname).active&&(I=null);let C;if(I)if(I.some(j=>j.route.lazy))C=!1;else if(!I.some(j=>j.route.loader))C=!0;else if(m.v7_partialHydration){let j=n.hydrationData?n.hydrationData.loaderData:null,z=n.hydrationData?n.hydrationData.errors:null;if(z){let te=I.findIndex(he=>z[he.route.id]!==void 0);C=I.slice(0,te+1).every(he=>!ep(he.route,j,z))}else C=I.every(te=>!ep(te.route,j,z))}else C=n.hydrationData!=null;else if(C=!1,I=[],m.v7_partialHydration){let j=It(null,o,n.history.location.pathname);j.active&&j.matches&&(R=!0,I=j.matches)}let V,_={historyAction:n.history.action,location:n.history.location,matches:I,initialized:C,navigation:pm,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||k,fetchers:new Map,blockers:new Map},N=Sr.Pop,F=!1,O,q=!1,H=new Map,ie=null,oe=!1,ce=!1,ae=[],ue=new Set,W=new Map,Z=0,ne=-1,P=new Map,B=new Set,de=new Map,pe=new Map,ge=new Set,we=new Map,Ie=new Map,Ge;function Ze(){if(g=n.history.listen(j=>{let{action:z,location:te,delta:he}=j;if(Ge){Ge(),Ge=void 0;return}Qa(Ie.size===0||he!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ae=js({currentLocation:_.location,nextLocation:te,historyAction:z});if(Ae&&he!=null){let ze=new Promise(Qe=>{Ge=Qe});n.history.go(he*-1),dn(Ae,{state:"blocked",location:te,proceed(){dn(Ae,{state:"proceeding",proceed:void 0,reset:void 0,location:te}),ze.then(()=>n.history.go(he))},reset(){let Qe=new Map(_.blockers);Qe.set(Ae,cu),Ht({blockers:Qe})}});return}return Xe(z,te)}),t){FI(e,H);let j=()=>UI(e,H);e.addEventListener("pagehide",j),ie=()=>e.removeEventListener("pagehide",j)}return _.initialized||Xe(Sr.Pop,_.location,{initialHydration:!0}),V}function vt(){g&&g(),ie&&ie(),y.clear(),O&&O.abort(),_.fetchers.forEach((j,z)=>Wt(z)),_.blockers.forEach((j,z)=>xs(z))}function er(j){return y.add(j),()=>y.delete(j)}function Ht(j,z){z===void 0&&(z={}),_=rr({},_,j);let te=[],he=[];m.v7_fetcherPersist&&_.fetchers.forEach((Ae,ze)=>{Ae.state==="idle"&&(ge.has(ze)?he.push(ze):te.push(ze))}),ge.forEach(Ae=>{!_.fetchers.has(Ae)&&!W.has(Ae)&&he.push(Ae)}),[...y].forEach(Ae=>Ae(_,{deletedFetchers:he,viewTransitionOpts:z.viewTransitionOpts,flushSync:z.flushSync===!0})),m.v7_fetcherPersist?(te.forEach(Ae=>_.fetchers.delete(Ae)),he.forEach(Ae=>Wt(Ae))):he.forEach(Ae=>ge.delete(Ae))}function fr(j,z,te){var he,Ae;let{flushSync:ze}=te===void 0?{}:te,Qe=_.actionData!=null&&_.navigation.formMethod!=null&&fs(_.navigation.formMethod)&&_.navigation.state==="loading"&&((he=j.state)==null?void 0:he._isRedirect)!==!0,Me;z.actionData?Object.keys(z.actionData).length>0?Me=z.actionData:Me=null:Qe?Me=_.actionData:Me=null;let Be=z.loaderData?Hv(_.loaderData,z.loaderData,z.matches||[],z.errors):_.loaderData,Pe=_.blockers;Pe.size>0&&(Pe=new Map(Pe),Pe.forEach((pt,wr)=>Pe.set(wr,cu)));let Ne=F===!0||_.navigation.formMethod!=null&&fs(_.navigation.formMethod)&&((Ae=j.state)==null?void 0:Ae._isRedirect)!==!0;u&&(o=u,u=void 0),oe||N===Sr.Pop||(N===Sr.Push?n.history.push(j,j.state):N===Sr.Replace&&n.history.replace(j,j.state));let it;if(N===Sr.Pop){let pt=H.get(_.location.pathname);pt&&pt.has(j.pathname)?it={currentLocation:_.location,nextLocation:j}:H.has(j.pathname)&&(it={currentLocation:j,nextLocation:_.location})}else if(q){let pt=H.get(_.location.pathname);pt?pt.add(j.pathname):(pt=new Set([j.pathname]),H.set(_.location.pathname,pt)),it={currentLocation:_.location,nextLocation:j}}Ht(rr({},z,{actionData:Me,loaderData:Be,historyAction:N,location:j,initialized:!0,navigation:pm,revalidation:"idle",restoreScrollPosition:St(j,z.matches||_.matches),preventScrollReset:Ne,blockers:Pe}),{viewTransitionOpts:it,flushSync:ze===!0}),N=Sr.Pop,F=!1,q=!1,oe=!1,ce=!1,ae=[]}async function cn(j,z){if(typeof j=="number"){n.history.go(j);return}let te=Jm(_.location,_.matches,d,m.v7_prependBasename,j,m.v7_relativeSplatPath,z==null?void 0:z.fromRouteId,z==null?void 0:z.relative),{path:he,submission:Ae,error:ze}=Fv(m.v7_normalizeFormMethod,!1,te,z),Qe=_.location,Me=Lu(_.location,he,z&&z.state);Me=rr({},Me,n.history.encodeLocation(Me));let Be=z&&z.replace!=null?z.replace:void 0,Pe=Sr.Push;Be===!0?Pe=Sr.Replace:Be===!1||Ae!=null&&fs(Ae.formMethod)&&Ae.formAction===_.location.pathname+_.location.search&&(Pe=Sr.Replace);let Ne=z&&"preventScrollReset"in z?z.preventScrollReset===!0:void 0,it=(z&&z.flushSync)===!0,pt=js({currentLocation:Qe,nextLocation:Me,historyAction:Pe});if(pt){dn(pt,{state:"blocked",location:Me,proceed(){dn(pt,{state:"proceeding",proceed:void 0,reset:void 0,location:Me}),cn(j,z)},reset(){let wr=new Map(_.blockers);wr.set(pt,cu),Ht({blockers:wr})}});return}return await Xe(Pe,Me,{submission:Ae,pendingError:ze,preventScrollReset:Ne,replace:z&&z.replace,enableViewTransition:z&&z.viewTransition,flushSync:it})}function ys(){if(_e(),Ht({revalidation:"loading"}),_.navigation.state!=="submitting"){if(_.navigation.state==="idle"){Xe(_.historyAction,_.location,{startUninterruptedRevalidation:!0});return}Xe(N||_.historyAction,_.navigation.location,{overrideNavigation:_.navigation,enableViewTransition:q===!0})}}async function Xe(j,z,te){O&&O.abort(),O=null,N=j,oe=(te&&te.startUninterruptedRevalidation)===!0,Je(_.location,_.matches),F=(te&&te.preventScrollReset)===!0,q=(te&&te.enableViewTransition)===!0;let he=u||o,Ae=te&&te.overrideNavigation,ze=te!=null&&te.initialHydration&&_.matches&&_.matches.length>0&&!R?_.matches:Na(he,z,d),Qe=(te&&te.flushSync)===!0;if(ze&&_.initialized&&!ce&&_I(_.location,z)&&!(te&&te.submission&&fs(te.submission.formMethod))){fr(z,{matches:ze},{flushSync:Qe});return}let Me=It(ze,he,z.pathname);if(Me.active&&Me.matches&&(ze=Me.matches),!ze){let{error:Nt,notFoundMatches:Tt,route:Qt}=$n(z.pathname);fr(z,{matches:Tt,loaderData:{},errors:{[Qt.id]:Nt}},{flushSync:Qe});return}O=new AbortController;let Be=Po(n.history,z,O.signal,te&&te.submission),Pe;if(te&&te.pendingError)Pe=[Ma(ze).route.id,{type:Ut.error,error:te.pendingError}];else if(te&&te.submission&&fs(te.submission.formMethod)){let Nt=await zt(Be,z,te.submission,ze,Me.active,{replace:te.replace,flushSync:Qe});if(Nt.shortCircuited)return;if(Nt.pendingActionResult){let[Tt,Qt]=Nt.pendingActionResult;if(Nn(Qt)&&_u(Qt.error)&&Qt.error.status===404){O=null,fr(z,{matches:Nt.matches,loaderData:{},errors:{[Tt]:Qt.error}});return}}ze=Nt.matches||ze,Pe=Nt.pendingActionResult,Ae=gm(z,te.submission),Qe=!1,Me.active=!1,Be=Po(n.history,Be.url,Be.signal)}let{shortCircuited:Ne,matches:it,loaderData:pt,errors:wr}=await nr(Be,z,ze,Me.active,Ae,te&&te.submission,te&&te.fetcherSubmission,te&&te.replace,te&&te.initialHydration===!0,Qe,Pe);Ne||(O=null,fr(z,rr({matches:it||ze},zv(Pe),{loaderData:pt,errors:wr})))}async function zt(j,z,te,he,Ae,ze){ze===void 0&&(ze={}),_e();let Qe=NI(z,te);if(Ht({navigation:Qe},{flushSync:ze.flushSync===!0}),Ae){let Pe=await yr(he,z.pathname,j.signal);if(Pe.type==="aborted")return{shortCircuited:!0};if(Pe.type==="error"){let Ne=Ma(Pe.partialMatches).route.id;return{matches:Pe.partialMatches,pendingActionResult:[Ne,{type:Ut.error,error:Pe.error}]}}else if(Pe.matches)he=Pe.matches;else{let{notFoundMatches:Ne,error:it,route:pt}=$n(z.pathname);return{matches:Ne,pendingActionResult:[pt.id,{type:Ut.error,error:it}]}}}let Me,Be=xu(he,z);if(!Be.route.action&&!Be.route.lazy)Me={type:Ut.error,error:Tn(405,{method:j.method,pathname:z.pathname,routeId:Be.route.id})};else if(Me=(await Ee("action",_,j,[Be],he,null))[Be.route.id],j.signal.aborted)return{shortCircuited:!0};if(Fa(Me)){let Pe;return ze&&ze.replace!=null?Pe=ze.replace:Pe=Vv(Me.response.headers.get("Location"),new URL(j.url),d,n.history)===_.location.pathname+_.location.search,await Te(j,Me,!0,{submission:te,replace:Pe}),{shortCircuited:!0}}if(na(Me))throw Tn(400,{type:"defer-action"});if(Nn(Me)){let Pe=Ma(he,Be.route.id);return(ze&&ze.replace)!==!0&&(N=Sr.Push),{matches:he,pendingActionResult:[Pe.route.id,Me]}}return{matches:he,pendingActionResult:[Be.route.id,Me]}}async function nr(j,z,te,he,Ae,ze,Qe,Me,Be,Pe,Ne){let it=Ae||gm(z,ze),pt=ze||Qe||qv(it),wr=!oe&&(!m.v7_partialHydration||!Be);if(he){if(wr){let jt=Mr(Ne);Ht(rr({navigation:it},jt!==void 0?{actionData:jt}:{}),{flushSync:Pe})}let xt=await yr(te,z.pathname,j.signal);if(xt.type==="aborted")return{shortCircuited:!0};if(xt.type==="error"){let jt=Ma(xt.partialMatches).route.id;return{matches:xt.partialMatches,loaderData:{},errors:{[jt]:xt.error}}}else if(xt.matches)te=xt.matches;else{let{error:jt,notFoundMatches:Ur,route:va}=$n(z.pathname);return{matches:Ur,loaderData:{},errors:{[va.id]:jt}}}}let Nt=u||o,[Tt,Qt]=Bv(n.history,_,te,pt,z,m.v7_partialHydration&&Be===!0,m.v7_skipActionErrorRevalidation,ce,ae,ue,ge,de,B,Nt,d,Ne);if(fn(xt=>!(te&&te.some(jt=>jt.route.id===xt))||Tt&&Tt.some(jt=>jt.route.id===xt)),ne=++Z,Tt.length===0&&Qt.length===0){let xt=Jn();return fr(z,rr({matches:te,loaderData:{},errors:Ne&&Nn(Ne[1])?{[Ne[0]]:Ne[1].error}:null},zv(Ne),xt?{fetchers:new Map(_.fetchers)}:{}),{flushSync:Pe}),{shortCircuited:!0}}if(wr){let xt={};if(!he){xt.navigation=it;let jt=Mr(Ne);jt!==void 0&&(xt.actionData=jt)}Qt.length>0&&(xt.fetchers=qt(Qt)),Ht(xt,{flushSync:Pe})}Qt.forEach(xt=>{Fr(xt.key),xt.controller&&W.set(xt.key,xt.controller)});let Vs=()=>Qt.forEach(xt=>Fr(xt.key));O&&O.signal.addEventListener("abort",Vs);let{loaderResults:ya,fetcherResults:es}=await fe(_,te,Tt,Qt,j);if(j.signal.aborted)return{shortCircuited:!0};O&&O.signal.removeEventListener("abort",Vs),Qt.forEach(xt=>W.delete(xt.key));let Rt=id(ya);if(Rt)return await Te(j,Rt.result,!0,{replace:Me}),{shortCircuited:!0};if(Rt=id(es),Rt)return B.add(Rt.key),await Te(j,Rt.result,!0,{replace:Me}),{shortCircuited:!0};let{loaderData:_l,errors:Gs}=Kv(_,te,ya,Ne,Qt,es,we);we.forEach((xt,jt)=>{xt.subscribe(Ur=>{(Ur||xt.done)&&we.delete(jt)})}),m.v7_partialHydration&&Be&&_.errors&&(Gs=rr({},_.errors,Gs));let Es=Jn(),Ks=tn(ne),uo=Es||Ks||Qt.length>0;return rr({matches:te,loaderData:_l,errors:Gs},uo?{fetchers:new Map(_.fetchers)}:{})}function Mr(j){if(j&&!Nn(j[1]))return{[j[0]]:j[1].data};if(_.actionData)return Object.keys(_.actionData).length===0?null:_.actionData}function qt(j){return j.forEach(z=>{let te=_.fetchers.get(z.key),he=du(void 0,te?te.data:void 0);_.fetchers.set(z.key,he)}),new Map(_.fetchers)}function U(j,z,te,he){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Fr(j);let Ae=(he&&he.flushSync)===!0,ze=u||o,Qe=Jm(_.location,_.matches,d,m.v7_prependBasename,te,m.v7_relativeSplatPath,z,he==null?void 0:he.relative),Me=Na(ze,Qe,d),Be=It(Me,ze,Qe);if(Be.active&&Be.matches&&(Me=Be.matches),!Me){tt(j,z,Tn(404,{pathname:Qe}),{flushSync:Ae});return}let{path:Pe,submission:Ne,error:it}=Fv(m.v7_normalizeFormMethod,!0,Qe,he);if(it){tt(j,z,it,{flushSync:Ae});return}let pt=xu(Me,Pe),wr=(he&&he.preventScrollReset)===!0;if(Ne&&fs(Ne.formMethod)){Y(j,z,Pe,pt,Me,Be.active,Ae,wr,Ne);return}de.set(j,{routeId:z,path:Pe}),se(j,z,Pe,pt,Me,Be.active,Ae,wr,Ne)}async function Y(j,z,te,he,Ae,ze,Qe,Me,Be){_e(),de.delete(j);function Pe(Lt){if(!Lt.route.action&&!Lt.route.lazy){let gi=Tn(405,{method:Be.formMethod,pathname:te,routeId:z});return tt(j,z,gi,{flushSync:Qe}),!0}return!1}if(!ze&&Pe(he))return;let Ne=_.fetchers.get(j);et(j,MI(Be,Ne),{flushSync:Qe});let it=new AbortController,pt=Po(n.history,te,it.signal,Be);if(ze){let Lt=await yr(Ae,new URL(pt.url).pathname,pt.signal,j);if(Lt.type==="aborted")return;if(Lt.type==="error"){tt(j,z,Lt.error,{flushSync:Qe});return}else if(Lt.matches){if(Ae=Lt.matches,he=xu(Ae,te),Pe(he))return}else{tt(j,z,Tn(404,{pathname:te}),{flushSync:Qe});return}}W.set(j,it);let wr=Z,Tt=(await Ee("action",_,pt,[he],Ae,j))[he.route.id];if(pt.signal.aborted){W.get(j)===it&&W.delete(j);return}if(m.v7_fetcherPersist&&ge.has(j)){if(Fa(Tt)||Nn(Tt)){et(j,ji(void 0));return}}else{if(Fa(Tt))if(W.delete(j),ne>wr){et(j,ji(void 0));return}else return B.add(j),et(j,du(Be)),Te(pt,Tt,!1,{fetcherSubmission:Be,preventScrollReset:Me});if(Nn(Tt)){tt(j,z,Tt.error);return}}if(na(Tt))throw Tn(400,{type:"defer-action"});let Qt=_.navigation.location||_.location,Vs=Po(n.history,Qt,it.signal),ya=u||o,es=_.navigation.state!=="idle"?Na(ya,_.navigation.location,d):_.matches;gt(es,"Didn't find any matches after fetcher action");let Rt=++Z;P.set(j,Rt);let _l=du(Be,Tt.data);_.fetchers.set(j,_l);let[Gs,Es]=Bv(n.history,_,es,Be,Qt,!1,m.v7_skipActionErrorRevalidation,ce,ae,ue,ge,de,B,ya,d,[he.route.id,Tt]);Es.filter(Lt=>Lt.key!==j).forEach(Lt=>{let gi=Lt.key,Ju=_.fetchers.get(gi),Lf=du(void 0,Ju?Ju.data:void 0);_.fetchers.set(gi,Lf),Fr(gi),Lt.controller&&W.set(gi,Lt.controller)}),Ht({fetchers:new Map(_.fetchers)});let Ks=()=>Es.forEach(Lt=>Fr(Lt.key));it.signal.addEventListener("abort",Ks);let{loaderResults:uo,fetcherResults:xt}=await fe(_,es,Gs,Es,Vs);if(it.signal.aborted)return;it.signal.removeEventListener("abort",Ks),P.delete(j),W.delete(j),Es.forEach(Lt=>W.delete(Lt.key));let jt=id(uo);if(jt)return Te(Vs,jt.result,!1,{preventScrollReset:Me});if(jt=id(xt),jt)return B.add(jt.key),Te(Vs,jt.result,!1,{preventScrollReset:Me});let{loaderData:Ur,errors:va}=Kv(_,es,uo,void 0,Es,xt,we);if(_.fetchers.has(j)){let Lt=ji(Tt.data);_.fetchers.set(j,Lt)}tn(Rt),_.navigation.state==="loading"&&Rt>ne?(gt(N,"Expected pending action"),O&&O.abort(),fr(_.navigation.location,{matches:es,loaderData:Ur,errors:va,fetchers:new Map(_.fetchers)})):(Ht({errors:va,loaderData:Hv(_.loaderData,Ur,es,va),fetchers:new Map(_.fetchers)}),ce=!1)}async function se(j,z,te,he,Ae,ze,Qe,Me,Be){let Pe=_.fetchers.get(j);et(j,du(Be,Pe?Pe.data:void 0),{flushSync:Qe});let Ne=new AbortController,it=Po(n.history,te,Ne.signal);if(ze){let Tt=await yr(Ae,new URL(it.url).pathname,it.signal,j);if(Tt.type==="aborted")return;if(Tt.type==="error"){tt(j,z,Tt.error,{flushSync:Qe});return}else if(Tt.matches)Ae=Tt.matches,he=xu(Ae,te);else{tt(j,z,Tn(404,{pathname:te}),{flushSync:Qe});return}}W.set(j,Ne);let pt=Z,Nt=(await Ee("loader",_,it,[he],Ae,j))[he.route.id];if(na(Nt)&&(Nt=await ng(Nt,it.signal,!0)||Nt),W.get(j)===Ne&&W.delete(j),!it.signal.aborted){if(ge.has(j)){et(j,ji(void 0));return}if(Fa(Nt))if(ne>pt){et(j,ji(void 0));return}else{B.add(j),await Te(it,Nt,!1,{preventScrollReset:Me});return}if(Nn(Nt)){tt(j,z,Nt.error);return}gt(!na(Nt),"Unhandled fetcher deferred data"),et(j,ji(Nt.data))}}async function Te(j,z,te,he){let{submission:Ae,fetcherSubmission:ze,preventScrollReset:Qe,replace:Me}=he===void 0?{}:he;z.response.headers.has("X-Remix-Revalidate")&&(ce=!0);let Be=z.response.headers.get("Location");gt(Be,"Expected a Location header on the redirect Response"),Be=Vv(Be,new URL(j.url),d,n.history);let Pe=Lu(_.location,Be,{_isRedirect:!0});if(t){let Tt=!1;if(z.response.headers.has("X-Remix-Reload-Document"))Tt=!0;else if(rg.test(Be)){const Qt=n.history.createURL(Be);Tt=Qt.origin!==e.location.origin||bl(Qt.pathname,d)==null}if(Tt){Me?e.location.replace(Be):e.location.assign(Be);return}}O=null;let Ne=Me===!0||z.response.headers.has("X-Remix-Replace")?Sr.Replace:Sr.Push,{formMethod:it,formAction:pt,formEncType:wr}=_.navigation;!Ae&&!ze&&it&&pt&&wr&&(Ae=qv(_.navigation));let Nt=Ae||ze;if(gI.has(z.response.status)&&Nt&&fs(Nt.formMethod))await Xe(Ne,Pe,{submission:rr({},Nt,{formAction:Be}),preventScrollReset:Qe||F,enableViewTransition:te?q:void 0});else{let Tt=gm(Pe,Ae);await Xe(Ne,Pe,{overrideNavigation:Tt,fetcherSubmission:ze,preventScrollReset:Qe||F,enableViewTransition:te?q:void 0})}}async function Ee(j,z,te,he,Ae,ze){let Qe,Me={};try{Qe=await wI(c,j,z,te,he,Ae,ze,i,s)}catch(Be){return he.forEach(Pe=>{Me[Pe.route.id]={type:Ut.error,error:Be}}),Me}for(let[Be,Pe]of Object.entries(Qe))if(kI(Pe)){let Ne=Pe.result;Me[Be]={type:Ut.redirect,response:RI(Ne,te,Be,Ae,d,m.v7_relativeSplatPath)}}else Me[Be]=await II(Pe);return Me}async function fe(j,z,te,he,Ae){let ze=j.matches,Qe=Ee("loader",j,Ae,te,z,null),Me=Promise.all(he.map(async Ne=>{if(Ne.matches&&Ne.match&&Ne.controller){let pt=(await Ee("loader",j,Po(n.history,Ne.path,Ne.controller.signal),[Ne.match],Ne.matches,Ne.key))[Ne.match.route.id];return{[Ne.key]:pt}}else return Promise.resolve({[Ne.key]:{type:Ut.error,error:Tn(404,{pathname:Ne.path})}})})),Be=await Qe,Pe=(await Me).reduce((Ne,it)=>Object.assign(Ne,it),{});return await Promise.all([PI(z,Be,Ae.signal,ze,j.loaderData),OI(z,Pe,he)]),{loaderResults:Be,fetcherResults:Pe}}function _e(){ce=!0,ae.push(...fn()),de.forEach((j,z)=>{W.has(z)&&ue.add(z),Fr(z)})}function et(j,z,te){te===void 0&&(te={}),_.fetchers.set(j,z),Ht({fetchers:new Map(_.fetchers)},{flushSync:(te&&te.flushSync)===!0})}function tt(j,z,te,he){he===void 0&&(he={});let Ae=Ma(_.matches,z);Wt(j),Ht({errors:{[Ae.route.id]:te},fetchers:new Map(_.fetchers)},{flushSync:(he&&he.flushSync)===!0})}function At(j){return pe.set(j,(pe.get(j)||0)+1),ge.has(j)&&ge.delete(j),_.fetchers.get(j)||yI}function Wt(j){let z=_.fetchers.get(j);W.has(j)&&!(z&&z.state==="loading"&&P.has(j))&&Fr(j),de.delete(j),P.delete(j),B.delete(j),m.v7_fetcherPersist&&ge.delete(j),ue.delete(j),_.fetchers.delete(j)}function en(j){let z=(pe.get(j)||0)-1;z<=0?(pe.delete(j),ge.add(j),m.v7_fetcherPersist||Wt(j)):pe.set(j,z),Ht({fetchers:new Map(_.fetchers)})}function Fr(j){let z=W.get(j);z&&(z.abort(),W.delete(j))}function zr(j){for(let z of j){let te=At(z),he=ji(te.data);_.fetchers.set(z,he)}}function Jn(){let j=[],z=!1;for(let te of B){let he=_.fetchers.get(te);gt(he,"Expected fetcher: "+te),he.state==="loading"&&(B.delete(te),j.push(te),z=!0)}return zr(j),z}function tn(j){let z=[];for(let[te,he]of P)if(he<j){let Ae=_.fetchers.get(te);gt(Ae,"Expected fetcher: "+te),Ae.state==="loading"&&(Fr(te),P.delete(te),z.push(te))}return zr(z),z.length>0}function vs(j,z){let te=_.blockers.get(j)||cu;return Ie.get(j)!==z&&Ie.set(j,z),te}function xs(j){_.blockers.delete(j),Ie.delete(j)}function dn(j,z){let te=_.blockers.get(j)||cu;gt(te.state==="unblocked"&&z.state==="blocked"||te.state==="blocked"&&z.state==="blocked"||te.state==="blocked"&&z.state==="proceeding"||te.state==="blocked"&&z.state==="unblocked"||te.state==="proceeding"&&z.state==="unblocked","Invalid blocker state transition: "+te.state+" -> "+z.state);let he=new Map(_.blockers);he.set(j,z),Ht({blockers:he})}function js(j){let{currentLocation:z,nextLocation:te,historyAction:he}=j;if(Ie.size===0)return;Ie.size>1&&Qa(!1,"A router only supports one blocker at a time");let Ae=Array.from(Ie.entries()),[ze,Qe]=Ae[Ae.length-1],Me=_.blockers.get(ze);if(!(Me&&Me.state==="proceeding")&&Qe({currentLocation:z,nextLocation:te,historyAction:he}))return ze}function $n(j){let z=Tn(404,{pathname:j}),te=u||o,{matches:he,route:Ae}=Wv(te);return fn(),{notFoundMatches:he,route:Ae,error:z}}function fn(j){let z=[];return we.forEach((te,he)=>{(!j||j(he))&&(te.cancel(),z.push(he),we.delete(he))}),z}function Rn(j,z,te){if(v=j,S=z,E=te||null,!A&&_.navigation===pm){A=!0;let he=St(_.location,_.matches);he!=null&&Ht({restoreScrollPosition:he})}return()=>{v=null,S=null,E=null}}function ga(j,z){return E&&E(j,z.map(he=>WA(he,_.loaderData)))||j.key}function Je(j,z){if(v&&S){let te=ga(j,z);v[te]=S()}}function St(j,z){if(v){let te=ga(j,z),he=v[te];if(typeof he=="number")return he}return null}function It(j,z,te){if(h)if(j){if(Object.keys(j[0].params).length>0)return{active:!0,matches:Cd(z,te,d,!0)}}else return{active:!0,matches:Cd(z,te,d,!0)||[]};return{active:!1,matches:null}}async function yr(j,z,te,he){if(!h)return{type:"success",matches:j};let Ae=j;for(;;){let ze=u==null,Qe=u||o,Me=i;try{await h({signal:te,path:z,matches:Ae,fetcherKey:he,patch:(Ne,it)=>{te.aborted||jv(Ne,it,Qe,Me,s)}})}catch(Ne){return{type:"error",error:Ne,partialMatches:Ae}}finally{ze&&!te.aborted&&(o=[...o])}if(te.aborted)return{type:"aborted"};let Be=Na(Qe,z,d);if(Be)return{type:"success",matches:Be};let Pe=Cd(Qe,z,d,!0);if(!Pe||Ae.length===Pe.length&&Ae.every((Ne,it)=>Ne.route.id===Pe[it].route.id))return{type:"success",matches:null};Ae=Pe}}function Wr(j){i={},u=Gd(j,s,void 0,i)}function Yr(j,z){let te=u==null;jv(j,z,u||o,i,s),te&&(o=[...o],Ht({}))}return V={get basename(){return d},get future(){return m},get state(){return _},get routes(){return o},get window(){return e},initialize:Ze,subscribe:er,enableScrollRestoration:Rn,navigate:cn,fetch:U,revalidate:ys,createHref:j=>n.history.createHref(j),encodeLocation:j=>n.history.encodeLocation(j),getFetcher:At,deleteFetcher:en,dispose:vt,getBlocker:vs,deleteBlocker:xs,patchRoutes:Yr,_internalFetchControllers:W,_internalActiveDeferreds:we,_internalSetRoutes:Wr},V}function EI(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function Jm(n,e,t,r,s,i,o,u){let d,c;if(o){d=[];for(let m of e)if(d.push(m),m.route.id===o){c=m;break}}else d=e,c=e[e.length-1];let h=pf(s||".",mf(d,i),bl(n.pathname,t)||n.pathname,u==="path");if(s==null&&(h.search=n.search,h.hash=n.hash),(s==null||s===""||s===".")&&c){let m=sg(h.search);if(c.route.index&&!m)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!c.route.index&&m){let g=new URLSearchParams(h.search),y=g.getAll("index");g.delete("index"),y.filter(E=>E).forEach(E=>g.append("index",E));let v=g.toString();h.search=v?"?"+v:""}}return r&&t!=="/"&&(h.pathname=h.pathname==="/"?t:di([t,h.pathname])),Xa(h)}function Fv(n,e,t,r){if(!r||!EI(r))return{path:t};if(r.formMethod&&!DI(r.formMethod))return{path:t,error:Tn(405,{method:r.formMethod})};let s=()=>({path:t,error:Tn(400,{type:"invalid-body"})}),i=r.formMethod||"get",o=n?i.toUpperCase():i.toLowerCase(),u=YS(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!fs(o))return s();let g=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((y,v)=>{let[E,S]=v;return""+y+E+"="+S+`
`},""):String(r.body);return{path:t,submission:{formMethod:o,formAction:u,formEncType:r.formEncType,formData:void 0,json:void 0,text:g}}}else if(r.formEncType==="application/json"){if(!fs(o))return s();try{let g=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:o,formAction:u,formEncType:r.formEncType,formData:void 0,json:g,text:void 0}}}catch{return s()}}}gt(typeof FormData=="function","FormData is not available in this environment");let d,c;if(r.formData)d=tp(r.formData),c=r.formData;else if(r.body instanceof FormData)d=tp(r.body),c=r.body;else if(r.body instanceof URLSearchParams)d=r.body,c=Gv(d);else if(r.body==null)d=new URLSearchParams,c=new FormData;else try{d=new URLSearchParams(r.body),c=Gv(d)}catch{return s()}let h={formMethod:o,formAction:u,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:c,json:void 0,text:void 0};if(fs(h.formMethod))return{path:t,submission:h};let m=ha(t);return e&&m.search&&sg(m.search)&&d.append("index",""),m.search="?"+d,{path:Xa(m),submission:h}}function Uv(n,e,t){t===void 0&&(t=!1);let r=n.findIndex(s=>s.route.id===e);return r>=0?n.slice(0,t?r+1:r):n}function Bv(n,e,t,r,s,i,o,u,d,c,h,m,g,y,v,E){let S=E?Nn(E[1])?E[1].error:E[1].data:void 0,A=n.createURL(e.location),I=n.createURL(s),R=t;i&&e.errors?R=Uv(t,Object.keys(e.errors)[0],!0):E&&Nn(E[1])&&(R=Uv(t,E[0]));let k=E?E[1].statusCode:void 0,C=o&&k&&k>=400,V=R.filter((N,F)=>{let{route:O}=N;if(O.lazy)return!0;if(O.loader==null)return!1;if(i)return ep(O,e.loaderData,e.errors);if(SI(e.loaderData,e.matches[F],N)||d.some(ie=>ie===N.route.id))return!0;let q=e.matches[F],H=N;return $v(N,rr({currentUrl:A,currentParams:q.params,nextUrl:I,nextParams:H.params},r,{actionResult:S,actionStatus:k,defaultShouldRevalidate:C?!1:u||A.pathname+A.search===I.pathname+I.search||A.search!==I.search||zS(q,H)}))}),_=[];return m.forEach((N,F)=>{if(i||!t.some(oe=>oe.route.id===N.routeId)||h.has(F))return;let O=Na(y,N.path,v);if(!O){_.push({key:F,routeId:N.routeId,path:N.path,matches:null,match:null,controller:null});return}let q=e.fetchers.get(F),H=xu(O,N.path),ie=!1;g.has(F)?ie=!1:c.has(F)?(c.delete(F),ie=!0):q&&q.state!=="idle"&&q.data===void 0?ie=u:ie=$v(H,rr({currentUrl:A,currentParams:e.matches[e.matches.length-1].params,nextUrl:I,nextParams:t[t.length-1].params},r,{actionResult:S,actionStatus:k,defaultShouldRevalidate:C?!1:u})),ie&&_.push({key:F,routeId:N.routeId,path:N.path,matches:O,match:H,controller:new AbortController})}),[V,_]}function ep(n,e,t){if(n.lazy)return!0;if(!n.loader)return!1;let r=e!=null&&e[n.id]!==void 0,s=t!=null&&t[n.id]!==void 0;return!r&&s?!1:typeof n.loader=="function"&&n.loader.hydrate===!0?!0:!r&&!s}function SI(n,e,t){let r=!e||t.route.id!==e.route.id,s=n[t.route.id]===void 0;return r||s}function zS(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function $v(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}function jv(n,e,t,r,s){var i;let o;if(n){let c=r[n];gt(c,"No route found to patch children into: routeId = "+n),c.children||(c.children=[]),o=c.children}else o=t;let u=e.filter(c=>!o.some(h=>WS(c,h))),d=Gd(u,s,[n||"_","patch",String(((i=o)==null?void 0:i.length)||"0")],r);o.push(...d)}function WS(n,e){return"id"in n&&"id"in e&&n.id===e.id?!0:n.index===e.index&&n.path===e.path&&n.caseSensitive===e.caseSensitive?(!n.children||n.children.length===0)&&(!e.children||e.children.length===0)?!0:n.children.every((t,r)=>{var s;return(s=e.children)==null?void 0:s.some(i=>WS(t,i))}):!1}async function TI(n,e,t){if(!n.lazy)return;let r=await n.lazy();if(!n.lazy)return;let s=t[n.id];gt(s,"No route found in manifest");let i={};for(let o in r){let d=s[o]!==void 0&&o!=="hasErrorBoundary";Qa(!d,'Route "'+s.id+'" has a static property "'+o+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+o+'" will be ignored.')),!d&&!HA.has(o)&&(i[o]=r[o])}Object.assign(s,i),Object.assign(s,rr({},e(s),{lazy:void 0}))}async function bI(n){let{matches:e}=n,t=e.filter(s=>s.shouldLoad);return(await Promise.all(t.map(s=>s.resolve()))).reduce((s,i,o)=>Object.assign(s,{[t[o].route.id]:i}),{})}async function wI(n,e,t,r,s,i,o,u,d,c){let h=i.map(y=>y.route.lazy?TI(y.route,d,u):void 0),m=i.map((y,v)=>{let E=h[v],S=s.some(I=>I.route.id===y.route.id);return rr({},y,{shouldLoad:S,resolve:async I=>(I&&r.method==="GET"&&(y.route.lazy||y.route.loader)&&(S=!0),S?AI(e,r,y,E,I,c):Promise.resolve({type:Ut.data,result:void 0}))})}),g=await n({matches:m,request:r,params:i[0].params,fetcherKey:o,context:c});try{await Promise.all(h)}catch{}return g}async function AI(n,e,t,r,s,i){let o,u,d=c=>{let h,m=new Promise((v,E)=>h=E);u=()=>h(),e.signal.addEventListener("abort",u);let g=v=>typeof c!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+n+'" [routeId: '+t.route.id+"]"))):c({request:e,params:t.params,context:i},...v!==void 0?[v]:[]),y=(async()=>{try{return{type:"data",result:await(s?s(E=>g(E)):g())}}catch(v){return{type:"error",result:v}}})();return Promise.race([y,m])};try{let c=t.route[n];if(r)if(c){let h,[m]=await Promise.all([d(c).catch(g=>{h=g}),r]);if(h!==void 0)throw h;o=m}else if(await r,c=t.route[n],c)o=await d(c);else if(n==="action"){let h=new URL(e.url),m=h.pathname+h.search;throw Tn(405,{method:e.method,pathname:m,routeId:t.route.id})}else return{type:Ut.data,result:void 0};else if(c)o=await d(c);else{let h=new URL(e.url),m=h.pathname+h.search;throw Tn(404,{pathname:m})}gt(o.result!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(c){return{type:Ut.error,result:c}}finally{u&&e.signal.removeEventListener("abort",u)}return o}async function II(n){let{result:e,type:t}=n;if(qS(e)){let m;try{let g=e.headers.get("Content-Type");g&&/\bapplication\/json\b/.test(g)?e.body==null?m=null:m=await e.json():m=await e.text()}catch(g){return{type:Ut.error,error:g}}return t===Ut.error?{type:Ut.error,error:new Kd(e.status,e.statusText,m),statusCode:e.status,headers:e.headers}:{type:Ut.data,data:m,statusCode:e.status,headers:e.headers}}if(t===Ut.error){if(Yv(e)){var r,s;if(e.data instanceof Error){var i,o;return{type:Ut.error,error:e.data,statusCode:(i=e.init)==null?void 0:i.status,headers:(o=e.init)!=null&&o.headers?new Headers(e.init.headers):void 0}}return{type:Ut.error,error:new Kd(((r=e.init)==null?void 0:r.status)||500,void 0,e.data),statusCode:_u(e)?e.status:void 0,headers:(s=e.init)!=null&&s.headers?new Headers(e.init.headers):void 0}}return{type:Ut.error,error:e,statusCode:_u(e)?e.status:void 0}}if(CI(e)){var u,d;return{type:Ut.deferred,deferredData:e,statusCode:(u=e.init)==null?void 0:u.status,headers:((d=e.init)==null?void 0:d.headers)&&new Headers(e.init.headers)}}if(Yv(e)){var c,h;return{type:Ut.data,data:e.data,statusCode:(c=e.init)==null?void 0:c.status,headers:(h=e.init)!=null&&h.headers?new Headers(e.init.headers):void 0}}return{type:Ut.data,data:e}}function RI(n,e,t,r,s,i){let o=n.headers.get("Location");if(gt(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!rg.test(o)){let u=r.slice(0,r.findIndex(d=>d.route.id===t)+1);o=Jm(new URL(e.url),u,s,!0,o,i),n.headers.set("Location",o)}return n}function Vv(n,e,t,r){let s=["about:","blob:","chrome:","chrome-untrusted:","content:","data:","devtools:","file:","filesystem:","javascript:"];if(rg.test(n)){let i=n,o=i.startsWith("//")?new URL(e.protocol+i):new URL(i);if(s.includes(o.protocol))throw new Error("Invalid redirect location");let u=bl(o.pathname,t)!=null;if(o.origin===e.origin&&u)return o.pathname+o.search+o.hash}try{let i=r.createURL(n);if(s.includes(i.protocol))throw new Error("Invalid redirect location")}catch{}return n}function Po(n,e,t,r){let s=n.createURL(YS(e)).toString(),i={signal:t};if(r&&fs(r.formMethod)){let{formMethod:o,formEncType:u}=r;i.method=o.toUpperCase(),u==="application/json"?(i.headers=new Headers({"Content-Type":u}),i.body=JSON.stringify(r.json)):u==="text/plain"?i.body=r.text:u==="application/x-www-form-urlencoded"&&r.formData?i.body=tp(r.formData):i.body=r.formData}return new Request(s,i)}function tp(n){let e=new URLSearchParams;for(let[t,r]of n.entries())e.append(t,typeof r=="string"?r:r.name);return e}function Gv(n){let e=new FormData;for(let[t,r]of n.entries())e.append(t,r);return e}function LI(n,e,t,r,s){let i={},o=null,u,d=!1,c={},h=t&&Nn(t[1])?t[1].error:void 0;return n.forEach(m=>{if(!(m.route.id in e))return;let g=m.route.id,y=e[g];if(gt(!Fa(y),"Cannot handle redirect results in processLoaderData"),Nn(y)){let v=y.error;h!==void 0&&(v=h,h=void 0),o=o||{};{let E=Ma(n,g);o[E.route.id]==null&&(o[E.route.id]=v)}i[g]=void 0,d||(d=!0,u=_u(y.error)?y.error.status:500),y.headers&&(c[g]=y.headers)}else na(y)?(r.set(g,y.deferredData),i[g]=y.deferredData.data,y.statusCode!=null&&y.statusCode!==200&&!d&&(u=y.statusCode),y.headers&&(c[g]=y.headers)):(i[g]=y.data,y.statusCode&&y.statusCode!==200&&!d&&(u=y.statusCode),y.headers&&(c[g]=y.headers))}),h!==void 0&&t&&(o={[t[0]]:h},i[t[0]]=void 0),{loaderData:i,errors:o,statusCode:u||200,loaderHeaders:c}}function Kv(n,e,t,r,s,i,o){let{loaderData:u,errors:d}=LI(e,t,r,o);return s.forEach(c=>{let{key:h,match:m,controller:g}=c,y=i[h];if(gt(y,"Did not find corresponding fetcher result"),!(g&&g.signal.aborted))if(Nn(y)){let v=Ma(n.matches,m==null?void 0:m.route.id);d&&d[v.route.id]||(d=rr({},d,{[v.route.id]:y.error})),n.fetchers.delete(h)}else if(Fa(y))gt(!1,"Unhandled fetcher revalidation redirect");else if(na(y))gt(!1,"Unhandled fetcher deferred data");else{let v=ji(y.data);n.fetchers.set(h,v)}}),{loaderData:u,errors:d}}function Hv(n,e,t,r){let s=rr({},e);for(let i of t){let o=i.route.id;if(e.hasOwnProperty(o)?e[o]!==void 0&&(s[o]=e[o]):n[o]!==void 0&&i.route.loader&&(s[o]=n[o]),r&&r.hasOwnProperty(o))break}return s}function zv(n){return n?Nn(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function Ma(n,e){return(e?n.slice(0,n.findIndex(r=>r.route.id===e)+1):[...n]).reverse().find(r=>r.route.hasErrorBoundary===!0)||n[0]}function Wv(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Tn(n,e){let{pathname:t,routeId:r,method:s,type:i,message:o}=e===void 0?{}:e,u="Unknown Server Error",d="Unknown @remix-run/router error";return n===400?(u="Bad Request",s&&t&&r?d="You made a "+s+' request to "'+t+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":i==="defer-action"?d="defer() is not supported in actions":i==="invalid-body"&&(d="Unable to encode submission body")):n===403?(u="Forbidden",d='Route "'+r+'" does not match URL "'+t+'"'):n===404?(u="Not Found",d='No route matches URL "'+t+'"'):n===405&&(u="Method Not Allowed",s&&t&&r?d="You made a "+s.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":s&&(d='Invalid request method "'+s.toUpperCase()+'"')),new Kd(n||500,u,new Error(d),!0)}function id(n){let e=Object.entries(n);for(let t=e.length-1;t>=0;t--){let[r,s]=e[t];if(Fa(s))return{key:r,result:s}}}function YS(n){let e=typeof n=="string"?ha(n):n;return Xa(rr({},e,{hash:""}))}function _I(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function kI(n){return qS(n.result)&&pI.has(n.result.status)}function na(n){return n.type===Ut.deferred}function Nn(n){return n.type===Ut.error}function Fa(n){return(n&&n.type)===Ut.redirect}function Yv(n){return typeof n=="object"&&n!=null&&"type"in n&&"data"in n&&"init"in n&&n.type==="DataWithResponseInit"}function CI(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function qS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function DI(n){return mI.has(n.toLowerCase())}function fs(n){return fI.has(n.toLowerCase())}async function PI(n,e,t,r,s){let i=Object.entries(e);for(let o=0;o<i.length;o++){let[u,d]=i[o],c=n.find(g=>(g==null?void 0:g.route.id)===u);if(!c)continue;let h=r.find(g=>g.route.id===c.route.id),m=h!=null&&!zS(h,c)&&(s&&s[c.route.id])!==void 0;na(d)&&m&&await ng(d,t,!1).then(g=>{g&&(e[u]=g)})}}async function OI(n,e,t){for(let r=0;r<t.length;r++){let{key:s,routeId:i,controller:o}=t[r],u=e[s];n.find(c=>(c==null?void 0:c.route.id)===i)&&na(u)&&(gt(o,"Expected an AbortController for revalidating fetcher deferred result"),await ng(u,o.signal,!0).then(c=>{c&&(e[s]=c)}))}}async function ng(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:Ut.data,data:n.deferredData.unwrappedData}}catch(s){return{type:Ut.error,error:s}}return{type:Ut.data,data:n.deferredData.data}}}function sg(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function xu(n,e){let t=typeof e=="string"?ha(e).search:e.search;if(n[n.length-1].route.index&&sg(t||""))return n[n.length-1];let r=GS(n);return r[r.length-1]}function qv(n){let{formMethod:e,formAction:t,formEncType:r,text:s,formData:i,json:o}=n;if(!(!e||!t||!r)){if(s!=null)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:void 0,text:s};if(i!=null)return{formMethod:e,formAction:t,formEncType:r,formData:i,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:o,text:void 0}}}function gm(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function NI(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function du(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function MI(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function ji(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function FI(n,e){try{let t=n.sessionStorage.getItem(HS);if(t){let r=JSON.parse(t);for(let[s,i]of Object.entries(r||{}))i&&Array.isArray(i)&&e.set(s,new Set(i||[]))}}catch{}}function UI(n,e){if(e.size>0){let t={};for(let[r,s]of e)t[r]=[...s];try{n.sessionStorage.setItem(HS,JSON.stringify(t))}catch(r){Qa(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hd(){return Hd=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Hd.apply(this,arguments)}const gf=D.createContext(null),QS=D.createContext(null),ma=D.createContext(null),ig=D.createContext(null),$s=D.createContext({outlet:null,matches:[],isDataRoute:!1}),XS=D.createContext(null);function BI(n,e){let{relative:t}=e===void 0?{}:e;wl()||gt(!1);let{basename:r,navigator:s}=D.useContext(ma),{hash:i,pathname:o,search:u}=JS(n,{relative:t}),d=o;return r!=="/"&&(d=o==="/"?r:di([r,o])),s.createHref({pathname:d,search:u,hash:i})}function wl(){return D.useContext(ig)!=null}function ao(){return wl()||gt(!1),D.useContext(ig).location}function ZS(n){D.useContext(ma).static||D.useLayoutEffect(n)}function Al(){let{isDataRoute:n}=D.useContext($s);return n?JI():$I()}function $I(){wl()||gt(!1);let n=D.useContext(gf),{basename:e,future:t,navigator:r}=D.useContext(ma),{matches:s}=D.useContext($s),{pathname:i}=ao(),o=JSON.stringify(mf(s,t.v7_relativeSplatPath)),u=D.useRef(!1);return ZS(()=>{u.current=!0}),D.useCallback(function(c,h){if(h===void 0&&(h={}),!u.current)return;if(typeof c=="number"){r.go(c);return}let m=pf(c,JSON.parse(o),i,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:di([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,o,i,n])}const jI=D.createContext(null);function VI(n){let e=D.useContext($s).outlet;return e&&D.createElement(jI.Provider,{value:n},e)}function yf(){let{matches:n}=D.useContext($s),e=n[n.length-1];return e?e.params:{}}function JS(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=D.useContext(ma),{matches:s}=D.useContext($s),{pathname:i}=ao(),o=JSON.stringify(mf(s,r.v7_relativeSplatPath));return D.useMemo(()=>pf(n,JSON.parse(o),i,t==="path"),[n,o,i,t])}function GI(n,e,t,r){wl()||gt(!1);let{navigator:s}=D.useContext(ma),{matches:i}=D.useContext($s),o=i[i.length-1],u=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let c=ao(),h;h=c;let m=h.pathname||"/",g=m;if(d!=="/"){let E=d.replace(/^\//,"").split("/");g="/"+m.replace(/^\//,"").split("/").slice(E.length).join("/")}let y=Na(n,{pathname:g});return YI(y&&y.map(E=>Object.assign({},E,{params:Object.assign({},u,E.params),pathname:di([d,s.encodeLocation?s.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?d:di([d,s.encodeLocation?s.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),i,t,r)}function KI(){let n=ZI(),e=_u(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),t?D.createElement("pre",{style:s},t):null,null)}const HI=D.createElement(KI,null);class zI extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?D.createElement($s.Provider,{value:this.props.routeContext},D.createElement(XS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function WI(n){let{routeContext:e,match:t,children:r}=n,s=D.useContext(gf);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),D.createElement($s.Provider,{value:e},r)}function YI(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,u=(s=t)==null?void 0:s.errors;if(u!=null){let h=o.findIndex(m=>m.route.id&&(u==null?void 0:u[m.route.id])!==void 0);h>=0||gt(!1),o=o.slice(0,Math.min(o.length,h+1))}let d=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let m=o[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(c=h),m.route.id){let{loaderData:g,errors:y}=t,v=m.route.loader&&g[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||v){d=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((h,m,g)=>{let y,v=!1,E=null,S=null;t&&(y=u&&m.route.id?u[m.route.id]:void 0,E=m.route.errorElement||HI,d&&(c<0&&g===0?(eR("route-fallback"),v=!0,S=null):c===g&&(v=!0,S=m.route.hydrateFallbackElement||null)));let A=e.concat(o.slice(0,g+1)),I=()=>{let R;return y?R=E:v?R=S:m.route.Component?R=D.createElement(m.route.Component,null):m.route.element?R=m.route.element:R=h,D.createElement(WI,{match:m,routeContext:{outlet:h,matches:A,isDataRoute:t!=null},children:R})};return t&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?D.createElement(zI,{location:t.location,revalidation:t.revalidation,component:E,error:y,children:I(),routeContext:{outlet:null,matches:A,isDataRoute:!0}}):I()},null)}var eT=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(eT||{}),tT=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(tT||{});function qI(n){let e=D.useContext(gf);return e||gt(!1),e}function QI(n){let e=D.useContext(QS);return e||gt(!1),e}function XI(n){let e=D.useContext($s);return e||gt(!1),e}function rT(n){let e=XI(),t=e.matches[e.matches.length-1];return t.route.id||gt(!1),t.route.id}function ZI(){var n;let e=D.useContext(XS),t=QI(tT.UseRouteError),r=rT();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function JI(){let{router:n}=qI(eT.UseNavigateStable),e=rT(),t=D.useRef(!1);return ZS(()=>{t.current=!0}),D.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,Hd({fromRouteId:e},i)))},[n,e])}const Qv={};function eR(n,e,t){Qv[n]||(Qv[n]=!0)}function tR(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function rp(n){let{to:e,replace:t,state:r,relative:s}=n;wl()||gt(!1);let{future:i,static:o}=D.useContext(ma),{matches:u}=D.useContext($s),{pathname:d}=ao(),c=Al(),h=pf(e,mf(u,i.v7_relativeSplatPath),d,s==="path"),m=JSON.stringify(h);return D.useEffect(()=>c(JSON.parse(m),{replace:t,state:r,relative:s}),[c,m,s,t,r]),null}function nT(n){return VI(n.context)}function rR(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Sr.Pop,navigator:i,static:o=!1,future:u}=n;wl()&&gt(!1);let d=e.replace(/^\/*/,"/"),c=D.useMemo(()=>({basename:d,navigator:i,static:o,future:Hd({v7_relativeSplatPath:!1},u)}),[d,u,i,o]);typeof r=="string"&&(r=ha(r));let{pathname:h="/",search:m="",hash:g="",state:y=null,key:v="default"}=r,E=D.useMemo(()=>{let S=bl(h,d);return S==null?null:{location:{pathname:S,search:m,hash:g,state:y,key:v},navigationType:s}},[d,h,m,g,y,v,s]);return E==null?null:D.createElement(ma.Provider,{value:c},D.createElement(ig.Provider,{children:t,value:E}))}new Promise(()=>{});function nR(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:D.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:D.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:D.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ku(){return ku=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ku.apply(this,arguments)}function sR(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function iR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function aR(n,e){return n.button===0&&(!e||e==="_self")&&!iR(n)}function np(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(s=>[t,s]):[[t,r]])},[]))}function oR(n,e){let t=np(n);return e&&e.forEach((r,s)=>{t.has(s)||e.getAll(s).forEach(i=>{t.append(s,i)})}),t}const lR=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],uR="6";try{window.__reactRouterVersion=uR}catch{}function cR(n,e){return xI({basename:void 0,future:ku({},void 0,{v7_prependBasename:!0}),history:VA({window:void 0}),hydrationData:dR(),routes:n,mapRouteProperties:nR,dataStrategy:void 0,patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function dR(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=ku({},e,{errors:fR(e.errors)})),e}function fR(n){if(!n)return null;let e=Object.entries(n),t={};for(let[r,s]of e)if(s&&s.__type==="RouteErrorResponse")t[r]=new Kd(s.status,s.statusText,s.data,s.internal===!0);else if(s&&s.__type==="Error"){if(s.__subType){let i=window[s.__subType];if(typeof i=="function")try{let o=new i(s.message);o.stack="",t[r]=o}catch{}}if(t[r]==null){let i=new Error(s.message);i.stack="",t[r]=i}}else t[r]=s;return t}const hR=D.createContext({isTransitioning:!1}),mR=D.createContext(new Map),pR="startTransition",Xv=Jp[pR],gR="flushSync",Zv=jA[gR];function yR(n){Xv?Xv(n):n()}function fu(n){Zv?Zv(n):n()}class vR{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}}function xR(n){let{fallbackElement:e,router:t,future:r}=n,[s,i]=D.useState(t.state),[o,u]=D.useState(),[d,c]=D.useState({isTransitioning:!1}),[h,m]=D.useState(),[g,y]=D.useState(),[v,E]=D.useState(),S=D.useRef(new Map),{v7_startTransition:A}=r||{},I=D.useCallback(N=>{A?yR(N):N()},[A]),R=D.useCallback((N,F)=>{let{deletedFetchers:O,flushSync:q,viewTransitionOpts:H}=F;N.fetchers.forEach((oe,ce)=>{oe.data!==void 0&&S.current.set(ce,oe.data)}),O.forEach(oe=>S.current.delete(oe));let ie=t.window==null||t.window.document==null||typeof t.window.document.startViewTransition!="function";if(!H||ie){q?fu(()=>i(N)):I(()=>i(N));return}if(q){fu(()=>{g&&(h&&h.resolve(),g.skipTransition()),c({isTransitioning:!0,flushSync:!0,currentLocation:H.currentLocation,nextLocation:H.nextLocation})});let oe=t.window.document.startViewTransition(()=>{fu(()=>i(N))});oe.finished.finally(()=>{fu(()=>{m(void 0),y(void 0),u(void 0),c({isTransitioning:!1})})}),fu(()=>y(oe));return}g?(h&&h.resolve(),g.skipTransition(),E({state:N,currentLocation:H.currentLocation,nextLocation:H.nextLocation})):(u(N),c({isTransitioning:!0,flushSync:!1,currentLocation:H.currentLocation,nextLocation:H.nextLocation}))},[t.window,g,h,S,I]);D.useLayoutEffect(()=>t.subscribe(R),[t,R]),D.useEffect(()=>{d.isTransitioning&&!d.flushSync&&m(new vR)},[d]),D.useEffect(()=>{if(h&&o&&t.window){let N=o,F=h.promise,O=t.window.document.startViewTransition(async()=>{I(()=>i(N)),await F});O.finished.finally(()=>{m(void 0),y(void 0),u(void 0),c({isTransitioning:!1})}),y(O)}},[I,o,h,t.window]),D.useEffect(()=>{h&&o&&s.location.key===o.location.key&&h.resolve()},[h,g,s.location,o]),D.useEffect(()=>{!d.isTransitioning&&v&&(u(v.state),c({isTransitioning:!0,flushSync:!1,currentLocation:v.currentLocation,nextLocation:v.nextLocation}),E(void 0))},[d.isTransitioning,v]),D.useEffect(()=>{},[]);let k=D.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:N=>t.navigate(N),push:(N,F,O)=>t.navigate(N,{state:F,preventScrollReset:O==null?void 0:O.preventScrollReset}),replace:(N,F,O)=>t.navigate(N,{replace:!0,state:F,preventScrollReset:O==null?void 0:O.preventScrollReset})}),[t]),C=t.basename||"/",V=D.useMemo(()=>({router:t,navigator:k,static:!1,basename:C}),[t,k,C]),_=D.useMemo(()=>({v7_relativeSplatPath:t.future.v7_relativeSplatPath}),[t.future.v7_relativeSplatPath]);return D.useEffect(()=>tR(r,t.future),[r,t.future]),D.createElement(D.Fragment,null,D.createElement(gf.Provider,{value:V},D.createElement(QS.Provider,{value:s},D.createElement(mR.Provider,{value:S.current},D.createElement(hR.Provider,{value:d},D.createElement(rR,{basename:C,location:s.location,navigationType:s.historyAction,navigator:k,future:_},s.initialized||t.future.v7_partialHydration?D.createElement(ER,{routes:t.routes,future:t.future,state:s}):e))))),null)}const ER=D.memo(SR);function SR(n){let{routes:e,future:t,state:r}=n;return GI(e,void 0,r,t)}const TR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",bR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ps=D.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:u,target:d,to:c,preventScrollReset:h,viewTransition:m}=e,g=sR(e,lR),{basename:y}=D.useContext(ma),v,E=!1;if(typeof c=="string"&&bR.test(c)&&(v=c,TR))try{let R=new URL(window.location.href),k=c.startsWith("//")?new URL(R.protocol+c):new URL(c),C=bl(k.pathname,y);k.origin===R.origin&&C!=null?c=C+k.search+k.hash:E=!0}catch{}let S=BI(c,{relative:s}),A=wR(c,{replace:o,state:u,target:d,preventScrollReset:h,relative:s,viewTransition:m});function I(R){r&&r(R),R.defaultPrevented||A(R)}return D.createElement("a",ku({},g,{href:v||S,onClick:E||i?r:I,ref:t,target:d}))});var Jv;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Jv||(Jv={}));var ex;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(ex||(ex={}));function wR(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:u}=e===void 0?{}:e,d=Al(),c=ao(),h=JS(n,{relative:o});return D.useCallback(m=>{if(aR(m,t)){m.preventDefault();let g=r!==void 0?r:Xa(c)===Xa(h);d(n,{replace:g,state:s,preventScrollReset:i,relative:o,viewTransition:u})}},[c,d,h,r,s,t,n,i,o,u])}function sT(n){let e=D.useRef(np(n)),t=D.useRef(!1),r=ao(),s=D.useMemo(()=>oR(r.search,t.current?null:e.current),[r.search]),i=Al(),o=D.useCallback((u,d)=>{const c=np(typeof u=="function"?u(s):u);t.current=!0,i("?"+c,d)},[i,s]);return[s,o]}/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iT=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var IR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RR=D.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:o,...u},d)=>D.createElement("svg",{ref:d,...IR,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:iT("lucide",s),...u},[...o.map(([c,h])=>D.createElement(c,h)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=(n,e)=>{const t=D.forwardRef(({className:r,...s},i)=>D.createElement(RR,{ref:i,iconNode:e,className:iT(`lucide-${AR(n)}`,r),...s}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LR=Pt("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _R=Pt("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kR=Pt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CR=Pt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=Pt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DR=Pt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PR=Pt("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OR=Pt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=Pt("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=Pt("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MR=Pt("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FR=Pt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UR=Pt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BR=Pt("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $R=Pt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jR=Pt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VR=Pt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GR=Pt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KR=Pt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HR=Pt("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=Pt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=Pt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zR=Pt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WR=Pt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=Pt("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=Pt("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YR=Pt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qR=Pt("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QR=Pt("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XR=Pt("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZR=Pt("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function dT(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=dT(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function fT(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=dT(n))&&(r&&(r+=" "),r+=e);return r}const og="-",JR=n=>{const e=tL(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const u=o.split(og);return u[0]===""&&u.length!==1&&u.shift(),hT(u,e)||eL(o)},getConflictingClassGroupIds:(o,u)=>{const d=t[o]||[];return u&&r[o]?[...d,...r[o]]:d}}},hT=(n,e)=>{var o;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?hT(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const i=n.join(og);return(o=e.validators.find(({validator:u})=>u(i)))==null?void 0:o.classGroupId},tx=/^\[(.+)\]$/,eL=n=>{if(tx.test(n)){const e=tx.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},tL=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return nL(Object.entries(n.classGroups),t).forEach(([i,o])=>{sp(o,r,i,e)}),r},sp=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const i=s===""?e:rx(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(rL(s)){sp(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,o])=>{sp(o,rx(e,i),t,r)})})},rx=(n,e)=>{let t=n;return e.split(og).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},rL=n=>n.isThemeGetter,nL=(n,e)=>e?n.map(([t,r])=>{const s=r.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,u])=>[e+o,u])):i);return[t,s]}):n,sL=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(i,o)=>{t.set(i,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(i){let o=t.get(i);if(o!==void 0)return o;if((o=r.get(i))!==void 0)return s(i,o),o},set(i,o){t.has(i)?t.set(i,o):s(i,o)}}},mT="!",iL=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,s=e[0],i=e.length,o=u=>{const d=[];let c=0,h=0,m;for(let S=0;S<u.length;S++){let A=u[S];if(c===0){if(A===s&&(r||u.slice(S,S+i)===e)){d.push(u.slice(h,S)),h=S+i;continue}if(A==="/"){m=S;continue}}A==="["?c++:A==="]"&&c--}const g=d.length===0?u:u.substring(h),y=g.startsWith(mT),v=y?g.substring(1):g,E=m&&m>h?m-h:void 0;return{modifiers:d,hasImportantModifier:y,baseClassName:v,maybePostfixModifierPosition:E}};return t?u=>t({className:u,parseClassName:o}):o},aL=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},oL=n=>({cache:sL(n.cacheSize),parseClassName:iL(n),...JR(n)}),lL=/\s+/,uL=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s}=e,i=[],o=n.trim().split(lL);let u="";for(let d=o.length-1;d>=0;d-=1){const c=o[d],{modifiers:h,hasImportantModifier:m,baseClassName:g,maybePostfixModifierPosition:y}=t(c);let v=!!y,E=r(v?g.substring(0,y):g);if(!E){if(!v){u=c+(u.length>0?" "+u:u);continue}if(E=r(g),!E){u=c+(u.length>0?" "+u:u);continue}v=!1}const S=aL(h).join(":"),A=m?S+mT:S,I=A+E;if(i.includes(I))continue;i.push(I);const R=s(E,v);for(let k=0;k<R.length;++k){const C=R[k];i.push(A+C)}u=c+(u.length>0?" "+u:u)}return u};function cL(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=pT(e))&&(r&&(r+=" "),r+=t);return r}const pT=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=pT(n[r]))&&(t&&(t+=" "),t+=e);return t};function dL(n,...e){let t,r,s,i=o;function o(d){const c=e.reduce((h,m)=>m(h),n());return t=oL(c),r=t.cache.get,s=t.cache.set,i=u,u(d)}function u(d){const c=r(d);if(c)return c;const h=uL(d,t);return s(d,h),h}return function(){return i(cL.apply(null,arguments))}}const Jt=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},gT=/^\[(?:([a-z-]+):)?(.+)\]$/i,fL=/^\d+\/\d+$/,hL=new Set(["px","full","screen"]),mL=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,pL=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gL=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,yL=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,vL=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Js=n=>Yo(n)||hL.has(n)||fL.test(n),Mi=n=>Il(n,"length",IL),Yo=n=>!!n&&!Number.isNaN(Number(n)),ym=n=>Il(n,"number",Yo),hu=n=>!!n&&Number.isInteger(Number(n)),xL=n=>n.endsWith("%")&&Yo(n.slice(0,-1)),lt=n=>gT.test(n),Fi=n=>mL.test(n),EL=new Set(["length","size","percentage"]),SL=n=>Il(n,EL,yT),TL=n=>Il(n,"position",yT),bL=new Set(["image","url"]),wL=n=>Il(n,bL,LL),AL=n=>Il(n,"",RL),mu=()=>!0,Il=(n,e,t)=>{const r=gT.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},IL=n=>pL.test(n)&&!gL.test(n),yT=()=>!1,RL=n=>yL.test(n),LL=n=>vL.test(n),_L=()=>{const n=Jt("colors"),e=Jt("spacing"),t=Jt("blur"),r=Jt("brightness"),s=Jt("borderColor"),i=Jt("borderRadius"),o=Jt("borderSpacing"),u=Jt("borderWidth"),d=Jt("contrast"),c=Jt("grayscale"),h=Jt("hueRotate"),m=Jt("invert"),g=Jt("gap"),y=Jt("gradientColorStops"),v=Jt("gradientColorStopPositions"),E=Jt("inset"),S=Jt("margin"),A=Jt("opacity"),I=Jt("padding"),R=Jt("saturate"),k=Jt("scale"),C=Jt("sepia"),V=Jt("skew"),_=Jt("space"),N=Jt("translate"),F=()=>["auto","contain","none"],O=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",lt,e],H=()=>[lt,e],ie=()=>["",Js,Mi],oe=()=>["auto",Yo,lt],ce=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ae=()=>["solid","dashed","dotted","double","none"],ue=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],W=()=>["start","end","center","between","around","evenly","stretch"],Z=()=>["","0",lt],ne=()=>["auto","avoid","all","avoid-page","page","left","right","column"],P=()=>[Yo,lt];return{cacheSize:500,separator:":",theme:{colors:[mu],spacing:[Js,Mi],blur:["none","",Fi,lt],brightness:P(),borderColor:[n],borderRadius:["none","","full",Fi,lt],borderSpacing:H(),borderWidth:ie(),contrast:P(),grayscale:Z(),hueRotate:P(),invert:Z(),gap:H(),gradientColorStops:[n],gradientColorStopPositions:[xL,Mi],inset:q(),margin:q(),opacity:P(),padding:H(),saturate:P(),scale:P(),sepia:Z(),skew:P(),space:H(),translate:H()},classGroups:{aspect:[{aspect:["auto","square","video",lt]}],container:["container"],columns:[{columns:[Fi]}],"break-after":[{"break-after":ne()}],"break-before":[{"break-before":ne()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ce(),lt]}],overflow:[{overflow:O()}],"overflow-x":[{"overflow-x":O()}],"overflow-y":[{"overflow-y":O()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[E]}],"inset-x":[{"inset-x":[E]}],"inset-y":[{"inset-y":[E]}],start:[{start:[E]}],end:[{end:[E]}],top:[{top:[E]}],right:[{right:[E]}],bottom:[{bottom:[E]}],left:[{left:[E]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",hu,lt]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",lt]}],grow:[{grow:Z()}],shrink:[{shrink:Z()}],order:[{order:["first","last","none",hu,lt]}],"grid-cols":[{"grid-cols":[mu]}],"col-start-end":[{col:["auto",{span:["full",hu,lt]},lt]}],"col-start":[{"col-start":oe()}],"col-end":[{"col-end":oe()}],"grid-rows":[{"grid-rows":[mu]}],"row-start-end":[{row:["auto",{span:[hu,lt]},lt]}],"row-start":[{"row-start":oe()}],"row-end":[{"row-end":oe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",lt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",lt]}],gap:[{gap:[g]}],"gap-x":[{"gap-x":[g]}],"gap-y":[{"gap-y":[g]}],"justify-content":[{justify:["normal",...W()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...W(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...W(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[I]}],px:[{px:[I]}],py:[{py:[I]}],ps:[{ps:[I]}],pe:[{pe:[I]}],pt:[{pt:[I]}],pr:[{pr:[I]}],pb:[{pb:[I]}],pl:[{pl:[I]}],m:[{m:[S]}],mx:[{mx:[S]}],my:[{my:[S]}],ms:[{ms:[S]}],me:[{me:[S]}],mt:[{mt:[S]}],mr:[{mr:[S]}],mb:[{mb:[S]}],ml:[{ml:[S]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",lt,e]}],"min-w":[{"min-w":[lt,e,"min","max","fit"]}],"max-w":[{"max-w":[lt,e,"none","full","min","max","fit","prose",{screen:[Fi]},Fi]}],h:[{h:[lt,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[lt,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[lt,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[lt,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Fi,Mi]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ym]}],"font-family":[{font:[mu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",lt]}],"line-clamp":[{"line-clamp":["none",Yo,ym]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Js,lt]}],"list-image":[{"list-image":["none",lt]}],"list-style-type":[{list:["none","disc","decimal",lt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[A]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[A]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ae(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Js,Mi]}],"underline-offset":[{"underline-offset":["auto",Js,lt]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:H()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",lt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",lt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[A]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ce(),TL]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",SL]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},wL]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[v]}],"gradient-via-pos":[{via:[v]}],"gradient-to-pos":[{to:[v]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[u]}],"border-w-x":[{"border-x":[u]}],"border-w-y":[{"border-y":[u]}],"border-w-s":[{"border-s":[u]}],"border-w-e":[{"border-e":[u]}],"border-w-t":[{"border-t":[u]}],"border-w-r":[{"border-r":[u]}],"border-w-b":[{"border-b":[u]}],"border-w-l":[{"border-l":[u]}],"border-opacity":[{"border-opacity":[A]}],"border-style":[{border:[...ae(),"hidden"]}],"divide-x":[{"divide-x":[u]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[u]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[A]}],"divide-style":[{divide:ae()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...ae()]}],"outline-offset":[{"outline-offset":[Js,lt]}],"outline-w":[{outline:[Js,Mi]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[A]}],"ring-offset-w":[{"ring-offset":[Js,Mi]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Fi,AL]}],"shadow-color":[{shadow:[mu]}],opacity:[{opacity:[A]}],"mix-blend":[{"mix-blend":[...ue(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ue()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",Fi,lt]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[m]}],saturate:[{saturate:[R]}],sepia:[{sepia:[C]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[A]}],"backdrop-saturate":[{"backdrop-saturate":[R]}],"backdrop-sepia":[{"backdrop-sepia":[C]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",lt]}],duration:[{duration:P()}],ease:[{ease:["linear","in","out","in-out",lt]}],delay:[{delay:P()}],animate:[{animate:["none","spin","ping","pulse","bounce",lt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[hu,lt]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[V]}],"skew-y":[{"skew-y":[V]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",lt]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",lt]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":H()}],"scroll-mx":[{"scroll-mx":H()}],"scroll-my":[{"scroll-my":H()}],"scroll-ms":[{"scroll-ms":H()}],"scroll-me":[{"scroll-me":H()}],"scroll-mt":[{"scroll-mt":H()}],"scroll-mr":[{"scroll-mr":H()}],"scroll-mb":[{"scroll-mb":H()}],"scroll-ml":[{"scroll-ml":H()}],"scroll-p":[{"scroll-p":H()}],"scroll-px":[{"scroll-px":H()}],"scroll-py":[{"scroll-py":H()}],"scroll-ps":[{"scroll-ps":H()}],"scroll-pe":[{"scroll-pe":H()}],"scroll-pt":[{"scroll-pt":H()}],"scroll-pr":[{"scroll-pr":H()}],"scroll-pb":[{"scroll-pb":H()}],"scroll-pl":[{"scroll-pl":H()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",lt]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[Js,Mi,ym]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},kL=dL(_L);function Hr(...n){return kL(fT(n))}function sn(n=500){return new Promise(e=>setTimeout(e,n))}const nx=n=>{let e;const t=new Set,r=(c,h)=>{const m=typeof c=="function"?c(e):c;if(!Object.is(m,e)){const g=e;e=h??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(y=>y(e,g))}},s=()=>e,u={setState:r,getState:s,getInitialState:()=>d,subscribe:c=>(t.add(c),()=>t.delete(c))},d=e=n(r,s,u);return u},CL=(n=>n?nx(n):nx),DL=n=>n;function PL(n,e=DL){const t=ve.useSyncExternalStore(n.subscribe,ve.useCallback(()=>e(n.getState()),[n,e]),ve.useCallback(()=>e(n.getInitialState()),[n,e]));return ve.useDebugValue(t),t}const sx=n=>{const e=CL(n),t=r=>PL(e,r);return Object.assign(t,e),t},vf=(n=>n?sx(n):sx);function OL(n,e){let t;try{t=n()}catch{return}return{getItem:s=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),u=(i=t.getItem(s))!=null?i:null;return u instanceof Promise?u.then(o):o(u)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const ip=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return ip(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return ip(r)(t)}}}},NL=(n,e)=>(t,r,s)=>{let i={storage:OL(()=>window.localStorage),partialize:S=>S,version:0,merge:(S,A)=>({...A,...S}),...e},o=!1,u=0;const d=new Set,c=new Set;let h=i.storage;if(!h)return n((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...S)},r,s);const m=()=>{const S=i.partialize({...r()});return h.setItem(i.name,{state:S,version:i.version})},g=s.setState;s.setState=(S,A)=>(g(S,A),m());const y=n((...S)=>(t(...S),m()),r,s);s.getInitialState=()=>y;let v;const E=()=>{var S,A;if(!h)return;const I=++u;o=!1,d.forEach(k=>{var C;return k((C=r())!=null?C:y)});const R=((A=i.onRehydrateStorage)==null?void 0:A.call(i,(S=r())!=null?S:y))||void 0;return ip(h.getItem.bind(h))(i.name).then(k=>{if(k)if(typeof k.version=="number"&&k.version!==i.version){if(i.migrate){const C=i.migrate(k.state,k.version);return C instanceof Promise?C.then(V=>[!0,V]):[!0,C]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,k.state];return[!1,void 0]}).then(k=>{var C;if(I!==u)return;const[V,_]=k;if(v=i.merge(_,(C=r())!=null?C:y),t(v,!0),V)return m()}).then(()=>{I===u&&(R==null||R(v,void 0),v=r(),o=!0,c.forEach(k=>k(v)))}).catch(k=>{I===u&&(R==null||R(void 0,k))})};return s.persist={setOptions:S=>{i={...i,...S},S.storage&&(h=S.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>E(),hasHydrated:()=>o,onHydrate:S=>(d.add(S),()=>{d.delete(S)}),onFinishHydration:S=>(c.add(S),()=>{c.delete(S)})},i.skipHydration||E(),v||y},vT=NL,Za=vf()(vT(n=>({user:null,token:localStorage.getItem("token"),setSession:(e,t)=>n({user:e,token:t}),clearSession:()=>n({user:null,token:null})}),{name:"auth-store"})),Cu=vf(n=>({collapsed:!1,mobileOpen:!1,toggle:()=>n(e=>({collapsed:!e.collapsed})),setMobileOpen:e=>n({mobileOpen:e})})),ML=[{to:"/",label:"Home",icon:BR},{to:"/shorts",label:"Shorts",icon:PR},{to:"/subscriptions",label:"Subscriptions",icon:qR}],FL=[{to:"/history",label:"History",icon:UR},{to:"/playlist/p1",label:"Watch Later",icon:OR},{to:"/liked",label:"Liked Videos",icon:ag}],UL=[{to:"/trending",label:"Trending",icon:MR},{to:"/live",label:"Live",icon:HR}];function pu({item:n,collapsed:e,active:t}){const r=n.icon;return e?b.jsxs(ps,{to:n.to,className:Hr("flex flex-col items-center gap-1 rounded-lg px-1 py-3 text-[10px] hover:bg-accent",t&&"bg-accent font-semibold"),children:[b.jsx(r,{className:"h-5 w-5"}),b.jsx("span",{className:"leading-tight",children:n.label})]}):b.jsxs(ps,{to:n.to,className:Hr("flex items-center gap-5 rounded-lg px-3 py-2 text-sm hover:bg-accent transition-colors",t&&"bg-accent font-semibold"),children:[b.jsx(r,{className:"h-5 w-5 shrink-0"}),b.jsx("span",{children:n.label})]})}function vm(){return b.jsx("hr",{className:"my-2 border-border"})}function BL(){const n=ao(),e=Za(s=>{var i;return(i=s.user)==null?void 0:i.role}),t=Cu(s=>s.collapsed),r=s=>n.pathname===s;return b.jsx("aside",{className:Hr("hidden shrink-0 overflow-y-auto overflow-x-hidden border-r-0 md:block transition-all duration-200",t?"w-[72px]":"w-60"),style:{height:"calc(100vh - 56px)"},children:b.jsxs("nav",{className:Hr("flex flex-col",t?"items-center px-1 pt-1":"px-3 pt-2"),children:[ML.map(s=>b.jsx(pu,{item:s,collapsed:t,active:r(s.to)},s.to)),b.jsx(vm,{}),!t&&b.jsxs("div",{className:"flex items-center gap-1 px-3 py-2 text-sm font-medium",children:["You ",b.jsx(aT,{className:"h-4 w-4"})]}),FL.map(s=>b.jsx(pu,{item:s,collapsed:t,active:r(s.to)},s.to)),b.jsx(vm,{}),!t&&b.jsx("div",{className:"px-3 py-2 text-sm font-medium",children:"Explore"}),UL.map(s=>b.jsx(pu,{item:s,collapsed:t,active:r(s.to)},s.to)),(e==="creator"||e==="admin")&&b.jsxs(b.Fragment,{children:[b.jsx(vm,{}),b.jsx(pu,{item:{to:"/studio",label:"Creator Studio",icon:$R},collapsed:t,active:r("/studio")})]}),e==="admin"&&b.jsx(pu,{item:{to:"/admin/dashboard",label:"Admin",icon:zR},collapsed:t,active:r("/admin/dashboard")})]})})}const ap=vf()(vT((n,e)=>({theme:"light",toggleTheme:()=>n({theme:e().theme==="light"?"dark":"light"})}),{name:"theme-store"})),ix=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,ax=fT,$L=(n,e)=>t=>{var r;if((e==null?void 0:e.variants)==null)return ax(n,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const h=t==null?void 0:t[c],m=i==null?void 0:i[c];if(h===null)return null;const g=ix(h)||ix(m);return s[c][g]}),u=t&&Object.entries(t).reduce((c,h)=>{let[m,g]=h;return g===void 0||(c[m]=g),c},{}),d=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,h)=>{let{class:m,className:g,...y}=h;return Object.entries(y).every(v=>{let[E,S]=v;return Array.isArray(S)?S.includes({...i,...u}[E]):{...i,...u}[E]===S})?[...c,m,g]:c},[]);return ax(n,o,d,t==null?void 0:t.class,t==null?void 0:t.className)},jL=$L("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",destructive:"bg-red-600 text-white hover:bg-red-500"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ct=D.forwardRef(({className:n,variant:e,size:t,...r},s)=>b.jsx("button",{className:Hr(jL({variant:e,size:t,className:n})),ref:s,...r}));Ct.displayName="Button";const jr="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",Ui=["https://i.pravatar.cc/120?img=12","https://i.pravatar.cc/120?img=24","https://i.pravatar.cc/120?img=36","https://i.pravatar.cc/120?img=48","https://i.pravatar.cc/120?img=5","https://i.pravatar.cc/120?img=15","https://i.pravatar.cc/120?img=33","https://i.pravatar.cc/120?img=57"],ut=[{id:"u1",name:"Alice User",handle:"@alice",avatarUrl:Ui[0],role:"user",followersCount:1200},{id:"u2",name:"Chris Creator",handle:"@creator",avatarUrl:Ui[1],role:"creator",followersCount:98e3},{id:"u3",name:"Ada Admin",handle:"@admin",avatarUrl:Ui[2],role:"admin",followersCount:3200},{id:"u4",name:"Nora Stream",handle:"@nora",avatarUrl:Ui[3],role:"creator",followersCount:45e3},{id:"u5",name:"Max Gaming",handle:"@maxgaming",avatarUrl:Ui[4],role:"creator",followersCount:32e4},{id:"u6",name:"Melody Vibes",handle:"@melodyvibes",avatarUrl:Ui[5],role:"creator",followersCount:15e5},{id:"u7",name:"News Daily",handle:"@newsdaily",avatarUrl:Ui[6],role:"creator",followersCount:89e4},{id:"u8",name:"Sport Zone",handle:"@sportzone",avatarUrl:Ui[7],role:"creator",followersCount:67e4}],mr=n=>`https://picsum.photos/seed/${n}/640/360`,xr=[{id:"v1",type:"long",title:"React 18 in Production: Battle-tested Patterns",description:"Deep dive into data, route and rendering patterns. We cover Suspense, transitions, server components, and how to structure large React applications for performance and maintainability.",coverUrl:mr("react18"),duration:1330,views:56e4,likes:22e3,createdAt:new Date(Date.now()-864e5*3).toISOString(),author:ut[1],tags:["react","frontend"],category:"Tech",visibility:"public",status:"published",hlsUrl:jr},{id:"v2",type:"long",title:"How We Designed a Modern Video UX",description:"Case study on feed, playback, and creator flow. Learn about the design decisions behind building a video platform from scratch.",coverUrl:mr("ux"),duration:920,views:21e4,likes:8e3,createdAt:new Date(Date.now()-864e5*6).toISOString(),author:ut[3],tags:["ux","product"],category:"Design",visibility:"public",status:"published",hlsUrl:jr},{id:"v3",type:"long",title:"Top 10 Indie Games You Missed in 2024",description:"Hidden gems from the indie scene that deserve your attention. From puzzle platformers to narrative adventures.",coverUrl:mr("indiegames"),duration:1580,views:89e4,likes:45e3,createdAt:new Date(Date.now()-864e5*2).toISOString(),author:ut[4],tags:["gaming","indie"],category:"Gaming",visibility:"public",status:"published",hlsUrl:jr},{id:"v4",type:"long",title:"Lo-fi Beats to Study & Relax To - 3 Hour Mix",description:"Chill lo-fi hip hop beats perfect for studying, working, or relaxing. Enjoy 3 hours of uninterrupted vibes.",coverUrl:mr("lofi"),duration:10800,views:42e5,likes:18e4,createdAt:new Date(Date.now()-864e5*14).toISOString(),author:ut[5],tags:["music","lofi","study"],category:"Music",visibility:"public",status:"published",hlsUrl:jr},{id:"v5",type:"long",title:"Breaking: Major Tech Layoffs Across Silicon Valley",description:"Analysis of the latest wave of tech layoffs, what it means for the industry, and how affected workers can navigate this challenging time.",coverUrl:mr("technews"),duration:720,views:13e5,likes:32e3,createdAt:new Date(Date.now()-864e5).toISOString(),author:ut[6],tags:["news","tech"],category:"News",visibility:"public",status:"published",hlsUrl:jr},{id:"v6",type:"long",title:"Champions League Final Highlights",description:"Full highlights from an incredible Champions League final. Goals, saves, and drama.",coverUrl:mr("football"),duration:960,views:56e5,likes:21e4,createdAt:new Date(Date.now()-864e5*1).toISOString(),author:ut[7],tags:["sports","football"],category:"Sports",visibility:"public",status:"published",hlsUrl:jr},{id:"v7",type:"long",title:"Building a Full-Stack App with Next.js 15",description:"Complete tutorial covering Next.js 15 features including server actions, parallel routes, and the new caching model.",coverUrl:mr("nextjs"),duration:2400,views:34e4,likes:15e3,createdAt:new Date(Date.now()-864e5*5).toISOString(),author:ut[1],tags:["nextjs","tutorial"],category:"Education",visibility:"public",status:"published",hlsUrl:jr},{id:"v8",type:"long",title:"Movie Recap: The Best Films of 2024",description:"A look back at the most memorable films of the year, from blockbusters to art-house gems.",coverUrl:mr("movies"),duration:1800,views:78e4,likes:28e3,createdAt:new Date(Date.now()-864e5*4).toISOString(),author:ut[3],tags:["entertainment","movies"],category:"Entertainment",visibility:"public",status:"published",hlsUrl:jr},{id:"v9",type:"long",title:"Guitar Tutorial: Learn 5 Songs in 30 Minutes",description:"Beginner-friendly guitar lesson. Learn to play popular songs with simple chords and strumming patterns.",coverUrl:mr("guitar"),duration:1860,views:45e4,likes:19e3,createdAt:new Date(Date.now()-864e5*8).toISOString(),author:ut[5],tags:["music","tutorial"],category:"Music",visibility:"public",status:"published",hlsUrl:jr},{id:"v10",type:"long",title:"Minecraft Speedrun World Record Attempt",description:"Watch this insane speedrun attempt of Minecraft. Will we break the record?",coverUrl:mr("minecraft"),duration:1200,views:21e5,likes:95e3,createdAt:new Date(Date.now()-864e5*3).toISOString(),author:ut[4],tags:["gaming","minecraft","speedrun"],category:"Gaming",visibility:"public",status:"published",hlsUrl:jr},{id:"v11",type:"long",title:"CSS Has Changed: Modern Techniques You Should Know",description:"Container queries, cascade layers, :has() selector, and more. CSS in 2024 is incredibly powerful.",coverUrl:mr("moderncss"),duration:1100,views:28e4,likes:12e3,createdAt:new Date(Date.now()-864e5*7).toISOString(),author:ut[1],tags:["css","frontend"],category:"Tech",visibility:"public",status:"published",hlsUrl:jr},{id:"v12",type:"long",title:"NBA Playoffs: Top 10 Plays of the Week",description:"The most jaw-dropping dunks, assists, and game-winners from this week in the NBA playoffs.",coverUrl:mr("nba"),duration:660,views:34e5,likes:15e4,createdAt:new Date(Date.now()-864e5*2).toISOString(),author:ut[7],tags:["sports","basketball"],category:"Sports",visibility:"public",status:"published",hlsUrl:jr},{id:"s1",type:"short",title:"30s Tip: Better Loading States",description:"Skeletons > spinners for content surfaces.",coverUrl:mr("short1"),duration:30,views:99e3,likes:6300,createdAt:new Date(Date.now()-864e5).toISOString(),author:ut[1],tags:["shorts"],category:"Tech",visibility:"public",status:"published"},{id:"s2",type:"short",title:"1 Minute CSS Grid Layout",description:"Practical grid recipe in under a minute.",coverUrl:mr("short2"),duration:45,views:142e3,likes:10800,createdAt:new Date(Date.now()-864e5*2).toISOString(),author:ut[3],tags:["css"],category:"Tech",visibility:"public",status:"published"},{id:"s3",type:"short",title:"Insane Goal from Last Night",description:"You have to see this bicycle kick!",coverUrl:mr("short3"),duration:15,views:28e5,likes:18e4,createdAt:new Date(Date.now()-864e5).toISOString(),author:ut[7],tags:["sports","football"],category:"Sports",visibility:"public",status:"published"},{id:"s4",type:"short",title:"Epic Gaming Clutch Moment",description:"1v5 clutch that broke the internet.",coverUrl:mr("short4"),duration:25,views:15e5,likes:95e3,createdAt:new Date(Date.now()-864e5*3).toISOString(),author:ut[4],tags:["gaming","clutch"],category:"Gaming",visibility:"public",status:"published"},{id:"r1",type:"replay",title:"Livestream Replay: Architecture AMA",description:"Replay of live architecture discussion. We covered microservices, monoliths, and everything in between.",coverUrl:mr("replay"),duration:3800,views:42e3,likes:1800,createdAt:new Date(Date.now()-864e5*7).toISOString(),author:ut[3],tags:["live","replay"],category:"Tech",visibility:"public",status:"published",hlsUrl:jr}],ad=[{id:"l1",title:"Building Creator Studio Live",coverUrl:mr("live1"),author:ut[3],viewers:12400,category:"Tech",status:"live",hlsUrl:jr,startedAt:new Date(Date.now()-36e5).toISOString()},{id:"l2",title:"Frontend System Design Review",coverUrl:mr("live2"),author:ut[1],viewers:5300,category:"Education",status:"live",hlsUrl:jr,startedAt:new Date(Date.now()-52e5).toISOString()},{id:"l3",title:"Late Night Gaming Session - Elden Ring DLC",coverUrl:mr("live3"),author:ut[4],viewers:28900,category:"Gaming",status:"live",hlsUrl:jr,startedAt:new Date(Date.now()-72e5).toISOString()},{id:"l4",title:"Live Music Production: Making a Beat from Scratch",coverUrl:mr("live4"),author:ut[5],viewers:8700,category:"Music",status:"live",hlsUrl:jr,startedAt:new Date(Date.now()-18e5).toISOString()}],VL=[{id:"p1",title:"Frontend Architecture Series",items:xr.filter(n=>["v1","v2","r1"].includes(n.id))}];let Ca=[{id:"c1",entityType:"video",entityId:"v1",author:ut[0],content:"This was the clearest explanation of query keys I've ever seen. Subscribed!",createdAt:new Date(Date.now()-72e5).toISOString(),likeCount:120},{id:"c2",entityType:"video",entityId:"v1",author:ut[1],content:"Thanks! We will publish part 2 soon.",createdAt:new Date(Date.now()-36e5).toISOString(),likeCount:32,parentId:"c1"},{id:"c3",entityType:"live",entityId:"l1",author:ut[0],content:"@creator can you share the repo later?",createdAt:new Date(Date.now()-2e5).toISOString(),likeCount:2},{id:"c4",entityType:"video",entityId:"v1",author:ut[4],content:"Great video! I wish you covered more about React Server Components though.",createdAt:new Date(Date.now()-54e5).toISOString(),likeCount:45},{id:"c5",entityType:"video",entityId:"v3",author:ut[0],content:"Number 7 was so good! I played it for like 40 hours straight.",createdAt:new Date(Date.now()-864e5).toISOString(),likeCount:89},{id:"c6",entityType:"video",entityId:"v3",author:ut[5],content:"The soundtrack alone makes some of these worth playing.",createdAt:new Date(Date.now()-432e5).toISOString(),likeCount:28},{id:"c7",entityType:"video",entityId:"v4",author:ut[0],content:"I listen to this every day while working. Thank you for making it!",createdAt:new Date(Date.now()-1728e5).toISOString(),likeCount:340},{id:"c8",entityType:"video",entityId:"v6",author:ut[4],content:"What a match! That last-minute goal was unreal.",createdAt:new Date(Date.now()-288e5).toISOString(),likeCount:156},{id:"c9",entityType:"video",entityId:"v7",author:ut[0],content:"Finally a Next.js 15 tutorial that actually explains the caching changes properly.",createdAt:new Date(Date.now()-144e5).toISOString(),likeCount:67},{id:"c10",entityType:"video",entityId:"v10",author:ut[7],content:"The RNG on that Ender Pearl was insane, no way that was legit lol",createdAt:new Date(Date.now()-36e6).toISOString(),likeCount:203},{id:"c11",entityType:"video",entityId:"v10",author:ut[4],content:"It was 100% legit, I verified the seed. Check the description for proof.",createdAt:new Date(Date.now()-32e6).toISOString(),likeCount:89,parentId:"c10"}];const GL=[{identifier:"user",password:"123456",userId:"u1"},{identifier:"creator",password:"123456",userId:"u2"},{identifier:"admin",password:"123456",userId:"u3"}],KL=[{id:"ch1",title:"Introduction",time:0},{id:"ch2",title:"Data Layer",time:220},{id:"ch3",title:"Route Strategy",time:570},{id:"ch4",title:"Q&A",time:980}],ox=n=>n.replace(/(spam||)/gi,"***").replace(/@([\w]+)/g,"<@$1>"),Dt={async login(n){await sn(300);const e=GL.find(r=>r.identifier===n.identifier&&r.password===n.password);if(!e)throw new Error("Invalid credentials");const t=ut.find(r=>r.id===e.userId);return{user:t,token:`token-${t.id}`}},async register(n){await sn(350);const e={id:`u${Date.now()}`,name:n.name,handle:`@${n.handle.replace("@","")}`,avatarUrl:"https://i.pravatar.cc/120?img=65",role:"user",followersCount:0};return ut.push(e),{user:e,token:`token-${e.id}`}},async me(n){if(await sn(180),!n)return{user:null};const e=n.replace("token-","");return{user:ut.find(t=>t.id===e)??null}},async home(n="All"){return await sn(260),{items:n==="All"?xr:xr.filter(t=>t.category===n)}},async trending(){return await sn(260),{items:[...xr].sort((n,e)=>e.views-n.views)}},async subscriptions(){return await sn(260),{items:xr.filter(n=>["u2","u4"].includes(n.author.id))}},async search(n,e,t){await sn(300);let r=xr.filter(s=>s.title.toLowerCase().includes(n.toLowerCase()));return t==="latest"&&(r=r.sort((s,i)=>+new Date(i.createdAt)-+new Date(s.createdAt))),t==="views"&&(r=r.sort((s,i)=>i.views-s.views)),{videos:r.filter(s=>["long","replay"].includes(s.type)),shorts:r.filter(s=>s.type==="short"),lives:ad.filter(s=>s.title.toLowerCase().includes(n.toLowerCase())),channels:ut.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())),activeTab:e}},async videoDetail(n){await sn(220);const e=xr.find(t=>t.id===n);if(!e)throw new Error("Not found");return{video:e,chapters:KL}},async recommendations(n){return await sn(200),{items:xr.filter(e=>e.id!==n)}},async likeVideo(n){const e=xr.find(t=>t.id===n);return e&&(e.likes+=1),{likes:(e==null?void 0:e.likes)??0}},async listShorts(){return await sn(180),{items:xr.filter(n=>n.type==="short")}},async likeShort(n){const e=xr.find(t=>t.id===n);return e&&(e.likes+=1),{likes:(e==null?void 0:e.likes)??0}},async listLive(n="All"){return await sn(200),{items:n==="All"?ad:ad.filter(e=>e.category===n)}},async liveDetail(n){await sn(200);const e=ad.find(t=>t.id===n);if(!e)throw new Error("Not found");return{room:e,replay:xr.find(t=>t.id==="r1")}},async liveChat(n){return await sn(130),{items:Ca.filter(e=>e.entityType==="live"&&e.entityId===n).map(e=>({...e,content:ox(e.content)}))}},async listComments(n,e){return await sn(150),{items:Ca.filter(t=>t.entityType===n&&t.entityId===e)}},async createComment(n){await sn(150);const e=ut.find(r=>r.id===n.currentUserId)??ut[0],t={id:`c${Date.now()}`,entityType:n.entityType??"video",entityId:n.entityId??"",author:e,content:ox(n.content??""),createdAt:new Date().toISOString(),likeCount:0,parentId:n.parentId};return Ca.unshift(t),{item:t}},async deleteComment(n){const e=Ca.findIndex(t=>t.id===n);return e>=0&&Ca.splice(e,1),{ok:!0}},async likeComment(n){const e=Ca.find(t=>t.id===n);return e&&(e.likeCount+=1),{likeCount:(e==null?void 0:e.likeCount)??0}},async channel(n){const e=ut.find(t=>t.id===n);if(!e)throw new Error("not found");return{channel:e,content:xr.filter(t=>t.author.id===n)}},async playlist(n){const e=VL.find(t=>t.id===n);if(!e)throw new Error("not found");return{playlist:e}},async studioOverview(){return{cards:[{label:"Views",value:"1.3M"},{label:"Followers",value:"98K"},{label:"Revenue",value:"$12,540"}],latest:xr.slice(0,3)}},async studioContent(n="all"){return{items:n==="all"?xr:xr.filter(t=>t.status===n)}},async studioUpload(n){const e={id:`v${Date.now()}`,type:"long",title:n.title??"Untitled",description:n.description??"",coverUrl:n.coverUrl??"https://picsum.photos/seed/upload/640/360",duration:0,views:0,likes:0,createdAt:new Date().toISOString(),author:ut[1],tags:n.tags??[],category:n.category??"Tech",visibility:n.visibility??"public",status:n.status??"reviewing"};return xr.unshift(e),{item:e}},async studioUpdate(n,e){const t=xr.find(r=>r.id===n);return t&&Object.assign(t,e),{item:t}},async studioComments(){return{items:Ca.filter(n=>n.entityType==="video")}},async adminDashboard(){return{stats:[{label:"Pending Reviews",value:18},{label:"Reports Open",value:27},{label:"Active Creators",value:342}]}},async adminReviewQueue(){return{items:xr.filter(n=>["reviewing","rejected"].includes(n.status))}},async adminReviewAction(n,e){const t=xr.find(r=>r.id===n);return t&&(t.status=e==="approve"?"published":e==="reject"?"rejected":"draft"),{ok:!0,item:t}},async adminReports(){return{items:[{id:"rp1",reason:"Copyright",target:"v2",status:"open"},{id:"rp2",reason:"Harassment",target:"c3",status:"processing"}]}},async adminUsers(){return{items:ut.map(n=>({...n,banned:!1}))}}};let od=localStorage.getItem("token");const lg={async login(n){const e=await Dt.login(n);return od=e.token,localStorage.setItem("token",e.token),e},async register(n){const e=await Dt.register(n);return od=e.token,localStorage.setItem("token",e.token),e},me:()=>Dt.me(od),async logout(){od=null,localStorage.removeItem("token")}},ug={home:Dt.home,trending:Dt.trending,subscriptions:Dt.subscriptions},HL={query:Dt.search},cg={detail:Dt.videoDetail,recommendations:Dt.recommendations,like:Dt.likeVideo,favorite:async()=>({ok:!0})},xT={list:Dt.listShorts,like:Dt.likeShort,favorite:async()=>({ok:!0})},dg={list:Dt.listLive,detail:Dt.liveDetail,chat:Dt.liveChat},ld={list:Dt.listComments,create:Dt.createComment,delete:Dt.deleteComment,like:Dt.likeComment},zL={detail:Dt.channel},WL={detail:Dt.playlist},hl={overview:Dt.studioOverview,content:Dt.studioContent,upload:Dt.studioUpload,update:Dt.studioUpdate,toggleLive:async()=>({ok:!0}),comments:Dt.studioComments},Du={dashboard:Dt.adminDashboard,reviewQueue:Dt.adminReviewQueue,reviewAction:Dt.adminReviewAction,reports:Dt.adminReports,reportAction:async()=>({ok:!0}),users:Dt.adminUsers,userAction:async()=>({ok:!0})};function YL(){const n=Al(),e=Za(u=>u.user),t=Za(u=>u.clearSession),r=ap(u=>u.theme),s=ap(u=>u.toggleTheme),i=Cu(u=>u.toggle),o=Cu(u=>u.setMobileOpen);return b.jsx("header",{className:"sticky top-0 z-30 bg-background",children:b.jsxs("div",{className:"flex h-14 items-center gap-2 px-4",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Ct,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>{window.innerWidth<768?o(!0):i()},children:b.jsx(jR,{className:"h-5 w-5"})}),b.jsxs(ps,{to:"/",className:"flex items-center gap-1",children:[b.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-lg bg-primary",children:b.jsx("svg",{viewBox:"0 0 24 24",fill:"white",className:"h-4 w-4",children:b.jsx("polygon",{points:"9.5,7.5 16.5,12 9.5,16.5"})})}),b.jsx("span",{className:"text-lg font-bold tracking-tight",children:"Youtobe"})]})]}),b.jsxs("form",{className:"mx-auto hidden w-full max-w-xl items-center md:flex",onSubmit:u=>{var c;u.preventDefault();const d=(c=new FormData(u.currentTarget).get("q"))==null?void 0:c.toString().trim();d&&n(`/search?q=${encodeURIComponent(d)}`)},children:[b.jsxs("div",{className:"flex w-full",children:[b.jsx("input",{name:"q",placeholder:"Search",className:"h-10 w-full rounded-l-full border border-r-0 bg-background px-4 text-sm outline-none focus:border-primary"}),b.jsx("button",{type:"submit",className:"flex h-10 w-16 items-center justify-center rounded-r-full border bg-secondary hover:bg-secondary/80",children:b.jsx(lT,{className:"h-4 w-4"})})]}),b.jsx(Ct,{variant:"ghost",size:"icon",className:"ml-2 rounded-full bg-secondary",type:"button",children:b.jsx(GR,{className:"h-4 w-4"})})]}),b.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e&&b.jsx(Ct,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>n("/studio/upload"),children:b.jsx(QR,{className:"h-5 w-5"})}),b.jsxs(Ct,{variant:"ghost",size:"icon",className:"relative rounded-full",children:[b.jsx(LR,{className:"h-5 w-5"}),e&&b.jsx("span",{className:"absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-primary"})]}),b.jsx(Ct,{variant:"ghost",size:"icon",className:"rounded-full",onClick:s,children:r==="dark"?b.jsx(WR,{className:"h-5 w-5"}):b.jsx(KR,{className:"h-5 w-5"})}),e?b.jsx("button",{className:"ml-1 h-8 w-8 overflow-hidden rounded-full",onClick:async()=>{await lg.logout(),t(),n("/login")},children:b.jsx("img",{src:e.avatarUrl,className:"h-full w-full object-cover",alt:e.name})}):b.jsx(Ct,{size:"sm",variant:"outline",className:"ml-1 gap-1 rounded-full border-primary/50 text-primary",onClick:()=>n("/login"),children:"Login"})]})]})})}function qL(){const n=Cu(t=>t.mobileOpen),e=Cu(t=>t.setMobileOpen);return b.jsxs("div",{className:"min-h-screen",children:[b.jsx(YL,{}),b.jsxs("div",{className:"flex",children:[b.jsx(BL,{}),b.jsx("main",{className:"flex-1 p-4 transition-all duration-200",children:b.jsx(nT,{})})]}),n&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 md:hidden",onClick:()=>e(!1)}),b.jsxs("aside",{className:"fixed inset-y-0 left-0 z-50 w-60 overflow-y-auto bg-background p-3 md:hidden",children:[b.jsxs("div",{className:"mb-4 flex items-center gap-2 px-3",children:[b.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-lg bg-primary",children:b.jsx("svg",{viewBox:"0 0 24 24",fill:"white",className:"h-4 w-4",children:b.jsx("polygon",{points:"9.5,7.5 16.5,12 9.5,16.5"})})}),b.jsx("span",{className:"text-lg font-bold tracking-tight",children:"Youtobe"})]}),b.jsx(QL,{onClose:()=>e(!1)})]})]})]})}function QL({onClose:n}){const e=[{to:"/",label:"Home"},{to:"/shorts",label:"Shorts"},{to:"/subscriptions",label:"Subscriptions"},{to:"/trending",label:"Trending"},{to:"/live",label:"Live"},{to:"/history",label:"History"}];return b.jsx("nav",{className:"space-y-1",children:e.map(t=>b.jsx(ps,{to:t.to,onClick:n,className:"block rounded-lg px-3 py-2 text-sm hover:bg-accent",children:t.label},t.to))})}function lx({allow:n}){const e=Za(t=>t.user);return e?n.includes(e.role)?b.jsx(nT,{}):b.jsx(rp,{to:"/",replace:!0}):b.jsx(rp,{to:"/login",replace:!0})}function gu({className:n}){return b.jsx("div",{className:Hr("animate-pulse rounded-md bg-muted",n)})}function XL({title:n,description:e,onRetry:t}){return b.jsxs("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[b.jsx("h3",{className:"text-lg font-semibold",children:n}),b.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:e}),t?b.jsx(Ct,{className:"mt-4",variant:"outline",onClick:t,children:"Retry"}):null]})}function qn(n){return n>=1e6?`${(n/1e6).toFixed(1)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:`${n}`}function ux(n){const e=Math.floor(n/60),t=`${n%60}`.padStart(2,"0");return`${e}:${t}`}function Pu(n){const e=Date.now()-new Date(n).getTime(),t=Math.floor(e/36e5);return t<24?`${t} hours ago`:`${Math.floor(t/24)} days ago`}function Rl({video:n,horizontal:e}){const t=n.type==="short"?"/shorts":n.type==="live"?`/live/${n.id}`:`/watch/${n.id}`;return e?b.jsxs(ps,{to:t,className:"group flex gap-2",children:[b.jsxs("div",{className:"relative w-40 shrink-0",children:[b.jsx("img",{src:n.coverUrl,className:"aspect-video w-full rounded-lg object-cover",alt:n.title}),b.jsx("span",{className:"absolute bottom-1 right-1 rounded bg-black/80 px-1 py-0.5 text-[10px] font-medium text-white",children:ux(n.duration)})]}),b.jsxs("div",{className:"flex-1 pt-0.5",children:[b.jsx("p",{className:"line-clamp-2 text-sm font-medium leading-snug",children:n.title}),b.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:n.author.name}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[qn(n.views)," views  ",Pu(n.createdAt)]})]})]}):b.jsxs(ps,{to:t,className:"group block",children:[b.jsxs("div",{className:"relative",children:[b.jsx("img",{src:n.coverUrl,className:"aspect-video w-full rounded-xl object-cover",alt:n.title}),b.jsx("span",{className:"absolute bottom-2 right-2 rounded bg-black/80 px-1 py-0.5 text-xs font-medium text-white",children:ux(n.duration)})]}),b.jsxs("div",{className:"mt-3 flex gap-3",children:[b.jsx("img",{src:n.author.avatarUrl,className:"h-9 w-9 shrink-0 rounded-full object-cover",alt:n.author.name}),b.jsxs("div",{className:"flex-1",children:[b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsx("p",{className:"line-clamp-2 text-sm font-medium leading-snug",children:n.title}),b.jsx("button",{className:"mt-0.5 shrink-0 opacity-0 transition-opacity group-hover:opacity-100",children:b.jsx(oT,{className:"h-5 w-5 text-muted-foreground"})})]}),b.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:n.author.name}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[qn(n.views)," views  ",Pu(n.createdAt)]})]})]})]})}var Ll=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ZL={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},Yi,Qp,LS,JL=(LS=class{constructor(){We(this,Yi,ZL);We(this,Qp,!1)}setTimeoutProvider(n){Le(this,Yi,n)}setTimeout(n,e){return $(this,Yi).setTimeout(n,e)}clearTimeout(n){$(this,Yi).clearTimeout(n)}setInterval(n,e){return $(this,Yi).setInterval(n,e)}clearInterval(n){$(this,Yi).clearInterval(n)}},Yi=new WeakMap,Qp=new WeakMap,LS),Ua=new JL;function e_(n){setTimeout(n,0)}var Ja=typeof window>"u"||"Deno"in globalThis;function ln(){}function t_(n,e){return typeof n=="function"?n(e):n}function op(n){return typeof n=="number"&&n>=0&&n!==1/0}function ET(n,e){return Math.max(n+(e||0)-Date.now(),0)}function ia(n,e){return typeof n=="function"?n(e):n}function Yn(n,e){return typeof n=="function"?n(e):n}function cx(n,e){const{type:t="all",exact:r,fetchStatus:s,predicate:i,queryKey:o,stale:u}=n;if(o){if(r){if(e.queryHash!==fg(o,e.options))return!1}else if(!Ou(e.queryKey,o))return!1}if(t!=="all"){const d=e.isActive();if(t==="active"&&!d||t==="inactive"&&d)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||s&&s!==e.state.fetchStatus||i&&!i(e))}function dx(n,e){const{exact:t,status:r,predicate:s,mutationKey:i}=n;if(i){if(!e.options.mutationKey)return!1;if(t){if(eo(e.options.mutationKey)!==eo(i))return!1}else if(!Ou(e.options.mutationKey,i))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function fg(n,e){return((e==null?void 0:e.queryKeyHashFn)||eo)(n)}function eo(n){return JSON.stringify(n,(e,t)=>lp(t)?Object.keys(t).sort().reduce((r,s)=>(r[s]=t[s],r),{}):t)}function Ou(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>Ou(n[t],e[t])):!1}var r_=Object.prototype.hasOwnProperty;function ST(n,e,t=0){if(n===e)return n;if(t>500)return e;const r=fx(n)&&fx(e);if(!r&&!(lp(n)&&lp(e)))return e;const i=(r?n:Object.keys(n)).length,o=r?e:Object.keys(e),u=o.length,d=r?new Array(u):{};let c=0;for(let h=0;h<u;h++){const m=r?h:o[h],g=n[m],y=e[m];if(g===y){d[m]=g,(r?h<i:r_.call(n,m))&&c++;continue}if(g===null||y===null||typeof g!="object"||typeof y!="object"){d[m]=y;continue}const v=ST(g,y,t+1);d[m]=v,v===g&&c++}return i===u&&c===i?n:d}function zd(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function fx(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function lp(n){if(!hx(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!hx(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function hx(n){return Object.prototype.toString.call(n)==="[object Object]"}function n_(n){return new Promise(e=>{Ua.setTimeout(e,n)})}function up(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?ST(n,e):e}function s_(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function i_(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var hg=Symbol();function TT(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===hg?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}function mg(n,e){return typeof n=="function"?n(...e):!!n}function a_(n,e,t){let r=!1,s;return Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(s??(s=e()),r||(r=!0,s.aborted?t():s.addEventListener("abort",t,{once:!0})),s)}),n}var $a,qi,tl,_S,o_=(_S=class extends Ll{constructor(){super();We(this,$a);We(this,qi);We(this,tl);Le(this,tl,e=>{if(!Ja&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){$(this,qi)||this.setEventListener($(this,tl))}onUnsubscribe(){var e;this.hasListeners()||((e=$(this,qi))==null||e.call(this),Le(this,qi,void 0))}setEventListener(e){var t;Le(this,tl,e),(t=$(this,qi))==null||t.call(this),Le(this,qi,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){$(this,$a)!==e&&(Le(this,$a,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof $(this,$a)=="boolean"?$(this,$a):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},$a=new WeakMap,qi=new WeakMap,tl=new WeakMap,_S),pg=new o_;function cp(){let n,e;const t=new Promise((s,i)=>{n=s,e=i});t.status="pending",t.catch(()=>{});function r(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{r({status:"fulfilled",value:s}),n(s)},t.reject=s=>{r({status:"rejected",reason:s}),e(s)},t}var l_=e_;function u_(){let n=[],e=0,t=u=>{u()},r=u=>{u()},s=l_;const i=u=>{e?n.push(u):s(()=>{t(u)})},o=()=>{const u=n;n=[],u.length&&s(()=>{r(()=>{u.forEach(d=>{t(d)})})})};return{batch:u=>{let d;e++;try{d=u()}finally{e--,e||o()}return d},batchCalls:u=>(...d)=>{i(()=>{u(...d)})},schedule:i,setNotifyFunction:u=>{t=u},setBatchNotifyFunction:u=>{r=u},setScheduler:u=>{s=u}}}var kr=u_(),rl,Qi,nl,kS,c_=(kS=class extends Ll{constructor(){super();We(this,rl,!0);We(this,Qi);We(this,nl);Le(this,nl,e=>{if(!Ja&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){$(this,Qi)||this.setEventListener($(this,nl))}onUnsubscribe(){var e;this.hasListeners()||((e=$(this,Qi))==null||e.call(this),Le(this,Qi,void 0))}setEventListener(e){var t;Le(this,nl,e),(t=$(this,Qi))==null||t.call(this),Le(this,Qi,e(this.setOnline.bind(this)))}setOnline(e){$(this,rl)!==e&&(Le(this,rl,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return $(this,rl)}},rl=new WeakMap,Qi=new WeakMap,nl=new WeakMap,kS),Wd=new c_;function d_(n){return Math.min(1e3*2**n,3e4)}function bT(n){return(n??"online")==="online"?Wd.isOnline():!0}var dp=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function wT(n){let e=!1,t=0,r;const s=cp(),i=()=>s.status!=="pending",o=E=>{var S;if(!i()){const A=new dp(E);g(A),(S=n.onCancel)==null||S.call(n,A)}},u=()=>{e=!0},d=()=>{e=!1},c=()=>pg.isFocused()&&(n.networkMode==="always"||Wd.isOnline())&&n.canRun(),h=()=>bT(n.networkMode)&&n.canRun(),m=E=>{i()||(r==null||r(),s.resolve(E))},g=E=>{i()||(r==null||r(),s.reject(E))},y=()=>new Promise(E=>{var S;r=A=>{(i()||c())&&E(A)},(S=n.onPause)==null||S.call(n)}).then(()=>{var E;r=void 0,i()||(E=n.onContinue)==null||E.call(n)}),v=()=>{if(i())return;let E;const S=t===0?n.initialPromise:void 0;try{E=S??n.fn()}catch(A){E=Promise.reject(A)}Promise.resolve(E).then(m).catch(A=>{var V;if(i())return;const I=n.retry??(Ja?0:3),R=n.retryDelay??d_,k=typeof R=="function"?R(t,A):R,C=I===!0||typeof I=="number"&&t<I||typeof I=="function"&&I(t,A);if(e||!C){g(A);return}t++,(V=n.onFail)==null||V.call(n,t,A),n_(k).then(()=>c()?void 0:y()).then(()=>{e?g(A):v()})})};return{promise:s,status:()=>s.status,cancel:o,continue:()=>(r==null||r(),s),cancelRetry:u,continueRetry:d,canStart:h,start:()=>(h()?v():y().then(v),s)}}var ja,CS,AT=(CS=class{constructor(){We(this,ja)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),op(this.gcTime)&&Le(this,ja,Ua.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Ja?1/0:300*1e3))}clearGcTimeout(){$(this,ja)&&(Ua.clearTimeout($(this,ja)),Le(this,ja,void 0))}},ja=new WeakMap,CS),Va,sl,Wn,Ga,Nr,zu,Ka,cs,ni,DS,f_=(DS=class extends AT{constructor(e){super();We(this,cs);We(this,Va);We(this,sl);We(this,Wn);We(this,Ga);We(this,Nr);We(this,zu);We(this,Ka);Le(this,Ka,!1),Le(this,zu,e.defaultOptions),this.setOptions(e.options),this.observers=[],Le(this,Ga,e.client),Le(this,Wn,$(this,Ga).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Le(this,Va,px(this.options)),this.state=e.state??$(this,Va),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=$(this,Nr))==null?void 0:e.promise}setOptions(e){if(this.options={...$(this,zu),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=px(this.options);t.data!==void 0&&(this.setState(mx(t.data,t.dataUpdatedAt)),Le(this,Va,t))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&$(this,Wn).remove(this)}setData(e,t){const r=up(this.state.data,e,this.options);return ct(this,cs,ni).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){ct(this,cs,ni).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,s;const t=(r=$(this,Nr))==null?void 0:r.promise;return(s=$(this,Nr))==null||s.cancel(e),t?t.then(ln).catch(ln):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState($(this,Va))}isActive(){return this.observers.some(e=>Yn(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===hg||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ia(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ET(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=$(this,Nr))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=$(this,Nr))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),$(this,Wn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||($(this,Nr)&&($(this,Ka)?$(this,Nr).cancel({revert:!0}):$(this,Nr).cancelRetry()),this.scheduleGc()),$(this,Wn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ct(this,cs,ni).call(this,{type:"invalidate"})}async fetch(e,t){var d,c,h,m,g,y,v,E,S,A,I,R;if(this.state.fetchStatus!=="idle"&&((d=$(this,Nr))==null?void 0:d.status())!=="rejected"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if($(this,Nr))return $(this,Nr).continueRetry(),$(this,Nr).promise}if(e&&this.setOptions(e),!this.options.queryFn){const k=this.observers.find(C=>C.options.queryFn);k&&this.setOptions(k.options)}const r=new AbortController,s=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(Le(this,Ka,!0),r.signal)})},i=()=>{const k=TT(this.options,t),V=(()=>{const _={client:$(this,Ga),queryKey:this.queryKey,meta:this.meta};return s(_),_})();return Le(this,Ka,!1),this.options.persister?this.options.persister(k,V,this):k(V)},u=(()=>{const k={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:$(this,Ga),state:this.state,fetchFn:i};return s(k),k})();(c=this.options.behavior)==null||c.onFetch(u,this),Le(this,sl,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=u.fetchOptions)==null?void 0:h.meta))&&ct(this,cs,ni).call(this,{type:"fetch",meta:(m=u.fetchOptions)==null?void 0:m.meta}),Le(this,Nr,wT({initialPromise:t==null?void 0:t.initialPromise,fn:u.fetchFn,onCancel:k=>{k instanceof dp&&k.revert&&this.setState({...$(this,sl),fetchStatus:"idle"}),r.abort()},onFail:(k,C)=>{ct(this,cs,ni).call(this,{type:"failed",failureCount:k,error:C})},onPause:()=>{ct(this,cs,ni).call(this,{type:"pause"})},onContinue:()=>{ct(this,cs,ni).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0}));try{const k=await $(this,Nr).start();if(k===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(k),(y=(g=$(this,Wn).config).onSuccess)==null||y.call(g,k,this),(E=(v=$(this,Wn).config).onSettled)==null||E.call(v,k,this.state.error,this),k}catch(k){if(k instanceof dp){if(k.silent)return $(this,Nr).promise;if(k.revert){if(this.state.data===void 0)throw k;return this.state.data}}throw ct(this,cs,ni).call(this,{type:"error",error:k}),(A=(S=$(this,Wn).config).onError)==null||A.call(S,k,this),(R=(I=$(this,Wn).config).onSettled)==null||R.call(I,this.state.data,k,this),k}finally{this.scheduleGc()}}},Va=new WeakMap,sl=new WeakMap,Wn=new WeakMap,Ga=new WeakMap,Nr=new WeakMap,zu=new WeakMap,Ka=new WeakMap,cs=new WeakSet,ni=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...IT(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,...mx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Le(this,sl,e.manual?s:void 0),s;case"error":const i=e.error;return{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),kr.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),$(this,Wn).notify({query:this,type:"updated",action:e})})},DS);function IT(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:bT(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function mx(n,e){return{data:n,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function px(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var En,Et,Wu,an,Ha,il,ai,Xi,Yu,al,ol,za,Wa,Zi,ll,Ot,Eu,fp,hp,mp,pp,gp,yp,vp,RT,PS,h_=(PS=class extends Ll{constructor(e,t){super();We(this,Ot);We(this,En);We(this,Et);We(this,Wu);We(this,an);We(this,Ha);We(this,il);We(this,ai);We(this,Xi);We(this,Yu);We(this,al);We(this,ol);We(this,za);We(this,Wa);We(this,Zi);We(this,ll,new Set);this.options=t,Le(this,En,e),Le(this,Xi,null),Le(this,ai,cp()),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&($(this,Et).addObserver(this),gx($(this,Et),this.options)?ct(this,Ot,Eu).call(this):this.updateResult(),ct(this,Ot,pp).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return xp($(this,Et),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return xp($(this,Et),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ct(this,Ot,gp).call(this),ct(this,Ot,yp).call(this),$(this,Et).removeObserver(this)}setOptions(e){const t=this.options,r=$(this,Et);if(this.options=$(this,En).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Yn(this.options.enabled,$(this,Et))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ct(this,Ot,vp).call(this),$(this,Et).setOptions(this.options),t._defaulted&&!zd(this.options,t)&&$(this,En).getQueryCache().notify({type:"observerOptionsUpdated",query:$(this,Et),observer:this});const s=this.hasListeners();s&&yx($(this,Et),r,this.options,t)&&ct(this,Ot,Eu).call(this),this.updateResult(),s&&($(this,Et)!==r||Yn(this.options.enabled,$(this,Et))!==Yn(t.enabled,$(this,Et))||ia(this.options.staleTime,$(this,Et))!==ia(t.staleTime,$(this,Et)))&&ct(this,Ot,fp).call(this);const i=ct(this,Ot,hp).call(this);s&&($(this,Et)!==r||Yn(this.options.enabled,$(this,Et))!==Yn(t.enabled,$(this,Et))||i!==$(this,Zi))&&ct(this,Ot,mp).call(this,i)}getOptimisticResult(e){const t=$(this,En).getQueryCache().build($(this,En),e),r=this.createResult(t,e);return p_(this,r)&&(Le(this,an,r),Le(this,il,this.options),Le(this,Ha,$(this,Et).state)),r}getCurrentResult(){return $(this,an)}trackResult(e,t){return new Proxy(e,{get:(r,s)=>(this.trackProp(s),t==null||t(s),s==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&$(this,ai).status==="pending"&&$(this,ai).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,s))})}trackProp(e){$(this,ll).add(e)}getCurrentQuery(){return $(this,Et)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=$(this,En).defaultQueryOptions(e),r=$(this,En).getQueryCache().build($(this,En),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return ct(this,Ot,Eu).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),$(this,an)))}createResult(e,t){var F;const r=$(this,Et),s=this.options,i=$(this,an),o=$(this,Ha),u=$(this,il),c=e!==r?e.state:$(this,Wu),{state:h}=e;let m={...h},g=!1,y;if(t._optimisticResults){const O=this.hasListeners(),q=!O&&gx(e,t),H=O&&yx(e,r,t,s);(q||H)&&(m={...m,...IT(h.data,e.options)}),t._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:v,errorUpdatedAt:E,status:S}=m;y=m.data;let A=!1;if(t.placeholderData!==void 0&&y===void 0&&S==="pending"){let O;i!=null&&i.isPlaceholderData&&t.placeholderData===(u==null?void 0:u.placeholderData)?(O=i.data,A=!0):O=typeof t.placeholderData=="function"?t.placeholderData((F=$(this,ol))==null?void 0:F.state.data,$(this,ol)):t.placeholderData,O!==void 0&&(S="success",y=up(i==null?void 0:i.data,O,t),g=!0)}if(t.select&&y!==void 0&&!A)if(i&&y===(o==null?void 0:o.data)&&t.select===$(this,Yu))y=$(this,al);else try{Le(this,Yu,t.select),y=t.select(y),y=up(i==null?void 0:i.data,y,t),Le(this,al,y),Le(this,Xi,null)}catch(O){Le(this,Xi,O)}$(this,Xi)&&(v=$(this,Xi),y=$(this,al),E=Date.now(),S="error");const I=m.fetchStatus==="fetching",R=S==="pending",k=S==="error",C=R&&I,V=y!==void 0,N={status:S,fetchStatus:m.fetchStatus,isPending:R,isSuccess:S==="success",isError:k,isInitialLoading:C,isLoading:C,data:y,dataUpdatedAt:m.dataUpdatedAt,error:v,errorUpdatedAt:E,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>c.dataUpdateCount||m.errorUpdateCount>c.errorUpdateCount,isFetching:I,isRefetching:I&&!R,isLoadingError:k&&!V,isPaused:m.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:k&&V,isStale:gg(e,t),refetch:this.refetch,promise:$(this,ai),isEnabled:Yn(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const O=N.data!==void 0,q=N.status==="error"&&!O,H=ce=>{q?ce.reject(N.error):O&&ce.resolve(N.data)},ie=()=>{const ce=Le(this,ai,N.promise=cp());H(ce)},oe=$(this,ai);switch(oe.status){case"pending":e.queryHash===r.queryHash&&H(oe);break;case"fulfilled":(q||N.data!==oe.value)&&ie();break;case"rejected":(!q||N.error!==oe.reason)&&ie();break}}return N}updateResult(){const e=$(this,an),t=this.createResult($(this,Et),this.options);if(Le(this,Ha,$(this,Et).state),Le(this,il,this.options),$(this,Ha).data!==void 0&&Le(this,ol,$(this,Et)),zd(t,e))return;Le(this,an,t);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!$(this,ll).size)return!0;const o=new Set(i??$(this,ll));return this.options.throwOnError&&o.add("error"),Object.keys($(this,an)).some(u=>{const d=u;return $(this,an)[d]!==e[d]&&o.has(d)})};ct(this,Ot,RT).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ct(this,Ot,pp).call(this)}},En=new WeakMap,Et=new WeakMap,Wu=new WeakMap,an=new WeakMap,Ha=new WeakMap,il=new WeakMap,ai=new WeakMap,Xi=new WeakMap,Yu=new WeakMap,al=new WeakMap,ol=new WeakMap,za=new WeakMap,Wa=new WeakMap,Zi=new WeakMap,ll=new WeakMap,Ot=new WeakSet,Eu=function(e){ct(this,Ot,vp).call(this);let t=$(this,Et).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(ln)),t},fp=function(){ct(this,Ot,gp).call(this);const e=ia(this.options.staleTime,$(this,Et));if(Ja||$(this,an).isStale||!op(e))return;const r=ET($(this,an).dataUpdatedAt,e)+1;Le(this,za,Ua.setTimeout(()=>{$(this,an).isStale||this.updateResult()},r))},hp=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval($(this,Et)):this.options.refetchInterval)??!1},mp=function(e){ct(this,Ot,yp).call(this),Le(this,Zi,e),!(Ja||Yn(this.options.enabled,$(this,Et))===!1||!op($(this,Zi))||$(this,Zi)===0)&&Le(this,Wa,Ua.setInterval(()=>{(this.options.refetchIntervalInBackground||pg.isFocused())&&ct(this,Ot,Eu).call(this)},$(this,Zi)))},pp=function(){ct(this,Ot,fp).call(this),ct(this,Ot,mp).call(this,ct(this,Ot,hp).call(this))},gp=function(){$(this,za)&&(Ua.clearTimeout($(this,za)),Le(this,za,void 0))},yp=function(){$(this,Wa)&&(Ua.clearInterval($(this,Wa)),Le(this,Wa,void 0))},vp=function(){const e=$(this,En).getQueryCache().build($(this,En),this.options);if(e===$(this,Et))return;const t=$(this,Et);Le(this,Et,e),Le(this,Wu,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},RT=function(e){kr.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t($(this,an))}),$(this,En).getQueryCache().notify({query:$(this,Et),type:"observerResultsUpdated"})})},PS);function m_(n,e){return Yn(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function gx(n,e){return m_(n,e)||n.state.data!==void 0&&xp(n,e,e.refetchOnMount)}function xp(n,e,t){if(Yn(e.enabled,n)!==!1&&ia(e.staleTime,n)!=="static"){const r=typeof t=="function"?t(n):t;return r==="always"||r!==!1&&gg(n,e)}return!1}function yx(n,e,t,r){return(n!==e||Yn(r.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&gg(n,t)}function gg(n,e){return Yn(e.enabled,n)!==!1&&n.isStaleByTime(ia(e.staleTime,n))}function p_(n,e){return!zd(n.getCurrentResult(),e)}function vx(n){return{onFetch:(e,t)=>{var h,m,g,y,v;const r=e.options,s=(g=(m=(h=e.fetchOptions)==null?void 0:h.meta)==null?void 0:m.fetchMore)==null?void 0:g.direction,i=((y=e.state.data)==null?void 0:y.pages)||[],o=((v=e.state.data)==null?void 0:v.pageParams)||[];let u={pages:[],pageParams:[]},d=0;const c=async()=>{let E=!1;const S=R=>{a_(R,()=>e.signal,()=>E=!0)},A=TT(e.options,e.fetchOptions),I=async(R,k,C)=>{if(E)return Promise.reject();if(k==null&&R.pages.length)return Promise.resolve(R);const _=(()=>{const q={client:e.client,queryKey:e.queryKey,pageParam:k,direction:C?"backward":"forward",meta:e.options.meta};return S(q),q})(),N=await A(_),{maxPages:F}=e.options,O=C?i_:s_;return{pages:O(R.pages,N,F),pageParams:O(R.pageParams,k,F)}};if(s&&i.length){const R=s==="backward",k=R?g_:xx,C={pages:i,pageParams:o},V=k(r,C);u=await I(C,V,R)}else{const R=n??i.length;do{const k=d===0?o[0]??r.initialPageParam:xx(r,u);if(d>0&&k==null)break;u=await I(u,k),d++}while(d<R)}return u};e.options.persister?e.fetchFn=()=>{var E,S;return(S=(E=e.options).persister)==null?void 0:S.call(E,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function xx(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function g_(n,{pages:e,pageParams:t}){var r;return e.length>0?(r=n.getPreviousPageParam)==null?void 0:r.call(n,e[0],e,t[0],t):void 0}var qu,_s,Jr,Ya,ks,Vi,OS,y_=(OS=class extends AT{constructor(e){super();We(this,ks);We(this,qu);We(this,_s);We(this,Jr);We(this,Ya);Le(this,qu,e.client),this.mutationId=e.mutationId,Le(this,Jr,e.mutationCache),Le(this,_s,[]),this.state=e.state||LT(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){$(this,_s).includes(e)||($(this,_s).push(e),this.clearGcTimeout(),$(this,Jr).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Le(this,_s,$(this,_s).filter(t=>t!==e)),this.scheduleGc(),$(this,Jr).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){$(this,_s).length||(this.state.status==="pending"?this.scheduleGc():$(this,Jr).remove(this))}continue(){var e;return((e=$(this,Ya))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var o,u,d,c,h,m,g,y,v,E,S,A,I,R,k,C,V,_;const t=()=>{ct(this,ks,Vi).call(this,{type:"continue"})},r={client:$(this,qu),meta:this.options.meta,mutationKey:this.options.mutationKey};Le(this,Ya,wT({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(N,F)=>{ct(this,ks,Vi).call(this,{type:"failed",failureCount:N,error:F})},onPause:()=>{ct(this,ks,Vi).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>$(this,Jr).canRun(this)}));const s=this.state.status==="pending",i=!$(this,Ya).canStart();try{if(s)t();else{ct(this,ks,Vi).call(this,{type:"pending",variables:e,isPaused:i}),$(this,Jr).config.onMutate&&await $(this,Jr).config.onMutate(e,this,r);const F=await((u=(o=this.options).onMutate)==null?void 0:u.call(o,e,r));F!==this.state.context&&ct(this,ks,Vi).call(this,{type:"pending",context:F,variables:e,isPaused:i})}const N=await $(this,Ya).start();return await((c=(d=$(this,Jr).config).onSuccess)==null?void 0:c.call(d,N,e,this.state.context,this,r)),await((m=(h=this.options).onSuccess)==null?void 0:m.call(h,N,e,this.state.context,r)),await((y=(g=$(this,Jr).config).onSettled)==null?void 0:y.call(g,N,null,this.state.variables,this.state.context,this,r)),await((E=(v=this.options).onSettled)==null?void 0:E.call(v,N,null,e,this.state.context,r)),ct(this,ks,Vi).call(this,{type:"success",data:N}),N}catch(N){try{await((A=(S=$(this,Jr).config).onError)==null?void 0:A.call(S,N,e,this.state.context,this,r))}catch(F){Promise.reject(F)}try{await((R=(I=this.options).onError)==null?void 0:R.call(I,N,e,this.state.context,r))}catch(F){Promise.reject(F)}try{await((C=(k=$(this,Jr).config).onSettled)==null?void 0:C.call(k,void 0,N,this.state.variables,this.state.context,this,r))}catch(F){Promise.reject(F)}try{await((_=(V=this.options).onSettled)==null?void 0:_.call(V,void 0,N,e,this.state.context,r))}catch(F){Promise.reject(F)}throw ct(this,ks,Vi).call(this,{type:"error",error:N}),N}finally{$(this,Jr).runNext(this)}}},qu=new WeakMap,_s=new WeakMap,Jr=new WeakMap,Ya=new WeakMap,ks=new WeakSet,Vi=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),kr.batch(()=>{$(this,_s).forEach(r=>{r.onMutationUpdate(e)}),$(this,Jr).notify({mutation:this,type:"updated",action:e})})},OS);function LT(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var oi,ds,Qu,NS,v_=(NS=class extends Ll{constructor(e={}){super();We(this,oi);We(this,ds);We(this,Qu);this.config=e,Le(this,oi,new Set),Le(this,ds,new Map),Le(this,Qu,0)}build(e,t,r){const s=new y_({client:e,mutationCache:this,mutationId:++nd(this,Qu)._,options:e.defaultMutationOptions(t),state:r});return this.add(s),s}add(e){$(this,oi).add(e);const t=ud(e);if(typeof t=="string"){const r=$(this,ds).get(t);r?r.push(e):$(this,ds).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if($(this,oi).delete(e)){const t=ud(e);if(typeof t=="string"){const r=$(this,ds).get(t);if(r)if(r.length>1){const s=r.indexOf(e);s!==-1&&r.splice(s,1)}else r[0]===e&&$(this,ds).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=ud(e);if(typeof t=="string"){const r=$(this,ds).get(t),s=r==null?void 0:r.find(i=>i.state.status==="pending");return!s||s===e}else return!0}runNext(e){var r;const t=ud(e);if(typeof t=="string"){const s=(r=$(this,ds).get(t))==null?void 0:r.find(i=>i!==e&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){kr.batch(()=>{$(this,oi).forEach(e=>{this.notify({type:"removed",mutation:e})}),$(this,oi).clear(),$(this,ds).clear()})}getAll(){return Array.from($(this,oi))}find(e){const t={exact:!0,...e};return this.getAll().find(r=>dx(t,r))}findAll(e={}){return this.getAll().filter(t=>dx(e,t))}notify(e){kr.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return kr.batch(()=>Promise.all(e.map(t=>t.continue().catch(ln))))}},oi=new WeakMap,ds=new WeakMap,Qu=new WeakMap,NS);function ud(n){var e;return(e=n.options.scope)==null?void 0:e.id}var li,Ji,Sn,ui,fi,Dd,Ep,MS,x_=(MS=class extends Ll{constructor(t,r){super();We(this,fi);We(this,li);We(this,Ji);We(this,Sn);We(this,ui);Le(this,li,t),this.setOptions(r),this.bindMethods(),ct(this,fi,Dd).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=$(this,li).defaultMutationOptions(t),zd(this.options,r)||$(this,li).getMutationCache().notify({type:"observerOptionsUpdated",mutation:$(this,Sn),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&eo(r.mutationKey)!==eo(this.options.mutationKey)?this.reset():((s=$(this,Sn))==null?void 0:s.state.status)==="pending"&&$(this,Sn).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=$(this,Sn))==null||t.removeObserver(this)}onMutationUpdate(t){ct(this,fi,Dd).call(this),ct(this,fi,Ep).call(this,t)}getCurrentResult(){return $(this,Ji)}reset(){var t;(t=$(this,Sn))==null||t.removeObserver(this),Le(this,Sn,void 0),ct(this,fi,Dd).call(this),ct(this,fi,Ep).call(this)}mutate(t,r){var s;return Le(this,ui,r),(s=$(this,Sn))==null||s.removeObserver(this),Le(this,Sn,$(this,li).getMutationCache().build($(this,li),this.options)),$(this,Sn).addObserver(this),$(this,Sn).execute(t)}},li=new WeakMap,Ji=new WeakMap,Sn=new WeakMap,ui=new WeakMap,fi=new WeakSet,Dd=function(){var r;const t=((r=$(this,Sn))==null?void 0:r.state)??LT();Le(this,Ji,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Ep=function(t){kr.batch(()=>{var r,s,i,o,u,d,c,h;if($(this,ui)&&this.hasListeners()){const m=$(this,Ji).variables,g=$(this,Ji).context,y={client:$(this,li),meta:this.options.meta,mutationKey:this.options.mutationKey};if((t==null?void 0:t.type)==="success"){try{(s=(r=$(this,ui)).onSuccess)==null||s.call(r,t.data,m,g,y)}catch(v){Promise.reject(v)}try{(o=(i=$(this,ui)).onSettled)==null||o.call(i,t.data,null,m,g,y)}catch(v){Promise.reject(v)}}else if((t==null?void 0:t.type)==="error"){try{(d=(u=$(this,ui)).onError)==null||d.call(u,t.error,m,g,y)}catch(v){Promise.reject(v)}try{(h=(c=$(this,ui)).onSettled)==null||h.call(c,void 0,t.error,m,g,y)}catch(v){Promise.reject(v)}}}this.listeners.forEach(m=>{m($(this,Ji))})})},MS),Cs,FS,E_=(FS=class extends Ll{constructor(e={}){super();We(this,Cs);this.config=e,Le(this,Cs,new Map)}build(e,t,r){const s=t.queryKey,i=t.queryHash??fg(s,t);let o=this.get(i);return o||(o=new f_({client:e,queryKey:s,queryHash:i,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){$(this,Cs).has(e.queryHash)||($(this,Cs).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=$(this,Cs).get(e.queryHash);t&&(e.destroy(),t===e&&$(this,Cs).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){kr.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return $(this,Cs).get(e)}getAll(){return[...$(this,Cs).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>cx(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>cx(e,r)):t}notify(e){kr.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){kr.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){kr.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Cs=new WeakMap,FS),dr,ea,ta,ul,cl,ra,dl,fl,US,S_=(US=class{constructor(n={}){We(this,dr);We(this,ea);We(this,ta);We(this,ul);We(this,cl);We(this,ra);We(this,dl);We(this,fl);Le(this,dr,n.queryCache||new E_),Le(this,ea,n.mutationCache||new v_),Le(this,ta,n.defaultOptions||{}),Le(this,ul,new Map),Le(this,cl,new Map),Le(this,ra,0)}mount(){nd(this,ra)._++,$(this,ra)===1&&(Le(this,dl,pg.subscribe(async n=>{n&&(await this.resumePausedMutations(),$(this,dr).onFocus())})),Le(this,fl,Wd.subscribe(async n=>{n&&(await this.resumePausedMutations(),$(this,dr).onOnline())})))}unmount(){var n,e;nd(this,ra)._--,$(this,ra)===0&&((n=$(this,dl))==null||n.call(this),Le(this,dl,void 0),(e=$(this,fl))==null||e.call(this),Le(this,fl,void 0))}isFetching(n){return $(this,dr).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return $(this,ea).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=$(this,dr).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=$(this,dr).build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(ia(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return $(this,dr).findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),s=$(this,dr).get(r.queryHash),i=s==null?void 0:s.state.data,o=t_(e,i);if(o!==void 0)return $(this,dr).build(this,r).setData(o,{...t,manual:!0})}setQueriesData(n,e,t){return kr.batch(()=>$(this,dr).findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=$(this,dr).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=$(this,dr);kr.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=$(this,dr);return kr.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=kr.batch(()=>$(this,dr).findAll(n).map(s=>s.cancel(t)));return Promise.all(r).then(ln).catch(ln)}invalidateQueries(n,e={}){return kr.batch(()=>($(this,dr).findAll(n).forEach(t=>{t.invalidate()}),(n==null?void 0:n.refetchType)==="none"?Promise.resolve():this.refetchQueries({...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=kr.batch(()=>$(this,dr).findAll(n).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(ln)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(ln)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=$(this,dr).build(this,e);return t.isStaleByTime(ia(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(ln).catch(ln)}fetchInfiniteQuery(n){return n.behavior=vx(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(ln).catch(ln)}ensureInfiniteQueryData(n){return n.behavior=vx(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Wd.isOnline()?$(this,ea).resumePausedMutations():Promise.resolve()}getQueryCache(){return $(this,dr)}getMutationCache(){return $(this,ea)}getDefaultOptions(){return $(this,ta)}setDefaultOptions(n){Le(this,ta,n)}setQueryDefaults(n,e){$(this,ul).set(eo(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...$(this,ul).values()],t={};return e.forEach(r=>{Ou(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){$(this,cl).set(eo(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...$(this,cl).values()],t={};return e.forEach(r=>{Ou(n,r.mutationKey)&&Object.assign(t,r.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...$(this,ta).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=fg(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===hg&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...$(this,ta).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){$(this,dr).clear(),$(this,ea).clear()}},dr=new WeakMap,ea=new WeakMap,ta=new WeakMap,ul=new WeakMap,cl=new WeakMap,ra=new WeakMap,dl=new WeakMap,fl=new WeakMap,US),_T=D.createContext(void 0),pa=n=>{const e=D.useContext(_T);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},T_=({client:n,children:e})=>(D.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),b.jsx(_T.Provider,{value:n,children:e})),kT=D.createContext(!1),b_=()=>D.useContext(kT);kT.Provider;function w_(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var A_=D.createContext(w_()),I_=()=>D.useContext(A_),R_=(n,e,t)=>{const r=t!=null&&t.state.error&&typeof n.throwOnError=="function"?mg(n.throwOnError,[t.state.error,t]):n.throwOnError;(n.suspense||n.experimental_prefetchInRender||r)&&(e.isReset()||(n.retryOnMount=!1))},L_=n=>{D.useEffect(()=>{n.clearReset()},[n])},__=({result:n,errorResetBoundary:e,throwOnError:t,query:r,suspense:s})=>n.isError&&!e.isReset()&&!n.isFetching&&r&&(s&&n.data===void 0||mg(t,[n.error,r])),k_=n=>{if(n.suspense){const t=s=>s==="static"?s:Math.max(s??1e3,1e3),r=n.staleTime;n.staleTime=typeof r=="function"?(...s)=>t(r(...s)):t(r),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3))}},C_=(n,e)=>n.isLoading&&n.isFetching&&!e,D_=(n,e)=>(n==null?void 0:n.suspense)&&e.isPending,Ex=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function P_(n,e,t){var g,y,v,E;const r=b_(),s=I_(),i=pa(),o=i.defaultQueryOptions(n);(y=(g=i.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||y.call(g,o);const u=i.getQueryCache().get(o.queryHash);o._optimisticResults=r?"isRestoring":"optimistic",k_(o),R_(o,s,u),L_(s);const d=!i.getQueryCache().get(o.queryHash),[c]=D.useState(()=>new e(i,o)),h=c.getOptimisticResult(o),m=!r&&n.subscribed!==!1;if(D.useSyncExternalStore(D.useCallback(S=>{const A=m?c.subscribe(kr.batchCalls(S)):ln;return c.updateResult(),A},[c,m]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),D.useEffect(()=>{c.setOptions(o)},[o,c]),D_(o,h))throw Ex(o,c,s);if(__({result:h,errorResetBoundary:s,throwOnError:o.throwOnError,query:u,suspense:o.suspense}))throw h.error;if((E=(v=i.getDefaultOptions().queries)==null?void 0:v._experimental_afterQuery)==null||E.call(v,o,h),o.experimental_prefetchInRender&&!Ja&&C_(h,r)){const S=d?Ex(o,c,s):u==null?void 0:u.promise;S==null||S.catch(ln).finally(()=>{c.updateResult()})}return o.notifyOnChangeProps?h:c.trackResult(h)}function gr(n,e){return P_(n,h_)}function Ms(n,e){const t=pa(),[r]=D.useState(()=>new x_(t,n));D.useEffect(()=>{r.setOptions(n)},[r,n]);const s=D.useSyncExternalStore(D.useCallback(o=>r.subscribe(kr.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=D.useCallback((o,u)=>{r.mutate(o,u).catch(ln)},[r]);if(s.error&&mg(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:i,mutateAsync:s.mutate}}function O_(n){return gr({queryKey:["feed","home",n],queryFn:()=>ug.home(n)})}function N_(){return gr({queryKey:["feed","trending"],queryFn:ug.trending})}function M_(){return gr({queryKey:["feed","subscriptions"],queryFn:ug.subscriptions})}const F_=["All","Music","Gaming","Tech","Design","Education","News","Sports","Entertainment"];function U_({value:n,onChange:e}){const t=D.useRef(null),r=s=>{var i;(i=t.current)==null||i.scrollBy({left:s==="left"?-200:200,behavior:"smooth"})};return b.jsxs("div",{className:"relative",children:[b.jsx("button",{onClick:()=>r("left"),className:"absolute -left-1 top-1/2 z-10 hidden -translate-y-1/2 rounded-full bg-background p-1 shadow md:block",children:b.jsx(CR,{className:"h-4 w-4"})}),b.jsx("div",{ref:t,className:"scrollbar-hide flex gap-2 overflow-x-auto px-1 py-1",children:F_.map(s=>b.jsx("button",{onClick:()=>e(s),className:Hr("shrink-0 rounded-full px-3 py-1.5 text-sm font-medium transition-colors",s===n?"bg-foreground text-background":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:s},s))}),b.jsx("button",{onClick:()=>r("right"),className:"absolute -right-1 top-1/2 z-10 hidden -translate-y-1/2 rounded-full bg-background p-1 shadow md:block",children:b.jsx(aT,{className:"h-4 w-4"})})]})}function B_(){return b.jsxs("div",{children:[b.jsx(gu,{className:"aspect-video w-full rounded-xl"}),b.jsxs("div",{className:"mt-3 flex gap-3",children:[b.jsx(gu,{className:"h-9 w-9 shrink-0 rounded-full"}),b.jsxs("div",{className:"flex-1 space-y-2",children:[b.jsx(gu,{className:"h-4 w-full"}),b.jsx(gu,{className:"h-3 w-2/3"}),b.jsx(gu,{className:"h-3 w-1/2"})]})]})]})}function yg({loading:n,items:e}){return n?b.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Array.from({length:8}).map((t,r)=>b.jsx(B_,{},r))}):e.length?b.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.map(t=>b.jsx(Rl,{video:t},t.id))}):b.jsx(XL,{title:"No content",description:"Try again later"})}function $_(){var r;const[n,e]=D.useState("All"),t=O_(n);return b.jsxs("section",{className:"space-y-5",children:[b.jsx(U_,{value:n,onChange:e}),b.jsx(yg,{loading:t.isLoading,items:((r=t.data)==null?void 0:r.items)??[]})]})}function j_(){var e;const n=N_();return b.jsxs("section",{className:"space-y-5",children:[b.jsx("h1",{className:"text-2xl font-bold",children:"Trending"}),b.jsx(yg,{loading:n.isLoading,items:((e=n.data)==null?void 0:e.items)??[]})]})}function V_(){var e;const n=M_();return b.jsxs("section",{className:"space-y-5",children:[b.jsx("h1",{className:"text-2xl font-bold",children:"Subscriptions"}),b.jsx(yg,{loading:n.isLoading,items:((e=n.data)==null?void 0:e.items)??[]})]})}function G_(n,e=300){const[t,r]=D.useState(n);return D.useEffect(()=>{const s=setTimeout(()=>r(n),e);return()=>clearTimeout(s)},[n,e]),t}function K_(n,e,t){return gr({queryKey:["search",n,e,t],queryFn:()=>HL.query(n,e,t),enabled:n.trim().length>0})}const H_=[{value:"video",label:"Videos"},{value:"channel",label:"Channels"},{value:"live",label:"Live"},{value:"short",label:"Shorts"}];function z_(){const[n,e]=sT(),t=n.get("q")??"",r=n.get("tab")??"video",s=n.get("sort")??"relevance",[i,o]=D.useState(t),u=G_(i,350);D.useEffect(()=>{e(h=>(h.set("q",u),h.set("tab",r),h.set("sort",s),h))},[u,r,s,e]);const d=K_(u,r,s),c=D.useMemo(()=>d.data?r==="short"?d.data.shorts:r==="live"?d.data.lives:r==="channel"?d.data.channels:d.data.videos:[],[d.data,r]);return b.jsxs("section",{className:"mx-auto max-w-4xl space-y-4",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("div",{className:"flex flex-1",children:[b.jsx("input",{value:i,onChange:h=>o(h.target.value),placeholder:"Search videos, channels, live...",className:"h-10 w-full rounded-l-full border border-r-0 bg-background px-4 text-sm outline-none focus:border-primary"}),b.jsx("button",{className:"flex h-10 w-14 items-center justify-center rounded-r-full border bg-secondary",children:b.jsx(lT,{className:"h-4 w-4"})})]}),b.jsxs("select",{className:"h-10 rounded-full border bg-background px-3 text-sm",value:s,onChange:h=>e({q:u,tab:r,sort:h.target.value}),children:[b.jsx("option",{value:"relevance",children:"Relevance"}),b.jsx("option",{value:"latest",children:"Latest"}),b.jsx("option",{value:"views",children:"Most viewed"})]})]}),b.jsx("div",{className:"flex gap-2 overflow-x-auto",children:H_.map(h=>b.jsx("button",{onClick:()=>e({q:u,tab:h.value,sort:s}),className:Hr("shrink-0 rounded-full px-3 py-1.5 text-sm font-medium transition-colors",h.value===r?"bg-foreground text-background":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:h.label},h.value))}),b.jsx("div",{className:"space-y-4",children:c.map(h=>{var m;return r==="channel"?b.jsxs(ps,{to:`/channel/${h.id}`,className:"flex items-center gap-4 rounded-xl p-3 hover:bg-accent",children:[b.jsx("img",{src:h.avatarUrl,className:"h-16 w-16 rounded-full object-cover",alt:h.name}),b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"font-medium",children:h.name}),b.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.handle,"  ",qn(h.followersCount)," subscribers"]})]}),b.jsx(Ct,{className:"rounded-full bg-foreground text-background hover:bg-foreground/90",children:"Subscribe"})]},h.id):r==="live"?b.jsxs(ps,{to:`/live/${h.id}`,className:"flex gap-4 rounded-xl p-2 hover:bg-accent",children:[b.jsxs("div",{className:"relative w-64 shrink-0",children:[b.jsx("img",{src:h.coverUrl,className:"aspect-video w-full rounded-lg object-cover",alt:h.title}),b.jsxs("span",{className:"absolute bottom-1 left-1 flex items-center gap-1 rounded bg-red-600 px-1.5 py-0.5 text-[10px] font-bold text-white",children:[b.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-white"})," LIVE"]})]}),b.jsxs("div",{className:"pt-1",children:[b.jsx("p",{className:"font-medium",children:h.title}),b.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:(m=h.author)==null?void 0:m.name}),b.jsxs("p",{className:"text-sm text-muted-foreground",children:[qn(h.viewers)," watching  ",h.category]})]})]},h.id):b.jsx(Rl,{video:h,horizontal:!0},h.id)})})]})}const Re=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},W_=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=Y_},Y_=Number.MAX_SAFE_INTEGER||9007199254740991;let Ve=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),X=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),w=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var ht={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},De={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Oo{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class q_{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Oo(e),this.fast_=new Oo(t),this.defaultTTFB_=s,this.ttfb_=new Oo(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Oo(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Oo(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Oo(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Q_(n,e,t){return(e=Z_(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $t(){return $t=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$t.apply(null,arguments)}function Sx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Ft(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sx(Object(t),!0).forEach(function(r){Q_(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sx(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function X_(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Z_(n){var e=X_(n,"string");return typeof e=="symbol"?e:e+""}class Xn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Ki,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Ki=function(){},J_={trace:Ki,debug:Ki,log:Ki,warn:Ki,info:Ki,error:Ki};function Sp(){return $t({},J_)}function ek(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Ki}function Tx(n,e,t){return e[n]?e[n].bind(e):ek(n,t)}const Tp=Sp();function tk(n,e,t){const r=Sp();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Tx(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Sp()}s.forEach(i=>{Tp[i]=Tx(i,n)})}else $t(Tp,r);return r}const Bt=Tp;function ua(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rk(n){return typeof self<"u"&&n===self.ManagedMediaSource}function CT(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function Un(n,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",u=0;for(;u<t;){if(r=n[u++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[u++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[u++],i=n[u++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function Gr(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function DT(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function nk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xm={exports:{}},bx;function sk(){return bx||(bx=1,(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,c,h){if(h=h||{},d=d.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return d;var m=u.parseURL(d);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var g=u.parseURL(c);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return h.alwaysNormalize?(g.path=u.normalizePath(g.path),u.buildURLFromParts(g)):c;var y=u.parseURL(d);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=s.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var E={scheme:y.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(E.netLoc=y.netLoc,g.path[0]!=="/"))if(!g.path)E.path=y.path,g.params||(E.params=y.params,g.query||(E.query=y.query));else{var S=y.path,A=S.substring(0,S.lastIndexOf("/")+1)+g.path;E.path=u.normalizePath(A)}return E.path===null&&(E.path=h.alwaysNormalize?u.normalizePath(g.path):g.path),u.buildURLFromParts(E)},parseURL:function(d){var c=r.exec(d);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(i,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};n.exports=u})()})(xm)),xm.exports}var vg=sk();class xg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Gt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class PT{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,ak(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Gt.AUDIO]:null,[Gt.VIDEO]:null,[Gt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=vg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Gt.AUDIO]=null,e[Gt.VIDEO]=null,e[Gt.AUDIOVIDEO]=null}}function pr(n){return n.sn!=="initSegment"}class Em extends PT{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Re(e)&&Re(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Re(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Re(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return pr(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,r),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,i)}}class ik extends PT{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function OT(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||OT(t,e)}}function ak(n,e){const t=OT(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const wx=Math.pow(2,32)-1,ok=[].push,NT={video:1,audio:2,id3:3,text:4};function Lr(n){return String.fromCharCode.apply(null,n)}function MT(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function nt(n,e){const t=FT(n,e);return t<0?4294967296+t:t}function Ax(n,e){let t=nt(n,e);return t*=Math.pow(2,32),t+=nt(n,e+4),t}function FT(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function lk(n){const e=n.byteLength;for(let t=0;t<e;){const r=nt(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function dt(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=nt(n,s),o=Lr(n.subarray(s+4,s+8)),u=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,u));else{const d=dt(n.subarray(s+8,u),e.slice(1));d.length&&ok.apply(t,d)}s=u}return t}function uk(n){const e=[],t=n[0];let r=8;const s=nt(n,r);r+=4;let i=0,o=0;t===0?(i=nt(n,r),o=nt(n,r+4),r+=8):(i=Ax(n,r),o=Ax(n,r+8),r+=16),r+=2;let u=n.length+o;const d=MT(n,r);r+=2;for(let c=0;c<d;c++){let h=r;const m=nt(n,h);h+=4;const g=m&2147483647;if((m&2147483648)>>>31===1)return Bt.warn("SIDX has hierarchical references (not supported)"),null;const v=nt(n,h);h+=4,e.push({referenceSize:g,subsegmentDuration:v,info:{duration:v/s,start:u,end:u+g-1}}),u+=g,h+=4,r=h}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:d,references:e}}function UT(n){const e=[],t=dt(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=dt(i,["tkhd"])[0];if(o){let u=o[0];const d=nt(o,u===0?12:20),c=dt(i,["mdia","mdhd"])[0];if(c){u=c[0];const h=nt(c,u===0?12:20),m=dt(i,["mdia","hdlr"])[0];if(m){const g=Lr(m.subarray(8,12)),y={soun:Gt.AUDIO,vide:Gt.VIDEO}[g],v=dt(i,["mdia","minf","stbl","stsd"])[0],E=ck(v);y?(e[d]={timescale:h,type:y,stsd:E},e[y]=Ft({timescale:h,id:d},E)):e[d]={timescale:h,type:g,stsd:E}}}}}return dt(n,["moov","mvex","trex"]).forEach(s=>{const i=nt(s,4),o=e[i];o&&(o.default={duration:nt(s,12),flags:nt(s,20)})}),e}function ck(n){const e=n.subarray(8),t=e.subarray(86),r=Lr(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const c=dt(e,[r])[0].subarray(r==="enca"?28:78);dt(c,["sinf"]).forEach(m=>{const g=dt(m,["schm"])[0];if(g){const y=Lr(g.subarray(4,8));if(y==="cbcs"||y==="cenc"){const v=dt(m,["frma"])[0];v&&(s=Lr(v))}}})}const u=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const d=dt(t,["avcC"])[0];d&&d.length>3&&(s+="."+dd(d[1])+dd(d[2])+dd(d[3]),i=cd(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=dt(e,[r])[0],c=dt(d.subarray(28),["esds"])[0];if(c&&c.length>7){let h=4;if(c[h++]!==3)break;h=Sm(c,h),h+=2;const m=c[h++];if(m&128&&(h+=2),m&64&&(h+=c[h++]),c[h++]!==4)break;h=Sm(c,h);const g=c[h++];if(g===64)s+="."+dd(g);else break;if(h+=12,c[h++]!==5)break;h=Sm(c,h);const y=c[h++];let v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((c[h]&224)>>5)),s+="."+v}break}case"hvc1":case"hev1":{const d=dt(t,["hvcC"])[0];if(d&&d.length>12){const c=d[1],h=["","A","B","C"][c>>6],m=c&31,g=nt(d,2),y=(c&32)>>5?"H":"L",v=d[12],E=d.subarray(6,12);s+="."+h+m,s+="."+dk(g).toString(16).toUpperCase(),s+="."+y+v;let S="";for(let A=E.length;A--;){const I=E[A];(I||S)&&(S="."+I.toString(16).toUpperCase()+S)}s+=S}i=cd(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=cd(s,t)||s;break}case"vp09":{const d=dt(t,["vpcC"])[0];if(d&&d.length>6){const c=d[4],h=d[5],m=d[6]>>4&15;s+="."+Rs(c)+"."+Rs(h)+"."+Rs(m)}break}case"av01":{const d=dt(t,["av1C"])[0];if(d&&d.length>2){const c=d[1]>>>5,h=d[1]&31,m=d[2]>>>7?"H":"M",g=(d[2]&64)>>6,y=(d[2]&32)>>5,v=c===2&&g?y?12:10:g?10:8,E=(d[2]&16)>>4,S=(d[2]&8)>>3,A=(d[2]&4)>>2,I=d[2]&3;s+="."+c+"."+Rs(h)+m+"."+Rs(v)+"."+E+"."+S+A+I+"."+Rs(1)+"."+Rs(1)+"."+Rs(1)+"."+0,i=cd("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function cd(n,e){const t=dt(e,["dvvC"]),r=t.length?t[0]:dt(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+Rs(s)+"."+Rs(i)}}function dk(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Sm(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function dd(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Rs(n){return(n<10?"0":"")+n}function fk(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&BT(n,(r,s)=>{const i=r.subarray(8,24);i.some(o=>o!==0)||(Bt.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Gr(i)} -> ${Gr(t)}`),r.set(t,8))})}function hk(n){const e=[];return BT(n,t=>e.push(t.subarray(8,24))),e}function BT(n,e){dt(n,["moov","trak"]).forEach(r=>{const s=dt(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=dt(i,["enca"]);const u=o.length>0;u||(o=dt(i,["encv"])),o.forEach(d=>{const c=u?d.subarray(28):d.subarray(78);dt(c,["sinf"]).forEach(m=>{const g=$T(m);g&&e(g,u)})})})}function $T(n){const e=dt(n,["schm"])[0];if(e){const t=Lr(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=dt(n,["schi","tenc"])[0];if(r)return r}}}function mk(n,e,t){const r={},s=dt(n,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],u=dt(o,["tfhd"])[0],d=nt(u,4),c=e[d];if(!c)continue;r[d]||(r[d]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const h=r[d],m=dt(o,["tfdt"])[0];if(m){const R=m[0];let k=nt(m,4);R===1&&(k===wx?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(k*=wx+1,k+=nt(m,8))),Re(k)&&(!Re(h.start)||k<h.start)&&(h.start=k)}const g=c.default,y=nt(u,0)|(g==null?void 0:g.flags);let v=(g==null?void 0:g.duration)||0;y&8&&(y&2?v=nt(u,12):v=nt(u,8));const E=dt(o,["trun"]);let S=h.start||0,A=0,I=v;for(let R=0;R<E.length;R++){const k=E[R],C=nt(k,4),V=h.sampleCount;h.sampleCount+=C;const _=k[3]&1,N=k[3]&4,F=k[2]&1,O=k[2]&2,q=k[2]&4,H=k[2]&8;let ie=8,oe=C;for(_&&(ie+=4),N&&C&&(!(k[ie+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=V),ie+=4,F?(I=nt(k,ie),ie+=4):I=v,O&&(ie+=4),H&&(ie+=4),S+=I,A+=I,oe--);oe--;)F?(I=nt(k,ie),ie+=4):I=v,O&&(ie+=4),q&&(k[ie+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(oe+1),h.keyFrameStart=S),ie+=4),H&&(ie+=4),S+=I,A+=I;!A&&v&&(A+=v*C)}h.duration+=A}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const u=dt(n,["sidx"]);for(let d=0;d<u.length;d++){const c=uk(u[d]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const h=c.references.reduce((m,g)=>m+g.info.duration||0,0);o=Math.max(o,h+c.earliestPresentationTime/c.timescale)}}o&&Re(o)&&Object.keys(r).forEach(d=>{r[d].duration||(r[d].duration=o*r[d].timescale-r[d].start)})}return r}function pk(n){const e={valid:null,remainder:null},t=dt(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Qn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Ix(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return dt(r,["moof"]).map(d=>{const c=d.byteOffset-8;dt(d,["traf"]).map(m=>{const g=dt(m,["tfdt"]).map(y=>{const v=y[0];let E=nt(y,4);return v===1&&(E*=Math.pow(2,32),E+=nt(y,8)),E/s})[0];return g!==void 0&&(n=g),dt(m,["tfhd"]).map(y=>{const v=nt(y,4),E=nt(y,0)&16777215,S=(E&1)!==0,A=(E&2)!==0,I=(E&8)!==0;let R=0;const k=(E&16)!==0;let C=0;const V=(E&32)!==0;let _=8;v===i&&(S&&(_+=8),A&&(_+=4),I&&(R=nt(y,_),_+=4),k&&(C=nt(y,_),_+=4),V&&(_+=4),e.type==="video"&&(o=xf(e.codec)),dt(m,["trun"]).map(N=>{const F=N[0],O=nt(N,0)&16777215,q=(O&1)!==0;let H=0;const ie=(O&4)!==0,oe=(O&256)!==0;let ce=0;const ae=(O&512)!==0;let ue=0;const W=(O&1024)!==0,Z=(O&2048)!==0;let ne=0;const P=nt(N,4);let B=8;q&&(H=nt(N,B),B+=4),ie&&(B+=4);let de=H+c;for(let pe=0;pe<P;pe++){if(oe?(ce=nt(N,B),B+=4):ce=R,ae?(ue=nt(N,B),B+=4):ue=C,W&&(B+=4),Z&&(F===0?ne=nt(N,B):ne=FT(N,B),B+=4),e.type===Gt.VIDEO){let ge=0;for(;ge<ue;){const we=nt(r,de);if(de+=4,gk(o,r[de])){const Ie=r.subarray(de,de+we);Eg(Ie,o?2:1,n+ne/s,t)}de+=we,ge+=we+4}}n+=ce/s}}))})})}),t}function xf(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function gk(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Eg(n,e,t,r){const s=jT(n);let i=0;i+=e;let o=0,u=0,d=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;d=s[i++],o+=d}while(d===255);u=0;do{if(i>=s.length)break;d=s[i++],u+=d}while(d===255);const c=s.length-i;let h=i;if(u<c)i+=u;else if(u>c){Bt.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(s[h++]===181){const g=MT(s,h);if(h+=2,g===49){const y=nt(s,h);if(h+=4,y===1195456820){const v=s[h++];if(v===3){const E=s[h++],S=31&E,A=64&E,I=A?2+S*3:0,R=new Uint8Array(I);if(A){R[0]=E;for(let k=1;k<I;k++)R[k]=s[h++]}r.push({type:v,payloadType:o,pts:t,bytes:R})}}}}}else if(o===5&&u>16){const m=[];for(let v=0;v<16;v++){const E=s[h++].toString(16);m.push(E.length==1?"0"+E:E),(v===3||v===5||v===7||v===9)&&m.push("-")}const g=u-16,y=new Uint8Array(g);for(let v=0;v<g;v++)y[v]=s[h++];r.push({payloadType:o,pts:t,uuid:m.join(""),userData:Un(y),userDataBytes:y})}}}function jT(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function yk(n){const e=n[0];let t="",r="",s=0,i=0,o=0,u=0,d=0,c=0;if(e===0){for(;Lr(n.subarray(c,c+1))!=="\0";)t+=Lr(n.subarray(c,c+1)),c+=1;for(t+=Lr(n.subarray(c,c+1)),c+=1;Lr(n.subarray(c,c+1))!=="\0";)r+=Lr(n.subarray(c,c+1)),c+=1;r+=Lr(n.subarray(c,c+1)),c+=1,s=nt(n,12),i=nt(n,16),u=nt(n,20),d=nt(n,24),c=28}else if(e===1){c+=4,s=nt(n,c),c+=4;const m=nt(n,c);c+=4;const g=nt(n,c);for(c+=4,o=2**32*m+g,W_(o)||(o=Number.MAX_SAFE_INTEGER,Bt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=nt(n,c),c+=4,d=nt(n,c),c+=4;Lr(n.subarray(c,c+1))!=="\0";)t+=Lr(n.subarray(c,c+1)),c+=1;for(t+=Lr(n.subarray(c,c+1)),c+=1;Lr(n.subarray(c,c+1))!=="\0";)r+=Lr(n.subarray(c,c+1)),c+=1;r+=Lr(n.subarray(c,c+1)),c+=1}const h=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:u,id:d,payload:h}}function vk(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function xk(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),vk([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t)}function Ek(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=Sk(s);e.push(i),r+=i.size}}return e}function Sk(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,u=Gr(new Uint8Array(o,t+12,16));let d=null,c=null,h=0;if(i===0)h=28;else{const g=n.getUint32(28);if(!g||r<32+g*16)return{offset:t,size:e};d=[];for(let y=0;y<g;y++)d.push(new Uint8Array(o,t+32+y*16,16));h=32+g*16}if(!h)return{offset:t,size:e};const m=n.getUint32(h);return e-32<m?{offset:t,size:e}:(c=new Uint8Array(o,t+h+4,m),{version:i,systemId:u,kids:d,data:c,offset:t,size:e})}const VT=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ml={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Sg(n,e){const t=ml[e];return!!t&&!!t[n.slice(0,4)]}function Nu(n,e,t=!0){return!n.split(",").some(r=>!Tg(r,e,t))}function Tg(n,e,t=!0){var r;const s=ua(t);return(r=s==null?void 0:s.isTypeSupported(Mu(n,e)))!=null?r:!1}function Mu(n,e){return`${e}/mp4;codecs=${n}`}function Rx(n){if(n){const e=n.substring(0,4);return ml.video[e]}return 2}function Yd(n){const e=VT();return n.split(",").reduce((t,r)=>{const i=e&&xf(r)?9:ml.video[r];return i?(i*2+t)/(t?3:2):(ml.audio[r]+t)/(t?2:1)},0)}const Tm={};function Tk(n,e=!0){if(Tm[n])return Tm[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(Tg(t[s],"audio",e))return Tm[n]=t[s],t[s];if(t[s]==="mp3"&&(r=ua(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const bk=/flac|opus|mp4a\.40\.34/i;function qd(n,e=!0){return n.replace(bk,t=>Tk(t.toLowerCase(),e))}function wk(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)Sg(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function Pd(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(Lx(n,"audio")||Lx(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function Lx(n,e){return Sg(n,e)&&Tg(n,e)}function Ak(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Ik(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function _x(n){const e=ua(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function bp(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Rk={supported:!0,powerEfficient:!0,smooth:!0},Lk={supported:!1,smooth:!1,powerEfficient:!1},GT={supported:!0,configurations:[],decodingInfoResults:[Rk]};function KT(n,e){return{supported:!1,configurations:e,decodingInfoResults:[Lk],error:n}}function _k(n,e,t,r,s,i){const o=n.videoCodec,u=n.audioCodec?n.audioGroups:null,d=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,h=c?parseInt(c):d?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((g,y)=>{if(y){const v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(E=>{g[E]=(g[E]||0)+v.channels[E]})}return g},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(g=>xf(g))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!m&&Re(h)&&Object.keys(m).some(g=>parseInt(g)>h)}function HT(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(GT);const i=[],o=kk(n),u=o.length,d=Ck(n,e,u>0),c=d.length;for(let h=u||1*c||1;h--;){const m={type:"media-source"};if(u&&(m.video=o[h%u]),c){m.audio=d[h%c];const g=m.audio.bitrate;m.video&&g&&(m.video.bitrate-=g)}i.push(m)}if(s){const h=navigator.userAgent;if(s.split(",").some(m=>xf(m))&&VT())return Promise.resolve(KT(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),i))}return Promise.all(i.map(h=>{const m=Pk(h);return r[m]||(r[m]=t.decodingInfo(h))})).then(h=>({supported:!h.some(m=>!m.supported),configurations:i,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:i,decodingInfoResults:[],error:h}))}function kk(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=zT(n),s=n.width||640,i=n.height||480,o=n.frameRate||30,u=n.videoRange.toLowerCase();return t?t.map(d=>{const c={contentType:Mu(Ik(d),"video"),width:s,height:i,bitrate:r,framerate:o};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function Ck(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=zT(n);return s&&n.audioGroups?n.audioGroups.reduce((o,u)=>{var d;const c=u?(d=e.groups[u])==null?void 0:d.tracks:null;return c?c.reduce((h,m)=>{if(m.groupId===u){const g=parseFloat(m.channels||"");s.forEach(y=>{const v={contentType:Mu(y,"audio"),bitrate:t?Dk(y,i):i};g&&(v.channels=""+g),h.push(v)})}return h},o):o},[]):[]}function Dk(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function zT(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Pk(n){let e="";const{audio:t,video:r}=n;if(r){const s=bp(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=bp(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const wp=["NONE","TYPE-0","TYPE-1",null];function Ok(n){return wp.indexOf(n)>-1}const Qd=["SDR","PQ","HLG"];function Nk(n){return!!n&&Qd.indexOf(n)>-1}var Od={No:"",Yes:"YES",v2:"v2"};function kx(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Od.v2:Od.Yes:Od.No}class Cx{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Fu{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Dx(this._audioGroups,e)}hasSubtitleGroup(e){return Dx(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Dx(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Mk(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Fk(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||Qd.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&Mk(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const Uk=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Kt=(n,e)=>JSON.stringify(n,Uk(e));function Bk(n,e,t,r,s){const i=Object.keys(n),o=r==null?void 0:r.channels,u=r==null?void 0:r.audioCodec,d=s==null?void 0:s.videoCodec,c=o&&parseInt(o)===2;let h=!1,m=!1,g=1/0,y=1/0,v=1/0,E=1/0,S=0,A=[];const{preferHDR:I,allowedVideoRanges:R}=Fk(e,s);for(let N=i.length;N--;){const F=n[i[N]];h||(h=F.channels[2]>0),g=Math.min(g,F.minHeight),y=Math.min(y,F.minFramerate),v=Math.min(v,F.minBitrate),R.filter(q=>F.videoRanges[q]>0).length>0&&(m=!0)}g=Re(g)?g:0,y=Re(y)?y:0;const k=Math.max(1080,g),C=Math.max(30,y);v=Re(v)?v:t,t=Math.max(v,t),m||(e=void 0);const V=i.length>1;return{codecSet:i.reduce((N,F)=>{const O=n[F];if(F===N)return N;if(A=m?R.filter(q=>O.videoRanges[q]>0):[],V){if(O.minBitrate>t)return As(F,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),N;if(!O.hasDefaultAudio)return As(F,"no renditions with default or auto-select sound found"),N;if(u&&F.indexOf(u.substring(0,4))%5!==0)return As(F,`audio codec preference "${u}" not found`),N;if(o&&!c){if(!O.channels[o])return As(F,`no renditions with ${o} channel sound found (channels options: ${Object.keys(O.channels)})`),N}else if((!u||c)&&h&&O.channels[2]===0)return As(F,"no renditions with stereo sound found"),N;if(O.minHeight>k)return As(F,`min resolution of ${O.minHeight} > maximum of ${k}`),N;if(O.minFramerate>C)return As(F,`min framerate of ${O.minFramerate} > maximum of ${C}`),N;if(!A.some(q=>O.videoRanges[q]>0))return As(F,`no variants with VIDEO-RANGE of ${Kt(A)} found`),N;if(d&&F.indexOf(d.substring(0,4))%5!==0)return As(F,`video codec preference "${d}" not found`),N;if(O.maxScore<S)return As(F,`max score of ${O.maxScore} < selected max of ${S}`),N}return N&&(Yd(F)>=Yd(N)||O.fragmentError>n[N].fragmentError)?N:(E=O.minIndex,S=O.maxScore,F)},void 0),videoRanges:A,preferHDR:I,minFramerate:y,minBitrate:v,minIndex:E}}function As(n,e){Bt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function WT(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function $k(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const u=i.audioGroups;let d=s[i.codecSet];d||(s[i.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return d.minHeight=Math.min(d.minHeight,c),d.minFramerate=Math.min(d.minFramerate,i.frameRate),d.minIndex=Math.min(d.minIndex,o),d.maxScore=Math.max(d.maxScore,i.score),d.fragmentError+=i.fragmentError,d.videoRanges[i.videoRange]=(d.videoRanges[i.videoRange]||0)+1,u&&u.forEach(h=>{if(!h)return;const m=e.groups[h];m&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(g=>{d.channels[g]=(d.channels[g]||0)+m.channels[g]}))}),s},{})}function Px(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function Os(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(qa(n,s,t))return r}return-1}function qa(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:u}=n,d=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||jk(i,e.lang))&&(i===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in n)||Vk(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function jk(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function Vk(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Oa(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function Gk(n,e,t,r,s){const i=e[r],u=e.reduce((g,y,v)=>{const E=y.uri;return(g[E]||(g[E]=[])).push(v),g},{})[i.uri];u.length>1&&(r=Math.max.apply(Math,u));const d=i.videoRange,c=i.frameRate,h=i.codecSet.substring(0,4),m=Ox(e,r,g=>{if(g.videoRange!==d||g.frameRate!==c||g.codecSet.substring(0,4)!==h)return!1;const y=g.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return Os(n,v,s)>-1});return m>-1?m:Ox(e,r,g=>{const y=g.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return Os(n,v,s)>-1})}function Ox(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function Xd(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class Kk extends Xn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:u,media:d}=o;if(!s||!d)return;const c=performance.now(),h=i?i.stats:s.stats,m=i?i.duration:s.duration,g=c-h.loading.start,y=o.minAutoLevel,v=s.level,E=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=E>-1&&E!==v,A=!!t||S;if(!A&&(d.paused||!d.playbackRate||!d.readyState))return;const I=o.mainForwardBufferInfo;if(!A&&I===null)return;const R=this.bwEstimator.getEstimateTTFB(),k=Math.abs(d.playbackRate);if(g<=Math.max(R,1e3*(m/(k*2))))return;const C=I?I.len/k:0,V=h.loading.first?h.loading.first-h.loading.start:-1,_=h.loaded&&V>-1,N=this.getBwEstimate(),F=o.levels,O=F[v],q=Math.max(h.loaded,Math.round(m*(s.bitrate||O.averageBitrate)/8));let H=_?g-V:g;H<1&&_&&(H=Math.min(g,h.loaded*8/N));const ie=_?h.loaded*1e3/H:0,oe=R/1e3,ce=ie?(q-h.loaded)/ie:q*8/N+oe;if(ce<=C)return;const ae=ie?ie*8:N,ue=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,W=this.hls.config.abrBandWidthUpFactor;let Z=Number.POSITIVE_INFINITY,ne;for(ne=v-1;ne>y;ne--){const pe=F[ne].maxBitrate,ge=!F[ne].details||ue;if(Z=this.getTimeToLoadFrag(oe,ae,m*pe,ge),Z<Math.min(C,m+oe))break}if(Z>=ce||Z>m*10)return;_?this.bwEstimator.sample(g-Math.min(R,V),h.loaded):this.bwEstimator.sampleTTFB(g);const P=F[ne].maxBitrate;this.getBwEstimate()*W>P&&this.resetEstimator(P);const B=this.findBestLevel(P,y,ne,0,C,1,1);B>-1&&(ne=B),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${C.toFixed(3)} s
      Estimated load time for current fragment: ${ce.toFixed(3)} s
      Estimated load time for down switch fragment: ${Z.toFixed(3)} s
      TTFB estimate: ${V|0} ms
      Current BW estimate: ${Re(N)?N|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ne} @ ${P|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ne,this.clearTimer();const de=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===ne&&ne>0){const pe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ne>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${pe.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,ne>y){let ge=this.findBestLevel(this.hls.levels[y].bitrate,y,ne,0,pe,1,1);ge===-1&&(ge=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};S||ce>Z*2?de():this.timer=self.setInterval(de,Z*1e3),o.trigger(w.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new q_(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(w.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case X.BUFFER_ADD_CODEC_ERROR:case X.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case X.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),u=i?i.stats:r.stats,d=o-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(m,c),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;Re(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===De.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+s.loaded,d=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:u,duration:d},o.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(w.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==De.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),c=this.getStarvationDelay();let h=i.abrBandWidthFactor,m=i.abrBandWidthUpFactor;if(c){const S=this.findBestLevel(d,o,s,c,0,h,m);if(S>=0)return this.rebufferNotice=-1,S}let g=u?Math.min(u,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const S=this.bitrateTestDelay;S&&(g=(u?Math.min(u,i.maxLoadingDelay):i.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),h=m=1)}const y=this.findBestLevel(d,o,s,c,g,h,m);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const v=r.levels[o],E=r.loadLevelObj;return E&&(v==null?void 0:v.bitrate)<E.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,u){var d;const c=s+i,h=this.lastLoadedFragLevel,m=h===-1?this.hls.firstLevel:h,{fragCurrent:g,partCurrent:y}=this,{levels:v,allAudioTracks:E,loadLevel:S,config:A}=this.hls;if(v.length===1)return 0;const I=v[m],R=!!((d=this.hls.latestLevelDetails)!=null&&d.live),k=S===-1||h===-1;let C,V="SDR",_=(I==null?void 0:I.frameRate)||0;const{audioPreference:N,videoPreference:F}=A,O=this.audioTracksByGroup||(this.audioTracksByGroup=WT(E));let q=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;const ae=this.codecTiers||(this.codecTiers=$k(v,O,t,r)),ue=Bk(ae,V,e,N,F),{codecSet:W,videoRanges:Z,minFramerate:ne,minBitrate:P,minIndex:B,preferHDR:de}=ue;q=B,C=W,V=de?Z[Z.length-1]:Z[0],_=ne,e=Math.max(e,P),this.log(`picked start tier ${Kt(ue)}`)}else C=I==null?void 0:I.codecSet,V=I==null?void 0:I.videoRange;const H=y?y.duration:g?g.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,oe=[];for(let ae=r;ae>=t;ae--){var ce;const ue=v[ae],W=ae>m;if(!ue)continue;if(A.useMediaCapabilities&&!ue.supportedResult&&!ue.supportedPromise){const ge=navigator.mediaCapabilities;typeof(ge==null?void 0:ge.decodingInfo)=="function"&&_k(ue,O,V,_,e,N)?(ue.supportedPromise=HT(ue,O,ge,this.supportedCache),ue.supportedPromise.then(we=>{if(!this.hls)return;ue.supportedResult=we;const Ie=this.hls.levels,Ge=Ie.indexOf(ue);we.error?this.warn(`MediaCapabilities decodingInfo error: "${we.error}" for level ${Ge} ${Kt(we)}`):we.supported?we.decodingInfoResults.some(Ze=>Ze.smooth===!1||Ze.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ge} not smooth or powerEfficient: ${Kt(we)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ge} ${Kt(we)}`),Ge>-1&&Ie.length>1&&(this.log(`Removing unsupported level ${Ge}`),this.hls.removeLevel(Ge),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(we=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${we}`)})):ue.supportedResult=GT}if((C&&ue.codecSet!==C||V&&ue.videoRange!==V||W&&_>ue.frameRate||!W&&_>0&&_<ue.frameRate||(ce=ue.supportedResult)!=null&&(ce=ce.decodingInfoResults)!=null&&ce.some(ge=>ge.smooth===!1))&&(!k||ae!==q)){oe.push(ae);continue}const Z=ue.details,ne=(y?Z==null?void 0:Z.partTarget:Z==null?void 0:Z.averagetargetduration)||H;let P;W?P=u*e:P=o*e;const B=H&&s>=H*2&&i===0?ue.averageBitrate:ue.maxBitrate,de=this.getTimeToLoadFrag(ie,P,B*ne,Z===void 0);if(P>=B&&(ae===h||ue.loadError===0&&ue.fragmentError===0)&&(de<=ie||!Re(de)||R&&!this.bitrateTestDelay||de<c)){const ge=this.forcedAutoLevel;return ae!==S&&(ge===-1||ge!==S)&&(oe.length&&this.trace(`Skipped level(s) ${oe.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${v[oe[0]].codecs}" ${v[oe[0]].videoRange}; not compatible with "${C}" ${V}`),this.info(`switch candidate:${m}->${ae} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-B)} ttfb:${ie.toFixed(1)} avgDuration:${ne.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${de.toFixed(1)} firstSelection:${k} codecSet:${ue.codecSet} videoRange:${ue.videoRange} hls.loadLevel:${S}`)),k&&(this.firstSelection=ae),ae}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const YT={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function Hk(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Re(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(Wk(e,t,o))return o}return null}function to(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const u=n.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&Nx(t,r,i)===0||zk(i,n,Math.min(s,r))))return i;const o=YT.search(e,Nx.bind(null,t,r));return o&&(o!==n||!i)?o:i}function zk(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function Nx(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function Wk(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function qT(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return YT.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Zd(n){switch(n.details){case X.FRAG_LOAD_TIMEOUT:case X.KEY_LOAD_TIMEOUT:case X.LEVEL_LOAD_TIMEOUT:case X.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function QT(n){return n.details.startsWith("key")}function XT(n){return QT(n)&&!!n.frag&&!n.frag.decryptdata}function Mx(n,e){const t=Zd(e);return n.default[`${t?"timeout":"error"}Retry`]}function bg(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Fx(n){return Ft(Ft({},n),{errorRetry:null,timeoutRetry:null})}function Jd(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(Yk(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function Yk(n){return Ap(n)||!!n&&(n<400||n>499)}function Ap(n){return n===0&&navigator.onLine===!1}var Vr={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Pn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class qk extends Xn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(w.ERROR,this.onError,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(w.ERROR,this.onError,this),e.off(w.ERROR,this.onErrorOut,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===De.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var u;return(u=o.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case X.FRAG_LOAD_ERROR:case X.FRAG_LOAD_TIMEOUT:case X.KEY_LOAD_ERROR:case X.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case X.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=qo();return}case X.FRAG_GAP:case X.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Vr.SendAlternateToPenaltyBox;return}case X.LEVEL_EMPTY_ERROR:case X.LEVEL_PARSING_ERROR:{var o;const d=t.parent===De.MAIN?t.level:s.loadLevel;t.details===X.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case X.LEVEL_LOAD_ERROR:case X.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case X.AUDIO_TRACK_LOAD_ERROR:case X.AUDIO_TRACK_LOAD_TIMEOUT:case X.SUBTITLE_LOAD_ERROR:case X.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const d=s.loadLevelObj;if(d&&(i.type===ht.AUDIO_TRACK&&d.hasAudioGroup(i.groupId)||i.type===ht.SUBTITLE_TRACK&&d.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Vr.SendAlternateToPenaltyBox,t.errorAction.flags=Pn.MoveAllAlternatesMatchingHost;return}}return;case X.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Vr.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingHDCP};return;case X.KEY_SYSTEM_SESSION_UPDATE_FAILED:case X.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case X.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Vr.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingKey};return;case X.BUFFER_ADD_CODEC_ERROR:case X.REMUX_ALLOC_ERROR:case X.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:s.loadLevel)}return;case X.INTERNAL_EXCEPTION:case X.BUFFER_APPENDING_ERROR:case X.BUFFER_FULL_ERROR:case X.LEVEL_SWITCH_ERROR:case X.BUFFER_STALLED_ERROR:case X.BUFFER_SEEK_OVER_HOLE:case X.BUFFER_NUDGE_ON_STALL:t.errorAction=qo();return}t.type===Ve.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=qo())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Mx(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(Jd(s,i,Zd(e),e.response))return{action:Vr.RetryRequest,flags:Pn.None,retryConfig:s,retryCount:i};const u=this.getLevelSwitchAction(e,t);return s&&(u.retryConfig=s,u.retryCount=i),u}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,u=Mx(QT(e)?o:i,e),d=t.levels.reduce((h,m)=>h+m.fragmentError,0);if(s&&(e.details!==X.FRAG_GAP&&s.fragmentError++,!XT(e)&&Jd(u,d,Zd(e),e.response)))return{action:Vr.RetryRequest,flags:Pn.None,retryConfig:u,retryCount:d};const c=this.getLevelSwitchAction(e,r);return u&&(c.retryConfig=u,c.retryCount=d),c}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const c=e.details;s.loadError++,c===X.BUFFER_APPEND_ERROR&&s.fragmentError++;let h=-1;const{levels:m,loadLevel:g,minAutoLevel:y,maxAutoLevel:v}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const E=(i=e.frag)==null?void 0:i.type,A=(E===De.AUDIO&&c===X.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===X.BUFFER_ADD_CODEC_ERROR||c===X.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:V})=>s.audioCodec!==V),R=e.sourceBufferName==="video"&&(c===X.BUFFER_ADD_CODEC_ERROR||c===X.BUFFER_APPEND_ERROR)&&m.some(({codecSet:V,audioCodec:_})=>s.codecSet!==V&&s.audioCodec===_),{type:k,groupId:C}=(o=e.context)!=null?o:{};for(let V=m.length;V--;){const _=(V+g)%m.length;if(_!==g&&_>=y&&_<=v&&m[_].loadError===0){var u,d;const N=m[_];if(c===X.FRAG_GAP&&E===De.MAIN&&e.frag){const F=m[_].details;if(F){const O=to(e.frag,F.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(k===ht.AUDIO_TRACK&&N.hasAudioGroup(C)||k===ht.SUBTITLE_TRACK&&N.hasSubtitleGroup(C))continue;if(E===De.AUDIO&&(u=s.audioGroups)!=null&&u.some(F=>N.hasAudioGroup(F))||E===De.SUBTITLE&&(d=s.subtitleGroups)!=null&&d.some(F=>N.hasSubtitleGroup(F))||A&&s.audioCodec===N.audioCodec||R&&s.codecSet===N.codecSet||!A&&s.codecSet!==N.codecSet)continue}h=_;break}}if(h>-1&&r.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Vr.SendAlternateToPenaltyBox,flags:Pn.None,nextAutoLevel:h}}return{action:Vr.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Vr.DoNothing:break;case Vr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==X.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Pn.None:this.switchLevel(e,i);break;case Pn.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),c=t.levels[d],h=c==null?void 0:c.attrs["HDCP-LEVEL"];if(r.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=wp[wp.indexOf(h)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Pn.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const c=this.hls.levels,h=c.length;for(let g=h;g--;)if(this.variantHasKey(c[g],d)){var o,u;this.log(`Banned key found in level ${g} (${c[g].bitrate}bps) or audio group "${(o=c[g].audioGroups)==null?void 0:o.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${Gr(d.keyId||[])}`),c[g].fragmentError++,c[g].loadError++,this.log(`Removing level ${g} with key error (${e.error})`),this.hls.removeLevel(g)}const m=e.frag;if(this.hls.levels.length<h)r.resolved=!0;else if(m&&m.type!==De.MAIN){const g=m.decryptdata;g&&!d.matches(g)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===X.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=bp(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function qo(n){const e={action:Vr.DoNothing,flags:Pn.None};return n&&(e.resolved=!0),e}var _r={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Qk{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const u=s[i[o]];if((u==null?void 0:u.body.type)===t&&(!r||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||o>=d.body.sn)return;if(!d.buffered&&(!d.loaded||i)){d.body.type===r&&this.removeFragment(d.body);return}const c=d.range[e];if(c){if(c.time.length===0){this.removeFragment(d.body);return}c.time.some(h=>{const m=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return m&&this.removeFragment(d.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=No(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(u=>{const d=r.elementaryStreams[u];if(!d)return;const c=t[u],h=o||d.partial===!0;i.range[u]=this.getBufferedTimes(r,e.part,h,c)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),fd(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Ux(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=No(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,u=e.end,d=e.minEndPTS||u,c=e.maxStartPTS||o;for(let h=0;h<s.length;h++){const m=s.start(h)-this.bufferPadding,g=s.end(h)+this.bufferPadding;if(c>=m&&d<=g){i.time.push({startPTS:Math.max(o,s.start(h)),endPTS:Math.min(u,s.end(h))});break}else if(o<g&&u>m){const y=Math.max(o,s.start(h)),v=Math.min(u,s.end(h));v>y&&(i.partial=!0,i.time.push({startPTS:y,endPTS:v}))}else if(u<=m)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(c=>{const h=d[c];h&&fd(h)&&(s=h.body.start-u,i=h.body.end+u,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=h.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||fd(t))}getState(e){const t=No(e),r=this.fragments[t];return r?r.buffered?fd(r)?_r.PARTIAL:_r.OK:_r.APPENDING:_r.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=No(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const u=r.type;if(s){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(s)}this.timeRanges=i;const d=i[o];this.detectEvictedFragments(o,d,u,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=No(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const d=u.body;d.type!==r||s&&!d.gap||d.start<t&&d.end>e&&(u.buffered||i)&&this.removeFragment(d)})}removeFragment(e){const t=No(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=Ux(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function fd(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function No(n){return`${n.type}_${n.level}_${n.sn}`}function Ux(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var ca={cbc:0,ctr:1};class Xk{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case ca.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ca.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Zk(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class Jk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],u=r[3],d=this.invSubMix,c=d[0],h=d[1],m=d[2],g=d[3],y=new Uint32Array(256);let v=0,E=0,S=0;for(S=0;S<256;S++)S<128?y[S]=S<<1:y[S]=S<<1^283;for(S=0;S<256;S++){let A=E^E<<1^E<<2^E<<3^E<<4;A=A>>>8^A&255^99,e[v]=A,t[A]=v;const I=y[v],R=y[I],k=y[R];let C=y[A]*257^A*16843008;s[v]=C<<24|C>>>8,i[v]=C<<16|C>>>16,o[v]=C<<8|C>>>24,u[v]=C,C=k*16843009^R*65537^I*257^v*16843008,c[A]=C<<24|C>>>8,h[A]=C<<16|C>>>16,m[A]=C<<8|C>>>24,g[A]=C,v?(v=I^y[y[y[k^I]]],E^=y[y[E]]):v=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let u,d;const c=this.keySchedule=new Uint32Array(o),h=this.invKeySchedule=new Uint32Array(o),m=this.sBox,g=this.rcon,y=this.invSubMix,v=y[0],E=y[1],S=y[2],A=y[3];let I,R;for(u=0;u<o;u++){if(u<i){I=c[u]=t[u];continue}R=I,u%i===0?(R=R<<8|R>>>24,R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255],R^=g[u/i|0]<<24):i>6&&u%i===4&&(R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255]),c[u]=I=(c[u-i]^R)>>>0}for(d=0;d<o;d++)u=o-d,d&3?R=c[u]:R=c[u-4],d<4||u<=4?h[d]=R:h[d]=v[m[R>>>24]]^E[m[R>>>16&255]]^S[m[R>>>8&255]]^A[m[R&255]],h[d]=h[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,d=u[0],c=u[1],h=u[2],m=u[3],g=this.uint8ArrayToUint32Array_(r);let y=g[0],v=g[1],E=g[2],S=g[3];const A=new Int32Array(e),I=new Int32Array(A.length);let R,k,C,V,_,N,F,O,q,H,ie,oe,ce,ae;const ue=this.networkToHostOrderSwap;for(;t<A.length;){for(q=ue(A[t]),H=ue(A[t+1]),ie=ue(A[t+2]),oe=ue(A[t+3]),_=q^i[0],N=oe^i[1],F=ie^i[2],O=H^i[3],ce=4,ae=1;ae<s;ae++)R=d[_>>>24]^c[N>>16&255]^h[F>>8&255]^m[O&255]^i[ce],k=d[N>>>24]^c[F>>16&255]^h[O>>8&255]^m[_&255]^i[ce+1],C=d[F>>>24]^c[O>>16&255]^h[_>>8&255]^m[N&255]^i[ce+2],V=d[O>>>24]^c[_>>16&255]^h[N>>8&255]^m[F&255]^i[ce+3],_=R,N=k,F=C,O=V,ce=ce+4;R=o[_>>>24]<<24^o[N>>16&255]<<16^o[F>>8&255]<<8^o[O&255]^i[ce],k=o[N>>>24]<<24^o[F>>16&255]<<16^o[O>>8&255]<<8^o[_&255]^i[ce+1],C=o[F>>>24]<<24^o[O>>16&255]<<16^o[_>>8&255]<<8^o[N&255]^i[ce+2],V=o[O>>>24]<<24^o[_>>16&255]<<16^o[N>>8&255]<<8^o[F&255]^i[ce+3],I[t]=ue(R^y),I[t+1]=ue(V^v),I[t+2]=ue(C^E),I[t+3]=ue(k^S),y=q,v=H,E=ie,S=oe,t=t+4}return I.buffer}}class eC{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=tC(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function tC(n){switch(n){case ca.cbc:return"AES-CBC";case ca.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const rC=16;class wg{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Zk(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,r,s);const d=this.flush();d?i(d.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:u}=this;if(s!==ca.cbc||t.byteLength!==16)return Bt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Qn(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;i&&(r=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new Jk),c.expandKey(t);const h=o;return this.currentResult=c.decrypt(d.buffer,0,r),this.currentIV=d.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new eC(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Xk(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Bt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%rC;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Bt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Bx=Math.pow(2,17);class nC{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new si({type:Ve.NETWORK_ERROR,details:X.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){d(jx(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new o(s),h=$x(e);e.loader=c;const m=Fx(s.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Bx};e.stats=c.stats;const y={onSuccess:(v,E,S,A)=>{this.resetLoader(e,c);let I=v.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(I.slice(0,16)),I=I.slice(16)),u({frag:e,part:null,payload:I,networkDetails:A})},onError:(v,E,S,A)=>{this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ft({url:r,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:A}))},onAbort:(v,E,S)=>{this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,E,S)=>{this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:S,stats:v}))}};t&&(y.onProgress=(v,E,S,A)=>t({frag:e,part:null,payload:S,networkDetails:A})),c.load(h,g,y)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(jx(e,t));return}const c=this.loader=i?new i(s):new o(s),h=$x(e,t);e.loader=c;const m=Fx(s.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Bx};t.stats=c.stats,c.load(h,g,{onSuccess:(y,v,E,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:y.data,networkDetails:S};r(A),u(A)},onError:(y,v,E,S)=>{this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ft({url:h.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:S}))},onAbort:(y,v,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,v,E)=>{this.resetLoader(e,c),d(new si({type:Ve.NETWORK_ERROR,details:X.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:E,stats:y}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const d=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/i),d),m=(d-c)*Math.round(r.loaded/c);r.total=r.loaded+m}else r.total=Math.max(r.loaded,r.total);const o=r.loading,u=s.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function $x(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(Re(s)&&Re(i)){var o;let u=s,d=i;if(n.sn==="initSegment"&&sC((o=n.decryptdata)==null?void 0:o.method)){const c=i-s;c%16&&(d=i+(16-c%16)),s!==0&&(r.resetIV=!0,u=s-16)}r.rangeStart=u,r.rangeEnd=d}return r}function jx(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:Ve.MEDIA_ERROR,details:X.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new si(r)}function sC(n){return n==="AES-128"||n==="AES-256"}class si extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class ZT extends Xn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Ag{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=hd(),this.buffering={audio:hd(),video:hd(),audiovideo:hd()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function hd(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Vx={length:0,start:()=>0,end:()=>0};class st{static isBuffered(e,t){if(e){const r=st.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=st.getBuffered(e);return st.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=st.bufferedRanges(e);if(s.length)return st.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((h,m)=>h.start-m.start||m.end-h.end);let s=-1,i=[];if(r)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(s=h);const m=i.length;if(m){const g=i[m-1].end;e[h].start-g<r?e[h].end>g&&(i[m-1].end=e[h].end):i.push(e[h])}else i.push(e[h])}else i=e;let o=0,u,d=t,c=t;for(let h=0;h<i.length;h++){const m=i[h].start,g=i[h].end;if(s===-1&&t>=m&&t<=g&&(s=h),t+r>=m&&t<g)d=m,c=g,o=c-t;else if(t+r<m){u=m;break}}return{len:o,start:d||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Vx}catch(t){return Bt.log("failed to get media.buffered",t),Vx}}}const JT=/\{\$([a-zA-Z0-9-_]+)\}/g;function Gx(n){return JT.test(n)}function Ip(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(JT,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function Kx(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function iC(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const aC=/^(\d+)x(\d+)$/,Hx=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ar{constructor(e,t){typeof e=="string"&&(e=ar.parseAttrList(e,t)),$t(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=aC.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={};for(Hx.lastIndex=0;(r=Hx.exec(e))!==null;){const o=r[1].trim();let u=r[2];const d=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let c=!1;if(d)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(d||c))u=Ip(t,u);else if(!c&&!d)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Bt.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=u}return s}}const oC="com.apple.hls.interstitial";function lC(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function uC(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class eb{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){Bt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=$t(new ar({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Re(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Bt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Re(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===oC}get isValid(){return!!this.id&&!this._badValueForSameId&&Re(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const cC=10;class dC{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?Re(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||cC}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ef(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function zx(n,e){return!n&&!e?!0:!n||!e?!1:ef(n,e)}function Qo(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Ig(n){switch(n){case"AES-128":case"AES-256":return ca.cbc;case"AES-256-CTR":return ca.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Rg(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Rp(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function fC(n){const e=Rp(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function tb(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function rb(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=Rg(o)):t=fC(o)}}return t}const tf=typeof self<"u"?self:void 0;var lr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Kr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Nd(n){switch(n){case Kr.FAIRPLAY:return lr.FAIRPLAY;case Kr.PLAYREADY:return lr.PLAYREADY;case Kr.WIDEVINE:return lr.WIDEVINE;case Kr.CLEARKEY:return lr.CLEARKEY}}function bm(n){switch(n){case lr.FAIRPLAY:return Kr.FAIRPLAY;case lr.PLAYREADY:return Kr.PLAYREADY;case lr.WIDEVINE:return Kr.WIDEVINE;case lr.CLEARKEY:return Kr.CLEARKEY}}function Su(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[lr.FAIRPLAY,lr.WIDEVINE,lr.PLAYREADY,lr.CLEARKEY].filter(s=>!!e[s]):[];return!r[lr.WIDEVINE]&&t&&r.push(lr.WIDEVINE),r}const nb=(function(n){return tf!=null&&(n=tf.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function hC(n,e,t,r){let s;switch(n){case lr.FAIRPLAY:s=["cenc","sinf"];break;case lr.WIDEVINE:case lr.PLAYREADY:s=["cenc"];break;case lr.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return mC(s,e,t,r)}function mC(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function pC(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function sb(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const d=Rg(u).subarray(0,16);return tb(d),d}}return null}let Mo={};class aa{static clearKeyUriToKeyIdMap(){Mo={}}static setKeyIdForUri(e,t){Mo[e]=t}static addKeyIdForUri(e){const t=Object.keys(Mo).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Mo[e]=r,r}constructor(e,t,r,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Qo(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(DT(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ef(e.keyFormatVersions,this.keyFormatVersions)&&zx(e.iv,this.iv)&&zx(e.keyId,this.keyId)}isSupported(){if(this.method){if(Qo(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Kr.FAIRPLAY:case Kr.WIDEVINE:case Kr.PLAYREADY:case Kr.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Qo(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Bt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=yC(e)),new aa(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Mo[this.uri];if(i&&!ef(this.keyId,i)&&aa.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=rb(this.uri);if(r)switch(this.keyFormat){case Kr.WIDEVINE:if(this.pssh=r,!this.keyId){const i=Ek(r.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=Wx(t));break;case Kr.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=xk(i,null,r),this.keyId=sb(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=gC(t),i||(i=Wx(t),i||(i=Mo[this.uri])),i&&(this.keyId=i,aa.setKeyIdForUri(this.uri,i))}return this}}function gC(n){const e=n==null?void 0:n[Kr.WIDEVINE];return e?e.keyId:null}function Wx(n){const e=n==null?void 0:n[Kr.PLAYREADY];if(e){const t=rb(e.uri);if(t)return sb(t)}return null}function yC(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Yx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,qx=/#EXT-X-MEDIA:(.*)/g,vC=/^#EXT(?:INF|-X-TARGETDURATION):/m,wm=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),xC=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ns{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return vg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vC.test(e)}static parseMasterPlaylist(e,t){const r=Gx(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(Yx.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=Yx.exec(e))!=null;)if(o[1]){var u;const c=new ar(o[1],s),h=Ip(s,o[2]),m={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Ns.resolve(h,t)},g=c.decimalResolution("RESOLUTION");g&&(m.width=g.width,m.height=g.height),Zx(c.CODECS,m);const y=c["SUPPLEMENTAL-CODECS"];y&&(m.supplemental={},Zx(y,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||i.push(m),s.levels.push(m)}else if(o[3]){const c=o[3],h=o[4];switch(c){case"SESSION-DATA":{const m=new ar(h,s),g=m["DATA-ID"];g&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[g]=m);break}case"SESSION-KEY":{const m=Qx(h,t,s);m.encrypted&&m.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(m)):Bt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const m=new ar(h,s);Kx(s,m,t)}break}case"CONTENT-STEERING":{const m=new ar(h,s);s.contentSteering={uri:Ns.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Xx(h);break}}}const d=i.length>0&&i.length<s.levels.length;return s.levels=d?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,u={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(qx.lastIndex=0;(s=qx.exec(e))!==null;){const c=new ar(s[1],r),h=c.TYPE;if(h){const m=u[h],g=i[h]||[];i[h]=g;const y=c.LANGUAGE,v=c["ASSOC-LANGUAGE"],E=c.CHANNELS,S=c.CHARACTERISTICS,A=c["INSTREAM-ID"],I={attrs:c,bitrate:0,id:d++,groupId:c["GROUP-ID"]||"",name:c.NAME||y||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:y,url:c.URI?Ns.resolve(c.URI,t):""};if(v&&(I.assocLang=v),E&&(I.channels=E),S&&(I.characteristics=S),A&&(I.instreamId=A),m!=null&&m.length){const R=Ns.findGroup(m,I.groupId)||m[0];Jx(I,R,"audioCodec"),Jx(I,R,"textCodec")}g.push(I)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var u;const d={url:t},c=new dC(t),h=c.fragments,m=[];let g=null,y=0,v=0,E=0,S=0,A=0,I=null,R=new Em(s,d),k,C,V,_=-1,N=!1,F=null,O;if(wm.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Gx(e),((u=wm.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(k=wm.exec(e))!==null;){N&&(N=!1,R=new Em(s,d),R.playlistOffset=E,R.setStart(E),R.sn=y,R.cc=S,A&&(R.bitrate=A),R.level=r,g&&(R.initSegment=g,g.rawProgramDateTime&&(R.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),F&&(R.setByteRange(F),F=null)));const oe=k[1];if(oe){R.duration=parseFloat(oe);const ce=(" "+k[2]).slice(1);R.title=ce||null,R.tagList.push(ce?["INF",oe,ce]:["INF",oe])}else if(k[3]){if(Re(R.duration)){R.playlistOffset=E,R.setStart(E),V&&tE(R,V,c),R.sn=y,R.level=r,R.cc=S,h.push(R);const ce=(" "+k[3]).slice(1);R.relurl=Ip(c,ce),Lp(R,I,m),I=R,E+=R.duration,y++,v=0,N=!0}}else{if(k=k[0].match(xC),!k){Bt.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<k.length&&k[C]===void 0;C++);const ce=(" "+k[C]).slice(1),ae=(" "+k[C+1]).slice(1),ue=k[C+2]?(" "+k[C+2]).slice(1):null;switch(ce){case"BYTERANGE":I?R.setByteRange(ae,I):R.setByteRange(ae);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=ae,R.tagList.push(["PROGRAM-DATE-TIME",ae]),_===-1&&(_=h.length);break;case"PLAYLIST-TYPE":c.type&&ei(c,ce,k),c.type=ae.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?ei(c,ce,k):h.length>0&&rE(c,ce,k),y=c.startSN=parseInt(ae);break;case"SKIP":{c.skippedSegments&&ei(c,ce,k);const W=new ar(ae,c),Z=W.decimalInteger("SKIPPED-SEGMENTS");if(Re(Z)){c.skippedSegments+=Z;for(let P=Z;P--;)h.push(null);y+=Z}const ne=W.enumeratedString("RECENTLY-REMOVED-DATERANGES");ne&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(ne.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&ei(c,ce,k),c.targetduration=Math.max(parseInt(ae),1);break;case"VERSION":c.version!==null&&ei(c,ce,k),c.version=parseInt(ae);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ei(c,ce,k),c.live=!1;break;case"#":(ae||ue)&&R.tagList.push(ue?[ae,ue]:[ae]);break;case"DISCONTINUITY":S++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([ce]);break;case"BITRATE":R.tagList.push([ce,ae]),A=parseInt(ae)*1e3,Re(A)?R.bitrate=A:A=0;break;case"DATERANGE":{const W=new ar(ae,c),Z=new eb(W,c.dateRanges[W.ID],c.dateRangeTagCount);c.dateRangeTagCount++,Z.isValid||c.skippedSegments?c.dateRanges[Z.id]=Z:Bt.warn(`Ignoring invalid DATERANGE tag: "${ae}"`),R.tagList.push(["EXT-X-DATERANGE",ae]);break}case"DEFINE":{{const W=new ar(ae,c);"IMPORT"in W?iC(c,W,o):Kx(c,W,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?ei(c,ce,k):h.length>0&&rE(c,ce,k),c.startCC=S=parseInt(ae);break;case"KEY":{const W=Qx(ae,t,c);if(W.isSupported()){if(W.method==="NONE"){V=void 0;break}V||(V={});const Z=V[W.keyFormat];Z!=null&&Z.matches(W)||(Z&&(V=$t({},V)),V[W.keyFormat]=W)}else Bt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${ae}"`);break}case"START":c.startTimeOffset=Xx(ae);break;case"MAP":{const W=new ar(ae,c);if(R.duration){const Z=new Em(s,d);eE(Z,W,r,V),g=Z,R.initSegment=g,g.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=g.rawProgramDateTime)}else{const Z=R.byteRangeEndOffset;if(Z){const ne=R.byteRangeStartOffset;F=`${Z-ne}@${ne}`}else F=null;eE(R,W,r,V),g=R,N=!0}g.cc=S;break}case"SERVER-CONTROL":{O&&ei(c,ce,k),O=new ar(ae),c.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),c.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&ei(c,ce,k);const W=new ar(ae);c.partTarget=W.decimalFloatingPoint("PART-TARGET");break}case"PART":{let W=c.partList;W||(W=c.partList=[]);const Z=v>0?W[W.length-1]:void 0,ne=v++,P=new ar(ae,c),B=new ik(P,R,d,ne,Z);W.push(B),R.duration+=B.duration;break}case"PRELOAD-HINT":{const W=new ar(ae,c);c.preloadHint=W;break}case"RENDITION-REPORT":{const W=new ar(ae,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(W);break}default:Bt.warn(`line parsed but not handled: ${k}`);break}}}I&&!I.relurl?(h.pop(),E-=I.duration,c.partList&&(c.fragmentHint=I)):c.partList&&(Lp(R,I,m),R.cc=S,c.fragmentHint=R,V&&tE(R,V,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const q=h.length,H=h[0],ie=h[q-1];if(E+=c.skippedSegments*c.targetduration,E>0&&q&&ie){c.averagetargetduration=E/q;const oe=ie.sn;c.endSN=oe!=="initSegment"?oe:0,c.live||(ie.endList=!0),_>0&&(SC(h,_),H&&m.unshift(H))}return c.fragmentHint&&(E+=c.fragmentHint.duration),c.totalduration=E,m.length&&c.dateRangeTagCount&&H&&ib(m,c),c.endCC=S,c}}function ib(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];n.push(u),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let u=i.length;u--;){const d=e.dateRanges[i[u]],c=d.startDate.getTime();d.tagAnchor=r.ref;for(let h=t;h--;){var o;if(((o=n[h])==null?void 0:o.sn)<e.startSN)break;const m=EC(e,c,n,h,s);if(m!==-1){d.tagAnchor=e.fragments[m].ref;break}}}}function EC(n,e,t,r,s){const i=t[r];if(i){const u=i.programDateTime;if(e>=u||r===0){var o;const d=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=u+d*1e3){const c=t[r].sn-n.startSN;if(c<0)return-1;const h=n.fragments;if(h.length>t.length){const g=(t[r+1]||h[h.length-1]).sn-n.startSN;for(let y=g;y>c;y--){const v=h[y].programDateTime;if(e>=v&&e<v+h[y].duration*1e3)return y}}return c}}}return-1}function Qx(n,e,t){var r,s;const i=new ar(n,t),o=(r=i.METHOD)!=null?r:"",u=i.URI,d=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,h=(s=i.KEYFORMAT)!=null?s:"identity";u&&i.IV&&!d&&Bt.error(`Invalid IV: ${i.IV}`);const m=u?Ns.resolve(u,e):"",g=(c||"1").split("/").map(Number).filter(Number.isFinite);return new aa(o,m,h,g,d,i.KEYID)}function Xx(n){const t=new ar(n).decimalFloatingPoint("TIME-OFFSET");return Re(t)?t:null}function Zx(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>Sg(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function Jx(n,e,t){const r=e[t];r&&(n[t]=r)}function SC(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Lp(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function eE(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function tE(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function ei(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function rE(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Am(n,e){const t=e.startPTS;if(Re(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function ab(n,e,t,r,s,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let d=t,c=r;const h=e.startPTS,m=e.endPTS;if(Re(h)){const A=Math.abs(h-t);n&&A>n.totalduration?o.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${n.url}`):Re(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,d=Math.max(t,h),t=Math.min(t,h),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(r,m),r=Math.max(r,m),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const g=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=s,e.endPTS=r,e.minEndPTS=c,e.endDTS=i;const y=e.sn;if(!n||y<n.startSN||y>n.endSN)return 0;let v;const E=y-n.startSN,S=n.fragments;for(S[E]=e,v=E;v>0;v--)Am(S[v],S[v-1]);for(v=E;v<S.length-1;v++)Am(S[v],S[v+1]);return n.fragmentHint&&Am(S[S.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,g}function TC(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let h=s.length-1;h>=0;h--){const m=s[h].initSegment;if(m){r=m;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;AC(n,e,(h,m,g,y)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==h.cc){const v=h.cc-m.cc;for(let E=g;E<y.length;E++)y[E].cc+=v;e.endCC=y[y.length-1].cc}Re(h.startPTS)&&Re(h.endPTS)&&(m.setStart(m.startPTS=h.startPTS),m.startDTS=h.startDTS,m.maxStartPTS=h.maxStartPTS,m.endPTS=h.endPTS,m.endDTS=h.endDTS,m.minEndPTS=h.minEndPTS,m.setDuration(h.endPTS-h.startPTS),m.duration&&(i=m),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(m.elementaryStreams=h.elementaryStreams),m.loader=h.loader,h.hasStats&&(m.stats=h.stats),h.initSegment&&(m.initSegment=h.initSegment,r=h.initSegment)});const o=e.fragments,u=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&u.forEach(h=>{var m;h&&(!h.initSegment||h.initSegment.relurl===((m=r)==null?void 0:m.relurl))&&(h.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=bC(n.dateRanges,e,t));const h=n.fragments.filter(m=>m.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&Lp(u[m],u[m-1],h);ib(h,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var d;const h=ub(n,e.startSN-1);e.startCC=(d=h==null?void 0:h.cc)!=null?d:o[0].cc}wC(n.partList,e.partList,(h,m)=>{m.elementaryStreams=h.elementaryStreams,m.stats=h.stats}),i?ab(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):ob(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function bC(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=$t({},n);s&&s.forEach(d=>{delete i[d]});const u=Object.keys(i).length;return u?(Object.keys(r).forEach(d=>{const c=i[d],h=new eb(r[d].attr,c);h.isValid?(i[d]=h,c||(h.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Kt(r[d].attr)}"`)}),i):r}function wC(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],u=e[s+r];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):r--}}}function AC(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=s;c<=i;c++){const h=d[o+c];let m=u[c];if(r&&!m&&h&&(m=e.fragments[c]=h),h&&m){t(h,m,c,u);const g=h.relurl,y=m.relurl;if(g&&IC(g,y)){e.playlistParsingError=nE(`media sequence mismatch ${m.sn}:`,n,e,h,m);return}else if(h.cc!==m.cc){e.playlistParsingError=nE(`discontinuity sequence mismatch (${h.cc}!=${m.cc})`,n,e,h,m);return}}}}function nE(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ob(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;_p(e,o)}function _p(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function lb(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function ub(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function sE(n,e,t){return n?cb(n.partList,e,t):null}function cb(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function db(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function IC(n,e){return n!==e&&e?iE(n)!==iE(e):!1}function iE(n){return n.replace(/\?[^?]*$/,"")}function bu(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function RC(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function aE(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function fb(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)aE(t[r],n);e.fragmentHint&&aE(e.fragmentHint,n),e.alignedSliding=!0}function LC(n,e){n&&(hb(e,n),e.alignedSliding||rf(e,n),!e.alignedSliding&&!e.skippedSegments&&ob(n,e,!1))}function hb(n,e){if(!RC(e,n))return;const t=Math.min(e.endCC,n.endCC),r=bu(e.fragments,t),s=bu(n.fragments,t);if(!r||!s)return;Bt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;fb(i,n)}function rf(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=bu(r,o),i=bu(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=bu(t,s.cc)||t[Math.floor(t.length/2)]);const u=s.programDateTime,d=i.programDateTime;if(!u||!d)return;const c=(d-u)/1e3-(i.start-s.start);fb(c,n)}function un(n,e,t){In(n,e,t),n.addEventListener(e,t)}function In(n,e,t){n.removeEventListener(e,t)}const _C={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},le={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Lg extends ZT{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=le.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:d,mediaBuffer:c,state:h}=this,m=d?d.currentTime:0,g=st.bufferInfo(c||d,m,o.maxBufferHole),y=!g.len;if(this.log(`Media seeking to ${Re(m)?m.toFixed(3):m}, state: ${h}, ${y?"out of":"in"} buffer`),this.state===le.ENDED)this.resetLoadingState();else if(u){const v=o.maxFragLookUpTolerance,E=u.start-v,S=u.start+u.duration+v;if(y||S<g.start||E>g.end){const A=m>S;(m<E||A)&&(A&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(m>v&&(this.lastCurrentTime=m),!this.loadingParts){const E=Math.max(g.end,m),S=this.shouldLoadParts(this.getLevelDetails(),E);S&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,y&&(this.startPosition=m)),y&&this.state===le.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new nC(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new wg(e.config)}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===le.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=le.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=st.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const h=d[d.length-1];return st.isBuffered(this.media,h.start+h.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;un(r,"seeking",this.onMediaSeeking),un(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===le.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),In(s,"seeking",this.onMediaSeeking),In(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=le.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,u=i.frag;if(this.fragContextChanged(u)){(o===le.FRAG_LOADING||!this.fragCurrent&&o===le.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=le.IDLE);return}"payload"in i&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(w.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===_r.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===_r.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(w.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,u=i.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&Qo(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,Ig(u.method)).catch(c=>{throw s.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const h=self.performance.now();return s.trigger(w.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:d,tdecrypt:h}}),r.payload=c,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==le.STOPPED&&(this.state=le.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(u.message),!o||o.mediaKeys?!1:(this.hls.trigger(w.ERROR,{type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?_C.toString(st.getBuffered(r)):"(detached)"})`),pr(e)){var s;if(e.type!==De.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=le.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=le.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(d=>!d),u=new Ag(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=le.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(w.KEY_LOADED,g),this.state===le.KEY_LOADING&&(this.state=le.IDLE),g}),this.hls.trigger(w.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(pr(e)&&(!d||e.sn!==d.sn)){const g=this.shouldLoadParts(t.details,e.end);g!==this.loadingParts&&(this.log(`LL-Part loading ${g?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${e.sn}`),this.loadingParts=g)}if(r=Math.max(e.start,r||0),this.loadingParts&&pr(e)){const g=o.partList;if(g&&s){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const y=this.getNextPart(g,e,r);if(y>-1){const v=g[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${g.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=le.FRAG_LOADING;let E;return u?E=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,v,t,s)).catch(S=>this.handleFragLoadError(S)):E=this.doFragPartsLoad(e,v,t,s).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(w.FRAG_LOADING,{frag:e,part:v,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(g,r))return Promise.resolve(null)}}if(pr(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(g=>g.loaded).map(g=>`[${g.start}-${g.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),Re(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=le.FRAG_LOADING;const h=this.config.progressive&&e.type!==De.SUBTITLE;let m;return h&&u?m=u.then(g=>!g||this.fragContextChanged(g.frag)?null:this.fragmentLoader.load(e,s)).catch(g=>this.handleFragLoadError(g)):m=Promise.all([this.fragmentLoader.load(e,h?s:void 0),u]).then(([g])=>(!h&&s&&s(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(w.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var u;const d=[],c=(u=r.details)==null?void 0:u.partList,h=m=>{this.fragmentLoader.loadPart(e,m,s).then(g=>{d[m.index]=g;const y=g.part;this.hls.trigger(w.FRAG_LOADED,g);const v=sE(r.details,e.sn,m.index+1)||cb(c,e.sn,m.index+1);if(v)h(v);else return i({frag:e,part:y,partsLoaded:d})}).catch(o)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===X.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ve.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(w.ERROR,t)}else this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==le.PARSING){!this.fragCurrent&&this.state!==le.STOPPED&&this.state!==le.ERROR&&(this.state=le.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const u=this.getLevelDetails(),c=u&&r.sn>u.endSN||this.shouldLoadParts(u,r.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===De.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const u=t[s],d=u.details,c=o>-1?sE(d,i,o):null,h=c?c.fragment:ub(d,i,r);return h?(r&&r!==h&&(h.stats=r.stats),{frag:h,part:c,level:u}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==le.PARSING)return;const{data1:o,data2:u}=e;let d=o;if(u&&(d=Qn(o,u)),!d.length)return;const c=this.initPTS[t.cc],h=c?-c.baseTime/c.timescale:void 0,m={type:e.type,frag:t,part:r,chunkMeta:s,offset:h,parent:t.type,data:d};if(this.hls.trigger(w.BUFFER_APPENDING,m),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!st.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=st.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),u=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!Re(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=st.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(i.nextStart,o.end)-t,s);return st.bufferInfo(e,t,u)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=De.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,u=i.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const m=i.initialLiveManifestSize;if(s<m)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const g=this.hls.startPosition,y=this.hls.liveSyncPosition,v=d?(g!==-1&&g>=o?g:y)||d.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${g} liveSyncPosition: ${y} frag.start: ${(c=d)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=o&&(d=r[0]);if(!d){const m=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,m,t)}let h=this.filterReplacedPrimary(d,t);if(!h&&d){const m=d.sn-t.startSN;h=this.filterReplacedPrimary(r[m+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===_r.OK||r===_r.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(u!==null&&r.len+u.len>=i){const d=o.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(oE(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(oE(this.config)&&e.type!==De.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let o=i.length;o--;){const u=i[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let u=0,d=e.length;u<d;u++){const c=e[u];if(o=o&&!c.independent,s>-1&&r<c.start)break;const h=c.loaded;h?s=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${c.start}`),s=u),i=h}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=Hk(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=qT(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:u}=r;const{fragmentHint:d}=r,{maxFragLookUpTolerance:c}=s,h=r.partList,m=!!(this.loadingParts&&h!=null&&h.length&&d);m&&!this.bitrateTest&&h[h.length-1].fragment.sn===d.sn&&(o=o.concat(d),u=d.sn);let g;if(e<t){var y;const E=e<this.lastCurrentTime||e>t-c||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:c;g=to(i,o,e,E)}else g=o[o.length-1];if(g){const v=g.sn-r.startSN,E=this.fragmentTracker.getState(g);if((E===_r.OK||E===_r.PARTIAL&&g.gap)&&(i=g),i&&g.sn===i.sn&&(!m||h[0].fragment.sn>g.sn||!r.live)&&g.level===i.level){const A=o[v+1];g.sn<u&&this.fragmentTracker.getState(A)!==_r.OK?g=A:g=null}}return g}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,u=e.alignedSliding&&Re(i);if(o||!u&&!i){LC(r,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),d}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&Re(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&pr(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==le.FRAG_LOADING_WAITING_RETRY)&&(this.state=le.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===X.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const u=t.errorAction;if(!u){this.state=le.ERROR;return}const{action:d,flags:c,retryCount:h=0,retryConfig:m}=u,g=!!m,y=g&&d===Vr.RetryRequest,v=g&&!u.resolved&&c===Pn.MoveAllAlternatesMatchingHost,E=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!y&&v&&pr(s)&&!s.endList&&E&&!XT(t))this.resetFragmentErrors(e),this.treatAsGap(s),u.resolved=!0;else if((y||v)&&h<m.maxNumRetry){var S;const A=Ap((S=t.response)==null?void 0:S.code),I=bg(m,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+I,this.state=le.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${h+1}/${m.maxNumRetry} in ${I}ms`)}else if(m)if(this.resetFragmentErrors(e),h<m.maxNumRetry)!o&&d!==Vr.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else d===Vr.SendAlternateToPenaltyBox?this.state=le.WAITING_LEVEL:this.state=le.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Ap(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=le.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===le.PARSING||this.state===le.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===De.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==le.STOPPED&&(this.state=le.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=st.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===le.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==le.STOPPED&&(this.state=le.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,c)=>{const h=e.elementaryStreams[c];if(h){const m=h.endPTS-h.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${m})`),d||!1;const g=s?0:ab(i,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(w.LEVEL_PTS_UPDATED,{details:i,level:r,drift:g,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return d},!1)){var u;const d=((u=this.transmuxer)==null?void 0:u.error)===null;if((r.fragmentError===0||d&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),d){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=le.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(w.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===De.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function oE(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class mb{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=kC(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function kC(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var Im={exports:{}},lE;function CC(){return lE||(lE=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(d,c,h){this.fn=d,this.context=c,this.once=h||!1}function i(d,c,h,m,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new s(h,m||d,g),v=t?t+c:c;return d._events[v]?d._events[v].fn?d._events[v]=[d._events[v],y]:d._events[v].push(y):(d._events[v]=y,d._eventsCount++),d}function o(d,c){--d._eventsCount===0?d._events=new r:delete d._events[c]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],h,m;if(this._eventsCount===0)return c;for(m in h=this._events)e.call(h,m)&&c.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},u.prototype.listeners=function(c){var h=t?t+c:c,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,y=m.length,v=new Array(y);g<y;g++)v[g]=m[g].fn;return v},u.prototype.listenerCount=function(c){var h=t?t+c:c,m=this._events[h];return m?m.fn?1:m.length:0},u.prototype.emit=function(c,h,m,g,y,v){var E=t?t+c:c;if(!this._events[E])return!1;var S=this._events[E],A=arguments.length,I,R;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),A){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,h),!0;case 3:return S.fn.call(S.context,h,m),!0;case 4:return S.fn.call(S.context,h,m,g),!0;case 5:return S.fn.call(S.context,h,m,g,y),!0;case 6:return S.fn.call(S.context,h,m,g,y,v),!0}for(R=1,I=new Array(A-1);R<A;R++)I[R-1]=arguments[R];S.fn.apply(S.context,I)}else{var k=S.length,C;for(R=0;R<k;R++)switch(S[R].once&&this.removeListener(c,S[R].fn,void 0,!0),A){case 1:S[R].fn.call(S[R].context);break;case 2:S[R].fn.call(S[R].context,h);break;case 3:S[R].fn.call(S[R].context,h,m);break;case 4:S[R].fn.call(S[R].context,h,m,g);break;default:if(!I)for(C=1,I=new Array(A-1);C<A;C++)I[C-1]=arguments[C];S[R].fn.apply(S[R].context,I)}}return!0},u.prototype.on=function(c,h,m){return i(this,c,h,m,!1)},u.prototype.once=function(c,h,m){return i(this,c,h,m,!0)},u.prototype.removeListener=function(c,h,m,g){var y=t?t+c:c;if(!this._events[y])return this;if(!h)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===h&&(!g||v.once)&&(!m||v.context===m)&&o(this,y);else{for(var E=0,S=[],A=v.length;E<A;E++)(v[E].fn!==h||g&&!v[E].once||m&&v[E].context!==m)&&S.push(v[E]);S.length?this._events[y]=S.length===1?S[0]:S:o(this,y)}return this},u.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&o(this,h)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,n.exports=u})(Im)),Im.exports}var DC=CC(),_g=nk(DC);const Uu="1.6.15",pl={};function PC(){return typeof __HLS_WORKER_BUNDLE__=="function"}function OC(){const n=pl[Uu];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return pl[Uu]=s,s}function NC(n){const e=pl[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return pl[n]=s,s}function MC(n){const e=pl[n||Uu];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete pl[n||Uu],s&&self.URL.revokeObjectURL(s),r.terminate()}}function pb(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function kg(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Ef(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Bu(n,e){const t=e;let r=0;for(;kg(n,e);){r+=10;const s=Ef(n,e+6);r+=s,pb(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function FC(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const y=new Error(`invalid ADTS sampling index:${o}`);n.emit(w.ERROR,w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const u=(i>>6&3)+1,d=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+u,h=s[o];let m=o;(u===5||u===29)&&(m-=3);const g=[u<<3|(m&14)>>1,(m&1)<<7|d<<3];return Bt.log(`manifest codec:${r}, parsed codec:${c}, channels:${d}, rate:${h} (ADTS object type:${u} sampling index:${o})`),{config:g,samplerate:h,channelCount:d,codec:c,parsedCodec:c,manifestCodec:r}}function gb(n,e){return n[e]===255&&(n[e+1]&246)===240}function yb(n,e){return n[e+1]&1?7:9}function Cg(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function UC(n,e){return e+5<n.length}function nf(n,e){return e+1<n.length&&gb(n,e)}function BC(n,e){return UC(n,e)&&gb(n,e)&&Cg(n,e)<=n.length-e}function $C(n,e){if(nf(n,e)){const t=yb(n,e);if(e+t>=n.length)return!1;const r=Cg(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||nf(n,s)}return!1}function vb(n,e,t,r,s){if(!n.samplerate){const i=FC(e,t,r,s);if(!i)return;$t(n,i)}}function xb(n){return 1024*9e4/n}function jC(n,e){const t=yb(n,e);if(e+t<=n.length){const r=Cg(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Eb(n,e,t,r,s){const i=xb(n.samplerate),o=r+s*i,u=jC(e,t);let d;if(u){const{frameLength:m,headerLength:g}=u,y=g+m,v=Math.max(0,t+y-e.length);v?(d=new Uint8Array(y-g),d.set(e.subarray(t+g,e.length),0)):d=e.subarray(t+g,t+y);const E={unit:d,pts:o};return v||n.samples.push(E),{sample:E,length:y,missing:v}}const c=e.length-t;return d=new Uint8Array(c),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:o},length:c,missing:-1}}function VC(n,e){return kg(n,e)&&Ef(n,e+6)+10<=n.length-e}function GC(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Rm(n,e=0,t=1/0){return KC(n,e,t,Uint8Array)}function KC(n,e,t,r){const s=HC(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=zC(n)?n.byteOffset:0,u=(o+n.byteLength)/i,d=(o+e)/i,c=Math.floor(Math.max(0,Math.min(d,u))),h=Math.floor(Math.min(c+Math.max(t,0),u));return new r(s,c,h-c)}function HC(n){return n instanceof ArrayBuffer?n:n.buffer}function zC(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function WC(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Un(Rm(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const u=Un(Rm(n.data,3+r,o));let d;return s==="-->"?d=Un(Rm(n.data,4+r+o)):d=GC(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=u,e.data=d,e}function YC(n){if(n.size<2)return;const e=Un(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function qC(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Un(n.data.subarray(t),!0);t+=r.length+1;const s=Un(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Un(n.data.subarray(1));return{key:n.type,info:"",data:e}}function QC(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Un(n.data.subarray(t),!0);t+=r.length+1;const s=Un(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Un(n.data);return{key:n.type,info:"",data:e}}function XC(n){return n.type==="PRIV"?YC(n):n.type[0]==="W"?QC(n):n.type==="APIC"?WC(n):qC(n)}function ZC(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Ef(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const md=10,JC=10;function Sb(n){let e=0;const t=[];for(;kg(n,e);){const r=Ef(n,e+6);n[e+5]>>6&1&&(e+=md),e+=md;const s=e+r;for(;e+JC<s;){const i=ZC(n.subarray(e)),o=XC(i);o&&t.push(o),e+=i.size+md}pb(n,e)&&(e+=md)}return t}function Tb(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function eD(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Dg(n){const e=Sb(n);for(let t=0;t<e.length;t++){const r=e[t];if(Tb(r))return eD(r)}}let Mn=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function Ds(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Pg{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Qn(this.cachedData,e),this.cachedData=null);let r=Bu(e,0),s=r?r.length:0,i;const o=this._audioTrack,u=this._id3Track,d=r?Dg(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Re(d))&&(this.basePTS=tD(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mn.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const h=this.appendFrame(o,e,s);h?(this.frameIndex++,this.lastPTS=h.sample.pts,s+=h.length,i=s):s=c}else VC(e,s)?(r=Bu(e,s),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===c&&i!==c){const h=e.slice(i);this.cachedData?this.cachedData=Qn(this.cachedData,h):this.cachedData=h}}return{audioTrack:o,videoTrack:Ds(),id3Track:u,textTrack:Ds()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ds(),id3Track:this._id3Track,textTrack:Ds()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const tD=(n,e,t)=>{if(Re(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let pd=null;const rD=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nD=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],sD=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],iD=[0,1,1,4];function bb(n,e,t,r,s){if(t+24>e.length)return;const i=wb(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,u=r+s*o,d={unit:e.subarray(t,t+i.frameLength),pts:u,dts:u};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(d),{sample:d,length:i.frameLength,missing:0}}}function wb(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,u=n[e+3]>>6,d=t===3?3-r:r===3?3:4,c=rD[d*14+s-1]*1e3,m=nD[(t===3?0:t===2?1:2)*3+i],g=u===3?1:2,y=sD[t][r],v=iD[r],E=y*8*v,S=Math.floor(y*c/m+o)*v;if(pd===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);pd=R?parseInt(R[1]):0}return!!pd&&pd<=87&&r===2&&c>=224e3&&u===0&&(n[e+3]=n[e+3]|128),{sampleRate:m,channelCount:g,frameLength:S,samplesPerFrame:E}}}function Og(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Ab(n,e){return e+1<n.length&&Og(n,e)}function aD(n,e){return Og(n,e)&&4<=n.length-e}function Ib(n,e){if(e+1<n.length&&Og(n,e)){const r=wb(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||Ab(n,i)}return!1}class oD extends Pg{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Bu(e,0);let s=(r==null?void 0:r.length)||0;if(Ib(e,s))return!1;for(let i=e.length;s<i;s++)if($C(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return BC(e,t)}appendFrame(e,t,r){vb(e,this.observer,t,r,e.manifestCodec);const s=Eb(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Rb=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const u=Math.min(r,8),d=8-u;i[0]=4278190080>>>24+d<<d,s[0]=(o[0]&i[0])>>d,t=t?t<<u|s[0]:s[0],e+=1,r-=u}return t};class lD extends Pg{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=Lb(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Bu(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Dg(t)!==void 0&&Rb(e,r)<16}}function Lb(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const u=[48e3,44100,32e3][i],d=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+i]*2;if(t+h>e.length)return-1;const m=e[t+6]>>5;let g=0;m===2?g+=2:(m&1&&m!==1&&(g+=2),m&4&&(g+=2));const y=(e[t+6]<<8|e[t+7])>>12-g&1,E=[2,1,2,3,3,4,4,5][m]+y,S=e[t+5]>>3,A=e[t+5]&7,I=new Uint8Array([i<<6|S<<1|A>>2,(A&3)<<6|m<<3|y<<2|d>>4,d<<4&224]),R=1536/u*9e4,k=r+s*R,C=e.subarray(t,t+h);return n.config=I,n.channelCount=E,n.samplerate=u,n.samples.push({unit:C,pts:k}),h}class uD extends Pg{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Bu(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Dg(t)!==void 0&&Rb(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(Ib(e,r))return Bt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return aD(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return bb(e,t,r,this.basePTS,this.frameIndex)}}const cD=/\/emsg[-/]ID3/i;class dD{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=Ds("video",1),o=this.audioTrack=Ds("audio",1),u=this.txtTrack=Ds("text",1);if(this.id3Track=Ds("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=UT(e);if(d.video){const{id:c,timescale:h,codec:m,supplemental:g}=d.video;i.id=c,i.timescale=u.timescale=h,i.codec=m,i.supplemental=g}if(d.audio){const{id:c,timescale:h,codec:m}=d.audio;o.id=c,o.timescale=h,o.codec=m}u.id=NT.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return lk(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Qn(this.remainderData,e));const u=pk(r);this.remainderData=u.remainder,s.samples=u.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=Ix(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Ix(e,t),{videoTrack:t,audioTrack:Ds(),id3Track:s,textTrack:Ds()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=dt(e.samples,["emsg"]);s&&s.forEach(i=>{const o=yk(i);if(cD.test(o.schemeIdUri)){const u=uE(o,t);let d=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const c=o.payload;r.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Mn.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=uE(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:Mn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function uE(n,e){return Re(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class fD{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new wg(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ca.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(u=>{const d=new Uint8Array(u);s.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=jT(i.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(d=>{i.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class _b{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,u=[];let d=0,c,h,m,g=-1,y=0;for(i===-1&&(g=0,y=this.getNALuType(t,0),i=0,d=1);d<s;){if(c=t[d++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(h=d-i-1,g>=0){const v={data:t.subarray(g,h),type:y};u.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(o&&d<=4-o&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-o)),h>0&&(v.data=Qn(v.data,t.subarray(0,h)),v.state=0))}d<s?(m=this.getNALuType(t,d),g=d,y=m,i=0):i=-1}else i=0}if(g>=0&&i>=0){const v={data:t.subarray(g,s),type:y,state:i};u.push(v)}if(u.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=Qn(v.data,t))}return e.naluState=i,u}}class wu{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Bt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class hD extends _b{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,u,d=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var h,m;switch(c.type){case 1:{let E=!1;u=!0;const S=c.data;if(d&&S.length>4){const A=this.readSliceType(S);(A===2||A===4||A===7||A===9)&&(E=!0)}if(E){var g;(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=E;break}case 5:u=!0,(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,Eg(c.data,1,r.pts,t.samples);break}case 7:{var y,v;u=!0,d=!0;const E=c.data,S=this.readSPS(E);if(!e.sps||e.width!==S.width||e.height!==S.height||((y=e.pixelRatio)==null?void 0:y[0])!==S.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[E];const A=E.subarray(1,4);let I="avc1.";for(let R=0;R<3;R++){let k=A[R].toString(16);k.length<2&&(k="0"+k),I+=k}e.codec=I}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new wu(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new wu(e);let r=0,s=0,i=0,o=0,u,d,c;const h=t.readUByte.bind(t),m=t.readBits.bind(t),g=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),E=t.skipEG.bind(t),S=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);h();const I=h();if(m(5),v(3),h(),S(),I===100||I===110||I===122||I===244||I===44||I===83||I===86||I===118||I===128){const N=g();if(N===3&&v(1),S(),S(),v(1),y())for(d=N!==3?8:12,c=0;c<d;c++)y()&&(c<6?A(16,t):A(64,t))}S();const R=g();if(R===0)g();else if(R===1)for(v(1),E(),E(),u=g(),c=0;c<u;c++)E();S(),v(1);const k=g(),C=g(),V=m(1);V===0&&v(1),v(1),y()&&(r=g(),s=g(),i=g(),o=g());let _=[1,1];if(y()&&y())switch(h()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((k+1)*16-r*2-s*2),height:(2-V)*(C+1)*16-(V?2:4)*(i+o),pixelRatio:_}}}class mD extends _b{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,u,d=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var h,m;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var g;(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,Eg(c.data,2,r.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=$t(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(c.data);for(const v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:u=!1;break}o&&u&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new wu(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new wu(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),d=t.readUByte(),c=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),S=t.readUByte(),A=t.readUByte(),I=[],R=[];for(let Xe=0;Xe<r;Xe++)I.push(t.readBoolean()),R.push(t.readBoolean());if(r>0)for(let Xe=r;Xe<8;Xe++)t.readBits(2);for(let Xe=0;Xe<r;Xe++)I[Xe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[Xe]&&t.readUByte();t.readUEG();const k=t.readUEG();k==3&&t.skipBits(1);const C=t.readUEG(),V=t.readUEG(),_=t.readBoolean();let N=0,F=0,O=0,q=0;_&&(N+=t.readUEG(),F+=t.readUEG(),O+=t.readUEG(),q+=t.readUEG());const H=t.readUEG(),ie=t.readUEG(),oe=t.readUEG(),ce=t.readBoolean();for(let Xe=ce?0:r;Xe<=r;Xe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let zt=0;zt<4;zt++)for(let nr=0;nr<(zt===3?2:6);nr++)if(!t.readBoolean())t.readUEG();else{const qt=Math.min(64,1<<4+(zt<<1));zt>1&&t.readEG();for(let U=0;U<qt;U++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const W=t.readUEG();let Z=0;for(let Xe=0;Xe<W;Xe++){let zt=!1;if(Xe!==0&&(zt=t.readBoolean()),zt){Xe===W&&t.readUEG(),t.readBoolean(),t.readUEG();let nr=0;for(let Mr=0;Mr<=Z;Mr++){const qt=t.readBoolean();let U=!1;qt||(U=t.readBoolean()),(qt||U)&&nr++}Z=nr}else{const nr=t.readUEG(),Mr=t.readUEG();Z=nr+Mr;for(let qt=0;qt<nr;qt++)t.readUEG(),t.readBoolean();for(let qt=0;qt<Mr;qt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Xe=t.readUEG();for(let zt=0;zt<Xe;zt++){for(let nr=0;nr<oe+4;nr++)t.readBits(1);t.readBits(1)}}let P=0,B=1,de=1,pe=!0,ge=1,we=0;t.readBoolean(),t.readBoolean();let Ie=!1;if(t.readBoolean()){if(t.readBoolean()){const Y=t.readUByte(),se=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Te=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Y>0&&Y<16?(B=se[Y-1],de=Te[Y-1]):Y===255&&(B=t.readBits(16),de=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ie=t.readBoolean(),Ie&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),we=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Te=t.readBoolean(),Ee=t.readBoolean();let fe=!1;(Te||Ee)&&(fe=t.readBoolean(),fe&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),fe&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let _e=0;_e<=r;_e++){pe=t.readBoolean();const et=pe||t.readBoolean();let tt=!1;et?t.readEG():tt=t.readBoolean();const At=tt?1:t.readUEG()+1;if(Te)for(let Wt=0;Wt<At;Wt++)t.readUEG(),t.readUEG(),fe&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ee)for(let Wt=0;Wt<At;Wt++)t.readUEG(),t.readUEG(),fe&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Ze=C,vt=V;if(_){let Xe=1,zt=1;k===1?Xe=zt=2:k==2&&(Xe=2),Ze=C-Xe*F-Xe*N,vt=V-zt*q-zt*O}const er=s?["A","B","C"][s]:"",Ht=u<<24|d<<16|c<<8|h;let fr=0;for(let Xe=0;Xe<32;Xe++)fr=(fr|(Ht>>Xe&1)<<31-Xe)>>>0;let cn=fr.toString(16);return o===1&&cn==="2"&&(cn="6"),{codecString:`hvc1.${er}${o}.${cn}.${i?"H":"L"}${A}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[u,d,c,h],general_constraint_indicator_flags:[m,g,y,v,E,S],general_level_idc:A,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:P,chroma_format_idc:k,frame_rate:{fixed:pe,fps:we/ge}},width:Ze,height:vt,pixelRatio:[B,de]}}readPPS(e){const t=new wu(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Or=188;class Hi{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=Hi.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Or*5,t-Or)+1,s=0;for(;s<r;){let i=!1,o=-1,u=0;for(let d=s;d<t;d+=Or)if(e[d]===71&&(t-d===Or||e[d+Or]===71)){if(u++,o===-1&&(o=d,o!==0&&(r=Math.min(o+Or*99,e.length-Or)+1)),i||(i=kp(e,d)===0),i&&u>1&&(o===0&&u>2||d+Or>r))return o}else{if(u)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:NT[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Hi.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Hi.createTrack("audio",s),this._id3Track=Hi.createTrack("id3"),this._txtTrack=Hi.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,u=this._audioTrack,d=this._id3Track,c=this._txtTrack;let h=o.pid,m=o.pesData,g=u.pid,y=d.pid,v=u.pesData,E=d.pesData,S=null,A=this.pmtParsed,I=this._pmtId,R=e.length;if(this.remainderData&&(e=Qn(this.remainderData,e),R=e.length,this.remainderData=null),R<Or&&!s)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:d,textTrack:c};const k=Math.max(0,Hi.syncOffset(e));R-=(R-k)%Or,R<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let C=0;for(let _=k;_<R;_+=Or)if(e[_]===71){const N=!!(e[_+1]&64),F=kp(e,_),O=(e[_+3]&48)>>4;let q;if(O>1){if(q=_+5+e[_+4],q===_+Or)continue}else q=_+4;switch(F){case h:N&&(m&&(i=Fo(m,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(q,_+Or)),m.size+=_+Or-q);break;case g:if(N){if(v&&(i=Fo(v,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,i);break;case"mp3":this.parseMPEGPES(u,i);break;case"ac3":this.parseAC3PES(u,i);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(q,_+Or)),v.size+=_+Or-q);break;case y:N&&(E&&(i=Fo(E,this.logger))&&this.parseID3PES(d,i),E={data:[],size:0}),E&&(E.data.push(e.subarray(q,_+Or)),E.size+=_+Or-q);break;case 0:N&&(q+=e[q]+1),I=this._pmtId=pD(e,q);break;case I:{N&&(q+=e[q]+1);const H=gD(e,q,this.typeSupported,r,this.observer,this.logger);h=H.videoPid,h>0&&(o.pid=h,o.segmentCodec=H.segmentVideoCodec),g=H.audioPid,g>0&&(u.pid=g,u.segmentCodec=H.segmentAudioCodec),y=H.id3Pid,y>0&&(d.pid=y),S!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${_} after unknown PID '${S}'. Backtracking to sync byte @${k} to parse all TS packets.`),S=null,_=k-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=F;break}}else C++;C>0&&Cp(this.observer,new Error(`Found ${C} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=m,u.pesData=v,d.pesData=E;const V={audioTrack:u,videoTrack:o,id3Track:d,textTrack:c};return s&&this.extractRemainingSamples(V),V}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,u=t.pesData,d=s.pesData;let c;if(o&&(c=Fo(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,c,!0),r.pesData=null)):r.pesData=o,u&&(c=Fo(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(c=Fo(d,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=d}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new fD(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new hD:e==="hevc"&&(this.videoParser=new mD))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const m=s.missing,g=s.sample.unit.byteLength;if(m===-1)i=Qn(s.sample.unit,i);else{const y=g-m;s.sample.unit.set(i.subarray(0,m),y),e.samples.push(s.sample),r=s.missing}}let o,u;for(o=r,u=i.length;o<u-1&&!nf(i,o);o++);if(o!==r){let m;const g=o<u-1;if(g?m=`AAC PES did not start with ADTS header,offset:${o}`:m="No ADTS header found in AAC PES",Cp(this.observer,new Error(m),g,this.logger),!g)return}vb(e,this.observer,i,o,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(s){const m=xb(e.samplerate);d=s.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;o<u;)if(h=Eb(e,i,o,d,c),o+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;o<u-1&&!nf(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Ab(r,o)){const d=bb(e,r,o,u,i);if(d)o+=d.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,u=0,d;for(;u<i&&(d=Lb(e,r,u,s,o++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=$t({},t,{type:this._videoTrack?Mn.emsg:Mn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function kp(n,e){return((n[e+1]&31)<<8)+n[e+2]}function pD(n,e){return(n[e+10]&31)<<8|n[e+11]}function gD(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(n[e+1]&15)<<8|n[e+2],d=e+3+u-4,c=(n[e+10]&15)<<8|n[e+11];for(e+=12+c;e<d;){const h=kp(n,e),m=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Lm("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=h);break;case 21:o.id3Pid===-1&&(o.id3Pid=h);break;case 219:if(!r){Lm("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="mp3");break;case 193:if(!r){Lm("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&m>0){let g=e+5,y=m;for(;y>2;){switch(n[g]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=h,o.segmentAudioCodec="ac3");break}const E=n[g+1]+2;g+=E,y-=E}}break;case 194:case 135:return Cp(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=h,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=m+5}return o}function Cp(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(w.ERROR,w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Lm(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Fo(n,e){let t=0,r,s,i,o,u;const d=n.data;if(!n||n.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=Qn(d[0],d[1]),d.splice(1,1);if(r=d[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const h=r[7];h&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,h&64?(u=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),i=r[8];let m=i+9;if(n.size<=m)return null;n.size-=m;const g=new Uint8Array(n.size);for(let y=0,v=d.length;y<v;y++){r=d[y];let E=r.byteLength;if(m)if(m>E){m-=E;continue}else r=r.subarray(m),E-=m,m=0;g.set(r,t),t+=E}return s&&(s-=i+3),{data:g,pts:o,dts:u,len:s}}return null}class yD{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Bi=Math.pow(2,32)-1;class Q{static init(){Q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Q.types)Q.types.hasOwnProperty(e)&&(Q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Q.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);Q.STTS=Q.STSC=Q.STCO=i,Q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);Q.FTYP=Q.box(Q.types.ftyp,o,d,o,u),Q.DINF=Q.box(Q.types.dinf,Q.box(Q.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return Q.box(Q.types.hdlr,Q.HDLR_TYPES[e])}static mdat(e){return Q.box(Q.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Bi+1)),s=Math.floor(t%(Bi+1));return Q.box(Q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return Q.box(Q.types.mdia,Q.mdhd(e.timescale||0,e.duration||0),Q.hdlr(e.type),Q.minf(e))}static mfhd(e){return Q.box(Q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Q.box(Q.types.minf,Q.box(Q.types.smhd,Q.SMHD),Q.DINF,Q.stbl(e)):Q.box(Q.types.minf,Q.box(Q.types.vmhd,Q.VMHD),Q.DINF,Q.stbl(e))}static moof(e,t,r){return Q.box(Q.types.moof,Q.mfhd(e),Q.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=Q.trak(e[t]);return Q.box.apply(null,[Q.types.moov,Q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(Q.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=Q.trex(e[t]);return Q.box.apply(null,[Q.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Bi+1)),s=Math.floor(t%(Bi+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Q.box(Q.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return Q.box(Q.types.sdtp,r)}static stbl(e){return Q.box(Q.types.stbl,Q.stsd(e),Q.box(Q.types.stts,Q.STTS),Q.box(Q.types.stsc,Q.STSC),Q.box(Q.types.stsz,Q.STSZ),Q.box(Q.types.stco,Q.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const u=Q.box(Q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),d=e.width,c=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return Q.box(Q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,Q.box(Q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Q.box(Q.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return Q.box(Q.types.mp4a,Q.audioStsd(e),Q.box(Q.types.esds,Q.esds(e)))}static mp3(e){return Q.box(Q.types[".mp3"],Q.audioStsd(e))}static ac3(e){return Q.box(Q.types["ac-3"],Q.audioStsd(e),Q.box(Q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return Q.box(Q.types.stsd,Q.STSD,Q.mp4a(e));if(t==="ac3"&&e.config)return Q.box(Q.types.stsd,Q.STSD,Q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return Q.box(Q.types.stsd,Q.STSD,Q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return Q.box(Q.types.stsd,Q.STSD,Q.avc1(e));if(t==="hevc"&&e.vps)return Q.box(Q.types.stsd,Q.STSD,Q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(Bi+1)),u=Math.floor(r%(Bi+1));return Q.box(Q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=Q.sdtp(e),s=e.id,i=Math.floor(t/(Bi+1)),o=Math.floor(t%(Bi+1));return Q.box(Q.types.traf,Q.box(Q.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),Q.box(Q.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),Q.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,Q.box(Q.types.trak,Q.tkhd(e),Q.mdia(e))}static trex(e){const t=e.id;return Q.box(Q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let u,d,c,h,m,g;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<s;u++)d=r[u],c=d.duration,h=d.size,m=d.flags,g=d.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*u);return Q.box(Q.types.trun,o)}static initSegment(e){Q.types||Q.init();const t=Q.moov(e);return Qn(Q.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let v=0;v<r.length;v+=1){o+=3;for(let E=0;E<r[v].length;E+=1)o+=2+r[v][E].length}const u=new Uint8Array(o);u.set(i,0),o=i.length;const d=r.length-1;for(let v=0;v<r.length;v+=1){u.set(new Uint8Array([32+v|(v===d?128:0),0,r[v].length]),o),o+=3;for(let E=0;E<r[v].length;E+=1)u.set(new Uint8Array([r[v][E].length>>8,r[v][E].length&255]),o),o+=2,u.set(r[v][E],o),o+=r[v][E].length}const c=Q.box(Q.types.hvcC,u),h=e.width,m=e.height,g=e.pixelRatio[0],y=e.pixelRatio[1];return Q.box(Q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,Q.box(Q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Q.box(Q.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,y>>24,y>>16&255,y>>8&255,y&255])))}}Q.types=void 0;Q.HDLR_TYPES=void 0;Q.STTS=void 0;Q.STSC=void 0;Q.STCO=void 0;Q.STSZ=void 0;Q.VMHD=void 0;Q.SMHD=void 0;Q.STSD=void 0;Q.FTYP=void 0;Q.DINF=void 0;const kb=9e4;function Ng(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function vD(n,e,t=1,r=!1){return Ng(n,e,1/t,r)}function yu(n,e=!1){return Ng(n,1e3,1/kb,e)}function xD(n,e=1){return Ng(n,kb,1/e)}function cE(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const ED=10*1e3,SD=1024,TD=1152,bD=1536;let Uo=null,_m=null;function dE(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Md extends Xn{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Uo===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Uo=o?parseInt(o[1]):0}if(_m===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);_m=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&cE(t)} > ${e&&cE(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let u=o.pts,d=u-i;return d<-4294967296&&(t=!0,u=On(u,r),d=u-i),d>0?i:u},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,u,d){let c,h,m,g,y,v,E=i,S=i;const A=e.pid>-1,I=t.pid>-1,R=t.samples.length,k=e.samples.length>0,C=u&&R>0||R>1;if((!A||k)&&(!I||C)||this.ISGenerated||u){if(this.ISGenerated){var _,N,F,O;const oe=this.videoTrackConfig;(oe&&(t.width!==oe.width||t.height!==oe.height||((_=t.pixelRatio)==null?void 0:_[0])!==((N=oe.pixelRatio)==null?void 0:N[0])||((F=t.pixelRatio)==null?void 0:F[1])!==((O=oe.pixelRatio)==null?void 0:O[1]))||!oe&&C||this.nextAudioTs===null&&k)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,i,o));const q=this.isVideoContiguous;let H=-1,ie;if(C&&(H=wD(t.samples),!q&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,H>0){this.warn(`Dropped ${H} out of ${R} video samples due to a missing keyframe`);const oe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,S+=(t.samples[0].pts-oe)/t.inputTimeScale,ie=S}else H===-1&&(this.warn(`No keyframe found out of ${R} video samples`),v=!1);if(this.ISGenerated){if(k&&C){const oe=this.getVideoStartPts(t.samples),ae=(On(e.samples[0].pts,oe)-oe)/t.inputTimeScale;E+=Math.max(0,ae),S+=Math.max(0,-ae)}if(k){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,i,o)),h=this.remuxAudio(e,E,this.isAudioContiguous,o,I||C||d===De.AUDIO?S:void 0),C){const oe=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,S,q,oe)}}else C&&(c=this.remuxVideo(t,S,q,0));c&&(c.firstKeyFrame=H,c.independent=H!==-1,c.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(y=Cb(r,i,this._initPTS,this._initDTS)),s.samples.length&&(g=Db(s,i,this._initPTS))),{audio:h,video:c,initSegment:m,independent:v,text:g,id3:y}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let o=On(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,r,s){const i=e.samples,o=t.samples,u=this.typeSupported,d={},c=this._initPTS;let h=!c||s,m="audio/mp4",g,y,v,E=-1;if(h&&(g=y=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):Q.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(E=e.id,v=e.inputTimeScale,!c||v!==c.timescale?g=y=this.computeInitPts(i[0].pts,v,r,"audio"):h=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Q.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(E=t.id,v=t.inputTimeScale,!c||v!==c.timescale){const S=this.getVideoStartPts(o),A=On(o[0].dts,S),I=this.computeInitPts(A,v,r,"video"),R=this.computeInitPts(S,v,r,"video");y=Math.min(y,I),g=Math.min(g,R)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,h?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${g/v} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${g/v} (${g}/${v}) trackId: ${E}`),this._initPTS={baseTime:g,timescale:v,trackId:E},this._initDTS={baseTime:y,timescale:v,trackId:E}):g=v=void 0,{tracks:d,initPTS:g,timescale:v,trackId:E}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,u=[],d=o.length,c=this._initPTS,h=c.baseTime*i/c.timescale;let m=this.nextVideoTs,g=8,y=this.videoSampleDuration,v,E,S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,I=!1;if(!r||m===null){const P=h+t*i,B=o[0].pts-On(o[0].dts,o[0].pts);Uo&&m!==null&&Math.abs(P-B-(m+h))<15e3?r=!0:m=P-B-h}const R=m+h;for(let P=0;P<d;P++){const B=o[P];B.pts=On(B.pts,R),B.dts=On(B.dts,R),B.dts<o[P>0?P-1:P].dts&&(I=!0)}I&&o.sort(function(P,B){const de=P.dts-B.dts,pe=P.pts-B.pts;return de||pe}),v=o[0].dts,E=o[o.length-1].dts;const k=E-v,C=k?Math.round(k/(d-1)):y||e.inputTimeScale/30;if(r){const P=v-R,B=P>C,de=P<-1;if((B||de)&&(B?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yu(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yu(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!de||R>=o[0].pts||Uo)){v=R;const pe=o[0].pts-P;if(B)o[0].dts=v,o[0].pts=pe;else{let ge=!0;for(let we=0;we<o.length&&!(o[we].dts>pe&&ge);we++){const Ie=o[we].pts;if(o[we].dts-=P,o[we].pts-=P,we<o.length-1){const Ge=o[we+1].pts,Ze=o[we].pts,vt=Ge<=Ze,er=Ge<=Ie;ge=vt==er}}}this.log(`Video: Initial PTS/DTS adjusted: ${yu(pe,!0)}/${yu(v,!0)}, delta: ${yu(P,!0)} ms`)}}v=Math.max(0,v);let V=0,_=0,N=v;for(let P=0;P<d;P++){const B=o[P],de=B.units,pe=de.length;let ge=0;for(let we=0;we<pe;we++)ge+=de[we].data.length;_+=ge,V+=pe,B.length=ge,B.dts<N?(B.dts=N,N+=C/4|0||1):N=B.dts,S=Math.min(B.pts,S),A=Math.max(B.pts,A)}E=o[d-1].dts;const F=_+4*V+8;let O;try{O=new Uint8Array(F)}catch(P){this.observer.emit(w.ERROR,w.ERROR,{type:Ve.MUX_ERROR,details:X.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:F,reason:`fail allocating video mdat ${F}`});return}const q=new DataView(O.buffer);q.setUint32(0,F),O.set(Q.types.mdat,4);let H=!1,ie=Number.POSITIVE_INFINITY,oe=Number.POSITIVE_INFINITY,ce=Number.NEGATIVE_INFINITY,ae=Number.NEGATIVE_INFINITY;for(let P=0;P<d;P++){const B=o[P],de=B.units;let pe=0;for(let Ie=0,Ge=de.length;Ie<Ge;Ie++){const Ze=de[Ie],vt=Ze.data,er=Ze.data.byteLength;q.setUint32(g,er),g+=4,O.set(vt,g),g+=er,pe+=4+er}let ge;if(P<d-1)y=o[P+1].dts-B.dts,ge=o[P+1].pts-B.pts;else{const Ie=this.config,Ge=P>0?B.dts-o[P-1].dts:C;if(ge=P>0?B.pts-o[P-1].pts:C,Ie.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ze=Math.floor(Ie.maxBufferHole*i),vt=(s?S+s*i:this.nextAudioTs+h)-B.pts;vt>Ze?(y=vt-Ge,y<0?y=Ge:H=!0,this.log(`It is approximately ${vt/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Ge}else y=Ge}const we=Math.round(B.pts-B.dts);ie=Math.min(ie,y),ce=Math.max(ce,y),oe=Math.min(oe,ge),ae=Math.max(ae,ge),u.push(dE(B.key,y,pe,we))}if(u.length){if(Uo){if(Uo<70){const P=u[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(_m&&ae-oe<ce-ie&&C/ce<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=v;for(let B=0,de=u.length;B<de;B++){const pe=P+u[B].duration,ge=P+u[B].cts;if(B<de-1){const we=pe+u[B+1].cts;u[B].duration=we-ge}else u[B].duration=B?u[B-1].duration:C;u[B].cts=0,P=pe}}}y=H||!y?C:y;const ue=E+y;this.nextVideoTs=m=ue-h,this.videoSampleDuration=y,this.isVideoContiguous=!0;const ne={data1:Q.moof(e.sequenceNumber++,v,$t(e,{samples:u})),data2:O,startPTS:(S-h)/i,endPTS:(A+y-h)/i,startDTS:(v-h)/i,endDTS:m/i,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ne}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return TD;case"ac3":return bD;default:return SD}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,d=o/u,c=this.getSamplesPerFrame(e),h=c*d,m=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=i!==void 0;let E=e.samples,S=g?0:8,A=this.nextAudioTs||-1;const I=m.baseTime*o/m.timescale,R=I+t*o;if(this.isAudioContiguous=r=r||E.length&&A>0&&(s&&Math.abs(R-(A+I))<9e3||Math.abs(On(E[0].pts,R)-(A+I))<20*h),E.forEach(function(ae){ae.pts=On(ae.pts,R)}),!r||A<0){const ae=E.length;if(E=E.filter(ue=>ue.pts>=0),ae!==E.length&&this.warn(`Removed ${E.length-ae} of ${ae} samples (initPTS ${I} / ${o})`),!E.length)return;i===0?A=0:s&&!v?A=Math.max(0,R-I):A=E[0].pts-I}if(e.segmentCodec==="aac"){const ae=this.config.maxAudioFramesDrift;for(let ue=0,W=A+I;ue<E.length;ue++){const Z=E[ue],ne=Z.pts,P=ne-W,B=Math.abs(1e3*P/o);if(P<=-ae*h&&v)ue===0&&(this.warn(`Audio frame @ ${(ne/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/o)} ms.`),this.nextAudioTs=A=ne-I,W=ne);else if(P>=ae*h&&B<ED&&v){let de=Math.round(P/h);for(W=ne-de*h;W<0&&de&&h;)de--,W+=h;ue===0&&(this.nextAudioTs=A=W-I),this.warn(`Injecting ${de} audio frames @ ${((W-I)/o).toFixed(3)}s due to ${Math.round(1e3*P/o)} ms gap.`);for(let pe=0;pe<de;pe++){let ge=yD.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=Z.unit.subarray()),E.splice(ue,0,{unit:ge,pts:W}),W+=h,ue++}}Z.pts=W,W+=h}}let k=null,C=null,V,_=0,N=E.length;for(;N--;)_+=E[N].unit.byteLength;for(let ae=0,ue=E.length;ae<ue;ae++){const W=E[ae],Z=W.unit;let ne=W.pts;if(C!==null){const B=y[ae-1];B.duration=Math.round((ne-C)/d)}else if(r&&e.segmentCodec==="aac"&&(ne=A+I),k=ne,_>0){_+=S;try{V=new Uint8Array(_)}catch(B){this.observer.emit(w.ERROR,w.ERROR,{type:Ve.MUX_ERROR,details:X.REMUX_ALLOC_ERROR,fatal:!1,error:B,bytes:_,reason:`fail allocating audio mdat ${_}`});return}g||(new DataView(V.buffer).setUint32(0,_),V.set(Q.types.mdat,4))}else return;V.set(Z,S);const P=Z.byteLength;S+=P,y.push(dE(!0,c,P,0)),C=ne}const F=y.length;if(!F)return;const O=y[y.length-1];A=C-I,this.nextAudioTs=A+d*O.duration;const q=g?new Uint8Array(0):Q.moof(e.sequenceNumber++,k/d,$t({},e,{samples:y}));e.samples=[];const H=(k-I)/o,ie=this.nextAudioTs/o,ce={data1:q,data2:V,startPTS:H,endPTS:ie,startDTS:H,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.isAudioContiguous=!0,ce}}function On(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function wD(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Cb(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let u=0;u<s;u++){const d=n.samples[u];d.pts=On(d.pts-t.baseTime*i/t.timescale,e*i)/i,d.dts=On(d.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function Db(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const u=n.samples[o];u.pts=On(u.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,u)=>o.pts-u.pts);const i=n.samples;return n.samples=[],{samples:i}}class AD extends Xn{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=UT(e);if(t)fk(e,t);else{const d=i||o;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}i&&(r=fE(i,Gt.AUDIO,this)),o&&(s=fE(o,Gt.VIDEO,this));const u={};i&&o?u.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?u.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?u.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,r,s,i,o){var u,d;let{initPTS:c,lastEndTime:h}=this;const m={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};Re(h)||(h=this.lastEndTime=i||0);const g=t.samples;if(!g.length)return m;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((u=v)!=null&&u.length||(this.generateInitSegment(g),v=this.initData),!((d=v)!=null&&d.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const E=mk(g,v,this),S=v.audio?E[v.audio.id]:null,A=v.video?E[v.video.id]:null,I=gd(A,1/0),R=gd(S,1/0),k=gd(A,0,!0),C=gd(S,0,!0);let V=i,_=0;const N=S&&(!A||!c&&R<I||c&&c.trackId===v.audio.id),F=N?S:A;if(F){const W=F.timescale,Z=F.start-i*W,ne=N?v.audio.id:v.video.id;V=F.start/W,_=N?C-R:k-I,(o||!c)&&(ID(c,V,i,_)||W!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${Z/W} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${V-i} (${Z}/${W}) trackId: ${ne}`),c=null,y.initPTS=Z,y.timescale=W,y.trackId=ne)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(y.initPTS=c.baseTime,y.timescale=c.timescale,y.trackId=c.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=V,y.timescale=1,y.trackId=-1),this.initPTS=c={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const O=V-c.baseTime/c.timescale,q=O+_;_>0?this.lastEndTime=q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!v.audio,ie=!!v.video;let oe="";H&&(oe+="audio"),ie&&(oe+="video");const ce=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),ae={data1:g,startPTS:O,startDTS:O,endPTS:q,endDTS:q,type:oe,hasAudio:H,hasVideo:ie,nb:1,dropped:0,encrypted:ce};m.audio=H&&!ie?ae:void 0,m.video=ie?ae:void 0;const ue=A==null?void 0:A.sampleCount;if(ue){const W=A.keyFrameIndex,Z=W!==-1;ae.nb=ue,ae.dropped=W===0||this.isVideoContiguous?0:Z?W:ue,ae.independent=Z,ae.firstKeyFrame=W,Z&&A.keyFrameStart&&(ae.firstKeyFramePTS=(A.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(m.independent=Z),this.isVideoContiguous||(this.isVideoContiguous=Z),ae.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${W}/${ue} dropped: ${ae.dropped} start: ${ae.firstKeyFramePTS||"NA"}`)}return m.initSegment=y,m.id3=Cb(r,i,c,c),s.samples.length&&(m.text=Db(s,i,c)),m}}function gd(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function ID(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function fE(n,e,t){const r=n.codec;return r&&r.length>4?r:e===Gt.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?qd(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let ii;try{ii=self.performance.now.bind(self.performance)}catch{ii=Date.now}const Fd=[{demux:dD,remux:AD},{demux:Hi,remux:Md},{demux:oD,remux:Md},{demux:uD,remux:Md}];Fd.splice(2,0,{demux:lD,remux:Md});class hE{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=ii();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:h,trackSwitch:m,accurateTimeOffset:g,timeOffset:y,initSegmentChange:v}=s||u,{audioCodec:E,videoCodec:S,defaultInitPts:A,duration:I,initSegmentData:R}=d,k=RD(o,t);if(k&&Qo(k.method)){const N=this.getDecrypter(),F=Ig(k.method);if(N.isSync()){let O=N.softwareDecrypt(o,k.key.buffer,k.iv.buffer,F);if(r.part>-1){const H=N.flush();O=H&&H.buffer}if(!O)return i.executeEnd=ii(),km(r);o=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=N.webCryptoDecrypt(o,k.key.buffer,k.iv.buffer,F).then(O=>{const q=this.push(O,null,r);return this.decryptionPromise=null,q}),this.decryptionPromise}const C=this.needsProbing(h,m);if(C){const N=this.configureTransmuxer(o);if(N)return this.logger.warn(`[transmuxer] ${N.message}`),this.observer.emit(w.ERROR,w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_PARSING_ERROR,fatal:!1,error:N,reason:N.message}),i.executeEnd=ii(),km(r)}(h||m||v||C)&&this.resetInitSegment(R,E,S,I,t),(h||v||C)&&this.resetInitialTimestamp(A),c||this.resetContiguity();const V=this.transmux(o,k,y,g,r);this.asyncResult=$u(V);const _=this.currentTransmuxState;return _.contiguous=!0,_.discontinuity=!1,_.trackSwitch=!1,i.executeEnd=ii(),V}flush(e){const t=e.transmuxing;t.executeStart=ii();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:u}=s;if(r){const m=r.flush();m&&o.push(this.push(m.buffer,null,e))}const{demuxer:d,remuxer:c}=this;if(!d||!c){t.executeEnd=ii();const m=[km(e)];return this.asyncResult?Promise.resolve(m):m}const h=d.flush(u);return $u(h)?(this.asyncResult=!0,h.then(m=>(this.flushRemux(o,m,e),o))):(this.flushRemux(o,h,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===De.MAIN?"level":"track"} ${r.level}`);const h=this.remuxer.remux(s,i,o,u,c,d,!0,this.id);e.push({remuxResult:h,chunkMeta:r}),r.transmuxing.executeEnd=ii()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,r,s),u.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,u,d,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let m=0,g=Fd.length;m<g;m++){var o;if((o=Fd[m].demux)!=null&&o.probe(e,this.logger)){i=Fd[m];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,c=i.remux,h=i.demux;(!d||!(d instanceof c))&&(this.remuxer=new c(r,t,s,this.logger)),(!u||!(u instanceof h))&&(this.demuxer=new h(r,t,s,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new wg(this.config)),e}}function RD(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const km=n=>({remuxResult:{},chunkMeta:n});function $u(n){return"then"in n&&n.then instanceof Function}class LD{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class _D{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let mE=0;class Pb{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=mE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const c=d.data,h=this.hls;if(!(!h||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var m;const g=(m=this.workerContext)==null?void 0:m.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{h.logger[c.data.logType]&&h.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,h.trigger(c.event,c.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const c=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(d,c)=>{c=c||{},c.frag=this.frag||void 0,d===w.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(d,c)};this.observer=new _g,this.observer.on(w.FRAG_DECRYPTED,o),this.observer.on(w.ERROR,o);const u=_x(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(i.workerPath||PC()){try{i.workerPath?(d.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=NC(i.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=OC());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Kt(i)})}catch(h){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new hE(this.observer,u,i,"",t,e.logger)}return}}this.transmuxer=new hE(this.observer,u,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=mE++;const t=this.hls.config,r=_x(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Kt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),MC(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,u,d,c,h){var m,g;c.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:v}=this,E=o?o.start:i.start,S=i.decryptdata,A=this.frag,I=!(A&&i.cc===A.cc),R=!(A&&c.level===A.level),k=A?c.sn-A.sn:-1,C=this.part?c.part-this.part.index:-1,V=k===0&&c.id>1&&c.id===(A==null?void 0:A.stats.chunkCount),_=!R&&(k===1||k===0&&(C===1||V&&C<=0)),N=self.performance.now();(R||k||i.stats.parsing.start===0)&&(i.stats.parsing.start=N),o&&(C||!_)&&(o.stats.parsing.start=N);const F=!(A&&((m=i.initSegment)==null?void 0:m.url)===((g=A.initSegment)==null?void 0:g.url)),O=new _D(I,_,d,R,E,F);if(!_||I||F){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===De.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${I}
        trackSwitch: ${R}
        contiguous: ${_}
        accurateTimeOffset: ${d}
        timeOffset: ${E}
        initSegmentChange: ${F}`);const q=new LD(r,s,t,u,h);this.configureTransmuxer(q)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:S,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(v){const q=v.push(e,S,c,O);$u(q)?q.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(q)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);$u(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const pE=100;class kD extends Lg{constructor(e,t,r){super(e,t,r,"audio-stream-controller",De.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(w.BUFFER_RESET,this.onBufferReset,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(w.BUFFER_RESET,this.onBufferReset,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){if(r===De.MAIN){const u=t.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${u} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===le.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==u)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===le.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),u=this.getLoadPosition(),d=qT(o,i,u);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===le.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=le.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(pE),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=le.IDLE):this.state=le.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case le.IDLE:this.doTickIdle();break;case le.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=le.WAITING_INIT_PTS}break}case le.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case le.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=le.FRAG_LOADING;const u=s.flush().buffer,d={frag:t,part:r,payload:u,networkDetails:null};this._handleFragmentLoadProgress(d),i&&super._handleFragmentLoadComplete(d)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=le.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const u=r[i],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=le.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Gt.AUDIO,De.AUDIO));const h=this.getFwdBufferInfo(c,De.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,d)){t.trigger(w.BUFFER_EOS,{type:"audio"}),this.state=le.ENDED;return}const m=h.len,g=t.maxBufferLength,y=d.fragments,v=y[0].start,E=this.getLoadPosition(),S=this.flushing?E:h.end;if(this.switchingTrack&&s){const R=E;d.PTSKnown&&R<v&&(h.end>v||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=v+.05)}if(m>=g&&!this.switchingTrack&&S<y[y.length-1].start)return;let A=this.getNextFragment(S,d);if(A&&this.isLoopLoading(A,S)&&(A=this.getNextFragmentLoopLoading(A,d,h,De.MAIN,g)),!A){this.bufferFlushed=!0;return}let I=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&I&&pr(A)&&!A.endList&&(!d.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(I)===_r.OK&&(this.mainFragLoading=I=null),I&&pr(I))){if(A.start>I.end){const k=this.fragmentTracker.getFragAtPos(S,De.MAIN);k&&k.end>I.end&&(I=k,this.mainFragLoading={frag:k,targetBufferTime:null})}if(A.start>I.end)return}this.loadFragment(A,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Fu(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==le.STOPPED&&(this.setInterval(pE),this.state=le.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(w.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:u,track:d}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${d.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==le.STOPPED&&(this.state=le.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${d.name}" of "${u}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const h=s[o];let m=0;if(i.live||(r=h.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(h.details){var g;m=this.alignPlaylists(i,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}i.alignedSliding||(hb(i,c),i.alignedSliding||rf(i,c),m=i.fragmentStart)}h.details=i,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,m),this.hls.trigger(w.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===le.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=le.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=d[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const m=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new Pb(this.hls,De.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[r.cc],v=(t=r.initSegment)==null?void 0:t.data;if(y!==void 0){const S=s?s.index:-1,A=S!==-1,I=new Ag(r.level,r.sn,r.stats.chunkCount,i.byteLength,S,A);g.push(i,v,m,"",r,s,h.totalduration,!1,I,y)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${h.startSN} ,${h.endSN}],track ${u}`);const{cache:E}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new mb,complete:!1};E.push(new Uint8Array(i)),this.state!==le.STOPPED&&(this.state=le.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===De.MAIN&&pr(t.frag)&&(this.mainFragLoading=t,this.state===le.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==De.AUDIO){!this.audioOnly&&r.type===De.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(pr(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(w.AUDIO_TRACK_SWITCHED,Ft({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=le.ERROR;return}switch(t.details){case X.FRAG_GAP:case X.FRAG_PARSING_ERROR:case X.FRAG_DECRYPT_ERROR:case X.FRAG_LOAD_ERROR:case X.FRAG_LOAD_TIMEOUT:case X.KEY_LOAD_ERROR:case X.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.AUDIO,t);break;case X.AUDIO_TRACK_LOAD_ERROR:case X.AUDIO_TRACK_LOAD_TIMEOUT:case X.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===le.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ht.AUDIO_TRACK&&(this.state=le.IDLE);break;case X.BUFFER_ADD_CODEC_ERROR:case X.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case X.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case X.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Gt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Gt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===le.ENDED&&(this.state=le.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,De.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:d,part:c,level:h}=u,{details:m}=h,{audio:g,text:y,id3:v,initSegment:E}=i;if(this.fragContextChanged(d)||!m){this.fragmentTracker.removeFragment(d);return}if(this.state=le.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const S=d.initSegment||d;if(this.unhandledEncryptionError(E,d))return;this._bufferInitSegment(h,E.tracks,S,o),s.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:r,tracks:E.tracks})}if(g){const{startPTS:S,endPTS:A,startDTS:I,endDTS:R}=g;c&&(c.elementaryStreams[Gt.AUDIO]={startPTS:S,endPTS:A,startDTS:I,endDTS:R}),d.setElementaryStreamInfo(Gt.AUDIO,S,A,I,R),this.bufferFragmentData(g,d,c,o)}if(v!=null&&(t=v.samples)!=null&&t.length){const S=$t({id:r,frag:d,details:m},v);s.trigger(w.FRAG_PARSING_METADATA,S)}if(y){const S=$t({id:r,frag:d,details:m},y);s.trigger(w.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,r,s){if(this.state!==le.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=De.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(w.BUFFER_CODECS,t);const u=i.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:u};this.hls.trigger(w.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===_r.NOT_LOADED||s===_r.PARTIAL){var i;if(!pr(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=le.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&rf(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:u}=this.bufferedTrack;qa({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:u},e,Oa)||(Xd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(w.AUDIO_TRACK_SWITCHED,Ft({},e))}}class Mg extends Xn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const u=s[o];let d;try{d=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),d=u.URI||""}if(d===e){i=o;break}else d===e.substring(0,d.length)&&(i=o)}if(i!==-1){const o=s[i],u=parseInt(o["LAST-MSN"])||t.lastPartSn;let d=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&h>t.partTarget&&(d+=1)}const c=r&&kx(r);return new Cx(u,d>=0?d:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),u=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==s.appliedTimelineOffset){const h=Math.max(d||0,0);s.appliedTimelineOffset=h,s.fragments.forEach(m=>{m.setStart(m.playlistOffset+h)})}if(s.live||r!=null&&r.live){const h="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){TC(r,s,this);const I=s.playlistParsingError;if(I){this.warn(I);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var c;const{networkDetails:k}=t;R.trigger(w.ERROR,{type:Ve.NETWORK_ERROR,details:X.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:I,reason:I.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:k,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const m=this.hls.mainForwardBufferInfo,g=m?m.end-m.len:0,y=(s.edge-g)*1e3,v=lb(s,y);if(s.requestScheduled+v<o?s.requestScheduled=o:s.requestScheduled+=v,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let E,S,A;if(s.canBlockReload&&s.endSN&&s.advanced){const I=this.hls.config.lowLatencyMode,R=s.lastPartSn,k=s.endSN,C=s.lastPartIndex,V=C!==-1,_=R===k;V?_?(S=k+1,A=I?0:C):(S=R,A=I?C+1:s.maxPartIndex):S=k+1;const N=s.age,F=N+s.ageHeader;let O=Math.min(F-s.partTarget,s.targetduration*1.5);if(O>0){if(F>s.targetduration*3)this.log(`Playlist last advanced ${N.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,A=void 0;else if(r!=null&&r.tuneInGoal&&F-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${O} with playlist age: ${s.age}`),O=0;else{const q=Math.floor(O/s.targetduration);if(S+=q,A!==void 0){const H=Math.round(O%s.targetduration/s.partTarget);A+=H}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${N.toFixed(2)}s goal: ${O} skip sn ${q} to part ${A}`)}s.tuneInGoal=O}if(E=this.getDeliveryDirectives(s,t.deliveryDirectives,S,A),I||!_){s.requestScheduled=o,this.loadingPlaylist(h,E);return}}else(s.canBlockReload||s.canSkipUntil)&&(E=this.getDeliveryDirectives(s,t.deliveryDirectives,S,A));E&&S!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(v-u*2,v/2)),this.scheduleLoading(h,E,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const u=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,r,s){let i=kx(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Od.No),new Cx(r,s,i)}checkRetry(e){const t=e.details,r=Zd(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:u}=s||{},d=!!s&&!!u&&(i===Vr.RetryRequest||!s.resolved&&i===Vr.SendAlternateToPenaltyBox);if(d){var c;if(o>=u.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=bg(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,s.resolved=!0}return d}}function Ob(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ju(n[t].attrs,e[t].attrs))return!1;return!0}function ju(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Dp(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class CD extends Mg{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(w.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(u=>(s==null?void 0:s.indexOf(u))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!r||r.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,y)=>{g.id=y});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!i&&d){const g=Os(d,u,Oa);if(g>-1)i=u[g];else{const y=Os(d,this.tracks);i=this.tracks[y]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const h={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(w.AUDIO_TRACKS_UPDATED,h);const m=this.trackId;if(c!==-1&&m===-1)this.setAudioTrack(c);else if(u.length&&m===-1){var o;const g=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(g.message),this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:g})}}}onError(e,t){t.fatal||!t.context||t.context.type===ht.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&qa(e,s,Oa))return s;const i=Os(e,this.tracksInGroup,Oa);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=Gk(e,t.levels,r,o,Oa);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=Os(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(w.AUDIO_TRACK_SWITCHING,Ft({},s)),i))return;const o=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||qa(e,s,Oa)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:u,channels:d}=e;for(let c=0;c<t.length;c++){const h=t[c];if(qa({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:u,channels:d},h,Oa))return c}for(let c=0;c<t.length;c++){const h=t[c];if(ju(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const h=t[c];if(ju(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Xd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(w.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class DD{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const gE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Nb="HlsJsTrackRemovedError";class PD extends Error{constructor(e){super(e),this.name=Nb}}class OD extends Xn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(w.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=rk(ua(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.BUFFER_RESET,this.onBufferReset,this),e.on(w.BUFFER_APPENDING,this.onBufferAppending,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.BUFFER_EOS,this.onBufferEos,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.FRAG_PARSED,this.onFragParsed,this),e.on(w.FRAG_CHANGED,this.onFragChanged,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.BUFFER_RESET,this.onBufferReset,this),e.off(w.BUFFER_APPENDING,this.onBufferAppending,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.BUFFER_EOS,this.onBufferEos,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.FRAG_PARSED,this.onFragParsed,this),e.off(w.FRAG_CHANGED,this.onFragChanged,this),e.off(w.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?$t(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=$t({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=ua(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const d=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||d&&o instanceof d,yE(r),ND(r,u),r.load()}catch{r.src=u}else r.src=u}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Kt(r,(d,c)=>d==="initSegment"?void 0:c)};
transfer tracks: ${Kt(s,(d,c)=>d==="initSegment"?void 0:c)}}`),!CT(s,r)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,c=this.details,h=Math.max(d,(c==null?void 0:c.fragments[0].start)||0);if(h-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${h} currentTime: ${d}`),this.onMediaDetaching(w.MEDIA_DETACHING,{}),this.onMediaAttaching(w.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,i.forEach(d=>{const c=d,h=s[c];if(h){const m=h.buffer;if(m){const g=this.fragmentTracker,y=h.id;if(g.hasFragments(y)||g.hasParts(y)){const S=st.getBuffered(m);g.detectEvictedFragments(c,S,y,null,!0)}const v=Cm(c),E=[c,m];this.sourceBuffers[v]=E,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,h)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=i.readyState==="open";try{const d=i.sourceBuffers;for(let c=d.length;c--;)u&&d[c].abort(),i.removeSourceBuffer(d[c]);u&&i.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&yE(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(w.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Cm(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new DD(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),u=!o&&this.sourceBufferCount&&this.media&&i.some(d=>!s[d]);if(o||u){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(d=>{var c,h;const m=t[d],{id:g,codec:y,levelCodec:v,container:E,metadata:S,supplemental:A}=m;let I=s[d];const R=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[d],k=R!=null&&R.buffer?R:I,C=(k==null?void 0:k.pendingCodec)||(k==null?void 0:k.codec),V=k==null?void 0:k.levelCodec;I||(I=s[d]={buffer:void 0,listeners:[],codec:y,supplemental:A,container:E,levelCodec:v,metadata:S,id:g});const _=Pd(C,V),N=_==null?void 0:_.replace(gE,"$1");let F=Pd(y,v);const O=(h=F)==null?void 0:h.replace(gE,"$1");F&&_&&N!==O&&(d.slice(0,5)==="audio"&&(F=qd(F,this.appendSource)),this.log(`switching codec ${C} to ${F}`),F!==(I.pendingCodec||I.codec)&&(I.pendingCodec=F),I.container=E,this.appendChangeType(d,E,F))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),u.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,De.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>s||d!=null&&d.buffer&&st.isBuffered(d.buffer,s)||((u=this.fragmentTracker.getAppendedFrag(s,De.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:u,part:d,chunkMeta:c,offset:h}=t,m=c.buffering[i],{sn:g,cc:y}=u,v=self.performance.now();m.start=v;const E=u.stats.buffering,S=d?d.stats.buffering:null;E.start===0&&(E.start=v),S&&S.start===0&&(S.start=v);const A=r.audio;let I=!1;i==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(I=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const R=r.video,k=R==null?void 0:R.buffer;if(k&&g!=="initSegment"){const _=d||u,N=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const O=_.start+_.duration*.05,q=k.buffered,H=this.currentOp("video");!q.length&&!H?this.blockAudio(_):!H&&!st.isBuffered(k,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(_)}else if(i==="video"){const F=_.end;if(N){const O=N.frag.start;(F>O||F<this.lastVideoAppendEnd||st.isBuffered(k,O))&&this.unblockAudio()}this.lastVideoAppendEnd=F}}const C=(d||u).start,V={label:`append-${i}`,execute:()=>{var _;m.executeStart=self.performance.now();const N=(_=this.tracks[i])==null?void 0:_.buffer;N&&(I?this.updateTimestampOffset(N,C,.1,i,g,y):h!==void 0&&Re(h)&&this.updateTimestampOffset(N,h,1e-6,i,g,y)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const _=self.performance.now();m.executeEnd=m.end=_,E.first===0&&(E.first=_),S&&S.first===0&&(S.first=_);const N={};this.sourceBuffers.forEach(([F,O])=>{F&&(N[F]=st.getBuffered(O))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(w.BUFFER_APPENDED,{type:i,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:N})},onError:_=>{var N;const F={type:Ve.MEDIA_ERROR,parent:u.type,details:X.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:u,part:d,chunkMeta:c,error:_,err:_,fatal:!1},O=(N=this.media)==null?void 0:N.error;if(_.code===DOMException.QUOTA_EXCEEDED_ERR||_.name=="QuotaExceededError"||"quota"in _)F.details=X.BUFFER_FULL_ERROR;else if(_.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)F.errorAction=qo(!0);else if(_.name===Nb&&this.sourceBufferCount===0)F.errorAction=qo(!0);else{const q=++this.appendErrors[i];this.warn(`Failed ${q}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${O||"no media error"})`),(q>=this.hls.config.appendErrorMaxRetry||O)&&(F.fatal=!0)}this.hls.trigger(w.ERROR,F)}};this.log(`queuing "${i}" append sn: ${g}${d?" p: "+d.index:""} of ${u.type===De.MAIN?"level":"track"} ${u.level} cc: ${y}`),this.append(V,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(w.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[Gt.AUDIOVIDEO]?i.push("audiovideo"):(o[Gt.AUDIO]&&i.push("audio"),o[Gt.VIDEO]&&i.push("video"));const u=()=>{const d=self.performance.now();r.stats.buffering.end=d,s&&(s.stats.buffering.end=d);const c=s?s.stats:r.stats;this.hls.trigger(w.FRAG_BUFFERED,{frag:r,part:s,stats:c,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(u,i).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(w.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(w.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===X.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;Re(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,u=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Re(u)&&u>=0){const c=Math.max(u,o),h=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,h)}const d=s.frontBufferFlushThreshold;if(Re(d)&&d>0){const c=Math.max(s.maxBufferLength,d),h=Math.max(c,o),m=Math.floor(i/o)*o+h;this.flushFrontBuffer(i,o,m)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const u=st.getBuffered(i);if(u.length>0&&r>u.start(0)){var o;this.hls.trigger(w.BACK_BUFFER_REACHED,{bufferEnd:r});const d=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(w.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(d!=null&&d.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=st.getBuffered(i),u=o.length;if(u<2)return;const d=o.start(u-1),c=o.end(u-1);if(r>d||e>=d&&e<=c)return;this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),h=Math.max(c,s);return{duration:1/0,start:c,end:h}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return Re(i)?{duration:i}:null;const o=this.media.duration,u=Re(r.duration)?r.duration:0;return s>u&&s>o||!Re(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(Re(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Kt(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(w.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,u=e[o];if(this.isPending(u)){const d=this.getTrackCodec(u,o),c=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${Kt(u)}`);try{const h=r.addSourceBuffer(c),m=Cm(o),g=[o,h];t[m]=g,u.buffer=h}catch(h){var s;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:o,mimeType:c,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Nu(r,"video")&&(s=wk(s,r));const i=Pd(s,e.levelCodec);return i?t.slice(0,5)==="audio"?qd(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(w.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,o){const u=t-e.timestampOffset;Math.abs(u)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],u=o==null?void 0:o.buffer;if(!s||!i||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=Re(s.duration)?s.duration:1/0,c=Re(i.duration)?i.duration:1/0,h=Math.max(0,t),m=Math.min(r,d,c);m>h&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${h},${m}] from the ${e} SourceBuffer`),u.remove(h,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new PD(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function yE(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function ND(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Cm(n){return n==="audio"?1:0}class Fg{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Re(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Fg.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=o||d.height>=o)&&s(d,e[u+1])){i=u;break}}return i}}const MD={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},xn=MD,FD={HLS:"h"},UD=FD;class Us{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Us?r:new Us(r))),this.value=e,this.params=t}}const BD="Dict";function $D(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function jD(n,e,t,r){return new Error(`failed to ${n} "${$D(e)}" as ${t}`,{cause:r})}function Bs(n,e,t){return jD("serialize",n,e,t)}class Mb{constructor(e){this.description=e}}const vE="Bare Item",VD="Boolean";function GD(n){if(typeof n!="boolean")throw Bs(n,VD);return n?"?1":"?0"}function KD(n){return btoa(String.fromCharCode(...n))}const HD="Byte Sequence";function zD(n){if(ArrayBuffer.isView(n)===!1)throw Bs(n,HD);return`:${KD(n)}:`}const WD="Integer";function YD(n){return n<-999999999999999||999999999999999<n}function Fb(n){if(YD(n))throw Bs(n,WD);return n.toString()}function qD(n){return`@${Fb(n.getTime()/1e3)}`}function Ub(n,e){if(n<0)return-Ub(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const QD="Decimal";function XD(n){const e=Ub(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Bs(n,QD);const t=e.toString();return t.includes(".")?t:`${t}.0`}const ZD="String",JD=/[\x00-\x1f\x7f]+/;function eP(n){if(JD.test(n))throw Bs(n,ZD);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function tP(n){return n.description||n.toString().slice(7,-1)}const rP="Token";function xE(n){const e=tP(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Bs(e,rP);return e}function Pp(n){switch(typeof n){case"number":if(!Re(n))throw Bs(n,vE);return Number.isInteger(n)?Fb(n):XD(n);case"string":return eP(n);case"symbol":return xE(n);case"boolean":return GD(n);case"object":if(n instanceof Date)return qD(n);if(n instanceof Uint8Array)return zD(n);if(n instanceof Mb)return xE(n);default:throw Bs(n,vE)}}const nP="Key";function Op(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Bs(n,nP);return n}function Ug(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Op(e)}`:`;${Op(e)}=${Pp(t)}`).join("")}function Bb(n){return n instanceof Us?`${Pp(n.value)}${Ug(n.params)}`:Pp(n)}function sP(n){return`(${n.value.map(Bb).join(" ")})${Ug(n.params)}`}function iP(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Bs(n,BD);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Us||(i=new Us(i));let o=Op(s);return i.value===!0?o+=Ug(i.params):(o+="=",Array.isArray(i.value)?o+=sP(i):o+=Bb(i)),o}).join(`,${r}`)}function $b(n,e){return iP(n,e)}const Is="CMCD-Object",cr="CMCD-Request",Da="CMCD-Session",$i="CMCD-Status",aP={br:Is,ab:Is,d:Is,ot:Is,tb:Is,tpb:Is,lb:Is,tab:Is,lab:Is,url:Is,pb:cr,bl:cr,tbl:cr,dl:cr,ltc:cr,mtp:cr,nor:cr,nrr:cr,rc:cr,sn:cr,sta:cr,su:cr,ttfb:cr,ttfbb:cr,ttlb:cr,cmsdd:cr,cmsds:cr,smrt:cr,df:cr,cs:cr,ts:cr,cid:Da,pr:Da,sf:Da,sid:Da,st:Da,v:Da,msd:Da,bs:$i,bsd:$i,cdn:$i,rtp:$i,bg:$i,pt:$i,ec:$i,e:$i},oP={REQUEST:cr};function lP(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function uP(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?lP(e):{};return r.reduce((i,o)=>{var u;const d=aP[o]||s[o]||oP.REQUEST,c=(u=i[d])!==null&&u!==void 0?u:i[d]={};return c[o]=n[o],i},t)}function cP(n){return["ot","sf","st","e","sta"].includes(n)}function dP(n){return typeof n=="number"?Re(n):n!=null&&n!==""&&n!==!1}const jb="event";function fP(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const Ud=n=>Math.round(n),Np=(n,e)=>Array.isArray(n)?n.map(t=>Np(t,e)):n instanceof Us&&typeof n.value=="string"?new Us(Np(n.value,e),n.params):(e.baseUrl&&(n=fP(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),yd=n=>Ud(n/100)*100,hP=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Us&&typeof n.value=="string"?t=new Us([n]):typeof n=="string"&&(t=[n])),Np(t,e)},mP={br:Ud,d:Ud,bl:yd,dl:yd,mtp:yd,nor:hP,rtp:yd,tb:Ud},Vb="request",Gb="response",Bg=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],pP=["e"],gP=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Sf(n){return gP.test(n)}function yP(n){return Bg.includes(n)||pP.includes(n)||Sf(n)}const Kb=["d","dl","nor","ot","rtp","su"];function vP(n){return Bg.includes(n)||Kb.includes(n)||Sf(n)}const xP=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function EP(n){return Bg.includes(n)||Kb.includes(n)||xP.includes(n)||Sf(n)}const SP=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function TP(n){return SP.includes(n)||Sf(n)}const bP={[Gb]:EP,[jb]:yP,[Vb]:vP};function Hb(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||Vb,i=r===1?TP:bP[s];let o=Object.keys(n).filter(i);const u=e.filter;typeof u=="function"&&(o=o.filter(u));const d=s===Gb||s===jb;d&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const c=$t({},mP,e.formatters),h={version:r,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(m=>{let g=n[m];const y=c[m];if(typeof y=="function"&&(g=y(g,h)),m==="v"){if(r===1)return;g=r}m=="pr"&&g===1||(d&&m==="ts"&&!Re(g)&&(g=Date.now()),dP(g)&&(cP(m)&&typeof g=="string"&&(g=new Mb(g)),t[m]=g))}),t}function wP(n,e={}){const t={};if(!n)return t;const r=Hb(n,e),s=uP(r,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[o,u])=>{const d=$b(u,{whitespace:!1});return d&&(i[o]=d),i},t)}function AP(n,e,t){return $t(n,wP(e,t))}const IP="CMCD";function RP(n,e={}){return n?$b(Hb(n,e),{whitespace:!1}):""}function LP(n,e={}){if(!n)return"";const t=RP(n,e);return encodeURIComponent(t)}function _P(n,e={}){if(!n)return"";const t=LP(n,e);return`${IP}=${t}`}const EE=/CMCD=[^&#]+/;function kP(n,e,t){const r=_P(e,t);if(!r)return n;if(EE.test(n))return n.replace(EE,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class CP{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:xn.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,u=this.hls.levels[i.level],d=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:d};(d===xn.VIDEO||d===xn.AUDIO||d==xn.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(d)/1e3,c.bl=this.getBufferLength(d));const h=o?this.getNextPart(o):this.getNextFrag(i);h!=null&&h.url&&h.url!==i.url&&(c.nor=h.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHED,this.onMediaDetached,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHED,this.onMediaDetached,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:UD.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){$t(t,this.createData());const r=t.ot===xn.INIT||t.ot===xn.VIDEO||t.ot===xn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,u)=>(s.includes(u)&&(o[u]=t[u]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),AP(e.headers,t,i)):e.url=kP(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.index===r&&d.fragment.sn===o)return i[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return xn.TIMED_TEXT;if(e.sn==="initSegment")return xn.INIT;if(t==="audio")return xn.AUDIO;if(t==="main")return this.hls.audioTracks.length?xn.VIDEO:xn.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===xn.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===xn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:st.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}}const DP=3e5;class PP extends Xn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Vr.SendAlternateToPenaltyBox&&r.flags===Pn.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:c}=t.context;u&&s?o=this.getPathwayForGroupId(u,c,o):d&&(o=d)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===X.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Kt(i)} penalized: ${Kt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>DP&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,db(t),this.hls.trigger(w.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];d&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===ht.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===ht.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":d}=i;if(t.some(h=>h.pathwayId===o))return;const c=this.getLevelsForPathway(u).map(h=>{const m=new ar(h.attrs);m["PATHWAY-ID"]=o;const g=m.AUDIO&&`${m.AUDIO}_clone_${o}`,y=m.SUBTITLES&&`${m.SUBTITLES}_clone_${o}`;g&&(r[m.AUDIO]=g,m.AUDIO=g),y&&(s[m.SUBTITLES]=y,m.SUBTITLES=y);const v=zb(h.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),E=new Fu({attrs:m,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:v,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let S=1;S<h.audioGroups.length;S++)E.addGroupId("audio",`${h.audioGroups[S]}_clone_${o}`);if(h.subtitleGroups)for(let S=1;S<h.subtitleGroups.length;S++)E.addGroupId("text",`${h.subtitleGroups[S]}_clone_${o}`);return E});t.push(...c),SE(this.audioTracks,r,d,o),SE(this.subtitleTracks,s,d,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+h)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(h,m,g,y)=>{this.log(`Loaded steering manifest: "${s}"`);const v=h.data;if((v==null?void 0:v.VERSION)!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":A}=v;if(E)try{this.uri=new self.URL(E,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||g.url),S&&this.clonePathways(S);const I={steeringManifest:v,url:s.toString()};this.hls.trigger(w.STEERING_MANIFEST_LOADED,I),A&&this.updatePathwayPriority(A)},onError:(h,m,g,y)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${m.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let v=this.timeToLoad*1e3;if(h.code===429){const E=this.loader;if(typeof(E==null?void 0:E.getResponseHeader)=="function"){const S=E.getResponseHeader("Retry-After");S&&(v=parseFloat(S)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,v)},onTimeout:(h,m,g)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,d,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function SE(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const u=$t({},o);return u.details=void 0,u.attrs=new ar(u.attrs),u.url=u.attrs.URI=zb(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[s],u.attrs["PATHWAY-ID"]=r,u});n.push(...i)})}function zb(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let u;e&&(u=o==null?void 0:o[e],u&&(n=u));const d=new self.URL(n);return s&&!u&&(d.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&d.searchParams.set(c,i[c])}),d.href}class Xo extends Xn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Xo.CDMCleanupPromise?[Xo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Su(this.config));const u=o.map(bm).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=Nd(o);if(r!=="sinf"||u!==lr.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${u}`);return}let d;try{const y=Lr(new Uint8Array(s)),v=Rg(JSON.parse(y).sinf),E=$T(v);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(E.subarray(8,24))}catch(y){this.warn(`${i} Failed to parse sinf: ${y}`);return}const c=Gr(d),{keyIdToKeySessionPromise:h,mediaKeySessions:m}=this;let g=h[c];for(let y=0;y<m.length;y++){const v=m[y],E=v.decryptdata;if(!E.keyId)continue;const S=Gr(E.keyId);if(ef(d,E.keyId)||E.uri.replace(/-/g,"").indexOf(c)!==-1){if(g=h[S],!g)continue;if(E.pssh)break;delete h[S],E.pssh=new Uint8Array(s),E.keyId=d,g=h[c]=g.then(()=>this.generateRequestWithPreferredKeySession(v,r,s,"encrypted-event-key-match")),g.catch(A=>this.handleError(A));break}}g||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(w.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(w.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===lr.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,u,d)=>!!o&&d.indexOf(o)===u,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,u)=>{const d=c=>{const h=c.shift();this.getMediaKeysPromise(h,s,i).then(m=>o({keySystem:h,mediaKeys:m})).catch(m=>{c.length?d(c):m instanceof Dn?u(m):u(new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return nb===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=hC(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],u=(s=o)==null?void 0:s.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Kt(i)}`),u=this.requestMediaKeySystemAccess(e,i);const d=o=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=d.mediaKeys=c.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,h.then(y=>y?this.setMediaKeysServerCertificate(g,e,y):g)));return m.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),m})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Gr(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=vd(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Gr(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>bm(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=bm(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Su(this.config),r=e.map(Nd).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=OP(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=vd(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const u=TE(s||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(d,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:c,decryptdata:t}))))).then(d=>{const c="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,c,h,"playlist-key")});return u.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[r]=u,u}return o.catch(u=>{if(u instanceof Dn){const d=Ft({},u.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const c=new Dn(d,u.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Dn){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Gr(r.keyId||[])})`:""}`),this.hls.trigger(w.ERROR,e.data)}else this.error(e.message),this.hls.trigger(w.ERROR,{type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=vd(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=Nd(e.keyFormat),i=s?[s]:Su(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Su(this.config)),e.length===0)throw new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Kt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const v=o.call(this.hls,t,r,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,r=v.initData?v.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=vd(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${u} URI: ${d} (init data type: ${t} length: ${r.byteLength})`);const c=new _g,h=e._onmessage=v=>{const E=e.mediaKeysSession;if(!E){c.emit("error",new Error("invalid state"));return}const{messageType:S,message:A}=v;this.log(`"${S}" message event for session "${E.sessionId}" message size: ${A.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,A).catch(I=>{c.eventNames().length?c.emit("error",I):this.handleError(I)}):S==="license-release"?e.keySystem===lr.FAIRPLAY&&this.updateKeySession(e,Rp("acknowledged")).then(()=>this.removeSession(e)).catch(I=>this.handleError(I)):this.warn(`unhandled media key message type "${S}"`)},m=(v,E)=>{E.keyStatus=v;let S;v.startsWith("usable")?c.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?S=TE(v,E.decryptdata):v==="expired"?S=new Error(`key expired (keyId: ${u})`):v==="released"?S=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${u})`),S&&(c.eventNames().length?c.emit("error",S):this.handleError(S))},g=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(k=>S[k]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${Kt(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let I=S[u];if(I)m(I,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[u]||(R[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const C=this.getKeyStatus(e.decryptdata);if(C&&C!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${C} from other session.`),m(C,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),I="internal-error",m(I,e)},1e3)),this.log(`No status for keyId ${u} (${Kt(S)}).`)}};un(e.mediaKeysSession,"message",h),un(e.mediaKeysSession,"keystatuseschange",g);const y=new Promise((v,E)=>{c.on("error",E),c.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${d}`)}).catch(v=>{throw new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const u=s;s=r,r=u}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===lr.PLAYREADY&&i.length===16){const u=Gr(i);t[u]=r,tb(i)}const o=Gr(i);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const d={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,y,v,E)=>{o(g.data)},onError:(g,y,v,E)=>{u(new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:Ft({url:d.url,data:void 0},g)},`"${e}" certificate request failed (${i}). Status: ${g.code} (${g.text})`))},onTimeout:(g,y,v)=>{u(new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(g,y,v)=>{u(new Error("aborted"))}};s.load(d,h,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let h;for(let m=0,g=i.length;m<g;m++){var o,u;h=i[m];const y=(o=h.querySelector("name"))==null?void 0:o.textContent,v=(u=h.querySelector("value"))==null?void 0:u.textContent;y&&v&&e.setRequestHeader(y,v)}}const d=s.querySelector("Challenge"),c=d==null?void 0:d.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Rp(atob(c))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const c=this.config.licenseResponseCallback;if(c)try{d=c.call(this.hls,u,o,e)}catch(h){this.error(h)}s(d)}else{const d=r.errorRetry,c=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)i(new Dn({type:Ve.KEY_SYSTEM_ERROR,details:X.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:d,licenseChallenge:c})=>{e.keySystem==lr.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(d,c)),d.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,un(r,"encrypted",this.onMediaEncrypted),un(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(In(e,"encrypted",this.onMediaEncrypted),In(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,aa.clearKeyUriToKeyIdMap();const i=s.length;Xo.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Gr((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:u}=this.config;return(pC(u)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(h)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Xo.CDMCleanupPromise=void 0;function vd(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Gr(n.keyId)}function OP(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class Dn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function TE(n,e){const t=n==="output-restricted",r=t?X.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:X.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Dn({type:Ve.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class NP{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*o/i,c=this.hls;if(c.trigger(w.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:r}),d>0&&o>c.config.fpsDroppedMonitoringThreshold*u){let h=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(w.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Wb(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function Yb(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Bt.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Bt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Wo(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Mp(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=FP(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function MP(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function FP(n,e,t){const r=[],s=MP(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const u=n[i];if(u.startTime>=e&&u.endTime<=t)r.push(u);else if(u.startTime>t)return r}return r}function Bd(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class UP extends Mg{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Bd(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(w.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Bd(r.textTracks).forEach(o=>{Wo(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!r||r.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,m)=>{h.id=m});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!i&&u){this.selectDefaultTrack=!1;const h=Os(u,o);if(h>-1)i=o[h];else{const m=Os(u,this.tracks);i=this.tracks[m]}}let d=this.findTrackId(i);d===-1&&i&&(d=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(w.SUBTITLE_TRACKS_UPDATED,c),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||qa(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(ju(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(ju(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Dp(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ht.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&qa(e,r))return r;const s=Os(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=Os(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(w.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Bd(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Dp(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Re(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:u="",name:d,type:c,url:h}=s;this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:d,type:c,url:h});const m=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(m)}}function BP(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Au(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Zo=.025;let sf=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function $P(n,e,t){return`${n.identifier}-${t+1}-${Au(e)}`}class jP{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Dm(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Dm(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Re(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Dm(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Zo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?sf.Range:sf.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return VP(this)}}function Dm(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Zo)?e.start:e.start+e.duration}function qb(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Pm(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function VP(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ko(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class GP{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(w.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(w.LEVEL_LOADED,o),i.once(w.AUDIO_TRACK_LOADED,o),i.once(w.SUBTITLE_TRACK_LOADED,o),i.on(w.MEDIA_ATTACHING,(u,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(w.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,i.trigger(w.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=qb(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=st.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=st.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ko(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const bE=.033;class KP extends Xn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&(t<u+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),u=Object.keys(s),d=i?i.filter(c=>!u.includes(c.identifier)):[];o.length&&o.sort((c,h)=>{const m=c.cue.pre,g=c.cue.post,y=h.cue.pre,v=h.cue.post;if(m&&!y)return-1;if(y&&!m||g&&!v)return 1;if(v&&!g)return-1;if(!m&&!y&&!g&&!v){const E=c.startTime,S=h.startTime;if(E!==S)return E-S}return c.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=o,d.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(r||t.length||(i==null?void 0:i.length)!==o.length||o.some((d,c)=>Math.abs(d.playout.start-i[c].playout.start)>.005||Math.abs(d.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const u=i[o],d=e[u];if(d.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(d):(c=new jP(d,t),this.eventMap[u]=c,r===!1&&(c.appendInPlace=r)),s.push(c)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,c=0;if(e.forEach((h,m)=>{const g=h.cue.pre,y=h.cue.post,v=e[m-1]||null,E=h.appendInPlace,S=y?i:h.startOffset,A=h.duration,I=h.timelineOccupancy===sf.Range?A:0,R=h.resumptionOffset,k=(v==null?void 0:v.startTime)===S,C=S+h.cumulativeDuration;let V=E?C+A:S+R;if(g||!y&&S<=0){const N=c;c+=I,h.timelineStart=C;const F=o;o+=A,r.push({event:h,start:C,end:V,playout:{start:F,end:o},integrated:{start:N,end:c}})}else if(S<=i){if(!k){const O=S-d;if(O>bE){const q=d,H=c;c+=O;const ie=o;o+=O;const oe={previousEvent:e[m-1]||null,nextEvent:h,start:q,end:q+O,playout:{start:ie,end:o},integrated:{start:H,end:c}};r.push(oe)}else O>0&&v&&(v.cumulativeDuration+=O,r[r.length-1].end=S)}y&&(V=C),h.timelineStart=C;const N=c;c+=I;const F=o;o+=A,r.push({event:h,start:C,end:V,playout:{start:F,end:o},integrated:{start:N,end:c}})}else return;const _=h.resumeTime;y||_>i?d=i:d=_}),d<i){var u;const h=d,m=c,g=i-d;c+=g;const y=o;o+=g,r.push({previousEvent:((u=r[r.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:h+g,playout:{start:y,end:o},integrated:{start:m,end:c}})}this.setDurations(i,o,c)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((u,d)=>{const c=u.cue.pre,h=u.cue.post,m=c?0:h?s:u.startTime;this.updateAssetDurations(u),o===m?u.cumulativeDuration=i:(i=0,o=m),!h&&u.snapOptions.in&&(u.resumeAnchor=to(null,r.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<bE&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const y=Re(u.resumeOffset)?u.resumeOffset:u.duration;i+=y})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>Zo?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const u=t[o].details,d=u.edge;if(r>=d)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${d}`),!1;const c=to(null,u.fragments,r);if(!c)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const h=o==="audio"?.175:0;return Math.abs(c.start-r)<Zo+h||Math.abs(c.end-r)<Zo+h?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const u=e.assetList[o],d=t+r;u.startOffset=r,u.timelineStart=d,s||(s=u.duration===null),i||(i=!!u.error);const c=u.error?0:u.duration||0;r+=c}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function os(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class HP{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=qb(r,this.hls.sessionId,e.baseUrl)}catch(g){const y=this.assignAssetListError(e,X.ASSET_LIST_LOAD_ERROR,g,r);this.hls.trigger(w.ERROR,y);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,u=new o(i),d={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,y,v,E)=>{const S=g.data,A=S==null?void 0:S.ASSETS;if(!Array.isArray(A)){const I=this.assignAssetListError(e,X.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,E);this.hls.trigger(w.ERROR,I);return}e.assetListResponse=S,this.hls.trigger(w.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:E})},onError:(g,y,v,E)=>{const S=this.assignAssetListError(e,X.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${g.code} ${g.text} (${y.url})`),y.url,E,v);this.hls.trigger(w.ERROR,S)},onTimeout:(g,y,v)=>{const E=this.assignAssetListError(e,X.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,g,v);this.hls.trigger(w.ERROR,E)}};return u.load(d,h,m),this.hls.trigger(w.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:Ve.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function wE(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function xd(n,e){return`[${n}] Advancing timeline position to ${e}`}class zP extends Xn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<u.start||r>=u.end){var d;const y=this.findItemIndex(u);let v=this.schedule.findItemIndexAtTime(r);if(v===-1&&(v=y+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${y} to ${v})`)),!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!o&&v>y){const E=this.schedule.findJumpRestrictedIndex(y+1,v);if(E>y){this.setSchedulePosition(E);return}}this.setSchedulePosition(v);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const y=u.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,y))}return}const h=c.timelineStart,m=c.duration||0;if(o&&r<h||r>=h+m){var g;(g=u.event)!=null&&g.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,c)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const u=this.findItemIndex(s);this.setSchedulePosition(u+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,u=i.events||[],d=i.items||[],c=i.durations,h=r.map(E=>E.identifier),m=!!(u.length||h.length);(m||s)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(E=>os(E))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let g=null,y=null;o&&(g=this.updateItem(o,this.timelinePos),this.itemsMatch(o,g)?this.playingItem=g:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),r.forEach(E=>{E.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const S=E.assetItem.timelineStart,A=E.timelineOffset-S;if(A)try{E.timelineOffset=S}catch(I){Math.abs(A)>Zo&&this.warn(`${I} ("${E.assetId}" ${E.timelineOffset}->${S})`)}}}),m||s){if(this.hls.trigger(w.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:c,removedIds:h}),this.isInterstitial(o)&&h.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(g,o),v&&y!==g&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new HP(e),this.schedule=new KP(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(w.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(w.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(w.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(w.MEDIA_ENDED,this.onMediaEnded,this),e.on(w.ERROR,this.onError,this),e.on(w.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(w.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(w.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(w.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(w.MEDIA_ENDED,this.onMediaEnded,this),e.off(w.ERROR,this.onError,this),e.off(w.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){In(e,"play",this.onPlay),In(e,"pause",this.onPause),In(e,"seeking",this.onSeeking),In(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;un(r,"seeking",this.onSeeking),un(r,"timeupdate",this.onTimeupdate),un(r,"play",this.onPlay),un(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=m=>m&&e.getAssetPlayer(m.identifier),s=(m,g,y,v,E)=>{if(m){let S=m[g].start;const A=m.event;if(A){if(g==="playout"||A.timelineOccupancy!==sf.Point){const I=r(y);(I==null?void 0:I.interstitial)===A&&(S+=I.assetItem.startOffset+I[E])}}else{const I=v==="bufferedPos"?o():e[v];S+=I-m.start}return S}return 0},i=(m,g)=>{var y;if(m!==0&&g!=="primary"&&(y=e.schedule)!=null&&y.length){var v;const E=e.schedule.findItemIndexAtTime(m),S=(v=e.schedule.items)==null?void 0:v[E];if(S){const A=S[g].start-S.start;return m+A}}return m},o=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var g,y;return(g=e.primaryDetails)!=null&&g.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[m])||0},d=(m,g)=>{var y,v;const E=e.effectivePlayingItem;if(E!=null&&(y=E.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${g}"`);const S=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(m,g),I=(v=e.schedule.items)==null?void 0:v[A],R=e.getBufferingPlayer(),k=R==null?void 0:R.interstitial,C=k==null?void 0:k.appendInPlace,V=S&&e.itemsMatch(S,I);if(S&&(C||V)){const _=r(e.playingAsset),N=(_==null?void 0:_.media)||e.primaryMedia;if(N){const F=g==="primary"?N.currentTime:s(S,g,e.playingAsset,"timelinePos","currentTime"),O=m-F,q=(C?F:N.currentTime)+O;if(q>=0&&(!_||C||q<=_.duration)){N.currentTime=q;return}}}if(I){let _=m;if(g!=="primary"){const F=I[g].start,O=m-F;_=I.start+O}const N=!e.isInterstitial(I);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(N||I.event.appendInPlace)){const F=e.media||(C?R==null?void 0:R.media:null);F&&(F.currentTime=_)}else if(S){const F=e.findItemIndex(S);if(A>F){const q=e.schedule.findJumpRestrictedIndex(F+1,A);if(q>F){e.setSchedulePosition(q);return}}let O=0;if(N)e.timelinePos=_,e.checkBuffer();else{const q=I.event.assetList,H=m-(I[g]||I).start;for(let ie=q.length;ie--;){const oe=q[ie];if(oe.duration&&H>=oe.startOffset&&H<oe.startOffset+oe.duration){O=ie;break}}}e.setSchedulePosition(A,O)}}},c=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const g=t();return e.isInterstitial(g)?g:null},h={get bufferedEnd(){const m=t(),g=e.bufferingItem;if(g&&g===m){var y;return s(g,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const m=c(),g=e.effectivePlayingItem;return g&&g===m?s(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(m){const g=c(),y=e.effectivePlayingItem;y&&y===g&&d(m+y.playout.start,"playout")},get duration(){const m=c();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const g=(m=c())==null?void 0:m.event.assetList;return g?g.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var m;const g=(m=c())==null?void 0:m.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return c()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return o()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){d(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){d(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return i(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,g=m==null?void 0:m.event;if(g&&!g.restrictions.skip){const y=e.findItemIndex(m);if(g.appendInPlace){const v=m.playout.start+m.event.duration;d(v+.001,"playout")}else e.advanceAfterAssetEnded(g,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!Re(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Kt(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,u=e!==o,d=u&&e.interstitial.appendInPlace,c=(r=this.detachedData)==null?void 0:r.mediaSource;let h;if(o.media)d&&(i=o.transferMedia(),this.detachedData=i),h="Primary";else if(c){const v=this.getBufferingPlayer();v?(i=v.transferMedia(),h=`${v}`):h="detached MediaSource"}else h="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${Kt(i)}`);else if(!this.detachedData||o.media===t){const v=this.playerQueue;v.length>1&&v.forEach(E=>{if(u&&E.interstitial.appendInPlace!==d){const S=E.interstitial;this.clearInterstitial(E.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",g=m&&i?i:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(g===i&&y){const v=u&&e.assetId===y.assetIdAtEnd;g.overrides={duration:y.duration,endOfStream:!u||v,cueRemoval:!u}}e.attachMedia(g)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(xd("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=Pm(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const u=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,r){const s=Pm(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,u=i.length;if(o>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(xd("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),u=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,u-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&os(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(o)){const h=o.event,m=this.playingAsset,g=m==null?void 0:m.identifier,y=g?this.getAssetPlayer(g):null;if(y&&g&&(!this.eventItemsMatch(o,i)||t!==void 0&&g!==h.assetList[t].identifier)){var d;const v=h.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${h.assetList.length} ${Ko(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(w.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:v,event:h,schedule:s.slice(0),scheduleIndex:e,player:y}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(g,i),y.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${os(o)}`),h.hasPlayed=!0,this.hls.trigger(w.INTERSTITIAL_ENDED,{event:h,schedule:s.slice(0),scheduleIndex:e}),h.cue.once)){var c;this.updateSchedule();const v=(c=this.schedule)==null?void 0:c.items;if(i&&v){const E=this.findItemIndex(i);this.advanceSchedule(E,v,t,o,u)}return}}this.advanceSchedule(e,s,t,o,u)}advanceSchedule(e,t,r,s,i){const o=this.schedule;if(!o)return;const u=t[e]||null,d=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{const m=h.interstitial,g=o.findEventIndex(m.identifier);(g<e||g>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const h=u.event;if(r===void 0){r=o.findAssetIndex(h,this.timelinePos);const v=Pm(h,r-1);if(h.isAssetPastPlayoutLimit(v)||h.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(h,e,r);return}r=v}const m=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);let g=this.preloadAssets(h,r);if(this.eventItemsMatch(u,m||s)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${os(u)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(w.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const y=h.assetList[r];if(!y){this.advanceAfterAssetEnded(h,e,r||0);return}if(g||(g=this.getAssetPlayer(y.identifier)),g===null||g.destroyed){const v=h.assetList.length;this.warn(`asset ${r+1}/${v} player destroyed ${h}`),g=this.createAssetPlayer(h,y,r),g.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(g,r,t,e,d),this.shouldPlay&&wE(g.media)}else u?(this.resumePrimary(u,e,s),this.shouldPlay&&wE(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${os(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(xd("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${os(e)}`),this.hls.trigger(w.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:st.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(xd("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(w.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(w.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=Ft(Ft({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ft(Ft({},this.altSelection),{},{audio:r});return}const i=Ft(Ft({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ft(Ft({},this.altSelection),{},{subtitles:r});return}const i=Ft(Ft({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=Px(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=Px(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),u=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=st.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${os(e)} (was ${os(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=st.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let d=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const h=this.findItemIndex(i),m=Math.min(h+1,t.length-1),g=t[m];if((d===-1&&i&&e>=i.end||(c=g.event)!=null&&c.appendInPlace&&e+.01>=g.start)&&(d=m),this.isInterstitial(i)){const y=i.event;if(m-u>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,d>h&&d>u)this.bufferedToItem(g);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&g.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(d===u?this.bufferedToItem(o):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${os(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,m)=>{const g=this.getAssetPlayer(h.identifier);g&&(m===c&&g.loadSource(),g.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(w.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const d=e.timelineStart;if(e.appendInPlace){var u;const g=this.playingItem;!this.isInterstitial(g)&&(g==null||(u=g.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let c,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const g=h-d;g>0&&(c=Math.round(g*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${c?` live-start: ${h} start-offset: ${c}`:""}`),r)return this.createAsset(e,0,0,d,e.duration,r);const m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!o&&s){for(let c=t;c<s;c++){const h=e.assetList[c],m=this.getAssetPlayerQueueIndex(h.identifier);(m===-1||this.playerQueue[m].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}const d=e.assetList[t];if(d){const c=this.getAssetPlayer(d.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const u={parentIdentifier:e.identifier,identifier:$P(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const u=s.loadLevelObj||s.levels[s.currentLevel];(o||u)&&(o=$t({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const d=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const k=this.timelinePos-t.timelineStart;if(k>1){const C=t.duration;C&&k<C&&(h=k)}}const m=t.identifier,g=Ft(Ft({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:d||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(g.timelineOffset=t.timelineStart));const y=g.cmcd;y!=null&&y.sessionId&&y.contentId&&(g.cmcd=$t({},y,{contentId:Au(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const v=new GP(this.HlsPlayerClass,g,e,t);this.playerQueue.push(v),e.assetList[r]=t;let E=!0;const S=k=>{if(k.live){var C;const N=new Error(`Interstitials MUST be VOD assets ${e}`),F={fatal:!0,type:Ve.OTHER_ERROR,details:X.INTERSTITIAL_ASSET_ITEM_ERROR,error:N},O=((C=this.schedule)==null?void 0:C.findEventIndex(e.identifier))||-1;this.handleAssetItemError(F,e,O,r,N.message);return}const V=k.edge-k.fragmentStart,_=t.duration;(E||_===null||V>_)&&(E=!1,this.log(`Interstitial asset "${m}" duration change ${_} > ${V}`),t.duration=V,this.updateSchedule())};v.on(w.LEVEL_UPDATED,(k,{details:C})=>S(C)),v.on(w.LEVEL_PTS_UPDATED,(k,{details:C})=>S(C)),v.on(w.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(k,C)=>{const V=this.getAssetPlayer(m);if(V&&C.tracks){V.off(w.BUFFER_CODECS,A),V.tracks=C.tracks;const _=this.primaryMedia;this.bufferingAsset===V.assetItem&&_&&!V.media&&this.bufferAssetPlayer(V,_)}};v.on(w.BUFFER_CODECS,A);const I=()=>{var k;const C=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${C}`),!C||!this.schedule)return;const V=this.schedule.findEventIndex(e.identifier),_=(k=this.schedule.items)==null?void 0:k[V];this.isInterstitial(_)&&this.advanceAssetBuffering(_,t)};v.on(w.BUFFERED_TO_END,I);const R=k=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const V=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,V,k)};return v.once(w.MEDIA_ENDED,R(r)),v.once(w.PLAYOUT_LIMIT_REACHED,R(1/0)),v.on(w.ERROR,(k,C)=>{if(!this.schedule)return;const V=this.getAssetPlayer(m);if(C.details===X.BUFFER_STALLED_ERROR){if(V!=null&&V.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${C.error} ${e}`)}),v.on(w.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const C=new Error(`Asset player destroyed unexpectedly ${m}`),V={fatal:!0,type:Ve.OTHER_ERROR,details:X.INTERSTITIAL_ASSET_ITEM_ERROR,error:C};this.handleAssetItemError(V,e,this.schedule.findEventIndex(e.identifier),r,C.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ko(t)}`),this.hls.trigger(w.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&os(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:u,assetId:d}=e,c=o.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!h||h.identifier!==d)&&(h&&(this.clearAssetPlayer(h.identifier,r[s]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Ko(u)}`),this.hls.trigger(w.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,u=this.schedule.findEventIndex(i.identifier),d=(r=this.schedule.items)==null?void 0:r[u];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const h=i.appendInPlace;if(h&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const m=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(h&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!CT(m,e.tracks)){const g=new Error(`Asset ${Ko(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),y={fatal:!0,type:Ve.OTHER_ERROR,details:X.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},v=i.findAssetIndex(o);this.handleAssetItemError(y,i,u,v,g.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const u=this.getAssetPlayer(o.identifier);if(u){const d=u.currentTime||s-o.timelineStart,c=u.duration-d;if(this.warn(`Stalled at ${d} of ${d+c} in ${u} ${e} (media.currentTime: ${s})`),d&&(c/r.playbackRate<.5||u.bufferedInPlaceToEnd(r))&&u.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===X.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ko(o)} ${e.error}`),!this.schedule)return;const u=(o==null?void 0:o.identifier)||"",d=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[d]||null,h=this.schedule.items,m=$t({},e,{fatal:!1,errorAction:qo(!0),asset:o,assetListIndex:s,event:t,schedule:h,scheduleIndex:r,player:c});if(this.hls.trigger(w.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const g=this.playingAsset,y=this.bufferingAsset,v=new Error(i);if(o&&(this.clearAssetPlayer(u,null),o.error=v),!t.assetList.some(E=>!E.error))t.error=v;else for(let E=s;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):g&&g.identifier===u?this.advanceAfterAssetEnded(t,r,s):y&&y.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${os(r)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(r,s);this.itemsMatch(r,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,s;const i=t.event,o=i.identifier,u=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const d=i.timelineStart,c=i.duration;let h=0;u.forEach((E,S)=>{const A=parseFloat(E.DURATION);this.createAsset(i,S,h,d+h,A,E.URI),h+=A}),i.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${i}`);const m=this.waitingItem,g=(m==null?void 0:m.event.identifier)===o;this.updateSchedule();const y=(s=this.bufferingItem)==null?void 0:s.event;if(g){var v;const E=this.schedule.findEventIndex(o),S=(v=this.schedule.items)==null?void 0:v[E];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){i.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(S)}this.setSchedulePosition(E)}else if((y==null?void 0:y.identifier)===o){const E=i.assetList[0];if(E){const S=this.getAssetPlayer(E.identifier);if(y.appendInPlace){const A=this.primaryMedia;S&&A&&this.bufferAssetPlayer(S,A)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case X.ASSET_LIST_PARSING_ERROR:case X.ASSET_LIST_LOAD_ERROR:case X.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case X.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const AE=500;class WP extends Lg{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",De.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=le.IDLE,this.setInterval(AE),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(pr(r)&&(this.fragPrevious=r),this.state=le.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const u=r.start;for(let c=0;c<i.length;c++)if(u>=i[c].start&&u<=i[c].end){o=i[c];break}const d=r.start+r.duration;o?o.end=d:(o={start:u,end:d},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=i){o.shift();continue}else if(o[u].start<i)o[u].start=i;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(r,i,De.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===De.SUBTITLE&&(t.details===X.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==le.STOPPED&&(this.state=le.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Ob(this.levels,t)){this.levels=t.map(r=>new Fu(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Fu(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,De.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==le.STOPPED&&this.setInterval(AE)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:u}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=i[u];if(u>=i.length||!d)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(r=d.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const g=m.fragments[0];if(!d.details)o.hasProgramDateTime&&m.hasProgramDateTime?(rf(o,m),c=o.fragmentStart):g&&(c=g.start,_p(o,c));else{var h;c=this.alignPlaylists(o,d.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&g&&(c=g.start,_p(o,c))}m&&!this.startFragRequested&&this.setStartPosition(m,c)}d.details=o,this.levelLastLoaded=d,u===s&&(this.hls.trigger(w.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===le.IDLE&&(to(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&Qo(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,Ig(s.method)).catch(u=>{throw i.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();i.trigger(w.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=le.IDLE})}}doTick(){if(!this.media){this.state=le.IDLE;return}if(this.state===le.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=st.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:u,len:d}=o,c=r.details,h=this.hls.maxBufferLength+c.levelTargetDuration;if(d>h)return;const m=c.fragments,g=m.length,y=c.edge;let v=null;const E=this.fragPrevious;if(u<y){const I=s.maxFragLookUpTolerance,R=u>y-I?0:I;v=to(E,m,Math.max(m[0].start,u),R),!v&&E&&E.start<m[0].start&&(v=m[0])}else v=m[g-1];if(v=this.filterReplacedPrimary(v,r.details),!v)return;const S=v.sn-c.startSN,A=m[S-1];if(A&&A.cc===v.cc&&this.fragmentTracker.getState(A)===_r.NOT_LOADED&&(v=A),this.fragmentTracker.getState(v)===_r.NOT_LOADED){const I=this.mapToInitFragWhenRequired(v);I&&this.loadFragment(I,r,u)}}}loadFragment(e,t,r){pr(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new YP(this.tracksBuffered[this.currentTrackId]||[])}}class YP{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const qP={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Qb=n=>String.fromCharCode(qP[n]||n),us=15,ti=100,QP={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},XP={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ZP={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},JP={25:2,26:4,29:6,30:8,31:10,27:13,28:15},eO=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class tO{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Bt.log(`${this.time} [${e}] ${r}`)}}}const Pa=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class Xb{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class rO{constructor(){this.uchar=" ",this.penState=new Xb}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class nO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Xb,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ti;t++)this.chars.push(new rO);this.logger=e}equals(e){for(let t=0;t<ti;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ti;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ti;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ti&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ti)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Qb(e);if(this.pos>=ti){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ti;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<ti;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Om{constructor(e){this.rows=[],this.currRow=us-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<us;t++)this.rows.push(new nO(e));this.logger=e}reset(){for(let e=0;e<us;e++)this.rows[e].clear();this.currRow=us-1}equals(e){let t=!0;for(let r=0;r<us;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<us;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<us;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Kt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<us;u++)this.rows[u].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[i].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Kt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<us;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class IE{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Om(r),this.nonDisplayedMemory=new Om(r),this.lastOutputScreen=new Om(r),this.currRollUpRow=this.displayedMemory.rows[us-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[us-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+Kt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class RE{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=iO(),this.logger=void 0;const s=this.logger=new tO;this.channels=[null,new IE(e,t,s),new IE(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,u=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Pa([t[r],t[r+1]])+"] -> ("+Pa([s,i])+")");const d=this.cmdHistory;if(s>=16&&s<=31){if(sO(s,i,d)){Ed(null,null,d),this.logger.log(3,()=>"Repeated command ("+Pa([s,i])+") is dropped");continue}Ed(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Ed(null,null,d);if(!o&&(u=this.parseChars(s,i),u)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Pa([s,i])+" orig: "+Pa([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Pa([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?QP[e]:ZP[e]:r=o===1?XP[e]:JP[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Qb(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Pa(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=eO[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ed(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ed(n,e,t){t.a=n,t.b=e}function sO(n,e,t){return t.a===n&&t.b===e}function iO(){return{a:null,b:null}}var $g=(function(){if(tf!=null&&tf.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const c=d.toLowerCase();return~u.indexOf(c)?c:!1}function r(u){return t(n,u)}function s(u){return t(e,u)}function i(u,...d){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const m in h)u[m]=h[m]}return u}function o(u,d,c){const h=this,m={enumerable:!0};h.hasBeenReset=!1;let g="",y=!1,v=u,E=d,S=c,A=null,I="",R=!0,k="auto",C="start",V=50,_="middle",N=50,F="middle";Object.defineProperty(h,"id",i({},m,{get:function(){return g},set:function(O){g=""+O}})),Object.defineProperty(h,"pauseOnExit",i({},m,{get:function(){return y},set:function(O){y=!!O}})),Object.defineProperty(h,"startTime",i({},m,{get:function(){return v},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");v=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",i({},m,{get:function(){return E},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");E=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",i({},m,{get:function(){return S},set:function(O){S=""+O,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",i({},m,{get:function(){return A},set:function(O){A=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",i({},m,{get:function(){return I},set:function(O){const q=r(O);if(q===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=q,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",i({},m,{get:function(){return R},set:function(O){R=!!O,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",i({},m,{get:function(){return k},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");k=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",i({},m,{get:function(){return C},set:function(O){const q=s(O);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");C=q,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",i({},m,{get:function(){return V},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");V=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",i({},m,{get:function(){return _},set:function(O){const q=s(O);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");_=q,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",i({},m,{get:function(){return N},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");N=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",i({},m,{get:function(){return F},set:function(O){const q=s(O);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");F=q,this.hasBeenReset=!0}})),h.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class aO{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Zb(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class oO{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Jb(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const u=o[0],d=o[1];e(u,d)}}const Fp=new $g(0,0,""),Sd=Fp.align==="middle"?"middle":"center";function lO(n,e,t){const r=n;function s(){const u=Zb(n);if(u===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),u}function i(u,d){const c=new oO;Jb(u,function(g,y){let v;switch(g){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===y){c.set(g,t[E].region);break}break;case"vertical":c.alt(g,y,["rl","lr"]);break;case"line":v=y.split(","),c.integer(g,v[0]),c.percent(g,v[0])&&c.set("snapToLines",!1),c.alt(g,v[0],["auto"]),v.length===2&&c.alt("lineAlign",v[1],["start",Sd,"end"]);break;case"position":v=y.split(","),c.percent(g,v[0]),v.length===2&&c.alt("positionAlign",v[1],["start",Sd,"end","line-left","line-right","auto"]);break;case"size":c.percent(g,y);break;case"align":c.alt(g,y,["start",Sd,"end","left","right"]);break}},/:/,/\s/),d.region=c.get("region",null),d.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&Fp.line===-1&&(h=-1),d.line=h,d.lineAlign=c.get("lineAlign","start"),d.snapToLines=c.get("snapToLines",!0),d.size=c.get("size",100),d.align=c.get("align",Sd);let m=c.get("position","auto");m==="auto"&&Fp.position===50&&(m=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=m}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function ew(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class uO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new aO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=ew(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const u=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),u}function s(i){Jb(i,function(o,u){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const u=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new $g(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{lO(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=i.indexOf("-->")!==-1;if(!i||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const cO=/\r\n|\n\r|\n|\r/g,Nm=function(e,t,r=0){return e.slice(r,r+t.length)===t},dO=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Re(t)||!Re(r)||!Re(s)||!Re(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=3600*1e3*i,t};function jg(n,e,t){return Au(n.toString())+Au(e.toString())+Au(t)}const fO=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function hO(n,e,t,r,s,i,o){const u=new uO,d=Un(new Uint8Array(n)).trim().replace(cO,`
`).split(`
`),c=[],h=e?xD(e.baseTime,e.timescale):0;let m="00:00.000",g=0,y=0,v,E=!0;u.oncue=function(S){const A=t[r];let I=t.ccOffset;const R=(g-h)/9e4;if(A!=null&&A.new&&(y!==void 0?I=t.ccOffset=A.start:fO(t,r,R)),R){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}I=R-t.presentationOffset}const k=S.endTime-S.startTime,C=On((S.startTime+I-y)*9e4,s*9e4)/9e4;S.startTime=Math.max(C,0),S.endTime=Math.max(C+k,0);const V=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(V)),S.id||(S.id=jg(S.startTime,S.endTime,V)),S.endTime>0&&c.push(S)},u.onparsingerror=function(S){v=S},u.onflush=function(){if(v){o(v);return}i(c)},d.forEach(S=>{if(E)if(Nm(S,"X-TIMESTAMP-MAP=")){E=!1,S.slice(16).split(",").forEach(A=>{Nm(A,"LOCAL:")?m=A.slice(6):Nm(A,"MPEGTS:")&&(g=parseInt(A.slice(7)))});try{y=dO(m)/1e3}catch(A){v=A}return}else S===""&&(E=!1);u.parse(S+`
`)}),u.flush()}const Mm="stpp.ttml.im1t",tw=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,rw=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,mO={left:"start",center:"center",right:"end",start:"start",end:"end"};function LE(n,e,t,r){const s=dt(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(u=>Un(u)),o=vD(e.baseTime,1,e.timescale);try{i.forEach(u=>t(pO(u,o)))}catch(u){r(u)}}function pO(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((m,g)=>(m[g]=s.getAttribute(`ttp:${g}`)||i[g],m),{}),u=s.getAttribute("xml:space")!=="preserve",d=_E(Fm(s,"styling","style")),c=_E(Fm(s,"layout","region")),h=Fm(s,"body","[begin]");return[].map.call(h,m=>{const g=nw(m,u);if(!g||!m.hasAttribute("begin"))return null;const y=Bm(m.getAttribute("begin"),o),v=Bm(m.getAttribute("dur"),o);let E=Bm(m.getAttribute("end"),o);if(y===null)throw kE(m);if(E===null){if(v===null)throw kE(m);E=y+v}const S=new $g(y-e,E-e,g);S.id=jg(S.startTime,S.endTime,S.text);const A=c[m.getAttribute("region")],I=d[m.getAttribute("style")],R=gO(A,I,d),{textAlign:k}=R;if(k){const C=mO[k];C&&(S.lineAlign=C),S.align=k}return $t(S,R),S}).filter(m=>m!==null)}function Fm(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function _E(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function nw(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?nw(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function gO(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((u,d)=>{const c=Um(e,r,d)||Um(n,r,d)||Um(s,r,d);return c&&(u[d]=c),u},{})}function Um(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function kE(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Bm(n,e){if(!n)return null;let t=Zb(n);return t===null&&(tw.test(n)?t=yO(n,e):rw.test(n)&&(t=vO(n,e))),t}function yO(n,e){const t=tw.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function vO(n,e){const t=rw.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Td{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class xO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=DE(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Td(this,"textTrack1"),t=new Td(this,"textTrack2"),r=new Td(this,"textTrack3"),s=new Td(this,"textTrack4");this.cea608Parser1=new RE(1,e,t),this.cea608Parser2=new RE(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let u=i.length;u--;){const d=i[u],c=EO(d[0],d[1],t,r);if(c>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),o=!0,c/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,r,s)}else{const u=this.Cues.newCue(null,t,r,s);this.hls.trigger(w.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:u}=this;r===De.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),u.length&&(this.unparsedVttFrags=[],u.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(w.FRAG_LOADED,d):this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(CE(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],u=this.getExistingTrack(i,o);if(u)r[e]=u,Wo(r[e]),Wb(r[e],s);else{const d=this.createTextTrack("captions",i,o);d&&(d[e]=!0,r[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Wo(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=DE(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Wo(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Mm);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Ob(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,u=o?Bd(o.textTracks):null;if(this.tracks.forEach((d,c)=>{let h;if(u){let m=null;for(let g=0;g<u.length;g++)if(u[g]&&CE(u[g],d)){m=u[g],u[g]=null;break}m&&(h=m)}if(h)Wo(h);else{const m=sw(d);h=this.createTextTrack(m,d.name,d.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),u!=null&&u.length){const d=u.filter(c=>c!==null).map(c=>c.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===De.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:u}=this,{cc:d,sn:c}=t.frag,h=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(c!==u+1||c===u&&h!==this.lastPartIndex+1||d!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=d,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===De.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const u=this.tracks[r.level],d=this.vttCCs;d[r.cc]||(d[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===Mm?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;LE(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,u=i.length-1;if(!i[r.cc]&&u===-1){o.push(e);return}const d=this.hls,c=(t=r.initSegment)!=null&&t.data?Qn(r.initSegment.data,new Uint8Array(s)).buffer:s;hO(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,h=>{this._appendCues(h,r.level),d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},h=>{const m=h.message==="Missing initPTS for VTT MPEGTS";m?o.push(e):this._fallbackToIMSC1(r,s),d.logger.log(`Failed to parse VTT cue: ${h}`),!(m&&u>r.cc)&&d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:h})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||LE(t,this.initPTS[e.cc],()=>{r.textCodec=Mm,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>Yb(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(w.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===De.SUBTITLE&&this.onFragLoaded(w.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===De.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,u[0]),this.cea608Parser2.addData(s[i].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>Mp(u[d],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>Mp(u[d],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],u=127&e[s++],d=127&e[s++];if(u===0&&d===0)continue;if((4&o)!==0){const h=3&o;(h===0||h===1)&&(t[h].push(u),t[h].push(d))}}return t}}function sw(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function CE(n,e){return!!n&&n.kind===sw(e)&&Dp(e,n)}function EO(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function DE(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const SO=/\s/,TO={newCue(n,e,t,r){const s=[];let i,o,u,d,c;const h=self.VTTCue||self.TextTrackCue;for(let g=0;g<r.rows.length;g++)if(i=r.rows[g],u=!0,d=0,c="",!i.isEmpty()){var m;for(let E=0;E<i.chars.length;E++)SO.test(i.chars[E].uchar)&&u?d++:(c+=i.chars[E].uchar,u=!1);i.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const y=ew(c.trim()),v=jg(e,t,y);n!=null&&(m=n.cues)!=null&&m.getCueById(v)||(o=new h(e,t,y),o.id=v,o.line=g+1,o.align="left",o.position=10+Math.min(80,Math.floor(d*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((g,y)=>g.line==="auto"||y.line==="auto"?0:g.line>8&&y.line>8?y.line-g.line:g.line-y.line),s.forEach(g=>Yb(n,g))),s}};function bO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const wO=/(\d+)-(\d+)\/(\d+)/;class PE{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||LO,this.controller=new self.AbortController,this.stats=new xg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=AO(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=d&&Re(d)?d:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),($u(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var g;this.response=this.loader=m;const y=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(y-s.loading.start)),!m.ok){const{status:E,statusText:S}=m;throw new _O(S||"fetch, bad network response",E,m)}s.loading.first=y,s.total=RO(m.headers)||s.total;const v=(g=this.callbacks)==null?void 0:g.onProgress;return v&&Re(t.highWaterMark)?this.loadProgressively(m,s,e,t.highWaterMark,v):o?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var g,y;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=m[u];E&&(s.loaded=s.total=E);const S={url:v.url,data:m,code:v.status},A=(g=this.callbacks)==null?void 0:g.onProgress;A&&!Re(t.highWaterMark)&&A(s,e,m,v),(y=this.callbacks)==null||y.onSuccess(S,s,e,v)}).catch(m=>{var g;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const y=m&&m.code||0,v=m?m.message:null;(g=this.callbacks)==null||g.onError({code:y,text:v},e,m?m.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new mb,u=e.body.getReader(),d=()=>u.read().then(c=>{if(c.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=c.value,m=h.length;return t.loaded+=m,m<s||o.dataLength?(o.push(h),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,h.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function AO(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers($t({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function IO(n){const e=wO.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function RO(n){const e=n.get("Content-Range");if(e){const r=IO(e);if(Re(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function LO(n,e){return new self.Request(n.url,e)}class _O extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const kO=/^age:\s*[\d.]+\s*$/im;class iw{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const u in s)e.setRequestHeader(u,s[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&Re(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,h=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const v=h??t.response;if(v!=null){var o,u;r.loading.end=Math.max(self.performance.now(),r.loading.first);const E=t.responseType==="arraybuffer"?v.byteLength:v.length;r.loaded=r.total=E,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const S=(o=this.callbacks)==null?void 0:o.onProgress;S&&S(r,e,v,t);const A={url:t.responseURL,data:v,code:c};(u=this.callbacks)==null||u.onSuccess(A,r,e,t);return}}const m=i.loadPolicy.errorRetry,g=r.retry,y={url:e.url,data:void 0,code:c};if(Jd(m,g,!1,y))this.retry(m);else{var d;Bt.error(`${c} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:c,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Jd(e,t,!0))this.retry(e);else{var r;Bt.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=bg(e,r.retry),r.retry++,Bt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&kO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const CO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},DO=Ft(Ft({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:iw,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Kk,bufferController:OD,capLevelController:Fg,errorController:qk,fpsController:NP,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:nb,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:CO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},PO()),{},{subtitleStreamController:WP,subtitleTrackController:UP,timelineController:xO,audioStreamController:kD,audioTrackController:CD,emeController:Xo,cmcdController:CP,contentSteeringController:PP,interstitialsController:zP});function PO(){return{cueHandler:TO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function OO(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Up(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,d=e[u]===void 0,c=[];i.forEach(h=>{const m=`${o}Loading${h}`,g=e[m];if(g!==void 0&&d){c.push(m);const y=r[u].default;switch(e[u]={default:y},h){case"TimeOut":y.maxLoadTimeMs=g,y.maxTimeToFirstByteMs=g;break;case"MaxRetry":y.errorRetry.maxNumRetry=g,y.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":y.errorRetry.retryDelayMs=g,y.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=g,y.timeoutRetry.maxRetryDelayMs=g;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${Kt(e[u])}`)}),Ft(Ft({},r),e)}function Up(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Up):Object.keys(n).reduce((e,t)=>(e[t]=Up(n[t]),e),{}):n}function NO(n,e){const t=n.loader;t!==PE&&t!==iw?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):bO()&&(n.loader=PE,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const $d=2,MO=.1,FO=.05,UO=100;class BO extends ZT{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(UO),this.mediaSource=t.mediaSource;const r=this.media=t.media;un(r,"playing",this.onMediaPlaying),un(r,"waiting",this.onMediaWaiting),un(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(In(r,"playing",this.onMediaPlaying),In(r,"waiting",this.onMediaWaiting),In(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:u}=o,d=this.seeking&&!u,c=!this.seeking&&u,h=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||d){d&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!1}));return}if(!st.getBuffered(o).length){this.nudgeRetry=0;return}const m=st.bufferInfo(o,e,0),g=m.nextStart||0,y=this.fragmentTracker;if(u&&y&&this.hls){const V=OE(this.hls.inFlightFragments,e),_=m.len>$d,N=!g||V||g-e>$d&&!y.getPartialFragment(e);if(_||N)return;this.moved=!1}const v=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(m.len>0)&&!g)return;const _=Math.max(g,m.start||0)-e,F=!!(v!=null&&v.live)?v.targetduration*2:$d,O=bd(e,y);if(_>0&&(_<=F||O)){o.paused||this._trySkipBufferHole(O);return}}const E=i.detectStallWithCurrentTimeMs,S=self.performance.now(),A=this.waiting;let I=this.stalled;if(I===null)if(A>0&&S-A<E)I=this.stalled=A;else{this.stalled=S;return}const R=S-I;if(!u&&(R>=E||A)&&this.hls){var k;if(((k=this.mediaSource)==null?void 0:k.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-((v==null?void 0:v.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const C=st.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(C,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(w.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=st.bufferedInfo(st.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=st.timeRangesToArray(s),u=st.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const d=st.bufferedInfo(o,e,0).bufferedIndex,c=o[u].end,h=o[u+1].start;if((d===-1||d>u)&&h-c<1&&e-c<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${h} buffered index: ${d}`);this.warn(m.message),this.media.currentTime+=1e-6;let g=bd(e,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);const y=st.bufferInfo(this.media,e,0);this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:g,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:o,media:u}=this,d=(s=this.hls)==null?void 0:s.config;if(!u||!o||!d)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,h=bd(r,o);if((h||c!=null&&c.live&&r<c.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const m=e.buffered,g=this.adjacentTraversal(e,r);(m&&m.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-r<d.maxBufferHole||g))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,De.MAIN),o=r.getFragAtPos(s,De.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Kt(e)})`);this.warn(o.message),t.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,u=st.bufferInfo(s,o,0),d=o<u.start?u.start:u.nextStart;if(d&&this.hls){const h=u.len<=i.maxBufferHole,m=u.len>0&&u.len<1&&s.readyState<3,g=d-o;if(g>0&&(h||m)){if(g>i.maxBufferHole){let v=!1;if(o===0){const E=r.getAppendedFrag(0,De.MAIN);E&&d<E.end&&(v=!0)}if(!v&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||OE(this.hls.inFlightFragments,d))return 0;let S=!1,A=e.end;for(;A<d;){const I=bd(A,r);if(I)A+=I.duration;else{S=!0;break}}if(S)return 0}}const y=Math.max(d+FO,o+MO);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${y}`),this.moved=!0,s.currentTime=y,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${y}`),E={type:Ve.MEDIA_ERROR,details:X.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(w.ERROR,E)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const u=o+(s+1)*i.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(d.message),r.currentTime=u,t.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function OE(n,e){const t=NE(n.main);if(t&&t.start<=e)return t;const r=NE(n.audio);return r&&r.start<=e?r:null}function NE(n){if(!n)return null;switch(n.state){case le.IDLE:case le.STOPPED:case le.ENDED:case le.ERROR:return null}return n.frag}function bd(n,e){return e.getAppendedFrag(n,De.MAIN)||e.getPartialFragment(n)}const $O=.25;function Bp(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function $m(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,Kt(s?Ft({type:s},r):r))}return i}const wd=(()=>{const n=Bp();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class jO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(w.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Wo(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Wb(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Bp();if(o)for(let u=0;u<i.length;u++){const d=i[u].type;if(d===Mn.emsg&&!r||!s)continue;const c=Sb(i[u].data),h=i[u].pts;let m=h+i[u].duration;m>wd&&(m=wd),m-h<=0&&(m=h+$O);for(let y=0;y<c.length;y++){const v=c[y];if(!Tb(v)){this.updateId3CueEnds(h,d);const E=$m(o,h,m,v,d);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===wd&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=o;if(i&&(u||d)){let c;s==="audio"?c=h=>h.type===Mn.audioId3&&d:s==="video"?c=h=>h.type===Mn.emsg&&u:c=h=>h.type===Mn.audioId3&&d||h.type===Mn.emsg&&u,Mp(i,t,r,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const u=Bp();if(r&&s&&!o){const{fragmentStart:E,fragmentEnd:S}=e;let A=this.assetCue;A?(A.startTime=E,A.endTime=S):u&&(A=this.assetCue=$m(u,E,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:c}=e,h=Object.keys(c);let m=this.dateRangeCuesAppended;if(d&&t){var g;if((g=d.cues)!=null&&g.length){const E=Object.keys(m).filter(S=>!h.includes(S));for(let S=E.length;S--;){var y;const A=E[S],I=(y=m[A])==null?void 0:y.cues;delete m[A],I&&Object.keys(I).forEach(R=>{const k=I[R];if(k){k.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(k)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(h.length===0||!Re(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<h.length;E++){const S=h[E],A=c[S],I=A.startTime,R=m[S],k=(R==null?void 0:R.cues)||{};let C=(R==null?void 0:R.durationKnown)||!1,V=wd;const{duration:_,endDate:N}=A;if(N&&_!==null)V=I+_,C=!0;else if(A.endOnNext&&!C){const O=h.reduce((q,H)=>{if(H!==A.id){const ie=c[H];if(ie.class===A.class&&ie.startDate>A.startDate&&(!q||A.startDate<q.startDate))return ie}return q},null);O&&(V=O.startTime,C=!0)}const F=Object.keys(A.attr);for(let O=0;O<F.length;O++){const q=F[O];if(!lC(q))continue;const H=k[q];if(H)C&&!(R!=null&&R.durationKnown)?H.endTime=V:Math.abs(H.startTime-I)>.01&&(H.startTime=I,H.endTime=V);else if(u){let ie=A.attr[q];uC(q)&&(ie=DT(ie));const ce=$m(u,I,V,{key:q,data:ie},Mn.dateRange);ce&&(ce.id=S,this.id3Track.addCue(ce),k[q]=ce,o&&(q==="X-ASSET-LIST"||q==="X-ASSET-URL")&&ce.addEventListener("enter",this.onEventCueEnter))}}m[S]={cues:k,dateRange:A,durationKnown:C}}}}}class VO{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const u=this.targetLatency;if(u===null)return;const d=s-u,c=Math.min(this.maxLatency,u+r.targetduration);if(d<c&&d>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,o)),g=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,y=Math.min(m,Math.max(1,g));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let c=u&&r||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*s);const h=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,u=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===X.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class GO extends Mg{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let u=!1,d=!1,c=!1;t.levels.forEach(h=>{const m=h.attrs;let{audioCodec:g,videoCodec:y}=h;g&&(h.audioCodec=g=qd(g,r)||void 0),y&&(y=h.videoCodec=Ak(y));const{width:v,height:E,unknownCodecs:S}=h,A=(S==null?void 0:S.length)||0;if(u||(u=!!(v&&E)),d||(d=!!y),c||(c=!!g),A||g&&!this.isAudioSupported(g)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:I,"FRAME-RATE":R,"HDCP-LEVEL":k,"PATHWAY-ID":C,RESOLUTION:V,"VIDEO-RANGE":_}=m,F=`${`${C||"."}-`}${h.bitrate}-${V}-${R}-${I}-${_}-${k}`;if(i[F])if(i[F].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const O=o[F]+=1;h.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const q=this.createLevel(h);i[F]=q,s.push(q)}else i[F].addGroupId("audio",m.AUDIO),i[F].addGroupId("text",m.SUBTITLES);else{const O=this.createLevel(h);i[F]=O,o[F]=1,s.push(O)}}),this.filterAndSortMediaOptions(s,t,u,d,c)}createLevel(e){const t=new Fu(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=KT(s,[])}return t}isAudioSupported(e){return Nu(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Nu(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var o;let u=[],d=[],c=e;const h=((o=t.stats)==null?void 0:o.parsing)||{};if((r||s)&&i&&(c=c.filter(({videoCodec:I,videoRange:R,width:k,height:C})=>(!!I||!!(k&&C))&&Nk(R))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let I="no level with compatible codecs found in manifest",R=I;t.levels.length&&(R=`one or more CODECS in variant not supported: ${Kt(t.levels.map(C=>C.attrs.CODECS).filter((C,V,_)=>_.indexOf(C)===V))}`,this.warn(R),I+=` (${R})`);const k=new Error(I);this.hls.trigger(w.ERROR,{type:Ve.MEDIA_ERROR,details:X.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:k,reason:R})}}),h.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(I=>!I.audioCodec||this.isAudioSupported(I.audioCodec)),ME(u)),t.subtitles&&(d=t.subtitles,ME(d));const m=c.slice(0);c.sort((I,R)=>{if(I.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(I.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&I.height!==R.height)return I.height-R.height;if(I.frameRate!==R.frameRate)return I.frameRate-R.frameRate;if(I.videoRange!==R.videoRange)return Qd.indexOf(I.videoRange)-Qd.indexOf(R.videoRange);if(I.videoCodec!==R.videoCodec){const k=Rx(I.videoCodec),C=Rx(R.videoCodec);if(k!==C)return C-k}if(I.uri===R.uri&&I.codecSet!==R.codecSet){const k=Yd(I.codecSet),C=Yd(R.codecSet);if(k!==C)return C-k}return I.averageBitrate!==R.averageBitrate?I.averageBitrate-R.averageBitrate:0});let g=m[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==m.length)){for(let I=0;I<m.length;I++)if(m[I].pathwayId===c[0].pathwayId){g=m[I];break}}this._levels=c;for(let I=0;I<c.length;I++)if(c[I]===g){var y;this._firstLevel=I;const R=g.bitrate,k=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${R}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const C=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);C>k&&k===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=C)}break}const v=i&&!s,E=this.hls.config,S=!!(E.audioStreamController&&E.audioTrackController),A={levels:c,audioTracks:u,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:S&&!v&&u.some(I=>!!I.url)};h.end=performance.now(),this.hls.trigger(w.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:h,reason:h.message}),m)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${r}${i?" with Pathway "+i:""}`);const d={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(w.LEVEL_SWITCHING,d);const c=o.details;if(!c||c.live){const h=this.switchParams(o.uri,s==null?void 0:s.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===ht.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===De.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${s}`),(u=t.deliveryDirectives)!=null&&u.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let d=o.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(s,t,d)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,u=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(w.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(u=>u.level=-1)),!1));db(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(w.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(w.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function ME(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function aw(){return self.SourceBuffer||self.WebKitSourceBuffer}function ow(){if(!ua())return!1;const e=aw();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function KO(){if(!ow())return!1;const n=ua();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Mu(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Mu(e,"audio"))))}function HO(){var n;const e=aw();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const zO=100;class WO extends Lg{constructor(e,t,r){super(e,t,r,"stream-controller",De.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!Re(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,De.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(zO),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=le.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=le.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case le.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=le.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=le.IDLE;break}break}case le.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===le.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(w.BUFFER_EOS,E),this.state=le.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===le.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=le.WAITING_LEVEL,this.startFragRequested=!1;return}const h=u.len,m=this.getMaxBufferLength(o.maxBitrate);if(h>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const g=this.backtrackFragment?this.backtrackFragment.start:u.end;let y=this.getNextFragment(g,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&pr(y)&&this.fragmentTracker.getState(y)!==_r.OK){var v;const S=((v=this.backtrackFragment)!=null?v:y).sn-c.startSN,A=c.fragments[S-1];A&&y.cc===A.cc&&(y=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,g)){if(!y.gap){const S=this.audioOnly&&!this.altAudio?Gt.AUDIO:Gt.VIDEO,A=(S===Gt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,S,De.MAIN)}y=this.getNextFragmentLoopLoading(y,c,u,De.MAIN,m)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,o,g))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===_r.NOT_LOADED||s===_r.PARTIAL?pr(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,De.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<i.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,h=Math.max(o.end,d+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case le.KEY_LOADING:case le.FRAG_LOADING:case le.FRAG_LOADING_WAITING_RETRY:case le.PARSING:case le.PARSED:this.state=le.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;un(r,"playing",this.onMediaPlaying),un(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(In(r,"playing",this.onMediaPlaying),In(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!HO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==le.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=le.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,u=t.details,d=u.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const c=t.levelInfo,h=this.fragCurrent;h&&(this.state===le.FRAG_LOADING||this.state===le.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let m=0;if(u.live||(r=c.details)!=null&&r.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(c.details=u,this.levelLastLoaded=c,i||this.setStartPosition(u,m),this.hls.trigger(w.LEVEL_UPDATED,{details:u,level:o}),this.state===le.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=le.IDLE}i&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,d=i>=o-t.maxFragLookUpTolerance&&i<=u;if(s!==null&&r.duration>s&&(i<s||!d)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&r.readyState<4||i<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const m=st.bufferInfo(r,s,0);if(!((c=m.buffered)!=null&&c.length)){r.currentTime=s;return}if(m.start<=i){r.currentTime=s;return}const{nextStart:y}=st.bufferedInfo(m.buffered,i,0);y&&(r.currentTime=y)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=o[r.level];if(!u){this.warn(`Level ${r.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=u.videoCodec,h=d.PTSKnown||!d.live,m=(t=r.initSegment)==null?void 0:t.data,g=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new Pb(this.hls,De.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=s?s.index:-1,E=v!==-1,S=new Ag(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,E),A=this.initPTS[r.cc];y.push(i,m,g,c,r,s,d.totalduration,h,S,A)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio!==0;if(Xd(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(w.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(w.AUDIO_TRACK_SWITCHED,t)}),r.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(w.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Xd(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const u in r){const d=r[u];if(d.id==="main"){if(i=u,s=d,u==="video"){const c=r[u];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===De.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===le.PARSED&&(this.state=le.IDLE);return}const u=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),pr(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&st.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=le.ERROR;return}switch(t.details){case X.FRAG_GAP:case X.FRAG_PARSING_ERROR:case X.FRAG_DECRYPT_ERROR:case X.FRAG_LOAD_ERROR:case X.FRAG_LOAD_TIMEOUT:case X.KEY_LOAD_ERROR:case X.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.MAIN,t);break;case X.LEVEL_LOAD_ERROR:case X.LEVEL_LOAD_TIMEOUT:case X.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===le.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ht.LEVEL&&(this.state=le.IDLE);break;case X.BUFFER_ADD_CODEC_ERROR:case X.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case X.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case X.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=le.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Gt.AUDIO||!this.altAudio){const r=(t===Gt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,De.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=st.getBuffered(e),u=o.length?o.start(0):0,d=u-r,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<c||this.loadingParts&&d<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),r+=d,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${u}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=le.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(w.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:u,part:d,level:c}=o,{video:h,text:m,id3:g,initSegment:y}=s,{details:v}=c,E=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=le.PARSING,y){const S=y.tracks;if(S){const k=u.initSegment||u;if(this.unhandledEncryptionError(y,u))return;this._bufferInitSegment(c,S,k,i),r.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:t,tracks:S})}const A=y.initPTS,I=y.timescale,R=this.initPTS[u.cc];if(Re(A)&&(!R||R.baseTime!==A||R.timescale!==I)){const k=y.trackId;this.initPTS[u.cc]={baseTime:A,timescale:I,trackId:k},r.trigger(w.INIT_PTS_FOUND,{frag:u,id:t,initPTS:A,timescale:I,trackId:k})}}if(h&&v){E&&h.type==="audiovideo"&&this.logMuxedErr(u);const S=v.fragments[u.sn-1-v.startSN],A=u.sn===v.startSN,I=!S||u.cc>S.cc;if(s.independent!==!1){const{startPTS:R,endPTS:k,startDTS:C,endDTS:V}=h;if(d)d.elementaryStreams[h.type]={startPTS:R,endPTS:k,startDTS:C,endDTS:V};else if(h.firstKeyFrame&&h.independent&&i.id===1&&!I&&(this.couldBacktrack=!0),h.dropped&&h.independent){const _=this.getMainFwdBufferInfo(),N=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,F=h.firstKeyFramePTS?h.firstKeyFramePTS:R;if(!A&&N<F-this.config.maxBufferHole&&!I){this.backtrack(u);return}else I&&(u.gap=!0);u.setElementaryStreamInfo(h.type,u.start,k,u.start,V,!0)}else A&&R-(v.appliedTimelineOffset||0)>$d&&(u.gap=!0);u.setElementaryStreamInfo(h.type,R,k,C,V),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(h,u,d,i,A||I)}else if(A||I)u.gap=!0;else{this.backtrack(u);return}}if(E){const{startPTS:S,endPTS:A,startDTS:I,endDTS:R}=E;d&&(d.elementaryStreams[Gt.AUDIO]={startPTS:S,endPTS:A,startDTS:I,endDTS:R}),u.setElementaryStreamInfo(Gt.AUDIO,S,A,I,R),this.bufferFragmentData(E,u,d,i)}if(v&&g!=null&&g.samples.length){const S={id:t,frag:u,details:v,samples:g.samples};r.trigger(w.FRAG_PARSING_METADATA,S)}if(v&&m){const S={id:t,frag:u,details:v,samples:m.samples};r.trigger(w.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${pr(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==le.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:u}=t;if(i){const c=e.audioCodec;let h=Pd(i.codec,c);h==="mp4a"&&(h="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const g=i.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),c&&c!==h&&this.log(`Swapping manifest audio codec "${c}" for "${h}"`),i.levelCodec=h,i.id=De.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${h||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=De.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(w.BUFFER_CODECS,t),!this.hls)return;d.forEach(c=>{const m=t[c].initSegment;m!=null&&m.byteLength&&this.hls.trigger(w.BUFFER_APPENDING,{type:c,data:m,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,De.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=le.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(st.isBuffered(e,r)?t=this.getAppendedFrag(r):st.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(w.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(w.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Re(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Re(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?to(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class YO extends Xn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=X.KEY_LOAD_ERROR,r,s,i){return new si({type:Ve.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!pr(e)||!pr(o)||e.sn<o.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(u=>{if(!this.emeController)return;o.setKeyFormat(u);const d=Nd(u);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const s=Su(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,X.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,X.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const u=jm(i);let d=this.keyIdToKeyInfo[u];if((r=d)!=null&&r.decryptdata.key)return i.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(s=d)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(h=>{const{keyInfo:m}=h;return i.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${i.keyId?" keyId: "+Gr(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[u]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,X.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=hk(t.initSegment.data);if(o.length){let u=o[0];u.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${Gr(u)}`),aa.setKeyIdForUri(e.decryptdata.uri,u)):(u=aa.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Gr(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!pr(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,y,v,E)=>{const{frag:S,keyInfo:A}=v,I=jm(A.decryptdata);if(!S.decryptdata||A!==this.keyIdToKeyInfo[I])return u(this.createKeyLoadError(S,X.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));A.decryptdata.key=S.decryptdata.key=new Uint8Array(g.data),S.keyLoader=null,A.loader=null,o({frag:S,keyInfo:A})},onError:(g,y,v,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,X.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),v,Ft({url:d.url,data:void 0},g)))},onTimeout:(g,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,X.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(g,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,X.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};i.load(d,h,m)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=jm(r.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function jm(n){if(n.keyFormat!==Kr.FAIRPLAY){const e=n.keyId;if(e)return Gr(e)}return n.uri}function FE(n){const{type:e}=n;switch(e){case ht.AUDIO_TRACK:return De.AUDIO;case ht.SUBTITLE_TRACK:return De.SUBTITLE;default:return De.MAIN}}function Vm(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class qO{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ht.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:u,levelInfo:d}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:ht.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:u}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ht.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:u}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ht.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const r=this.loaders[ht.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[ht.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,h=s.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===ht.MANIFEST?i=r.manifestLoadPolicy.default:i=$t({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),Re((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ht.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ht.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ht.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,m=c.targetduration;if(h&&m){const g=Math.max(h*3,m*.8)*1e3;i=$t({},i,{maxTimeToFirstByteMs:Math.min(g,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},u={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(c,h,m,g)=>{const y=this.getInternalLoader(m);this.resetInternalLoader(m.type);const v=c.data;h.parsing.start=performance.now(),Ns.isMediaPlaylist(v)||m.type!==ht.MANIFEST?this.handleTrackOrLevelPlaylist(c,h,m,g||null,y):this.handleMasterPlaylist(c,h,m,g)},onError:(c,h,m,g)=>{this.handleNetworkError(h,m,!1,c,g)},onTimeout:(c,h,m)=>{this.handleNetworkError(h,m,!0,void 0,c)}};s.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,u=Vm(e,r),d=Ns.parseMasterPlaylist(o,u);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,d.playlistParsingError,s,t);return}const{contentSteering:c,levels:h,sessionData:m,sessionKeys:g,startTimeOffset:y,variableList:v}=d;this.variableList=v,h.forEach(I=>{const{unknownCodecs:R}=I;if(R){const{preferManagedMediaSource:k}=this.hls.config;let{audioCodec:C,videoCodec:V}=I;for(let _=R.length;_--;){const N=R[_];Nu(N,"audio",k)?(I.audioCodec=C=C?`${C},${N}`:N,ml.audio[C.substring(0,4)]=2,R.splice(_,1)):Nu(N,"video",k)&&(I.videoCodec=V=V?`${V},${N}`:N,ml.video[V.substring(0,4)]=2,R.splice(_,1))}}});const{AUDIO:E=[],SUBTITLES:S,"CLOSED-CAPTIONS":A}=Ns.parseMasterPlaylistMedia(o,u,d);E.length&&!E.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ar({}),bitrate:0,url:""})),i.trigger(w.MANIFEST_LOADED,{levels:h,audioTracks:E,subtitles:S,captions:A,contentSteering:c,url:u,stats:t,networkDetails:s,sessionData:m,sessionKeys:g,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:u,level:d,type:c}=r,h=Vm(e,r),m=Re(d)?d:Re(u)?u:0,g=FE(r),y=Ns.parseLevelPlaylist(e.data,h,m,g,0,this.variableList);if(c===ht.MANIFEST){const v={attrs:new ar({}),bitrate:0,details:y,name:"",url:h};y.requestScheduled=t.loading.start+lb(y,0),o.trigger(w.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=y,this.handlePlaylistLoaded(y,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(w.ERROR,{type:Ve.NETWORK_ERROR,details:X.MANIFEST_PARSING_ERROR,fatal:t.type===ht.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ht.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ht.AUDIO_TRACK||e.type===ht.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let d=X.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case ht.MANIFEST:d=r?X.MANIFEST_LOAD_TIMEOUT:X.MANIFEST_LOAD_ERROR,c=!0;break;case ht.LEVEL:d=r?X.LEVEL_LOAD_TIMEOUT:X.LEVEL_LOAD_ERROR,c=!1;break;case ht.AUDIO_TRACK:d=r?X.AUDIO_TRACK_LOAD_TIMEOUT:X.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ht.SUBTITLE_TRACK:d=r?X.SUBTITLE_TRACK_LOAD_TIMEOUT:X.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const m={type:Ve.NETWORK_ERROR,details:d,fatal:c,url:e.url,loader:h,context:e,error:u,networkDetails:t,stats:i};if(s){const g=(t==null?void 0:t.url)||e.url;m.response=Ft({url:g,data:void 0},s)}this.hls.trigger(w.ERROR,m)}handlePlaylistLoaded(e,t,r,s,i,o){const u=this.hls,{type:d,level:c,levelOrTrack:h,id:m,groupId:g,deliveryDirectives:y}=s,v=Vm(t,s),E=FE(s);let S=typeof s.level=="number"&&E===De.MAIN?c:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(w.ERROR,{type:Ve.NETWORK_ERROR,details:X.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:A,reason:A.message,response:t,context:s,level:S,parent:E,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const I=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(w.ERROR,{type:Ve.NETWORK_ERROR,details:X.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:I,reason:I.message,response:t,context:s,level:S,parent:E,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case ht.MANIFEST:case ht.LEVEL:if(S){if(!h)S=0;else if(h!==u.levels[S]){const I=u.levels.indexOf(h);I>-1&&(S=I)}}u.trigger(w.LEVEL_LOADED,{details:e,levelInfo:h||u.levels[0],level:S||0,id:m||0,stats:r,networkDetails:i,deliveryDirectives:y,withoutMultiVariant:d===ht.MANIFEST});break;case ht.AUDIO_TRACK:u.trigger(w.AUDIO_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:g||"",stats:r,networkDetails:i,deliveryDirectives:y});break;case ht.SUBTITLE_TRACK:u.trigger(w.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:g||"",stats:r,networkDetails:i,deliveryDirectives:y});break}}}class ci{static get version(){return Uu}static isMSESupported(){return ow()}static isSupported(){return KO()}static getMediaSource(){return ua()}static get Events(){return w}static get MetadataSchema(){return Mn}static get ErrorTypes(){return Ve}static get ErrorDetails(){return X}static get DefaultConfig(){return ci.defaultConfig?ci.defaultConfig:DO}static set DefaultConfig(e){ci.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _g,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=tk(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=OO(ci.DefaultConfig,e,t);this.userConfig=e,r.progressive&&NO(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:u,fpsController:d}=r,c=new u(this),h=this.abrController=new s(this),m=new Qk(this),g=r.interstitialsController,y=g?this.interstitialsController=new g(this,ci):null,v=this.bufferController=new i(this,m),E=this.capLevelController=new o(this),S=new d(this),A=new qO(this),I=r.contentSteeringController,R=I?new I(this):null,k=this.levelController=new GO(this,R),C=new jO(this),V=new YO(this.config,this.logger),_=this.streamController=new WO(this,m,V),N=this.gapController=new BO(this,m);E.setStreamController(_),S.setStreamController(_);const F=[A,k,_];y&&F.splice(1,0,y),R&&F.splice(1,0,R),this.networkControllers=F;const O=[h,v,N,E,S,C,m];this.audioTrackController=this.createController(r.audioTrackController,F);const q=r.audioStreamController;q&&F.push(this.audioStreamController=new q(this,m,V)),this.subtitleTrackController=this.createController(r.subtitleTrackController,F);const H=r.subtitleStreamController;H&&F.push(this.subtititleStreamController=new H(this,m,V)),this.createController(r.timelineController,O),V.emeController=this.emeController=this.createController(r.emeController,O),this.cmcdController=this.createController(r.cmcdController,O),this.latencyController=this.createController(VO,O),this.coreComponents=O,F.push(c);const ie=c.onErrorOut;typeof ie=="function"&&this.on(w.ERROR,ie,c),this.on(w.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===w.ERROR;this.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(w.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(w.ERROR,{type:Ve.OTHER_ERROR,details:X.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(w.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(w.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(w.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=vg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(w.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[De.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[De.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[De.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=BP()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ok(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=WT(t);return HT(e,r,navigator.mediaCapabilities)}}ci.defaultConfig=void 0;const QO=vf(n=>({muted:!1,volume:.8,setMuted:e=>n({muted:e}),setVolume:e=>n({volume:e})}));function lw({src:n,poster:e,autoPlay:t,playbackKey:r}){const s=D.useRef(null),{muted:i,volume:o}=QO();return D.useEffect(()=>{const u=s.current;if(!u)return;let d=null;if(u.canPlayType("application/vnd.apple.mpegurl")?u.src=n:ci.isSupported()&&(d=new ci,d.loadSource(n),d.attachMedia(u)),r){const c=localStorage.getItem(`progress:${r}`);c&&(u.currentTime=Number(c));const h=()=>localStorage.setItem(`progress:${r}`,String(u.currentTime));return u.addEventListener("timeupdate",h),()=>{u.removeEventListener("timeupdate",h),d==null||d.destroy()}}return()=>d==null?void 0:d.destroy()},[n,r]),D.useEffect(()=>{const u=s.current;u&&(u.muted=i,u.volume=o)},[i,o]),b.jsx("video",{ref:s,controls:!0,autoPlay:t,poster:e,className:"w-full rounded-xl bg-black"})}var Xu=n=>n.type==="checkbox",Ba=n=>n instanceof Date,wn=n=>n==null;const uw=n=>typeof n=="object";var br=n=>!wn(n)&&!Array.isArray(n)&&uw(n)&&!Ba(n),XO=n=>br(n)&&n.target?Xu(n.target)?n.target.checked:n.target.value:n,ZO=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,JO=(n,e)=>n.has(ZO(e)),eN=n=>{const e=n.constructor&&n.constructor.prototype;return br(e)&&e.hasOwnProperty("isPrototypeOf")},Vg=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Rr(n){if(n instanceof Date)return new Date(n);const e=typeof FileList<"u"&&n instanceof FileList;if(Vg&&(n instanceof Blob||e))return n;const t=Array.isArray(n);if(!t&&!(br(n)&&eN(n)))return n;const r=t?[]:Object.create(Object.getPrototypeOf(n));for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=Rr(n[s]));return r}var Tf=n=>/^\w*$/.test(n),or=n=>n===void 0,Gg=n=>Array.isArray(n)?n.filter(Boolean):[],Kg=n=>Gg(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Ue=(n,e,t)=>{if(!e||!br(n))return t;const r=(Tf(e)?[e]:Kg(e)).reduce((s,i)=>wn(s)?s:s[i],n);return or(r)||r===n?or(n[e])?t:n[e]:r},Ls=n=>typeof n=="boolean",hs=n=>typeof n=="function",Vt=(n,e,t)=>{let r=-1;const s=Tf(e)?[e]:Kg(e),i=s.length,o=i-1;for(;++r<i;){const u=s[r];let d=t;if(r!==o){const c=n[u];d=br(c)||Array.isArray(c)?c:isNaN(+s[r+1])?{}:[]}if(u==="__proto__"||u==="constructor"||u==="prototype")return;n[u]=d,n=n[u]}};const UE={BLUR:"blur",FOCUS_OUT:"focusout"},ms={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ri={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},tN=ve.createContext(null);tN.displayName="HookFormControlContext";var rN=(n,e,t,r=!0)=>{const s={defaultValues:e._defaultValues};for(const i in n)Object.defineProperty(s,i,{get:()=>{const o=i;return e._proxyFormState[o]!==ms.all&&(e._proxyFormState[o]=!r||ms.all),n[o]}});return s};const nN=typeof window<"u"?ve.useLayoutEffect:ve.useEffect;var Fn=n=>typeof n=="string",sN=(n,e,t,r,s)=>Fn(n)?(r&&e.watch.add(n),Ue(t,n,s)):Array.isArray(n)?n.map(i=>(r&&e.watch.add(i),Ue(t,i))):(r&&(e.watchAll=!0),t),$p=n=>wn(n)||!uw(n);function Wi(n,e,t=new WeakSet){if($p(n)||$p(e))return Object.is(n,e);if(Ba(n)&&Ba(e))return Object.is(n.getTime(),e.getTime());const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;if(t.has(n)||t.has(e))return!0;t.add(n),t.add(e);for(const i of r){const o=n[i];if(!s.includes(i))return!1;if(i!=="ref"){const u=e[i];if(Ba(o)&&Ba(u)||br(o)&&br(u)||Array.isArray(o)&&Array.isArray(u)?!Wi(o,u,t):!Object.is(o,u))return!1}}return!0}const iN=ve.createContext(null);iN.displayName="HookFormContext";var cw=(n,e,t,r,s)=>e?{...t[n],types:{...t[n]&&t[n].types?t[n].types:{},[r]:s||!0}}:{},Iu=n=>Array.isArray(n)?n:[n],BE=()=>{let n=[];return{get observers(){return n},next:s=>{for(const i of n)i.next&&i.next(s)},subscribe:s=>(n.push(s),{unsubscribe:()=>{n=n.filter(i=>i!==s)}}),unsubscribe:()=>{n=[]}}};function dw(n,e){const t={};for(const r in n)if(n.hasOwnProperty(r)){const s=n[r],i=e[r];if(s&&br(s)&&i){const o=dw(s,i);br(o)&&(t[r]=o)}else n[r]&&(t[r]=i)}return t}var on=n=>br(n)&&!Object.keys(n).length,Hg=n=>n.type==="file",af=n=>{if(!Vg)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},fw=n=>n.type==="select-multiple",zg=n=>n.type==="radio",aN=n=>zg(n)||Xu(n),Gm=n=>af(n)&&n.isConnected;function oN(n,e){const t=e.slice(0,-1).length;let r=0;for(;r<t;)n=or(n)?r++:n[e[r++]];return n}function lN(n){for(const e in n)if(n.hasOwnProperty(e)&&!or(n[e]))return!1;return!0}function Er(n,e){const t=Array.isArray(e)?e:Tf(e)?[e]:Kg(e),r=t.length===1?n:oN(n,t),s=t.length-1,i=t[s];return r&&delete r[i],s!==0&&(br(r)&&on(r)||Array.isArray(r)&&lN(r))&&Er(n,t.slice(0,-1)),n}var uN=n=>{for(const e in n)if(hs(n[e]))return!0;return!1};function hw(n){return Array.isArray(n)||br(n)&&!uN(n)}function jp(n,e={}){for(const t in n){const r=n[t];hw(r)?(e[t]=Array.isArray(r)?[]:{},jp(r,e[t])):or(r)||(e[t]=!0)}return e}function Ho(n,e,t){t||(t=jp(e));for(const r in n){const s=n[r];if(hw(s))or(e)||$p(t[r])?t[r]=jp(s,Array.isArray(s)?[]:{}):Ho(s,wn(e)?{}:e[r],t[r]);else{const i=e[r];t[r]=!Wi(s,i)}}return t}const $E={value:!1,isValid:!1},jE={value:!0,isValid:!0};var mw=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!or(n[0].attributes.value)?or(n[0].value)||n[0].value===""?jE:{value:n[0].value,isValid:!0}:jE:$E}return $E},pw=(n,{valueAsNumber:e,valueAsDate:t,setValueAs:r})=>or(n)?n:e?n===""?NaN:n&&+n:t&&Fn(n)?new Date(n):r?r(n):n;const VE={isValid:!1,value:null};var gw=n=>Array.isArray(n)?n.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,VE):VE;function GE(n){const e=n.ref;return Hg(e)?e.files:zg(e)?gw(n.refs).value:fw(e)?[...e.selectedOptions].map(({value:t})=>t):Xu(e)?mw(n.refs).value:pw(or(e.value)?n.ref.value:e.value,n)}var cN=(n,e,t,r)=>{const s={};for(const i of n){const o=Ue(e,i);o&&Vt(s,i,o._f)}return{criteriaMode:t,names:[...n],fields:s,shouldUseNativeValidation:r}},of=n=>n instanceof RegExp,vu=n=>or(n)?n:of(n)?n.source:br(n)?of(n.value)?n.value.source:n.value:n,KE=n=>({isOnSubmit:!n||n===ms.onSubmit,isOnBlur:n===ms.onBlur,isOnChange:n===ms.onChange,isOnAll:n===ms.all,isOnTouch:n===ms.onTouched});const HE="AsyncFunction";var dN=n=>!!n&&!!n.validate&&!!(hs(n.validate)&&n.validate.constructor.name===HE||br(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===HE)),fN=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),zE=(n,e,t)=>!t&&(e.watchAll||e.watch.has(n)||[...e.watch].some(r=>n.startsWith(r)&&/^\.\w+/.test(n.slice(r.length))));const Ru=(n,e,t,r)=>{for(const s of t||Object.keys(n)){const i=Ue(n,s);if(i){const{_f:o,...u}=i;if(o){if(o.refs&&o.refs[0]&&e(o.refs[0],s)&&!r)return!0;if(o.ref&&e(o.ref,o.name)&&!r)return!0;if(Ru(u,e))break}else if(br(u)&&Ru(u,e))break}}};function WE(n,e,t){const r=Ue(n,t);if(r||Tf(t))return{error:r,name:t};const s=t.split(".");for(;s.length;){const i=s.join("."),o=Ue(e,i),u=Ue(n,i);if(o&&!Array.isArray(o)&&t!==i)return{name:t};if(u&&u.type)return{name:i,error:u};if(u&&u.root&&u.root.type)return{name:`${i}.root`,error:u.root};s.pop()}return{name:t}}var hN=(n,e,t,r)=>{t(n);const{name:s,...i}=n;return on(i)||Object.keys(i).length>=Object.keys(e).length||Object.keys(i).find(o=>e[o]===(!r||ms.all))},mN=(n,e,t)=>!n||!e||n===e||Iu(n).some(r=>r&&(t?r===e:r.startsWith(e)||e.startsWith(r))),pN=(n,e,t,r,s)=>s.isOnAll?!1:!t&&s.isOnTouch?!(e||n):(t?r.isOnBlur:s.isOnBlur)?!n:(t?r.isOnChange:s.isOnChange)?n:!0,gN=(n,e)=>!Gg(Ue(n,e)).length&&Er(n,e),yN=(n,e,t)=>{const r=Iu(Ue(n,t));return Vt(r,"root",e[t]),Vt(n,t,r),n};function YE(n,e,t="validate"){if(Fn(n)||Array.isArray(n)&&n.every(Fn)||Ls(n)&&!n)return{type:t,message:Fn(n)?n:"",ref:e}}var Bo=n=>br(n)&&!of(n)?n:{value:n,message:""},qE=async(n,e,t,r,s,i)=>{const{ref:o,refs:u,required:d,maxLength:c,minLength:h,min:m,max:g,pattern:y,validate:v,name:E,valueAsNumber:S,mount:A}=n._f,I=Ue(t,E);if(!A||e.has(E))return{};const R=u?u[0]:o,k=H=>{s&&R.reportValidity&&(R.setCustomValidity(Ls(H)?"":H||""),R.reportValidity())},C={},V=zg(o),_=Xu(o),N=V||_,F=(S||Hg(o))&&or(o.value)&&or(I)||af(o)&&o.value===""||I===""||Array.isArray(I)&&!I.length,O=cw.bind(null,E,r,C),q=(H,ie,oe,ce=ri.maxLength,ae=ri.minLength)=>{const ue=H?ie:oe;C[E]={type:H?ce:ae,message:ue,ref:o,...O(H?ce:ae,ue)}};if(i?!Array.isArray(I)||!I.length:d&&(!N&&(F||wn(I))||Ls(I)&&!I||_&&!mw(u).isValid||V&&!gw(u).isValid)){const{value:H,message:ie}=Fn(d)?{value:!!d,message:d}:Bo(d);if(H&&(C[E]={type:ri.required,message:ie,ref:R,...O(ri.required,ie)},!r))return k(ie),C}if(!F&&(!wn(m)||!wn(g))){let H,ie;const oe=Bo(g),ce=Bo(m);if(!wn(I)&&!isNaN(I)){const ae=o.valueAsNumber||I&&+I;wn(oe.value)||(H=ae>oe.value),wn(ce.value)||(ie=ae<ce.value)}else{const ae=o.valueAsDate||new Date(I),ue=ne=>new Date(new Date().toDateString()+" "+ne),W=o.type=="time",Z=o.type=="week";Fn(oe.value)&&I&&(H=W?ue(I)>ue(oe.value):Z?I>oe.value:ae>new Date(oe.value)),Fn(ce.value)&&I&&(ie=W?ue(I)<ue(ce.value):Z?I<ce.value:ae<new Date(ce.value))}if((H||ie)&&(q(!!H,oe.message,ce.message,ri.max,ri.min),!r))return k(C[E].message),C}if((c||h)&&!F&&(Fn(I)||i&&Array.isArray(I))){const H=Bo(c),ie=Bo(h),oe=!wn(H.value)&&I.length>+H.value,ce=!wn(ie.value)&&I.length<+ie.value;if((oe||ce)&&(q(oe,H.message,ie.message),!r))return k(C[E].message),C}if(y&&!F&&Fn(I)){const{value:H,message:ie}=Bo(y);if(of(H)&&!I.match(H)&&(C[E]={type:ri.pattern,message:ie,ref:o,...O(ri.pattern,ie)},!r))return k(ie),C}if(v){if(hs(v)){const H=await v(I,t),ie=YE(H,R);if(ie&&(C[E]={...ie,...O(ri.validate,ie.message)},!r))return k(ie.message),C}else if(br(v)){let H={};for(const ie in v){if(!on(H)&&!r)break;const oe=YE(await v[ie](I,t),R,ie);oe&&(H={...oe,...O(ie,oe.message)},k(oe.message),r&&(C[E]=H))}if(!on(H)&&(C[E]={ref:R,...H},!r))return C}}return k(!0),C};const vN={mode:ms.onSubmit,reValidateMode:ms.onChange,shouldFocusError:!0};function xN(n={}){let e={...vN,...n},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:hs(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},r={},s=br(e.defaultValues)||br(e.values)?Rr(e.defaultValues||e.values)||{}:{},i=e.shouldUnregister?{}:Rr(s),o={action:!1,mount:!1,watch:!1,keepIsValid:!1},u={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},d,c=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},m={...h};let g={...m};const y={array:BE(),state:BE()},v=e.criteriaMode===ms.all,E=U=>Y=>{clearTimeout(c),c=setTimeout(U,Y)},S=async U=>{if(!o.keepIsValid&&!e.disabled&&(m.isValid||g.isValid||U)){let Y;e.resolver?(Y=on((await N()).errors),A()):Y=await O(r,!0),Y!==t.isValid&&y.state.next({isValid:Y})}},A=(U,Y)=>{!e.disabled&&(m.isValidating||m.validatingFields||g.isValidating||g.validatingFields)&&((U||Array.from(u.mount)).forEach(se=>{se&&(Y?Vt(t.validatingFields,se,Y):Er(t.validatingFields,se))}),y.state.next({validatingFields:t.validatingFields,isValidating:!on(t.validatingFields)}))},I=(U,Y=[],se,Te,Ee=!0,fe=!0)=>{if(Te&&se&&!e.disabled){if(o.action=!0,fe&&Array.isArray(Ue(r,U))){const _e=se(Ue(r,U),Te.argA,Te.argB);Ee&&Vt(r,U,_e)}if(fe&&Array.isArray(Ue(t.errors,U))){const _e=se(Ue(t.errors,U),Te.argA,Te.argB);Ee&&Vt(t.errors,U,_e),gN(t.errors,U)}if((m.touchedFields||g.touchedFields)&&fe&&Array.isArray(Ue(t.touchedFields,U))){const _e=se(Ue(t.touchedFields,U),Te.argA,Te.argB);Ee&&Vt(t.touchedFields,U,_e)}(m.dirtyFields||g.dirtyFields)&&(t.dirtyFields=Ho(s,i)),y.state.next({name:U,isDirty:H(U,Y),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else Vt(i,U,Y)},R=(U,Y)=>{Vt(t.errors,U,Y),y.state.next({errors:t.errors})},k=U=>{t.errors=U,y.state.next({errors:t.errors,isValid:!1})},C=(U,Y,se,Te)=>{const Ee=Ue(r,U);if(Ee){const fe=Ue(i,U,or(se)?Ue(s,U):se);or(fe)||Te&&Te.defaultChecked||Y?Vt(i,U,Y?fe:GE(Ee._f)):ce(U,fe),o.mount&&!o.action&&S()}},V=(U,Y,se,Te,Ee)=>{let fe=!1,_e=!1;const et={name:U};if(!e.disabled){if(!se||Te){(m.isDirty||g.isDirty)&&(_e=t.isDirty,t.isDirty=et.isDirty=H(),fe=_e!==et.isDirty);const tt=Wi(Ue(s,U),Y);_e=!!Ue(t.dirtyFields,U),tt?Er(t.dirtyFields,U):Vt(t.dirtyFields,U,!0),et.dirtyFields=t.dirtyFields,fe=fe||(m.dirtyFields||g.dirtyFields)&&_e!==!tt}if(se){const tt=Ue(t.touchedFields,U);tt||(Vt(t.touchedFields,U,se),et.touchedFields=t.touchedFields,fe=fe||(m.touchedFields||g.touchedFields)&&tt!==se)}fe&&Ee&&y.state.next(et)}return fe?et:{}},_=(U,Y,se,Te)=>{const Ee=Ue(t.errors,U),fe=(m.isValid||g.isValid)&&Ls(Y)&&t.isValid!==Y;if(e.delayError&&se?(d=E(()=>R(U,se)),d(e.delayError)):(clearTimeout(c),d=null,se?Vt(t.errors,U,se):Er(t.errors,U)),(se?!Wi(Ee,se):Ee)||!on(Te)||fe){const _e={...Te,...fe&&Ls(Y)?{isValid:Y}:{},errors:t.errors,name:U};t={...t,..._e},y.state.next(_e)}},N=async U=>(A(U,!0),await e.resolver(i,e.context,cN(U||u.mount,r,e.criteriaMode,e.shouldUseNativeValidation))),F=async U=>{const{errors:Y}=await N(U);if(A(U),U)for(const se of U){const Te=Ue(Y,se);Te?Vt(t.errors,se,Te):Er(t.errors,se)}else t.errors=Y;return Y},O=async(U,Y,se={valid:!0})=>{for(const Te in U){const Ee=U[Te];if(Ee){const{_f:fe,..._e}=Ee;if(fe){const et=u.array.has(fe.name),tt=Ee._f&&dN(Ee._f);tt&&m.validatingFields&&A([fe.name],!0);const At=await qE(Ee,u.disabled,i,v,e.shouldUseNativeValidation&&!Y,et);if(tt&&m.validatingFields&&A([fe.name]),At[fe.name]&&(se.valid=!1,Y||n.shouldUseNativeValidation))break;!Y&&(Ue(At,fe.name)?et?yN(t.errors,At,fe.name):Vt(t.errors,fe.name,At[fe.name]):Er(t.errors,fe.name))}!on(_e)&&await O(_e,Y,se)}}return se.valid},q=()=>{for(const U of u.unMount){const Y=Ue(r,U);Y&&(Y._f.refs?Y._f.refs.every(se=>!Gm(se)):!Gm(Y._f.ref))&&Ge(U)}u.unMount=new Set},H=(U,Y)=>!e.disabled&&(U&&Y&&Vt(i,U,Y),!Wi(P(),s)),ie=(U,Y,se)=>sN(U,u,{...o.mount?i:or(Y)?s:Fn(U)?{[U]:Y}:Y},se,Y),oe=U=>Gg(Ue(o.mount?i:s,U,e.shouldUnregister?Ue(s,U,[]):[])),ce=(U,Y,se={})=>{const Te=Ue(r,U);let Ee=Y;if(Te){const fe=Te._f;fe&&(!fe.disabled&&Vt(i,U,pw(Y,fe)),Ee=af(fe.ref)&&wn(Y)?"":Y,fw(fe.ref)?[...fe.ref.options].forEach(_e=>_e.selected=Ee.includes(_e.value)):fe.refs?Xu(fe.ref)?fe.refs.forEach(_e=>{(!_e.defaultChecked||!_e.disabled)&&(Array.isArray(Ee)?_e.checked=!!Ee.find(et=>et===_e.value):_e.checked=Ee===_e.value||!!Ee)}):fe.refs.forEach(_e=>_e.checked=_e.value===Ee):Hg(fe.ref)?fe.ref.value="":(fe.ref.value=Ee,fe.ref.type||y.state.next({name:U,values:Rr(i)})))}(se.shouldDirty||se.shouldTouch)&&V(U,Ee,se.shouldTouch,se.shouldDirty,!0),se.shouldValidate&&ne(U)},ae=(U,Y,se)=>{for(const Te in Y){if(!Y.hasOwnProperty(Te))return;const Ee=Y[Te],fe=U+"."+Te,_e=Ue(r,fe);(u.array.has(U)||br(Ee)||_e&&!_e._f)&&!Ba(Ee)?ae(fe,Ee,se):ce(fe,Ee,se)}},ue=(U,Y,se={})=>{const Te=Ue(r,U),Ee=u.array.has(U),fe=Rr(Y);Vt(i,U,fe),Ee?(y.array.next({name:U,values:Rr(i)}),(m.isDirty||m.dirtyFields||g.isDirty||g.dirtyFields)&&se.shouldDirty&&y.state.next({name:U,dirtyFields:Ho(s,i),isDirty:H(U,fe)})):Te&&!Te._f&&!wn(fe)?ae(U,fe,se):ce(U,fe,se),zE(U,u)?y.state.next({...t,name:U,values:Rr(i)}):y.state.next({name:o.mount?U:void 0,values:Rr(i)})},W=async U=>{o.mount=!0;const Y=U.target;let se=Y.name,Te=!0;const Ee=Ue(r,se),fe=tt=>{Te=Number.isNaN(tt)||Ba(tt)&&isNaN(tt.getTime())||Wi(tt,Ue(i,se,tt))},_e=KE(e.mode),et=KE(e.reValidateMode);if(Ee){let tt,At;const Wt=Y.type?GE(Ee._f):XO(U),en=U.type===UE.BLUR||U.type===UE.FOCUS_OUT,Fr=!fN(Ee._f)&&!e.resolver&&!Ue(t.errors,se)&&!Ee._f.deps||pN(en,Ue(t.touchedFields,se),t.isSubmitted,et,_e),zr=zE(se,u,en);Vt(i,se,Wt),en?(!Y||!Y.readOnly)&&(Ee._f.onBlur&&Ee._f.onBlur(U),d&&d(0)):Ee._f.onChange&&Ee._f.onChange(U);const Jn=V(se,Wt,en),tn=!on(Jn)||zr;if(!en&&y.state.next({name:se,type:U.type,values:Rr(i)}),Fr)return(m.isValid||g.isValid)&&(e.mode==="onBlur"?en&&S():en||S()),tn&&y.state.next({name:se,...zr?{}:Jn});if(!en&&zr&&y.state.next({...t}),e.resolver){const{errors:vs}=await N([se]);if(A([se]),fe(Wt),Te){const xs=WE(t.errors,r,se),dn=WE(vs,r,xs.name||se);tt=dn.error,se=dn.name,At=on(vs)}}else A([se],!0),tt=(await qE(Ee,u.disabled,i,v,e.shouldUseNativeValidation))[se],A([se]),fe(Wt),Te&&(tt?At=!1:(m.isValid||g.isValid)&&(At=await O(r,!0)));Te&&(Ee._f.deps&&(!Array.isArray(Ee._f.deps)||Ee._f.deps.length>0)&&ne(Ee._f.deps),_(se,At,tt,Jn))}},Z=(U,Y)=>{if(Ue(t.errors,Y)&&U.focus)return U.focus(),1},ne=async(U,Y={})=>{let se,Te;const Ee=Iu(U);if(e.resolver){const fe=await F(or(U)?U:Ee);se=on(fe),Te=U?!Ee.some(_e=>Ue(fe,_e)):se}else U?(Te=(await Promise.all(Ee.map(async fe=>{const _e=Ue(r,fe);return await O(_e&&_e._f?{[fe]:_e}:_e)}))).every(Boolean),!(!Te&&!t.isValid)&&S()):Te=se=await O(r);return y.state.next({...!Fn(U)||(m.isValid||g.isValid)&&se!==t.isValid?{}:{name:U},...e.resolver||!U?{isValid:se}:{},errors:t.errors}),Y.shouldFocus&&!Te&&Ru(r,Z,U?Ee:u.mount),Te},P=(U,Y)=>{let se={...o.mount?i:s};return Y&&(se=dw(Y.dirtyFields?t.dirtyFields:t.touchedFields,se)),or(U)?se:Fn(U)?Ue(se,U):U.map(Te=>Ue(se,Te))},B=(U,Y)=>({invalid:!!Ue((Y||t).errors,U),isDirty:!!Ue((Y||t).dirtyFields,U),error:Ue((Y||t).errors,U),isValidating:!!Ue(t.validatingFields,U),isTouched:!!Ue((Y||t).touchedFields,U)}),de=U=>{U&&Iu(U).forEach(Y=>Er(t.errors,Y)),y.state.next({errors:U?t.errors:{}})},pe=(U,Y,se)=>{const Te=(Ue(r,U,{_f:{}})._f||{}).ref,Ee=Ue(t.errors,U)||{},{ref:fe,message:_e,type:et,...tt}=Ee;Vt(t.errors,U,{...tt,...Y,ref:Te}),y.state.next({name:U,errors:t.errors,isValid:!1}),se&&se.shouldFocus&&Te&&Te.focus&&Te.focus()},ge=(U,Y)=>hs(U)?y.state.subscribe({next:se=>"values"in se&&U(ie(void 0,Y),se)}):ie(U,Y,!0),we=U=>y.state.subscribe({next:Y=>{mN(U.name,Y.name,U.exact)&&hN(Y,U.formState||m,nr,U.reRenderRoot)&&U.callback({values:{...i},...t,...Y,defaultValues:s})}}).unsubscribe,Ie=U=>(o.mount=!0,g={...g,...U.formState},we({...U,formState:{...h,...U.formState}})),Ge=(U,Y={})=>{for(const se of U?Iu(U):u.mount)u.mount.delete(se),u.array.delete(se),Y.keepValue||(Er(r,se),Er(i,se)),!Y.keepError&&Er(t.errors,se),!Y.keepDirty&&Er(t.dirtyFields,se),!Y.keepTouched&&Er(t.touchedFields,se),!Y.keepIsValidating&&Er(t.validatingFields,se),!e.shouldUnregister&&!Y.keepDefaultValue&&Er(s,se);y.state.next({values:Rr(i)}),y.state.next({...t,...Y.keepDirty?{isDirty:H()}:{}}),!Y.keepIsValid&&S()},Ze=({disabled:U,name:Y})=>{if(Ls(U)&&o.mount||U||u.disabled.has(Y)){const Ee=u.disabled.has(Y)!==!!U;U?u.disabled.add(Y):u.disabled.delete(Y),Ee&&o.mount&&!o.action&&S()}},vt=(U,Y={})=>{let se=Ue(r,U);const Te=Ls(Y.disabled)||Ls(e.disabled);return Vt(r,U,{...se||{},_f:{...se&&se._f?se._f:{ref:{name:U}},name:U,mount:!0,...Y}}),u.mount.add(U),se?Ze({disabled:Ls(Y.disabled)?Y.disabled:e.disabled,name:U}):C(U,!0,Y.value),{...Te?{disabled:Y.disabled||e.disabled}:{},...e.progressive?{required:!!Y.required,min:vu(Y.min),max:vu(Y.max),minLength:vu(Y.minLength),maxLength:vu(Y.maxLength),pattern:vu(Y.pattern)}:{},name:U,onChange:W,onBlur:W,ref:Ee=>{if(Ee){vt(U,Y),se=Ue(r,U);const fe=or(Ee.value)&&Ee.querySelectorAll&&Ee.querySelectorAll("input,select,textarea")[0]||Ee,_e=aN(fe),et=se._f.refs||[];if(_e?et.find(tt=>tt===fe):fe===se._f.ref)return;Vt(r,U,{_f:{...se._f,..._e?{refs:[...et.filter(Gm),fe,...Array.isArray(Ue(s,U))?[{}]:[]],ref:{type:fe.type,name:U}}:{ref:fe}}}),C(U,!1,void 0,fe)}else se=Ue(r,U,{}),se._f&&(se._f.mount=!1),(e.shouldUnregister||Y.shouldUnregister)&&!(JO(u.array,U)&&o.action)&&u.unMount.add(U)}}},er=()=>e.shouldFocusError&&Ru(r,Z,u.mount),Ht=U=>{Ls(U)&&(y.state.next({disabled:U}),Ru(r,(Y,se)=>{const Te=Ue(r,se);Te&&(Y.disabled=Te._f.disabled||U,Array.isArray(Te._f.refs)&&Te._f.refs.forEach(Ee=>{Ee.disabled=Te._f.disabled||U}))},0,!1))},fr=(U,Y)=>async se=>{let Te;se&&(se.preventDefault&&se.preventDefault(),se.persist&&se.persist());let Ee=Rr(i);if(y.state.next({isSubmitting:!0}),e.resolver){const{errors:fe,values:_e}=await N();A(),t.errors=fe,Ee=Rr(_e)}else await O(r);if(u.disabled.size)for(const fe of u.disabled)Er(Ee,fe);if(Er(t.errors,"root"),on(t.errors)){y.state.next({errors:{}});try{await U(Ee,se)}catch(fe){Te=fe}}else Y&&await Y({...t.errors},se),er(),setTimeout(er);if(y.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:on(t.errors)&&!Te,submitCount:t.submitCount+1,errors:t.errors}),Te)throw Te},cn=(U,Y={})=>{Ue(r,U)&&(or(Y.defaultValue)?ue(U,Rr(Ue(s,U))):(ue(U,Y.defaultValue),Vt(s,U,Rr(Y.defaultValue))),Y.keepTouched||Er(t.touchedFields,U),Y.keepDirty||(Er(t.dirtyFields,U),t.isDirty=Y.defaultValue?H(U,Rr(Ue(s,U))):H()),Y.keepError||(Er(t.errors,U),m.isValid&&S()),y.state.next({...t}))},ys=(U,Y={})=>{const se=U?Rr(U):s,Te=Rr(se),Ee=on(U),fe=Ee?s:Te;if(Y.keepDefaultValues||(s=se),!Y.keepValues){if(Y.keepDirtyValues){const _e=new Set([...u.mount,...Object.keys(Ho(s,i))]);for(const et of Array.from(_e)){const tt=Ue(t.dirtyFields,et),At=Ue(i,et),Wt=Ue(fe,et);tt&&!or(At)?Vt(fe,et,At):!tt&&!or(Wt)&&ue(et,Wt)}}else{if(Vg&&or(U))for(const _e of u.mount){const et=Ue(r,_e);if(et&&et._f){const tt=Array.isArray(et._f.refs)?et._f.refs[0]:et._f.ref;if(af(tt)){const At=tt.closest("form");if(At){At.reset();break}}}}if(Y.keepFieldsRef)for(const _e of u.mount)ue(_e,Ue(fe,_e));else r={}}i=e.shouldUnregister?Y.keepDefaultValues?Rr(s):{}:Rr(fe),y.array.next({values:{...fe}}),y.state.next({values:{...fe}})}u={mount:Y.keepDirtyValues?u.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!m.isValid||!!Y.keepIsValid||!!Y.keepDirtyValues||!e.shouldUnregister&&!on(fe),o.watch=!!e.shouldUnregister,o.keepIsValid=!!Y.keepIsValid,o.action=!1,Y.keepErrors||(t.errors={}),y.state.next({submitCount:Y.keepSubmitCount?t.submitCount:0,isDirty:Ee?!1:Y.keepDirty?t.isDirty:!!(Y.keepDefaultValues&&!Wi(U,s)),isSubmitted:Y.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:Ee?{}:Y.keepDirtyValues?Y.keepDefaultValues&&i?Ho(s,i):t.dirtyFields:Y.keepDefaultValues&&U?Ho(s,U):Y.keepDirty?t.dirtyFields:{},touchedFields:Y.keepTouched?t.touchedFields:{},errors:Y.keepErrors?t.errors:{},isSubmitSuccessful:Y.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:s})},Xe=(U,Y)=>ys(hs(U)?U(i):U,{...e.resetOptions,...Y}),zt=(U,Y={})=>{const se=Ue(r,U),Te=se&&se._f;if(Te){const Ee=Te.refs?Te.refs[0]:Te.ref;Ee.focus&&setTimeout(()=>{Ee.focus(),Y.shouldSelect&&hs(Ee.select)&&Ee.select()})}},nr=U=>{t={...t,...U}},qt={control:{register:vt,unregister:Ge,getFieldState:B,handleSubmit:fr,setError:pe,_subscribe:we,_runSchema:N,_updateIsValidating:A,_focusError:er,_getWatch:ie,_getDirty:H,_setValid:S,_setFieldArray:I,_setDisabledField:Ze,_setErrors:k,_getFieldArray:oe,_reset:ys,_resetDefaultValues:()=>hs(e.defaultValues)&&e.defaultValues().then(U=>{Xe(U,e.resetOptions),y.state.next({isLoading:!1})}),_removeUnmounted:q,_disableForm:Ht,_subjects:y,_proxyFormState:m,get _fields(){return r},get _formValues(){return i},get _state(){return o},set _state(U){o=U},get _defaultValues(){return s},get _names(){return u},set _names(U){u=U},get _formState(){return t},get _options(){return e},set _options(U){e={...e,...U}}},subscribe:Ie,trigger:ne,register:vt,handleSubmit:fr,watch:ge,setValue:ue,getValues:P,reset:Xe,resetField:cn,clearErrors:de,unregister:Ge,setError:pe,setFocus:zt,getFieldState:B};return{...qt,formControl:qt}}function bf(n={}){const e=ve.useRef(void 0),t=ve.useRef(void 0),[r,s]=ve.useState({isDirty:!1,isValidating:!1,isLoading:hs(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:hs(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:r},n.defaultValues&&!hs(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:o,...u}=xN(n);e.current={...u,formState:r}}const i=e.current.control;return i._options=n,nN(()=>{const o=i._subscribe({formState:i._proxyFormState,callback:()=>s({...i._formState}),reRenderRoot:!0});return s(u=>({...u,isReady:!0})),i._formState.isReady=!0,o},[i]),ve.useEffect(()=>i._disableForm(n.disabled),[i,n.disabled]),ve.useEffect(()=>{n.mode&&(i._options.mode=n.mode),n.reValidateMode&&(i._options.reValidateMode=n.reValidateMode)},[i,n.mode,n.reValidateMode]),ve.useEffect(()=>{n.errors&&(i._setErrors(n.errors),i._focusError())},[i,n.errors]),ve.useEffect(()=>{n.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,n.shouldUnregister]),ve.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==r.isDirty&&i._subjects.state.next({isDirty:o})}},[i,r.isDirty]),ve.useEffect(()=>{var o;n.values&&!Wi(n.values,t.current)?(i._reset(n.values,{keepFieldsRef:!0,...i._options.resetOptions}),!((o=i._options.resetOptions)===null||o===void 0)&&o.keepIsValid||i._setValid(),t.current=n.values,s(u=>({...u}))):i._resetDefaultValues()},[i,n.values]),ve.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),e.current.formState=ve.useMemo(()=>rN(r,i),[i,r]),e.current}const QE=(n,e,t)=>{if(n&&"reportValidity"in n){const r=Ue(t,e);n.setCustomValidity(r&&r.message||""),n.reportValidity()}},yw=(n,e)=>{for(const t in e.fields){const r=e.fields[t];r&&r.ref&&"reportValidity"in r.ref?QE(r.ref,t,n):r.refs&&r.refs.forEach(s=>QE(s,t,n))}},EN=(n,e)=>{e.shouldUseNativeValidation&&yw(n,e);const t={};for(const r in n){const s=Ue(e.fields,r),i=Object.assign(n[r]||{},{ref:s&&s.ref});if(SN(e.names||Object.keys(n),r)){const o=Object.assign({},Ue(t,r));Vt(o,"root",i),Vt(t,r,o)}else Vt(t,r,i)}return t},SN=(n,e)=>n.some(t=>t.startsWith(e+"."));var TN=function(n,e){for(var t={};n.length;){var r=n[0],s=r.code,i=r.message,o=r.path.join(".");if(!t[o])if("unionErrors"in r){var u=r.unionErrors[0].errors[0];t[o]={message:u.message,type:u.code}}else t[o]={message:i,type:s};if("unionErrors"in r&&r.unionErrors.forEach(function(h){return h.errors.forEach(function(m){return n.push(m)})}),e){var d=t[o].types,c=d&&d[r.code];t[o]=cw(o,e,t,s,c?[].concat(c,r.message):r.message)}n.shift()}return t},wf=function(n,e,t){return t===void 0&&(t={}),function(r,s,i){try{return Promise.resolve((function(o,u){try{var d=Promise.resolve(n[t.mode==="sync"?"parse":"parseAsync"](r,e)).then(function(c){return i.shouldUseNativeValidation&&yw({},i),{errors:{},values:t.raw?r:c}})}catch(c){return u(c)}return d&&d.then?d.then(void 0,u):d})(0,function(o){if((function(u){return Array.isArray(u==null?void 0:u.errors)})(o))return{values:{},errors:EN(TN(o.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw o}))}catch(o){return Promise.reject(o)}}},kt;(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const o of s)i[o]=o;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(u=>typeof s[s[u]]!="number"),o={};for(const u of i)o[u]=s[u];return n.objectValues(o)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},n.find=(s,i)=>{for(const o of s)if(i(o))return o},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(kt||(kt={}));var XE;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(XE||(XE={}));const je=kt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),zi=n=>{switch(typeof n){case"undefined":return je.undefined;case"string":return je.string;case"number":return Number.isNaN(n)?je.nan:je.number;case"boolean":return je.boolean;case"function":return je.function;case"bigint":return je.bigint;case"symbol":return je.symbol;case"object":return Array.isArray(n)?je.array:n===null?je.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?je.promise:typeof Map<"u"&&n instanceof Map?je.map:typeof Set<"u"&&n instanceof Set?je.set:typeof Date<"u"&&n instanceof Date?je.date:je.object;default:return je.unknown}},be=kt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class hi extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let u=r,d=0;for(;d<o.path.length;){const c=o.path[d];d===o.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(t(o))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return s(this),r}static assert(e){if(!(e instanceof hi))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,kt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)if(s.path.length>0){const i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}hi.create=n=>new hi(n);const Vp=(n,e)=>{let t;switch(n.code){case be.invalid_type:n.received===je.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case be.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,kt.jsonStringifyReplacer)}`;break;case be.unrecognized_keys:t=`Unrecognized key(s) in object: ${kt.joinValues(n.keys,", ")}`;break;case be.invalid_union:t="Invalid input";break;case be.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${kt.joinValues(n.options)}`;break;case be.invalid_enum_value:t=`Invalid enum value. Expected ${kt.joinValues(n.options)}, received '${n.received}'`;break;case be.invalid_arguments:t="Invalid function arguments";break;case be.invalid_return_type:t="Invalid function return type";break;case be.invalid_date:t="Invalid date";break;case be.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:kt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case be.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case be.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case be.custom:t="Invalid input";break;case be.invalid_intersection_types:t="Intersection results could not be merged";break;case be.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case be.not_finite:t="Number must be finite";break;default:t=e.defaultError,kt.assertNever(n)}return{message:t}};let bN=Vp;function wN(){return bN}const AN=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let u="";const d=r.filter(c=>!!c).slice().reverse();for(const c of d)u=c(o,{data:e,defaultError:u}).message;return{...s,path:i,message:u}};function Ce(n,e){const t=wN(),r=AN({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Vp?void 0:Vp].filter(s=>!!s)});n.common.issues.push(r)}class Bn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return at;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,o=await s.value;r.push({key:i,value:o})}return Bn.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return at;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(r[i.value]=o.value)}return{status:e.value,value:r}}}const at=Object.freeze({status:"aborted"}),Tu=n=>({status:"dirty",value:n}),Zn=n=>({status:"valid",value:n}),ZE=n=>n.status==="aborted",JE=n=>n.status==="dirty",gl=n=>n.status==="valid",lf=n=>typeof Promise<"u"&&n instanceof Promise;var He;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(He||(He={}));class da{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const eS=(n,e)=>{if(gl(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new hi(n.common.issues);return this._error=t,this._error}}};function mt(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,u)=>{const{message:d}=n;return o.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??r??u.defaultError}:o.code!=="invalid_type"?{message:u.defaultError}:{message:d??t??u.defaultError}},description:s}}class wt{get description(){return this._def.description}_getType(e){return zi(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:zi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Bn,ctx:{common:e.parent.common,data:e.data,parsedType:zi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(lf(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:zi(e)},s=this._parseSync({data:e,path:r.path,parent:r});return eS(r,s)}"~validate"(e){var r,s;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:zi(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:t});return gl(i)?{value:i.value}:{issues:t.common.issues}}catch(i){(s=(r=i==null?void 0:i.message)==null?void 0:r.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(i=>gl(i)?{value:i.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:zi(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(lf(s)?s:Promise.resolve(s));return eS(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const o=e(s),u=()=>i.addIssue({code:be.custom,...r(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(d=>d?!0:(u(),!1)):o?!0:(u(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new xl({schema:this,typeName:ot.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return oa.create(this,this._def)}nullable(){return El.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Fs.create(this)}promise(){return ff.create(this,this._def)}or(e){return cf.create([this,e],this._def)}and(e){return df.create(this,e,this._def)}transform(e){return new xl({...mt(this._def),schema:this,typeName:ot.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Kp({...mt(this._def),innerType:this,defaultValue:t,typeName:ot.ZodDefault})}brand(){return new YN({typeName:ot.ZodBranded,type:this,...mt(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Hp({...mt(this._def),innerType:this,catchValue:t,typeName:ot.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Wg.create(this,e)}readonly(){return zp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const IN=/^c[^\s-]{8,}$/i,RN=/^[0-9a-z]+$/,LN=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_N=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kN=/^[a-z0-9_-]{21}$/i,CN=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,DN=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,PN=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ON="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Km;const NN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,MN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,FN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,UN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,BN=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$N=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,vw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jN=new RegExp(`^${vw}$`);function xw(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function VN(n){return new RegExp(`^${xw(n)}$`)}function GN(n){let e=`${vw}T${xw(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function KN(n,e){return!!((e==="v4"||!e)&&NN.test(n)||(e==="v6"||!e)&&FN.test(n))}function HN(n,e){if(!CN.test(n))return!1;try{const[t]=n.split(".");if(!t)return!1;const r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function zN(n,e){return!!((e==="v4"||!e)&&MN.test(n)||(e==="v6"||!e)&&UN.test(n))}class sa extends wt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==je.string){const i=this._getOrReturnCtx(e);return Ce(i,{code:be.invalid_type,expected:je.string,received:i.parsedType}),at}const r=new Bn;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,u=e.data.length<i.value;(o||u)&&(s=this._getOrReturnCtx(e,s),o?Ce(s,{code:be.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):u&&Ce(s,{code:be.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")PN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"email",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Km||(Km=new RegExp(ON,"u")),Km.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"emoji",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")_N.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"uuid",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")kN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"nanoid",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")IN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"cuid",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")RN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"cuid2",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")LN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"ulid",code:be.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),Ce(s,{validation:"url",code:be.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"regex",code:be.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?GN(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?jN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?VN(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?DN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"duration",code:be.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?KN(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"ip",code:be.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?HN(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"jwt",code:be.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?zN(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"cidr",code:be.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?BN.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"base64",code:be.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?$N.test(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{validation:"base64url",code:be.invalid_string,message:i.message}),r.dirty()):kt.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:be.invalid_string,...He.errToObj(r)})}_addCheck(e){return new sa({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...He.errToObj(e)})}url(e){return this._addCheck({kind:"url",...He.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...He.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...He.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...He.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...He.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...He.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...He.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...He.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...He.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...He.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...He.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...He.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...He.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...He.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...He.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...He.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...He.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...He.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...He.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...He.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...He.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...He.errToObj(t)})}nonempty(e){return this.min(1,He.errToObj(e))}trim(){return new sa({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sa({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sa({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}sa.create=n=>new sa({checks:[],typeName:ot.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...mt(n)});function WN(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=Number.parseInt(n.toFixed(s).replace(".","")),o=Number.parseInt(e.toFixed(s).replace(".",""));return i%o/10**s}class yl extends wt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==je.number){const i=this._getOrReturnCtx(e);return Ce(i,{code:be.invalid_type,expected:je.number,received:i.parsedType}),at}let r;const s=new Bn;for(const i of this._def.checks)i.kind==="int"?kt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?WN(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.not_finite,message:i.message}),s.dirty()):kt.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,He.toString(t))}gt(e,t){return this.setLimit("min",e,!1,He.toString(t))}lte(e,t){return this.setLimit("max",e,!0,He.toString(t))}lt(e,t){return this.setLimit("max",e,!1,He.toString(t))}setLimit(e,t,r,s){return new yl({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:He.toString(s)}]})}_addCheck(e){return new yl({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:He.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:He.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:He.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:He.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:He.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:He.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:He.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:He.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:He.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&kt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}yl.create=n=>new yl({checks:[],typeName:ot.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...mt(n)});class Vu extends wt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==je.bigint)return this._getInvalidInput(e);let r;const s=new Bn;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:be.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):kt.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ce(t,{code:be.invalid_type,expected:je.bigint,received:t.parsedType}),at}gte(e,t){return this.setLimit("min",e,!0,He.toString(t))}gt(e,t){return this.setLimit("min",e,!1,He.toString(t))}lte(e,t){return this.setLimit("max",e,!0,He.toString(t))}lt(e,t){return this.setLimit("max",e,!1,He.toString(t))}setLimit(e,t,r,s){return new Vu({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:He.toString(s)}]})}_addCheck(e){return new Vu({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:He.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:He.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:He.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:He.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:He.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Vu.create=n=>new Vu({checks:[],typeName:ot.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...mt(n)});class tS extends wt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==je.boolean){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.boolean,received:r.parsedType}),at}return Zn(e.data)}}tS.create=n=>new tS({typeName:ot.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...mt(n)});class uf extends wt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==je.date){const i=this._getOrReturnCtx(e);return Ce(i,{code:be.invalid_type,expected:je.date,received:i.parsedType}),at}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return Ce(i,{code:be.invalid_date}),at}const r=new Bn;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:be.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):kt.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new uf({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:He.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:He.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}uf.create=n=>new uf({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ot.ZodDate,...mt(n)});class rS extends wt{_parse(e){if(this._getType(e)!==je.symbol){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.symbol,received:r.parsedType}),at}return Zn(e.data)}}rS.create=n=>new rS({typeName:ot.ZodSymbol,...mt(n)});class nS extends wt{_parse(e){if(this._getType(e)!==je.undefined){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.undefined,received:r.parsedType}),at}return Zn(e.data)}}nS.create=n=>new nS({typeName:ot.ZodUndefined,...mt(n)});class sS extends wt{_parse(e){if(this._getType(e)!==je.null){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.null,received:r.parsedType}),at}return Zn(e.data)}}sS.create=n=>new sS({typeName:ot.ZodNull,...mt(n)});class iS extends wt{constructor(){super(...arguments),this._any=!0}_parse(e){return Zn(e.data)}}iS.create=n=>new iS({typeName:ot.ZodAny,...mt(n)});class aS extends wt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Zn(e.data)}}aS.create=n=>new aS({typeName:ot.ZodUnknown,...mt(n)});class fa extends wt{_parse(e){const t=this._getOrReturnCtx(e);return Ce(t,{code:be.invalid_type,expected:je.never,received:t.parsedType}),at}}fa.create=n=>new fa({typeName:ot.ZodNever,...mt(n)});class oS extends wt{_parse(e){if(this._getType(e)!==je.undefined){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.void,received:r.parsedType}),at}return Zn(e.data)}}oS.create=n=>new oS({typeName:ot.ZodVoid,...mt(n)});class Fs extends wt{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==je.array)return Ce(t,{code:be.invalid_type,expected:je.array,received:t.parsedType}),at;if(s.exactLength!==null){const o=t.data.length>s.exactLength.value,u=t.data.length<s.exactLength.value;(o||u)&&(Ce(t,{code:o?be.too_big:be.too_small,minimum:u?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(Ce(t,{code:be.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(Ce(t,{code:be.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,u)=>s.type._parseAsync(new da(t,o,t.path,u)))).then(o=>Bn.mergeArray(r,o));const i=[...t.data].map((o,u)=>s.type._parseSync(new da(t,o,t.path,u)));return Bn.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Fs({...this._def,minLength:{value:e,message:He.toString(t)}})}max(e,t){return new Fs({...this._def,maxLength:{value:e,message:He.toString(t)}})}length(e,t){return new Fs({...this._def,exactLength:{value:e,message:He.toString(t)}})}nonempty(e){return this.min(1,e)}}Fs.create=(n,e)=>new Fs({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ot.ZodArray,...mt(e)});function zo(n){if(n instanceof Tr){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=oa.create(zo(r))}return new Tr({...n._def,shape:()=>e})}else return n instanceof Fs?new Fs({...n._def,type:zo(n.element)}):n instanceof oa?oa.create(zo(n.unwrap())):n instanceof El?El.create(zo(n.unwrap())):n instanceof ro?ro.create(n.items.map(e=>zo(e))):n}class Tr extends wt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=kt.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==je.object){const c=this._getOrReturnCtx(e);return Ce(c,{code:be.invalid_type,expected:je.object,received:c.parsedType}),at}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof fa&&this._def.unknownKeys==="strip"))for(const c in s.data)o.includes(c)||u.push(c);const d=[];for(const c of o){const h=i[c],m=s.data[c];d.push({key:{status:"valid",value:c},value:h._parse(new da(s,m,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof fa){const c=this._def.unknownKeys;if(c==="passthrough")for(const h of u)d.push({key:{status:"valid",value:h},value:{status:"valid",value:s.data[h]}});else if(c==="strict")u.length>0&&(Ce(s,{code:be.unrecognized_keys,keys:u}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const h of u){const m=s.data[h];d.push({key:{status:"valid",value:h},value:c._parse(new da(s,m,s.path,h)),alwaysSet:h in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const h of d){const m=await h.key,g=await h.value;c.push({key:m,value:g,alwaysSet:h.alwaysSet})}return c}).then(c=>Bn.mergeObjectSync(r,c)):Bn.mergeObjectSync(r,d)}get shape(){return this._def.shape()}strict(e){return He.errToObj,new Tr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,o;const s=((o=(i=this._def).errorMap)==null?void 0:o.call(i,t,r).message)??r.defaultError;return t.code==="unrecognized_keys"?{message:He.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new Tr({...this._def,unknownKeys:"strip"})}passthrough(){return new Tr({...this._def,unknownKeys:"passthrough"})}extend(e){return new Tr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Tr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ot.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Tr({...this._def,catchall:e})}pick(e){const t={};for(const r of kt.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new Tr({...this._def,shape:()=>t})}omit(e){const t={};for(const r of kt.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new Tr({...this._def,shape:()=>t})}deepPartial(){return zo(this)}partial(e){const t={};for(const r of kt.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new Tr({...this._def,shape:()=>t})}required(e){const t={};for(const r of kt.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof oa;)i=i._def.innerType;t[r]=i}return new Tr({...this._def,shape:()=>t})}keyof(){return Ew(kt.objectKeys(this.shape))}}Tr.create=(n,e)=>new Tr({shape:()=>n,unknownKeys:"strip",catchall:fa.create(),typeName:ot.ZodObject,...mt(e)});Tr.strictCreate=(n,e)=>new Tr({shape:()=>n,unknownKeys:"strict",catchall:fa.create(),typeName:ot.ZodObject,...mt(e)});Tr.lazycreate=(n,e)=>new Tr({shape:n,unknownKeys:"strip",catchall:fa.create(),typeName:ot.ZodObject,...mt(e)});class cf extends wt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const u of i)if(u.result.status==="valid")return u.result;for(const u of i)if(u.result.status==="dirty")return t.common.issues.push(...u.ctx.common.issues),u.result;const o=i.map(u=>new hi(u.ctx.common.issues));return Ce(t,{code:be.invalid_union,unionErrors:o}),at}if(t.common.async)return Promise.all(r.map(async i=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i;const o=[];for(const d of r){const c={...t,common:{...t.common,issues:[]},parent:null},h=d._parseSync({data:t.data,path:t.path,parent:c});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const u=o.map(d=>new hi(d));return Ce(t,{code:be.invalid_union,unionErrors:u}),at}}get options(){return this._def.options}}cf.create=(n,e)=>new cf({options:n,typeName:ot.ZodUnion,...mt(e)});function Gp(n,e){const t=zi(n),r=zi(e);if(n===e)return{valid:!0,data:n};if(t===je.object&&r===je.object){const s=kt.objectKeys(e),i=kt.objectKeys(n).filter(u=>s.indexOf(u)!==-1),o={...n,...e};for(const u of i){const d=Gp(n[u],e[u]);if(!d.valid)return{valid:!1};o[u]=d.data}return{valid:!0,data:o}}else if(t===je.array&&r===je.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const o=n[i],u=e[i],d=Gp(o,u);if(!d.valid)return{valid:!1};s.push(d.data)}return{valid:!0,data:s}}else return t===je.date&&r===je.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class df extends wt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,o)=>{if(ZE(i)||ZE(o))return at;const u=Gp(i.value,o.value);return u.valid?((JE(i)||JE(o))&&t.dirty(),{status:t.value,value:u.data}):(Ce(r,{code:be.invalid_intersection_types}),at)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}df.create=(n,e,t)=>new df({left:n,right:e,typeName:ot.ZodIntersection,...mt(t)});class ro extends wt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==je.array)return Ce(r,{code:be.invalid_type,expected:je.array,received:r.parsedType}),at;if(r.data.length<this._def.items.length)return Ce(r,{code:be.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),at;!this._def.rest&&r.data.length>this._def.items.length&&(Ce(r,{code:be.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((o,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new da(r,o,r.path,u)):null}).filter(o=>!!o);return r.common.async?Promise.all(i).then(o=>Bn.mergeArray(t,o)):Bn.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new ro({...this._def,rest:e})}}ro.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ro({items:n,typeName:ot.ZodTuple,rest:null,...mt(e)})};class lS extends wt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==je.map)return Ce(r,{code:be.invalid_type,expected:je.map,received:r.parsedType}),at;const s=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([u,d],c)=>({key:s._parse(new da(r,u,r.path,[c,"key"])),value:i._parse(new da(r,d,r.path,[c,"value"]))}));if(r.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of o){const c=await d.key,h=await d.value;if(c.status==="aborted"||h.status==="aborted")return at;(c.status==="dirty"||h.status==="dirty")&&t.dirty(),u.set(c.value,h.value)}return{status:t.value,value:u}})}else{const u=new Map;for(const d of o){const c=d.key,h=d.value;if(c.status==="aborted"||h.status==="aborted")return at;(c.status==="dirty"||h.status==="dirty")&&t.dirty(),u.set(c.value,h.value)}return{status:t.value,value:u}}}}lS.create=(n,e,t)=>new lS({valueType:e,keyType:n,typeName:ot.ZodMap,...mt(t)});class Gu extends wt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==je.set)return Ce(r,{code:be.invalid_type,expected:je.set,received:r.parsedType}),at;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(Ce(r,{code:be.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(Ce(r,{code:be.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function o(d){const c=new Set;for(const h of d){if(h.status==="aborted")return at;h.status==="dirty"&&t.dirty(),c.add(h.value)}return{status:t.value,value:c}}const u=[...r.data.values()].map((d,c)=>i._parse(new da(r,d,r.path,c)));return r.common.async?Promise.all(u).then(d=>o(d)):o(u)}min(e,t){return new Gu({...this._def,minSize:{value:e,message:He.toString(t)}})}max(e,t){return new Gu({...this._def,maxSize:{value:e,message:He.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Gu.create=(n,e)=>new Gu({valueType:n,minSize:null,maxSize:null,typeName:ot.ZodSet,...mt(e)});class uS extends wt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}uS.create=(n,e)=>new uS({getter:n,typeName:ot.ZodLazy,...mt(e)});class cS extends wt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ce(t,{received:t.data,code:be.invalid_literal,expected:this._def.value}),at}return{status:"valid",value:e.data}}get value(){return this._def.value}}cS.create=(n,e)=>new cS({value:n,typeName:ot.ZodLiteral,...mt(e)});function Ew(n,e){return new vl({values:n,typeName:ot.ZodEnum,...mt(e)})}class vl extends wt{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return Ce(t,{expected:kt.joinValues(r),received:t.parsedType,code:be.invalid_type}),at}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Ce(t,{received:t.data,code:be.invalid_enum_value,options:r}),at}return Zn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return vl.create(e,{...this._def,...t})}exclude(e,t=this._def){return vl.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}vl.create=Ew;class dS extends wt{_parse(e){const t=kt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==je.string&&r.parsedType!==je.number){const s=kt.objectValues(t);return Ce(r,{expected:kt.joinValues(s),received:r.parsedType,code:be.invalid_type}),at}if(this._cache||(this._cache=new Set(kt.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=kt.objectValues(t);return Ce(r,{received:r.data,code:be.invalid_enum_value,options:s}),at}return Zn(e.data)}get enum(){return this._def.values}}dS.create=(n,e)=>new dS({values:n,typeName:ot.ZodNativeEnum,...mt(e)});class ff extends wt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==je.promise&&t.common.async===!1)return Ce(t,{code:be.invalid_type,expected:je.promise,received:t.parsedType}),at;const r=t.parsedType===je.promise?t.data:Promise.resolve(t.data);return Zn(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ff.create=(n,e)=>new ff({type:n,typeName:ot.ZodPromise,...mt(e)});class xl extends wt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ot.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{Ce(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const o=s.transform(r.data,i);if(r.common.async)return Promise.resolve(o).then(async u=>{if(t.value==="aborted")return at;const d=await this._def.schema._parseAsync({data:u,path:r.path,parent:r});return d.status==="aborted"?at:d.status==="dirty"||t.value==="dirty"?Tu(d.value):d});{if(t.value==="aborted")return at;const u=this._def.schema._parseSync({data:o,path:r.path,parent:r});return u.status==="aborted"?at:u.status==="dirty"||t.value==="dirty"?Tu(u.value):u}}if(s.type==="refinement"){const o=u=>{const d=s.refinement(u,i);if(r.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(r.common.async===!1){const u=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return u.status==="aborted"?at:(u.status==="dirty"&&t.dirty(),o(u.value),{status:t.value,value:u.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(u=>u.status==="aborted"?at:(u.status==="dirty"&&t.dirty(),o(u.value).then(()=>({status:t.value,value:u.value}))))}if(s.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!gl(o))return at;const u=s.transform(o.value,i);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:u}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>gl(o)?Promise.resolve(s.transform(o.value,i)).then(u=>({status:t.value,value:u})):at);kt.assertNever(s)}}xl.create=(n,e,t)=>new xl({schema:n,typeName:ot.ZodEffects,effect:e,...mt(t)});xl.createWithPreprocess=(n,e,t)=>new xl({schema:e,effect:{type:"preprocess",transform:n},typeName:ot.ZodEffects,...mt(t)});class oa extends wt{_parse(e){return this._getType(e)===je.undefined?Zn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oa.create=(n,e)=>new oa({innerType:n,typeName:ot.ZodOptional,...mt(e)});class El extends wt{_parse(e){return this._getType(e)===je.null?Zn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}El.create=(n,e)=>new El({innerType:n,typeName:ot.ZodNullable,...mt(e)});class Kp extends wt{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===je.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Kp.create=(n,e)=>new Kp({innerType:n,typeName:ot.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...mt(e)});class Hp extends wt{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return lf(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new hi(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new hi(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Hp.create=(n,e)=>new Hp({innerType:n,typeName:ot.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...mt(e)});class fS extends wt{_parse(e){if(this._getType(e)!==je.nan){const r=this._getOrReturnCtx(e);return Ce(r,{code:be.invalid_type,expected:je.nan,received:r.parsedType}),at}return{status:"valid",value:e.data}}}fS.create=n=>new fS({typeName:ot.ZodNaN,...mt(n)});class YN extends wt{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Wg extends wt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?at:i.status==="dirty"?(t.dirty(),Tu(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?at:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Wg({in:e,out:t,typeName:ot.ZodPipeline})}}class zp extends wt{_parse(e){const t=this._def.innerType._parse(e),r=s=>(gl(s)&&(s.value=Object.freeze(s.value)),s);return lf(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}zp.create=(n,e)=>new zp({innerType:n,typeName:ot.ZodReadonly,...mt(e)});var ot;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ot||(ot={}));const yt=sa.create,Jo=yl.create;fa.create;const Sw=Fs.create,mi=Tr.create;cf.create;df.create;ro.create;const oo=vl.create;ff.create;oa.create;El.create;const qN=oo(["user","creator","admin"]),QN=oo(["long","short","live","replay"]),XN=oo(["public","unlisted","private"]),ZN=oo(["published","reviewing","rejected","draft"]),Zu=mi({id:yt(),name:yt(),handle:yt(),avatarUrl:yt().url(),role:qN,followersCount:Jo().int().nonnegative()}),JN=mi({id:yt(),type:QN,title:yt(),description:yt(),coverUrl:yt().url(),duration:Jo().int().nonnegative(),views:Jo().int().nonnegative(),likes:Jo().int().nonnegative(),createdAt:yt(),author:Zu,tags:Sw(yt()),category:yt(),visibility:XN,status:ZN,hlsUrl:yt().url().optional()});mi({id:yt(),entityType:oo(["video","short","live"]),entityId:yt(),author:Zu,content:yt(),createdAt:yt(),likeCount:Jo().int().nonnegative(),parentId:yt().optional()});mi({id:yt(),title:yt(),coverUrl:yt().url(),author:Zu,viewers:Jo().int().nonnegative(),category:yt(),status:oo(["live","offline"]),hlsUrl:yt().url(),startedAt:yt()});mi({id:yt(),title:yt(),items:Sw(JN)});const eM=mi({identifier:yt().min(2),password:yt().min(6)}),tM=mi({name:yt().min(2),handle:yt().min(2),password:yt().min(6)}),rM=mi({content:yt().min(1).max(300)});function Tw({entityType:n,entityId:e}){var m;const t=pa(),r=Za(g=>g.user),s=gr({queryKey:["comments",n,e],queryFn:()=>ld.list(n,e)}),i=bf({resolver:wf(rM),defaultValues:{content:""}}),o=Ms({mutationFn:g=>ld.create({entityType:n,entityId:e,content:g,currentUserId:r==null?void 0:r.id}),onSuccess:()=>{t.invalidateQueries({queryKey:["comments",n,e]}),i.reset()}}),u=Ms({mutationFn:g=>ld.like(g),onSuccess:()=>t.invalidateQueries({queryKey:["comments",n,e]})}),d=Ms({mutationFn:g=>ld.delete(g),onSuccess:()=>t.invalidateQueries({queryKey:["comments",n,e]})}),c=((m=s.data)==null?void 0:m.items)??[],h=c.filter(g=>!g.parentId);return b.jsxs("section",{className:"space-y-5",children:[b.jsxs("h3",{className:"text-base font-bold",children:[c.length," Comments"]}),b.jsxs("form",{onSubmit:i.handleSubmit(g=>o.mutate(g.content)),className:"flex gap-3",children:[r&&b.jsx("img",{src:r.avatarUrl,className:"mt-1 h-8 w-8 shrink-0 rounded-full object-cover",alt:r.name}),b.jsxs("div",{className:"flex-1",children:[b.jsx("input",{placeholder:"Add a comment...",className:"w-full border-b bg-transparent pb-1 text-sm outline-none focus:border-foreground",...i.register("content")}),b.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[b.jsx(Ct,{type:"button",variant:"ghost",size:"sm",className:"rounded-full",onClick:()=>i.reset(),children:"Cancel"}),b.jsx(Ct,{type:"submit",size:"sm",className:"rounded-full",disabled:o.isPending,children:"Comment"})]})]})]}),h.map(g=>b.jsx(nM,{comment:g,replies:c.filter(y=>y.parentId===g.id),currentUserId:r==null?void 0:r.id,onLike:y=>u.mutate(y),onDelete:y=>d.mutate(y)},g.id))]})}function nM({comment:n,replies:e,currentUserId:t,onLike:r,onDelete:s}){const[i,o]=D.useState(!1);return b.jsxs("div",{className:"flex gap-3",children:[b.jsx("img",{src:n.author.avatarUrl,className:"mt-0.5 h-8 w-8 shrink-0 rounded-full object-cover",alt:n.author.name}),b.jsxs("div",{className:"flex-1",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-xs font-medium",children:n.author.name}),b.jsx("span",{className:"text-xs text-muted-foreground",children:Pu(n.createdAt)})]}),b.jsx("p",{className:"mt-1 text-sm",children:n.content}),b.jsxs("div",{className:"mt-1 flex items-center gap-3",children:[b.jsxs("button",{onClick:()=>r(n.id),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground",children:[b.jsx(ag,{className:"h-3.5 w-3.5"}),n.likeCount>0&&n.likeCount]}),e.length>0&&b.jsxs("button",{onClick:()=>o(!i),className:"text-xs font-medium text-primary",children:[i?"Hide":`${e.length}`," ",e.length===1?"reply":"replies"]}),n.author.id===t&&b.jsx("button",{onClick:()=>s(n.id),className:"text-xs text-muted-foreground hover:text-destructive",children:b.jsx(YR,{className:"h-3.5 w-3.5"})})]}),i&&e.length>0&&b.jsx("div",{className:"mt-3 space-y-3",children:e.map(u=>b.jsxs("div",{className:"flex gap-3",children:[b.jsx("img",{src:u.author.avatarUrl,className:"mt-0.5 h-6 w-6 shrink-0 rounded-full object-cover",alt:u.author.name}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-xs font-medium",children:u.author.name}),b.jsx("span",{className:"text-xs text-muted-foreground",children:Pu(u.createdAt)})]}),b.jsx("p",{className:"mt-0.5 text-sm",children:u.content})]})]},u.id))})]})]})}function sM(n){return gr({queryKey:["video",n],queryFn:()=>cg.detail(n)})}function iM(n){return gr({queryKey:["video",n,"recommend"],queryFn:()=>cg.recommendations(n)})}function aM(n){const e=pa();return Ms({mutationFn:()=>cg.like(n),onSuccess:()=>e.invalidateQueries({queryKey:["video",n]})})}function bw(){var u,d,c;const{id:n=""}=yf(),e=sM(n),t=iM(n),r=aM(n),[s,i]=D.useState(!1),o=(u=e.data)==null?void 0:u.video;return o?b.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-[1fr_380px]",children:[b.jsxs("section",{className:"space-y-3",children:[b.jsx("div",{className:"overflow-hidden rounded-xl",children:b.jsx(lw,{src:o.hlsUrl??"",poster:o.coverUrl,autoPlay:!0,playbackKey:o.id})}),b.jsx("h1",{className:"text-xl font-bold leading-snug",children:o.title}),b.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("img",{src:o.author.avatarUrl,className:"h-10 w-10 rounded-full object-cover",alt:o.author.name}),b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium",children:o.author.name}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[qn(o.author.followersCount)," subscribers"]})]})]}),b.jsx(Ct,{className:"rounded-full bg-foreground text-background hover:bg-foreground/90",children:"Subscribe"}),b.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[b.jsxs("div",{className:"flex items-center overflow-hidden rounded-full bg-secondary",children:[b.jsxs("button",{onClick:()=>r.mutate(),className:"flex items-center gap-1 px-4 py-2 text-sm font-medium hover:bg-secondary/70",children:[b.jsx(ag,{className:"h-4 w-4"}),qn(o.likes)]}),b.jsx("div",{className:"h-6 w-px bg-border"}),b.jsx("button",{className:"px-3 py-2 hover:bg-secondary/70",children:b.jsx(cT,{className:"h-4 w-4"})})]}),b.jsxs(Ct,{variant:"secondary",className:"gap-2 rounded-full",children:[b.jsx(uT,{className:"h-4 w-4"})," Share"]}),b.jsxs(Ct,{variant:"secondary",className:"gap-2 rounded-full",children:[b.jsx(_R,{className:"h-4 w-4"})," Save"]}),b.jsx(Ct,{variant:"secondary",size:"icon",className:"rounded-full",children:b.jsx(NR,{className:"h-4 w-4"})})]})]}),b.jsxs("div",{className:"cursor-pointer rounded-xl bg-secondary p-3 text-sm transition-colors hover:bg-secondary/80",onClick:()=>i(!s),children:[b.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[b.jsxs("span",{children:[qn(o.views)," views"]}),b.jsx("span",{children:Pu(o.createdAt)})]}),b.jsx("p",{className:s?"mt-2 whitespace-pre-wrap":"mt-2 line-clamp-2",children:o.description}),s&&((d=e.data)==null?void 0:d.chapters)&&e.data.chapters.length>0&&b.jsxs("div",{className:"mt-3 space-y-1 border-t border-border pt-3",children:[b.jsx("p",{className:"text-sm font-medium",children:"Chapters"}),e.data.chapters.map(h=>b.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.jsxs("span",{className:"font-medium text-primary",children:[Math.floor(h.time/60),":",String(h.time%60).padStart(2,"0")]})," ",h.title]},h.id))]}),b.jsx("button",{className:"mt-1 flex items-center gap-1 text-xs font-medium text-muted-foreground",children:s?b.jsxs(b.Fragment,{children:["Show less ",b.jsx(DR,{className:"h-3 w-3"})]}):b.jsxs(b.Fragment,{children:["...more ",b.jsx(kR,{className:"h-3 w-3"})]})})]}),b.jsx(Tw,{entityType:"video",entityId:n})]}),b.jsx("aside",{className:"space-y-3",children:(((c=t.data)==null?void 0:c.items)??[]).map(h=>b.jsx(Rl,{video:h,horizontal:!0},h.id))})]}):b.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."})}function oM(){return gr({queryKey:["shorts"],queryFn:xT.list})}function lM(){const n=pa();return Ms({mutationFn:e=>xT.like(e),onSuccess:()=>n.invalidateQueries({queryKey:["shorts"]})})}function la(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n==null||n(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function hS(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Yg(...n){return e=>{let t=!1;const r=n.map(s=>{const i=hS(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():hS(n[s],null)}}}}function lo(...n){return D.useCallback(Yg(...n),n)}function uM(n,e){const t=D.createContext(e),r=i=>{const{children:o,...u}=i,d=D.useMemo(()=>u,Object.values(u));return b.jsx(t.Provider,{value:d,children:o})};r.displayName=n+"Provider";function s(i){const o=D.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${n}\``)}return[r,s]}function cM(n,e=[]){let t=[];function r(i,o){const u=D.createContext(o),d=t.length;t=[...t,o];const c=m=>{var A;const{scope:g,children:y,...v}=m,E=((A=g==null?void 0:g[n])==null?void 0:A[d])||u,S=D.useMemo(()=>v,Object.values(v));return b.jsx(E.Provider,{value:S,children:y})};c.displayName=i+"Provider";function h(m,g){var E;const y=((E=g==null?void 0:g[n])==null?void 0:E[d])||u,v=D.useContext(y);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${m}\` must be used within \`${i}\``)}return[c,h]}const s=()=>{const i=t.map(o=>D.createContext(o));return function(u){const d=(u==null?void 0:u[n])||i;return D.useMemo(()=>({[`__scope${n}`]:{...u,[n]:d}}),[u,d])}};return s.scopeName=n,[r,dM(s,...e)]}function dM(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=r.reduce((u,{useScope:d,scopeName:c})=>{const m=d(i)[`__scope${c}`];return{...u,...m}},{});return D.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}var Ku=globalThis!=null&&globalThis.document?D.useLayoutEffect:()=>{},fM=Jp[" useId ".trim().toString()]||(()=>{}),hM=0;function Hm(n){const[e,t]=D.useState(fM());return Ku(()=>{t(r=>r??String(hM++))},[n]),n||(e?`radix-${e}`:"")}var mM=Jp[" useInsertionEffect ".trim().toString()]||Ku;function pM({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[s,i,o]=gM({defaultProp:e,onChange:t}),u=n!==void 0,d=u?n:s;{const h=D.useRef(n!==void 0);D.useEffect(()=>{const m=h.current;m!==u&&console.warn(`${r} is changing from ${m?"controlled":"uncontrolled"} to ${u?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=u},[u,r])}const c=D.useCallback(h=>{var m;if(u){const g=yM(h)?h(n):h;g!==n&&((m=o.current)==null||m.call(o,g))}else i(h)},[u,n,i,o]);return[d,c]}function gM({defaultProp:n,onChange:e}){const[t,r]=D.useState(n),s=D.useRef(t),i=D.useRef(e);return mM(()=>{i.current=e},[e]),D.useEffect(()=>{var o;s.current!==t&&((o=i.current)==null||o.call(i,t),s.current=t)},[t,s]),[t,r,i]}function yM(n){return typeof n=="function"}function vM(n){const e=xM(n),t=D.forwardRef((r,s)=>{const{children:i,...o}=r,u=D.Children.toArray(i),d=u.find(SM);if(d){const c=d.props.children,h=u.map(m=>m===d?D.Children.count(c)>1?D.Children.only(null):D.isValidElement(c)?c.props.children:null:m);return b.jsx(e,{...o,ref:s,children:D.isValidElement(c)?D.cloneElement(c,void 0,h):null})}return b.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${n}.Slot`,t}function xM(n){const e=D.forwardRef((t,r)=>{const{children:s,...i}=t;if(D.isValidElement(s)){const o=bM(s),u=TM(i,s.props);return s.type!==D.Fragment&&(u.ref=r?Yg(r,o):o),D.cloneElement(s,u)}return D.Children.count(s)>1?D.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var EM=Symbol("radix.slottable");function SM(n){return D.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===EM}function TM(n,e){const t={...e};for(const r in e){const s=n[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?t[r]=(...u)=>{const d=i(...u);return s(...u),d}:s&&(t[r]=s):r==="style"?t[r]={...s,...i}:r==="className"&&(t[r]=[s,i].filter(Boolean).join(" "))}return{...n,...t}}function bM(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var wM=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],pi=wM.reduce((n,e)=>{const t=vM(`Primitive.${e}`),r=D.forwardRef((s,i)=>{const{asChild:o,...u}=s,d=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(d,{...u,ref:i})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function AM(n,e){n&&eg.flushSync(()=>n.dispatchEvent(e))}function Hu(n){const e=D.useRef(n);return D.useEffect(()=>{e.current=n}),D.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function IM(n,e=globalThis==null?void 0:globalThis.document){const t=Hu(n);D.useEffect(()=>{const r=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var RM="DismissableLayer",Wp="dismissableLayer.update",LM="dismissableLayer.pointerDownOutside",_M="dismissableLayer.focusOutside",mS,ww=D.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Aw=D.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:u,...d}=n,c=D.useContext(ww),[h,m]=D.useState(null),g=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,y]=D.useState({}),v=lo(e,_=>m(_)),E=Array.from(c.layers),[S]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),A=E.indexOf(S),I=h?E.indexOf(h):-1,R=c.layersWithOutsidePointerEventsDisabled.size>0,k=I>=A,C=DM(_=>{const N=_.target,F=[...c.branches].some(O=>O.contains(N));!k||F||(s==null||s(_),o==null||o(_),_.defaultPrevented||u==null||u())},g),V=PM(_=>{const N=_.target;[...c.branches].some(O=>O.contains(N))||(i==null||i(_),o==null||o(_),_.defaultPrevented||u==null||u())},g);return IM(_=>{I===c.layers.size-1&&(r==null||r(_),!_.defaultPrevented&&u&&(_.preventDefault(),u()))},g),D.useEffect(()=>{if(h)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(mS=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(h)),c.layers.add(h),pS(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=mS)}},[h,g,t,c]),D.useEffect(()=>()=>{h&&(c.layers.delete(h),c.layersWithOutsidePointerEventsDisabled.delete(h),pS())},[h,c]),D.useEffect(()=>{const _=()=>y({});return document.addEventListener(Wp,_),()=>document.removeEventListener(Wp,_)},[]),b.jsx(pi.div,{...d,ref:v,style:{pointerEvents:R?k?"auto":"none":void 0,...n.style},onFocusCapture:la(n.onFocusCapture,V.onFocusCapture),onBlurCapture:la(n.onBlurCapture,V.onBlurCapture),onPointerDownCapture:la(n.onPointerDownCapture,C.onPointerDownCapture)})});Aw.displayName=RM;var kM="DismissableLayerBranch",CM=D.forwardRef((n,e)=>{const t=D.useContext(ww),r=D.useRef(null),s=lo(e,r);return D.useEffect(()=>{const i=r.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),b.jsx(pi.div,{...n,ref:s})});CM.displayName=kM;function DM(n,e=globalThis==null?void 0:globalThis.document){const t=Hu(n),r=D.useRef(!1),s=D.useRef(()=>{});return D.useEffect(()=>{const i=u=>{if(u.target&&!r.current){let d=function(){Iw(LM,t,c,{discrete:!0})};const c={originalEvent:u};u.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=d,e.addEventListener("click",s.current,{once:!0})):d()}else e.removeEventListener("click",s.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function PM(n,e=globalThis==null?void 0:globalThis.document){const t=Hu(n),r=D.useRef(!1);return D.useEffect(()=>{const s=i=>{i.target&&!r.current&&Iw(_M,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function pS(){const n=new CustomEvent(Wp);document.dispatchEvent(n)}function Iw(n,e,t,{discrete:r}){const s=t.originalEvent.target,i=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?AM(s,i):s.dispatchEvent(i)}var zm="focusScope.autoFocusOnMount",Wm="focusScope.autoFocusOnUnmount",gS={bubbles:!1,cancelable:!0},OM="FocusScope",Rw=D.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=n,[u,d]=D.useState(null),c=Hu(s),h=Hu(i),m=D.useRef(null),g=lo(e,E=>d(E)),y=D.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;D.useEffect(()=>{if(r){let E=function(R){if(y.paused||!u)return;const k=R.target;u.contains(k)?m.current=k:Gi(m.current,{select:!0})},S=function(R){if(y.paused||!u)return;const k=R.relatedTarget;k!==null&&(u.contains(k)||Gi(m.current,{select:!0}))},A=function(R){if(document.activeElement===document.body)for(const C of R)C.removedNodes.length>0&&Gi(u)};document.addEventListener("focusin",E),document.addEventListener("focusout",S);const I=new MutationObserver(A);return u&&I.observe(u,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",E),document.removeEventListener("focusout",S),I.disconnect()}}},[r,u,y.paused]),D.useEffect(()=>{if(u){vS.add(y);const E=document.activeElement;if(!u.contains(E)){const A=new CustomEvent(zm,gS);u.addEventListener(zm,c),u.dispatchEvent(A),A.defaultPrevented||(NM($M(Lw(u)),{select:!0}),document.activeElement===E&&Gi(u))}return()=>{u.removeEventListener(zm,c),setTimeout(()=>{const A=new CustomEvent(Wm,gS);u.addEventListener(Wm,h),u.dispatchEvent(A),A.defaultPrevented||Gi(E??document.body,{select:!0}),u.removeEventListener(Wm,h),vS.remove(y)},0)}}},[u,c,h,y]);const v=D.useCallback(E=>{if(!t&&!r||y.paused)return;const S=E.key==="Tab"&&!E.altKey&&!E.ctrlKey&&!E.metaKey,A=document.activeElement;if(S&&A){const I=E.currentTarget,[R,k]=MM(I);R&&k?!E.shiftKey&&A===k?(E.preventDefault(),t&&Gi(R,{select:!0})):E.shiftKey&&A===R&&(E.preventDefault(),t&&Gi(k,{select:!0})):A===I&&E.preventDefault()}},[t,r,y.paused]);return b.jsx(pi.div,{tabIndex:-1,...o,ref:g,onKeyDown:v})});Rw.displayName=OM;function NM(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Gi(r,{select:e}),document.activeElement!==t)return}function MM(n){const e=Lw(n),t=yS(e,n),r=yS(e.reverse(),n);return[t,r]}function Lw(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function yS(n,e){for(const t of n)if(!FM(t,{upTo:e}))return t}function FM(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function UM(n){return n instanceof HTMLInputElement&&"select"in n}function Gi(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&UM(n)&&e&&n.select()}}var vS=BM();function BM(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=xS(n,e),n.unshift(e)},remove(e){var t;n=xS(n,e),(t=n[0])==null||t.resume()}}}function xS(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function $M(n){return n.filter(e=>e.tagName!=="A")}var jM="Portal",_w=D.forwardRef((n,e)=>{var u;const{container:t,...r}=n,[s,i]=D.useState(!1);Ku(()=>i(!0),[]);const o=t||s&&((u=globalThis==null?void 0:globalThis.document)==null?void 0:u.body);return o?tg.createPortal(b.jsx(pi.div,{...r,ref:e}),o):null});_w.displayName=jM;function VM(n,e){return D.useReducer((t,r)=>e[t][r]??t,n)}var Af=n=>{const{present:e,children:t}=n,r=GM(e),s=typeof t=="function"?t({present:r.isPresent}):D.Children.only(t),i=lo(r.ref,KM(s));return typeof t=="function"||r.isPresent?D.cloneElement(s,{ref:i}):null};Af.displayName="Presence";function GM(n){const[e,t]=D.useState(),r=D.useRef(null),s=D.useRef(n),i=D.useRef("none"),o=n?"mounted":"unmounted",[u,d]=VM(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return D.useEffect(()=>{const c=Ad(r.current);i.current=u==="mounted"?c:"none"},[u]),Ku(()=>{const c=r.current,h=s.current;if(h!==n){const g=i.current,y=Ad(c);n?d("MOUNT"):y==="none"||(c==null?void 0:c.display)==="none"?d("UNMOUNT"):d(h&&g!==y?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,d]),Ku(()=>{if(e){let c;const h=e.ownerDocument.defaultView??window,m=y=>{const E=Ad(r.current).includes(CSS.escape(y.animationName));if(y.target===e&&E&&(d("ANIMATION_END"),!s.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",c=h.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},g=y=>{y.target===e&&(i.current=Ad(r.current))};return e.addEventListener("animationstart",g),e.addEventListener("animationcancel",m),e.addEventListener("animationend",m),()=>{h.clearTimeout(c),e.removeEventListener("animationstart",g),e.removeEventListener("animationcancel",m),e.removeEventListener("animationend",m)}}else d("ANIMATION_END")},[e,d]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:D.useCallback(c=>{r.current=c?getComputedStyle(c):null,t(c)},[])}}function Ad(n){return(n==null?void 0:n.animationName)||"none"}function KM(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Ym=0;function HM(){D.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??ES()),document.body.insertAdjacentElement("beforeend",n[1]??ES()),Ym++,()=>{Ym===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ym--}},[])}function ES(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Ps=function(){return Ps=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ps.apply(this,arguments)};function kw(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function zM(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var jd="right-scroll-bar-position",Vd="width-before-scroll-bar",WM="with-scroll-bars-hidden",YM="--removed-body-scroll-bar-size";function qm(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function qM(n,e){var t=D.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var s=t.value;s!==r&&(t.value=r,t.callback(r,s))}}}})[0];return t.callback=e,t.facade}var QM=typeof window<"u"?D.useLayoutEffect:D.useEffect,SS=new WeakMap;function XM(n,e){var t=qM(null,function(r){return n.forEach(function(s){return qm(s,r)})});return QM(function(){var r=SS.get(t);if(r){var s=new Set(r),i=new Set(n),o=t.current;s.forEach(function(u){i.has(u)||qm(u,null)}),i.forEach(function(u){s.has(u)||qm(u,o)})}SS.set(t,n)},[n]),t}function ZM(n){return n}function JM(n,e){e===void 0&&(e=ZM);var t=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(i){var o=e(i,r);return t.push(o),function(){t=t.filter(function(u){return u!==o})}},assignSyncMedium:function(i){for(r=!0;t.length;){var o=t;t=[],o.forEach(i)}t={push:function(u){return i(u)},filter:function(){return t}}},assignMedium:function(i){r=!0;var o=[];if(t.length){var u=t;t=[],u.forEach(i),o=t}var d=function(){var h=o;o=[],h.forEach(i)},c=function(){return Promise.resolve().then(d)};c(),t={push:function(h){o.push(h),c()},filter:function(h){return o=o.filter(h),t}}}};return s}function eF(n){n===void 0&&(n={});var e=JM(null);return e.options=Ps({async:!0,ssr:!1},n),e}var Cw=function(n){var e=n.sideCar,t=kw(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return D.createElement(r,Ps({},t))};Cw.isSideCarExport=!0;function tF(n,e){return n.useMedium(e),Cw}var Dw=eF(),Qm=function(){},If=D.forwardRef(function(n,e){var t=D.useRef(null),r=D.useState({onScrollCapture:Qm,onWheelCapture:Qm,onTouchMoveCapture:Qm}),s=r[0],i=r[1],o=n.forwardProps,u=n.children,d=n.className,c=n.removeScrollBar,h=n.enabled,m=n.shards,g=n.sideCar,y=n.noRelative,v=n.noIsolation,E=n.inert,S=n.allowPinchZoom,A=n.as,I=A===void 0?"div":A,R=n.gapMode,k=kw(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=g,V=XM([t,e]),_=Ps(Ps({},k),s);return D.createElement(D.Fragment,null,h&&D.createElement(C,{sideCar:Dw,removeScrollBar:c,shards:m,noRelative:y,noIsolation:v,inert:E,setCallbacks:i,allowPinchZoom:!!S,lockRef:t,gapMode:R}),o?D.cloneElement(D.Children.only(u),Ps(Ps({},_),{ref:V})):D.createElement(I,Ps({},_,{className:d,ref:V}),u))});If.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};If.classNames={fullWidth:Vd,zeroRight:jd};var rF=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function nF(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=rF();return e&&n.setAttribute("nonce",e),n}function sF(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function iF(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var aF=function(){var n=0,e=null;return{add:function(t){n==0&&(e=nF())&&(sF(e,t),iF(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},oF=function(){var n=aF();return function(e,t){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},Pw=function(){var n=oF(),e=function(t){var r=t.styles,s=t.dynamic;return n(r,s),null};return e},lF={left:0,top:0,right:0,gap:0},Xm=function(n){return parseInt(n||"",10)||0},uF=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],s=e[n==="padding"?"paddingRight":"marginRight"];return[Xm(t),Xm(r),Xm(s)]},cF=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return lF;var e=uF(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},dF=Pw(),el="data-scroll-locked",fF=function(n,e,t,r){var s=n.left,i=n.top,o=n.right,u=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(WM,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(u,"px ").concat(r,`;
  }
  body[`).concat(el,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(u,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(u,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(jd,` {
    right: `).concat(u,"px ").concat(r,`;
  }
  
  .`).concat(Vd,` {
    margin-right: `).concat(u,"px ").concat(r,`;
  }
  
  .`).concat(jd," .").concat(jd,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Vd," .").concat(Vd,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(el,`] {
    `).concat(YM,": ").concat(u,`px;
  }
`)},TS=function(){var n=parseInt(document.body.getAttribute(el)||"0",10);return isFinite(n)?n:0},hF=function(){D.useEffect(function(){return document.body.setAttribute(el,(TS()+1).toString()),function(){var n=TS()-1;n<=0?document.body.removeAttribute(el):document.body.setAttribute(el,n.toString())}},[])},mF=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,s=r===void 0?"margin":r;hF();var i=D.useMemo(function(){return cF(s)},[s]);return D.createElement(dF,{styles:fF(i,!e,s,t?"":"!important")})},Yp=!1;if(typeof window<"u")try{var Id=Object.defineProperty({},"passive",{get:function(){return Yp=!0,!0}});window.addEventListener("test",Id,Id),window.removeEventListener("test",Id,Id)}catch{Yp=!1}var $o=Yp?{passive:!1}:!1,pF=function(n){return n.tagName==="TEXTAREA"},Ow=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!pF(n)&&t[e]==="visible")},gF=function(n){return Ow(n,"overflowY")},yF=function(n){return Ow(n,"overflowX")},bS=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var s=Nw(n,r);if(s){var i=Mw(n,r),o=i[1],u=i[2];if(o>u)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},vF=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},xF=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},Nw=function(n,e){return n==="v"?gF(e):yF(e)},Mw=function(n,e){return n==="v"?vF(e):xF(e)},EF=function(n,e){return n==="h"&&e==="rtl"?-1:1},SF=function(n,e,t,r,s){var i=EF(n,window.getComputedStyle(e).direction),o=i*r,u=t.target,d=e.contains(u),c=!1,h=o>0,m=0,g=0;do{if(!u)break;var y=Mw(n,u),v=y[0],E=y[1],S=y[2],A=E-S-i*v;(v||A)&&Nw(n,u)&&(m+=A,g+=v);var I=u.parentNode;u=I&&I.nodeType===Node.DOCUMENT_FRAGMENT_NODE?I.host:I}while(!d&&u!==document.body||d&&(e.contains(u)||e===u));return(h&&Math.abs(m)<1||!h&&Math.abs(g)<1)&&(c=!0),c},Rd=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},wS=function(n){return[n.deltaX,n.deltaY]},AS=function(n){return n&&"current"in n?n.current:n},TF=function(n,e){return n[0]===e[0]&&n[1]===e[1]},bF=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},wF=0,jo=[];function AF(n){var e=D.useRef([]),t=D.useRef([0,0]),r=D.useRef(),s=D.useState(wF++)[0],i=D.useState(Pw)[0],o=D.useRef(n);D.useEffect(function(){o.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(s));var E=zM([n.lockRef.current],(n.shards||[]).map(AS),!0).filter(Boolean);return E.forEach(function(S){return S.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),E.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(s))})}}},[n.inert,n.lockRef.current,n.shards]);var u=D.useCallback(function(E,S){if("touches"in E&&E.touches.length===2||E.type==="wheel"&&E.ctrlKey)return!o.current.allowPinchZoom;var A=Rd(E),I=t.current,R="deltaX"in E?E.deltaX:I[0]-A[0],k="deltaY"in E?E.deltaY:I[1]-A[1],C,V=E.target,_=Math.abs(R)>Math.abs(k)?"h":"v";if("touches"in E&&_==="h"&&V.type==="range")return!1;var N=window.getSelection(),F=N&&N.anchorNode,O=F?F===V||F.contains(V):!1;if(O)return!1;var q=bS(_,V);if(!q)return!0;if(q?C=_:(C=_==="v"?"h":"v",q=bS(_,V)),!q)return!1;if(!r.current&&"changedTouches"in E&&(R||k)&&(r.current=C),!C)return!0;var H=r.current||C;return SF(H,S,E,H==="h"?R:k)},[]),d=D.useCallback(function(E){var S=E;if(!(!jo.length||jo[jo.length-1]!==i)){var A="deltaY"in S?wS(S):Rd(S),I=e.current.filter(function(C){return C.name===S.type&&(C.target===S.target||S.target===C.shadowParent)&&TF(C.delta,A)})[0];if(I&&I.should){S.cancelable&&S.preventDefault();return}if(!I){var R=(o.current.shards||[]).map(AS).filter(Boolean).filter(function(C){return C.contains(S.target)}),k=R.length>0?u(S,R[0]):!o.current.noIsolation;k&&S.cancelable&&S.preventDefault()}}},[]),c=D.useCallback(function(E,S,A,I){var R={name:E,delta:S,target:A,should:I,shadowParent:IF(A)};e.current.push(R),setTimeout(function(){e.current=e.current.filter(function(k){return k!==R})},1)},[]),h=D.useCallback(function(E){t.current=Rd(E),r.current=void 0},[]),m=D.useCallback(function(E){c(E.type,wS(E),E.target,u(E,n.lockRef.current))},[]),g=D.useCallback(function(E){c(E.type,Rd(E),E.target,u(E,n.lockRef.current))},[]);D.useEffect(function(){return jo.push(i),n.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:g}),document.addEventListener("wheel",d,$o),document.addEventListener("touchmove",d,$o),document.addEventListener("touchstart",h,$o),function(){jo=jo.filter(function(E){return E!==i}),document.removeEventListener("wheel",d,$o),document.removeEventListener("touchmove",d,$o),document.removeEventListener("touchstart",h,$o)}},[]);var y=n.removeScrollBar,v=n.inert;return D.createElement(D.Fragment,null,v?D.createElement(i,{styles:bF(s)}):null,y?D.createElement(mF,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function IF(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const RF=tF(Dw,AF);var Fw=D.forwardRef(function(n,e){return D.createElement(If,Ps({},n,{ref:e,sideCar:RF}))});Fw.classNames=If.classNames;var LF=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Vo=new WeakMap,Ld=new WeakMap,_d={},Zm=0,Uw=function(n){return n&&(n.host||Uw(n.parentNode))},_F=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=Uw(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},kF=function(n,e,t,r){var s=_F(e,Array.isArray(n)?n:[n]);_d[t]||(_d[t]=new WeakMap);var i=_d[t],o=[],u=new Set,d=new Set(s),c=function(m){!m||u.has(m)||(u.add(m),c(m.parentNode))};s.forEach(c);var h=function(m){!m||d.has(m)||Array.prototype.forEach.call(m.children,function(g){if(u.has(g))h(g);else try{var y=g.getAttribute(r),v=y!==null&&y!=="false",E=(Vo.get(g)||0)+1,S=(i.get(g)||0)+1;Vo.set(g,E),i.set(g,S),o.push(g),E===1&&v&&Ld.set(g,!0),S===1&&g.setAttribute(t,"true"),v||g.setAttribute(r,"true")}catch(A){console.error("aria-hidden: cannot operate on ",g,A)}})};return h(e),u.clear(),Zm++,function(){o.forEach(function(m){var g=Vo.get(m)-1,y=i.get(m)-1;Vo.set(m,g),i.set(m,y),g||(Ld.has(m)||m.removeAttribute(r),Ld.delete(m)),y||m.removeAttribute(t)}),Zm--,Zm||(Vo=new WeakMap,Vo=new WeakMap,Ld=new WeakMap,_d={})}},CF=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),s=LF(n);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live], script"))),kF(r,s,t,"aria-hidden")):function(){return null}};function DF(n){const e=PF(n),t=D.forwardRef((r,s)=>{const{children:i,...o}=r,u=D.Children.toArray(i),d=u.find(NF);if(d){const c=d.props.children,h=u.map(m=>m===d?D.Children.count(c)>1?D.Children.only(null):D.isValidElement(c)?c.props.children:null:m);return b.jsx(e,{...o,ref:s,children:D.isValidElement(c)?D.cloneElement(c,void 0,h):null})}return b.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${n}.Slot`,t}function PF(n){const e=D.forwardRef((t,r)=>{const{children:s,...i}=t;if(D.isValidElement(s)){const o=FF(s),u=MF(i,s.props);return s.type!==D.Fragment&&(u.ref=r?Yg(r,o):o),D.cloneElement(s,u)}return D.Children.count(s)>1?D.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var OF=Symbol("radix.slottable");function NF(n){return D.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===OF}function MF(n,e){const t={...e};for(const r in e){const s=n[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?t[r]=(...u)=>{const d=i(...u);return s(...u),d}:s&&(t[r]=s):r==="style"?t[r]={...s,...i}:r==="className"&&(t[r]=[s,i].filter(Boolean).join(" "))}return{...n,...t}}function FF(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Rf="Dialog",[Bw]=cM(Rf),[UF,gs]=Bw(Rf),$w=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:s,onOpenChange:i,modal:o=!0}=n,u=D.useRef(null),d=D.useRef(null),[c,h]=pM({prop:r,defaultProp:s??!1,onChange:i,caller:Rf});return b.jsx(UF,{scope:e,triggerRef:u,contentRef:d,contentId:Hm(),titleId:Hm(),descriptionId:Hm(),open:c,onOpenChange:h,onOpenToggle:D.useCallback(()=>h(m=>!m),[h]),modal:o,children:t})};$w.displayName=Rf;var jw="DialogTrigger",BF=D.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=gs(jw,t),i=lo(e,s.triggerRef);return b.jsx(pi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Xg(s.open),...r,ref:i,onClick:la(n.onClick,s.onOpenToggle)})});BF.displayName=jw;var qg="DialogPortal",[$F,Vw]=Bw(qg,{forceMount:void 0}),Gw=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:s}=n,i=gs(qg,e);return b.jsx($F,{scope:e,forceMount:t,children:D.Children.map(r,o=>b.jsx(Af,{present:t||i.open,children:b.jsx(_w,{asChild:!0,container:s,children:o})}))})};Gw.displayName=qg;var hf="DialogOverlay",Kw=D.forwardRef((n,e)=>{const t=Vw(hf,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=gs(hf,n.__scopeDialog);return i.modal?b.jsx(Af,{present:r||i.open,children:b.jsx(VF,{...s,ref:e})}):null});Kw.displayName=hf;var jF=DF("DialogOverlay.RemoveScroll"),VF=D.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=gs(hf,t);return b.jsx(Fw,{as:jF,allowPinchZoom:!0,shards:[s.contentRef],children:b.jsx(pi.div,{"data-state":Xg(s.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),no="DialogContent",Hw=D.forwardRef((n,e)=>{const t=Vw(no,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=gs(no,n.__scopeDialog);return b.jsx(Af,{present:r||i.open,children:i.modal?b.jsx(GF,{...s,ref:e}):b.jsx(KF,{...s,ref:e})})});Hw.displayName=no;var GF=D.forwardRef((n,e)=>{const t=gs(no,n.__scopeDialog),r=D.useRef(null),s=lo(e,t.contentRef,r);return D.useEffect(()=>{const i=r.current;if(i)return CF(i)},[]),b.jsx(zw,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:la(n.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:la(n.onPointerDownOutside,i=>{const o=i.detail.originalEvent,u=o.button===0&&o.ctrlKey===!0;(o.button===2||u)&&i.preventDefault()}),onFocusOutside:la(n.onFocusOutside,i=>i.preventDefault())})}),KF=D.forwardRef((n,e)=>{const t=gs(no,n.__scopeDialog),r=D.useRef(!1),s=D.useRef(!1);return b.jsx(zw,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,u;(o=n.onCloseAutoFocus)==null||o.call(n,i),i.defaultPrevented||(r.current||(u=t.triggerRef.current)==null||u.focus(),i.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:i=>{var d,c;(d=n.onInteractOutside)==null||d.call(n,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),zw=D.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,...o}=n,u=gs(no,t),d=D.useRef(null),c=lo(e,d);return HM(),b.jsxs(b.Fragment,{children:[b.jsx(Rw,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:i,children:b.jsx(Aw,{role:"dialog",id:u.contentId,"aria-describedby":u.descriptionId,"aria-labelledby":u.titleId,"data-state":Xg(u.open),...o,ref:c,onDismiss:()=>u.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(YF,{titleId:u.titleId}),b.jsx(QF,{contentRef:d,descriptionId:u.descriptionId})]})]})}),Qg="DialogTitle",HF=D.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=gs(Qg,t);return b.jsx(pi.h2,{id:s.titleId,...r,ref:e})});HF.displayName=Qg;var Ww="DialogDescription",zF=D.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=gs(Ww,t);return b.jsx(pi.p,{id:s.descriptionId,...r,ref:e})});zF.displayName=Ww;var Yw="DialogClose",WF=D.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=gs(Yw,t);return b.jsx(pi.button,{type:"button",...r,ref:e,onClick:la(n.onClick,()=>s.onOpenChange(!1))})});WF.displayName=Yw;function Xg(n){return n?"open":"closed"}var qw="DialogTitleWarning",[lU,Qw]=uM(qw,{contentName:no,titleName:Qg,docsSlug:"dialog"}),YF=({titleId:n})=>{const e=Qw(qw),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return D.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},qF="DialogDescriptionWarning",QF=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Qw(qF).contentName}}.`;return D.useEffect(()=>{var i;const s=(i=n.current)==null?void 0:i.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},XF=$w,ZF=Gw,JF=Kw,e2=Hw;const t2=XF;function r2({className:n,...e}){return b.jsxs(ZF,{children:[b.jsx(JF,{className:"fixed inset-0 bg-black/50"}),b.jsx(e2,{className:Hr("fixed bottom-0 right-0 top-0 z-50 w-full max-w-md border-l bg-background p-4 shadow-xl",n),...e})]})}function n2(){var h;const n=oM(),e=lM(),t=D.useRef([]),[r,s]=D.useState(!1),[i,o]=D.useState(""),[u,d]=D.useState(!0);D.useEffect(()=>{const m=new IntersectionObserver(g=>{g.forEach(y=>{const v=y.target;y.isIntersecting?(t.current.forEach(E=>E==null?void 0:E.pause()),v.play().catch(()=>null),o(v.dataset.id??"")):v.pause()})},{threshold:.7});return t.current.forEach(g=>g&&m.observe(g)),()=>m.disconnect()},[n.data]);const c=((h=n.data)==null?void 0:h.items)??[];return b.jsxs("div",{className:"mx-auto max-w-[420px]",style:{height:"calc(100vh - 56px)",overflowY:"auto",scrollSnapType:"y mandatory"},children:[c.map((m,g)=>b.jsx("div",{className:"relative flex items-center justify-center",style:{height:"calc(100vh - 56px)",scrollSnapAlign:"start"},children:b.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-xl bg-black",children:[b.jsx("video",{"data-id":m.id,ref:y=>t.current[g]=y,src:m.hlsUrl??"https://www.w3schools.com/html/mov_bbb.mp4",poster:m.coverUrl,className:"h-full w-full object-cover",loop:!0,playsInline:!0,muted:u,preload:"metadata"}),b.jsxs("div",{className:"absolute bottom-0 left-0 right-14 bg-gradient-to-t from-black/70 to-transparent p-4 pt-16",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("img",{src:m.author.avatarUrl,className:"h-9 w-9 rounded-full border-2 border-white object-cover",alt:m.author.name}),b.jsx("span",{className:"text-sm font-semibold text-white",children:m.author.name})]}),b.jsx("p",{className:"mt-2 line-clamp-2 text-sm text-white/90",children:m.title}),b.jsx("div",{className:"mt-2 flex items-center gap-2",children:b.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-white/20 px-2 py-0.5 text-xs text-white",children:[b.jsx("span",{children:""})," Original audio"]})})]}),b.jsxs("div",{className:"absolute bottom-20 right-3 flex flex-col items-center gap-5",children:[b.jsx(Go,{icon:b.jsx(FR,{className:"h-6 w-6"}),label:qn(m.likes),onClick:()=>e.mutate(m.id)}),b.jsx(Go,{icon:b.jsx(cT,{className:"h-6 w-6"}),label:"Dislike",onClick:()=>{}}),b.jsx(Go,{icon:b.jsx(VR,{className:"h-6 w-6"}),label:"Comments",onClick:()=>{o(m.id),s(!0)}}),b.jsx(Go,{icon:b.jsx(uT,{className:"h-6 w-6"}),label:"Share",onClick:()=>{}}),b.jsx(Go,{icon:u?b.jsx(ZR,{className:"h-6 w-6"}):b.jsx(XR,{className:"h-6 w-6"}),label:u?"Unmute":"Mute",onClick:()=>d(!u)}),b.jsx(Go,{icon:b.jsx(oT,{className:"h-6 w-6"}),label:"",onClick:()=>{}})]})]})},m.id)),b.jsx(t2,{open:r,onOpenChange:s,children:b.jsx(r2,{children:b.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-4",children:i?b.jsx(Tw,{entityType:"short",entityId:i}):null})})})]})}function Go({icon:n,label:e,onClick:t}){return b.jsxs("button",{onClick:t,className:"flex flex-col items-center gap-0.5 text-white drop-shadow-lg",children:[n,e&&b.jsx("span",{className:"text-[11px] font-medium",children:e})]})}function s2({room:n}){return b.jsxs(ps,{to:`/live/${n.id}`,className:"group block",children:[b.jsxs("div",{className:"relative overflow-hidden rounded-xl",children:[b.jsx("img",{src:n.coverUrl,alt:n.title,className:"aspect-video w-full object-cover transition group-hover:scale-[1.02]"}),b.jsxs("span",{className:"absolute left-2 top-2 flex items-center gap-1 rounded bg-red-600 px-1.5 py-0.5 text-[11px] font-bold text-white",children:[b.jsx("span",{className:"h-1.5 w-1.5 animate-pulse rounded-full bg-white"}),"LIVE"]}),b.jsxs("span",{className:"absolute bottom-2 right-2 rounded bg-black/70 px-1.5 py-0.5 text-[11px] font-medium text-white",children:[qn(n.viewers)," watching"]})]}),b.jsxs("div",{className:"mt-3 flex gap-3",children:[b.jsx("img",{src:n.author.avatarUrl,className:"h-9 w-9 shrink-0 rounded-full object-cover",alt:n.author.name}),b.jsxs("div",{children:[b.jsx("p",{className:"line-clamp-2 text-sm font-medium leading-snug",children:n.title}),b.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:n.author.name})]})]})]})}function i2(n){return gr({queryKey:["live",n],queryFn:()=>dg.list(n)})}function a2(n){return gr({queryKey:["live",n],queryFn:()=>dg.detail(n)})}function o2(n){return gr({queryKey:["live",n,"chat"],queryFn:()=>dg.chat(n),refetchInterval:3e3})}const l2=["All","Tech","Education","Gaming","Music"];function u2(){var r,s;const[n,e]=D.useState("All"),t=i2(n);return b.jsxs("section",{className:"space-y-5",children:[b.jsx("h1",{className:"text-2xl font-bold",children:"Live"}),b.jsx("div",{className:"flex gap-2 overflow-x-auto",children:l2.map(i=>b.jsx("button",{onClick:()=>e(i),className:Hr("shrink-0 rounded-full px-3 py-1.5 text-sm font-medium transition-colors",i===n?"bg-foreground text-background":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:i},i))}),b.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:(s=(r=t.data)==null?void 0:r.items)==null?void 0:s.map(i=>b.jsx(s2,{room:i},i.id))})]})}function c2(){var o,u,d;const{id:n=""}=yf(),[e]=sT(),t=e.get("tab"),r=a2(n),s=o2(n);if(t==="replay")return b.jsx(bw,{});const i=(o=r.data)==null?void 0:o.room;return i?b.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-[1fr_360px]",children:[b.jsxs("section",{className:"space-y-3",children:[b.jsx("div",{className:"overflow-hidden rounded-xl",children:b.jsx(lw,{src:i.hlsUrl,poster:i.coverUrl,autoPlay:!0})}),b.jsx("h1",{className:"text-xl font-bold",children:i.title}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("img",{src:i.author.avatarUrl,className:"h-10 w-10 rounded-full object-cover",alt:i.author.name}),b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium",children:i.author.name}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[qn(i.viewers)," watching now"]})]}),b.jsx(Ct,{className:"ml-auto rounded-full bg-foreground text-background hover:bg-foreground/90",children:"Subscribe"})]})]}),b.jsxs("div",{className:"flex flex-col rounded-xl border",style:{height:"70vh"},children:[b.jsx("div",{className:"border-b px-4 py-3",children:b.jsx("h3",{className:"text-sm font-semibold",children:"Live chat"})}),b.jsx("div",{className:"flex-1 space-y-1 overflow-y-auto p-3",children:(d=(u=s.data)==null?void 0:u.items)==null?void 0:d.map(c=>b.jsxs("div",{className:"flex gap-2 rounded-md px-2 py-1 hover:bg-accent",children:[b.jsx("img",{src:c.author.avatarUrl,className:"mt-0.5 h-6 w-6 shrink-0 rounded-full object-cover",alt:c.author.name}),b.jsxs("p",{className:"text-sm",children:[b.jsx("span",{className:"mr-1 font-medium text-muted-foreground",children:c.author.name}),c.content]})]},c.id))})]})]}):b.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})}const d2=["Home","Videos","Shorts","Replay","About"];function f2(){var o,u;const{id:n=""}=yf(),[e,t]=D.useState("Videos"),r=gr({queryKey:["channel",n],queryFn:()=>zL.detail(n)}),s=(o=r.data)==null?void 0:o.channel,i=((u=r.data)==null?void 0:u.content)??[];return s?b.jsxs("section",{className:"space-y-4",children:[b.jsx("div",{className:"h-28 rounded-xl bg-gradient-to-r from-primary/30 via-primary/10 to-primary/30 sm:h-36 lg:h-44",style:{backgroundImage:`url(https://picsum.photos/seed/${n}/1200/300)`,backgroundSize:"cover",backgroundPosition:"center"}}),b.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("img",{src:s.avatarUrl,className:"h-20 w-20 rounded-full object-cover",alt:s.name}),b.jsxs("div",{children:[b.jsx("h1",{className:"text-2xl font-bold",children:s.name}),b.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.handle,"  ",qn(s.followersCount)," subscribers"]})]})]}),b.jsx(Ct,{className:"w-fit rounded-full bg-foreground text-background hover:bg-foreground/90",children:"Subscribe"})]}),b.jsx("div",{className:"border-b",children:b.jsx("div",{className:"flex gap-6",children:d2.map(d=>b.jsx("button",{onClick:()=>t(d),className:Hr("border-b-2 px-1 pb-3 text-sm font-medium transition-colors",d===e?"border-foreground text-foreground":"border-transparent text-muted-foreground hover:text-foreground"),children:d},d))})}),e==="About"?b.jsxs("div",{className:"max-w-xl space-y-2 text-sm text-muted-foreground",children:[b.jsxs("p",{children:["Channel created by ",s.name]}),b.jsxs("p",{children:[qn(s.followersCount)," subscribers"]})]}):b.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:i.map(d=>b.jsx(Rl,{video:d},d.id))})]}):b.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})}function h2(){var r;const{id:n=""}=yf(),t=(r=gr({queryKey:["playlist",n],queryFn:()=>WL.detail(n)}).data)==null?void 0:r.playlist;return t?b.jsxs("section",{className:"space-y-4",children:[b.jsx("h1",{className:"text-xl font-bold",children:t.title}),b.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:t.items.map(s=>b.jsx(Rl,{video:s},s.id))})]}):b.jsx("p",{children:"Loading..."})}const An=D.forwardRef(({className:n,type:e,...t},r)=>b.jsx("input",{type:e,className:Hr("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",n),ref:r,...t}));An.displayName="Input";function so({className:n,...e}){return b.jsx("div",{className:Hr("rounded-lg border bg-card text-card-foreground shadow-sm",n),...e})}function Sl({className:n,...e}){return b.jsx("div",{className:Hr("flex flex-col space-y-1.5 p-4",n),...e})}function Tl({className:n,...e}){return b.jsx("h3",{className:Hr("font-semibold",n),...e})}function io({className:n,...e}){return b.jsx("div",{className:Hr("p-4 pt-0",n),...e})}function m2(){const n=Al(),e=Za(s=>s.setSession),t=bf({resolver:wf(eM),defaultValues:{identifier:"",password:""}}),r=Ms({mutationFn:lg.login,onSuccess:s=>{const i=Zu.parse(s.user);e(i,s.token),n("/")}});return b.jsx("div",{className:"mx-auto mt-20 max-w-md",children:b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:""})}),b.jsxs(io,{children:[b.jsxs("form",{className:"space-y-3",onSubmit:t.handleSubmit(s=>r.mutate(s)),children:[b.jsx(An,{placeholder:": user/creator/admin",...t.register("identifier")}),b.jsx(An,{type:"password",placeholder:": 123456",...t.register("password")}),b.jsx(Ct,{type:"submit",className:"w-full",children:""})]}),b.jsxs("p",{className:"mt-3 text-sm",children:["",b.jsx(ps,{to:"/register",className:"text-primary",children:""})]})]})]})})}function p2(){const n=Al(),e=Za(s=>s.setSession),t=bf({resolver:wf(tM),defaultValues:{name:"",handle:"",password:""}}),r=Ms({mutationFn:lg.register,onSuccess:s=>{const i=Zu.parse(s.user);e(i,s.token),n("/")}});return b.jsx("div",{className:"mx-auto mt-20 max-w-md",children:b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:""})}),b.jsxs(io,{children:[b.jsxs("form",{className:"space-y-3",onSubmit:t.handleSubmit(s=>r.mutate(s)),children:[b.jsx(An,{placeholder:"",...t.register("name")}),b.jsx(An,{placeholder:"handle",...t.register("handle")}),b.jsx(An,{type:"password",placeholder:"",...t.register("password")}),b.jsx(Ct,{type:"submit",className:"w-full",children:""})]}),b.jsxs("p",{className:"mt-3 text-sm",children:["",b.jsx(ps,{to:"/login",className:"text-primary",children:""})]})]})]})})}const Zg=D.forwardRef(({className:n,...e},t)=>b.jsx("textarea",{className:Hr("min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",n),ref:t,...e}));Zg.displayName="Textarea";const g2=mi({title:yt().min(2),description:yt().min(2),tags:yt().optional(),category:yt().min(1),visibility:oo(["public","unlisted","private"]),scheduleAt:yt().optional(),coverUrl:yt().optional()});function y2(){var e,t;const n=gr({queryKey:["studio","overview"],queryFn:hl.overview});return b.jsxs("section",{className:"space-y-4",children:[b.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:(((e=n.data)==null?void 0:e.cards)??[]).map(r=>b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:r.label})}),b.jsx(io,{children:r.value})]},r.label))}),b.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:(((t=n.data)==null?void 0:t.latest)??[]).map(r=>b.jsx(Rl,{video:r},r.id))})]})}function v2(){const n=pa(),e=bf({resolver:wf(g2),defaultValues:{title:localStorage.getItem("draft:title")??"",description:localStorage.getItem("draft:description")??"",tags:"",category:"Tech",visibility:"public",scheduleAt:"",coverUrl:""}}),t=e.watch("coverUrl"),r=Ms({mutationFn:s=>{var i;return hl.upload({...s,tags:((i=s.tags)==null?void 0:i.split(",").map(o=>o.trim()))??[],status:s.scheduleAt?"draft":"reviewing"})},onSuccess:()=>{n.invalidateQueries({queryKey:["studio"]}),localStorage.removeItem("draft:title"),localStorage.removeItem("draft:description"),e.reset()}});return b.jsxs("section",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[1fr_320px]",children:[b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:""})}),b.jsx(io,{children:b.jsxs("form",{className:"space-y-3",onSubmit:e.handleSubmit(s=>r.mutate(s)),children:[b.jsx(An,{placeholder:"",...e.register("title"),onBlur:s=>localStorage.setItem("draft:title",s.target.value)}),b.jsx(Zg,{placeholder:"",...e.register("description"),onBlur:s=>localStorage.setItem("draft:description",s.target.value)}),b.jsx(An,{placeholder:"URLmock",...e.register("coverUrl")}),b.jsx(An,{placeholder:"",...e.register("tags")}),b.jsx(An,{placeholder:"",...e.register("category")}),b.jsxs("select",{className:"h-9 w-full rounded-md border bg-background px-3 text-sm",...e.register("visibility"),children:[b.jsx("option",{value:"public",children:""}),b.jsx("option",{value:"unlisted",children:""}),b.jsx("option",{value:"private",children:""})]}),b.jsx(An,{type:"datetime-local",...e.register("scheduleAt")}),b.jsx(Ct,{type:"submit",disabled:r.isPending,children:"mock"})]})})]}),b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:""})}),b.jsx(io,{children:b.jsx("div",{className:"rounded-lg border p-2",children:t?b.jsx("img",{src:t,className:"aspect-video w-full rounded object-cover"}):b.jsx("p",{className:"text-sm text-muted-foreground",children:""})})})]})]})}function x2(){var i;const[n,e]=D.useState("all"),t=pa(),r=gr({queryKey:["studio","content",n],queryFn:()=>hl.content(n)}),s=Ms({mutationFn:({id:o,next:u})=>hl.update(o,{status:u}),onSuccess:()=>t.invalidateQueries({queryKey:["studio","content"]})});return b.jsxs("section",{className:"space-y-3",children:[b.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:n,onChange:o=>e(o.target.value),children:[b.jsx("option",{value:"all",children:""}),b.jsx("option",{value:"published",children:""}),b.jsx("option",{value:"reviewing",children:""}),b.jsx("option",{value:"rejected",children:""}),b.jsx("option",{value:"draft",children:""})]}),b.jsx("div",{className:"space-y-2",children:(((i=r.data)==null?void 0:i.items)??[]).map(o=>b.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[b.jsxs("div",{children:[b.jsx("p",{className:"font-medium",children:o.title}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:["",o.status]})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Ct,{size:"sm",variant:"outline",onClick:()=>s.mutate({id:o.id,next:"draft"}),children:""}),b.jsx(Ct,{size:"sm",onClick:()=>s.mutate({id:o.id,next:"published"}),children:""})]})]},o.id))})]})}function E2(){var r;const[n,e]=D.useState(!1),t=gr({queryKey:["live","list"],queryFn:()=>hl.content("published")});return b.jsxs("section",{className:"space-y-4",children:[b.jsx(so,{children:b.jsxs(io,{className:"pt-4",children:[b.jsx("p",{children:"rtmp://mock/live/stream-key-xxx"}),b.jsx("p",{children:"mock-key-1234"})]})}),b.jsx(Ct,{onClick:()=>e(s=>!s),children:n?"":""}),b.jsx("div",{className:"space-y-2",children:(r=t.data)==null?void 0:r.items.slice(0,3).map(s=>b.jsxs("div",{className:"rounded border p-2 text-sm",children:["",s.title]},s.id))})]})}function S2(){var e,t;const n=gr({queryKey:["studio","comments"],queryFn:hl.comments});return b.jsx("section",{className:"space-y-3",children:(t=(e=n.data)==null?void 0:e.items)==null?void 0:t.map(r=>b.jsxs("div",{className:"rounded-lg border p-3",children:[b.jsxs("p",{className:"text-sm",children:[b.jsx("span",{className:"font-medium",children:r.author.name}),": ",r.content]}),b.jsxs("div",{className:"mt-2 flex gap-2",children:[b.jsx(Ct,{size:"sm",variant:"outline",children:""}),b.jsx(Ct,{size:"sm",variant:"outline",children:""})]})]},r.id))})}function T2(){return b.jsxs("section",{className:"max-w-xl space-y-3",children:[b.jsx(An,{placeholder:"",defaultValue:"Creator Channel"}),b.jsx(An,{placeholder:" URL",defaultValue:"https://i.pravatar.cc/120?img=24"}),b.jsx(An,{placeholder:" URL",defaultValue:"https://picsum.photos/seed/banner/1200/320"}),b.jsx(Zg,{placeholder:"",defaultValue:"Build products and ship fast."}),b.jsx(Ct,{children:""})]})}function b2(){var e;const n=gr({queryKey:["admin","dashboard"],queryFn:Du.dashboard});return b.jsx("section",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:(((e=n.data)==null?void 0:e.stats)??[]).map(t=>b.jsxs(so,{children:[b.jsx(Sl,{children:b.jsx(Tl,{children:t.label})}),b.jsx(io,{children:t.value})]},t.label))})}function w2(){var r;const n=pa(),e=gr({queryKey:["admin","review"],queryFn:Du.reviewQueue}),t=Ms({mutationFn:({id:s,act:i})=>Du.reviewAction(s,i),onSuccess:()=>n.invalidateQueries({queryKey:["admin","review"]})});return b.jsx("section",{className:"space-y-3",children:(r=e.data)==null?void 0:r.items.map(s=>b.jsxs("div",{className:"rounded-lg border p-3",children:[b.jsx("p",{className:"font-medium",children:s.title}),b.jsxs("div",{className:"mt-2 flex gap-2",children:[b.jsx(Ct,{size:"sm",onClick:()=>t.mutate({id:s.id,act:"approve"}),children:""}),b.jsx(Ct,{size:"sm",variant:"outline",onClick:()=>t.mutate({id:s.id,act:"reject"}),children:""}),b.jsx(Ct,{size:"sm",variant:"destructive",onClick:()=>t.mutate({id:s.id,act:"take_down"}),children:""})]})]},s.id))})}function A2(){var e,t;const n=gr({queryKey:["admin","reports"],queryFn:Du.reports});return b.jsx("section",{className:"space-y-2",children:(t=(e=n.data)==null?void 0:e.items)==null?void 0:t.map(r=>b.jsxs("div",{className:"rounded-lg border p-3 text-sm",children:[r.reason," ","->"," ",r.target," (",r.status,")"]},r.id))})}function I2(){var e,t;const n=gr({queryKey:["admin","users"],queryFn:Du.users});return b.jsx("section",{className:"space-y-2",children:(t=(e=n.data)==null?void 0:e.items)==null?void 0:t.map(r=>b.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 text-sm",children:[b.jsxs("span",{children:[r.name," (",r.role,")"]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Ct,{size:"sm",variant:"outline",children:"/"}),b.jsx(Ct,{size:"sm",variant:"outline",children:""})]})]},r.id))})}function R2({title:n}){return b.jsx("div",{className:"rounded-lg border p-8 text-sm text-muted-foreground",children:n})}const L2=cR([{path:"/",element:b.jsx(qL,{}),children:[{index:!0,element:b.jsx($_,{})},{path:"trending",element:b.jsx(j_,{})},{path:"subscriptions",element:b.jsx(V_,{})},{path:"search",element:b.jsx(z_,{})},{path:"watch/:id",element:b.jsx(bw,{})},{path:"shorts",element:b.jsx(n2,{})},{path:"live",element:b.jsx(u2,{})},{path:"live/:id",element:b.jsx(c2,{})},{path:"channel/:id",element:b.jsx(f2,{})},{path:"playlist/:id",element:b.jsx(h2,{})},{path:"history",element:b.jsx(R2,{title:"mock"})},{element:b.jsx(lx,{allow:["creator","admin"]}),children:[{path:"studio",element:b.jsx(y2,{})},{path:"studio/upload",element:b.jsx(v2,{})},{path:"studio/content",element:b.jsx(x2,{})},{path:"studio/live",element:b.jsx(E2,{})},{path:"studio/comments",element:b.jsx(S2,{})},{path:"studio/settings",element:b.jsx(T2,{})}]},{element:b.jsx(lx,{allow:["admin"]}),children:[{path:"admin/dashboard",element:b.jsx(b2,{})},{path:"admin/content",element:b.jsx(w2,{})},{path:"admin/reports",element:b.jsx(A2,{})},{path:"admin/users",element:b.jsx(I2,{})}]}]},{path:"/login",element:b.jsx(m2,{})},{path:"/register",element:b.jsx(p2,{})},{path:"*",element:b.jsx(rp,{to:"/",replace:!0})}]);function _2(){return b.jsx(xR,{router:L2})}var k2=n=>{switch(n){case"success":return P2;case"info":return N2;case"warning":return O2;case"error":return M2;default:return null}},C2=Array(12).fill(0),D2=({visible:n,className:e})=>ve.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},ve.createElement("div",{className:"sonner-spinner"},C2.map((t,r)=>ve.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),P2=ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ve.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),O2=ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ve.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),N2=ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),M2=ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),F2=ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ve.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ve.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),U2=()=>{let[n,e]=ve.useState(document.hidden);return ve.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n},qp=1,B2=class{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{let e=this.subscribers.indexOf(n);this.subscribers.splice(e,1)}),this.publish=n=>{this.subscribers.forEach(e=>e(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var e;let{message:t,...r}=n,s=typeof(n==null?void 0:n.id)=="number"||((e=n.id)==null?void 0:e.length)>0?n.id:qp++,i=this.toasts.find(u=>u.id===s),o=n.dismissible===void 0?!0:n.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(u=>u.id===s?(this.publish({...u,...n,id:s,title:t}),{...u,...n,id:s,dismissible:o,title:t}):u):this.addToast({title:t,...r,dismissible:o,id:s}),s},this.dismiss=n=>(this.dismissedToasts.add(n),n||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:n,dismiss:!0})),n),this.message=(n,e)=>this.create({...e,message:n}),this.error=(n,e)=>this.create({...e,message:n,type:"error"}),this.success=(n,e)=>this.create({...e,type:"success",message:n}),this.info=(n,e)=>this.create({...e,type:"info",message:n}),this.warning=(n,e)=>this.create({...e,type:"warning",message:n}),this.loading=(n,e)=>this.create({...e,type:"loading",message:n}),this.promise=(n,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:n,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let r=n instanceof Promise?n:n(),s=t!==void 0,i,o=r.then(async d=>{if(i=["resolve",d],ve.isValidElement(d))s=!1,this.create({id:t,type:"default",message:d});else if(j2(d)&&!d.ok){s=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${d.status}`):e.error,h=typeof e.description=="function"?await e.description(`HTTP error! status: ${d.status}`):e.description;this.create({id:t,type:"error",message:c,description:h})}else if(e.success!==void 0){s=!1;let c=typeof e.success=="function"?await e.success(d):e.success,h=typeof e.description=="function"?await e.description(d):e.description;this.create({id:t,type:"success",message:c,description:h})}}).catch(async d=>{if(i=["reject",d],e.error!==void 0){s=!1;let c=typeof e.error=="function"?await e.error(d):e.error,h=typeof e.description=="function"?await e.description(d):e.description;this.create({id:t,type:"error",message:c,description:h})}}).finally(()=>{var d;s&&(this.dismiss(t),t=void 0),(d=e.finally)==null||d.call(e)}),u=()=>new Promise((d,c)=>o.then(()=>i[0]==="reject"?c(i[1]):d(i[1])).catch(c));return typeof t!="string"&&typeof t!="number"?{unwrap:u}:Object.assign(t,{unwrap:u})},this.custom=(n,e)=>{let t=(e==null?void 0:e.id)||qp++;return this.create({jsx:n(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(n=>!this.dismissedToasts.has(n.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},bn=new B2,$2=(n,e)=>{let t=(e==null?void 0:e.id)||qp++;return bn.addToast({title:n,...e,id:t}),t},j2=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",V2=$2,G2=()=>bn.toasts,K2=()=>bn.getActiveToasts();Object.assign(V2,{success:bn.success,info:bn.info,warning:bn.warning,error:bn.error,custom:bn.custom,message:bn.message,promise:bn.promise,dismiss:bn.dismiss,loading:bn.loading},{getHistory:G2,getToasts:K2});function H2(n,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}H2(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function kd(n){return n.label!==void 0}var z2=3,W2="32px",Y2="16px",IS=4e3,q2=356,Q2=14,X2=20,Z2=200;function ls(...n){return n.filter(Boolean).join(" ")}function J2(n){let[e,t]=n.split("-"),r=[];return e&&r.push(e),t&&r.push(t),r}var eU=n=>{var e,t,r,s,i,o,u,d,c,h,m;let{invert:g,toast:y,unstyled:v,interacting:E,setHeights:S,visibleToasts:A,heights:I,index:R,toasts:k,expanded:C,removeToast:V,defaultRichColors:_,closeButton:N,style:F,cancelButtonStyle:O,actionButtonStyle:q,className:H="",descriptionClassName:ie="",duration:oe,position:ce,gap:ae,loadingIcon:ue,expandByDefault:W,classNames:Z,icons:ne,closeButtonAriaLabel:P="Close toast",pauseWhenPageIsHidden:B}=n,[de,pe]=ve.useState(null),[ge,we]=ve.useState(null),[Ie,Ge]=ve.useState(!1),[Ze,vt]=ve.useState(!1),[er,Ht]=ve.useState(!1),[fr,cn]=ve.useState(!1),[ys,Xe]=ve.useState(!1),[zt,nr]=ve.useState(0),[Mr,qt]=ve.useState(0),U=ve.useRef(y.duration||oe||IS),Y=ve.useRef(null),se=ve.useRef(null),Te=R===0,Ee=R+1<=A,fe=y.type,_e=y.dismissible!==!1,et=y.className||"",tt=y.descriptionClassName||"",At=ve.useMemo(()=>I.findIndex(Je=>Je.toastId===y.id)||0,[I,y.id]),Wt=ve.useMemo(()=>{var Je;return(Je=y.closeButton)!=null?Je:N},[y.closeButton,N]),en=ve.useMemo(()=>y.duration||oe||IS,[y.duration,oe]),Fr=ve.useRef(0),zr=ve.useRef(0),Jn=ve.useRef(0),tn=ve.useRef(null),[vs,xs]=ce.split("-"),dn=ve.useMemo(()=>I.reduce((Je,St,It)=>It>=At?Je:Je+St.height,0),[I,At]),js=U2(),$n=y.invert||g,fn=fe==="loading";zr.current=ve.useMemo(()=>At*ae+dn,[At,dn]),ve.useEffect(()=>{U.current=en},[en]),ve.useEffect(()=>{Ge(!0)},[]),ve.useEffect(()=>{let Je=se.current;if(Je){let St=Je.getBoundingClientRect().height;return qt(St),S(It=>[{toastId:y.id,height:St,position:y.position},...It]),()=>S(It=>It.filter(yr=>yr.toastId!==y.id))}},[S,y.id]),ve.useLayoutEffect(()=>{if(!Ie)return;let Je=se.current,St=Je.style.height;Je.style.height="auto";let It=Je.getBoundingClientRect().height;Je.style.height=St,qt(It),S(yr=>yr.find(Wr=>Wr.toastId===y.id)?yr.map(Wr=>Wr.toastId===y.id?{...Wr,height:It}:Wr):[{toastId:y.id,height:It,position:y.position},...yr])},[Ie,y.title,y.description,S,y.id]);let Rn=ve.useCallback(()=>{vt(!0),nr(zr.current),S(Je=>Je.filter(St=>St.toastId!==y.id)),setTimeout(()=>{V(y)},Z2)},[y,V,S,zr]);ve.useEffect(()=>{if(y.promise&&fe==="loading"||y.duration===1/0||y.type==="loading")return;let Je;return C||E||B&&js?(()=>{if(Jn.current<Fr.current){let St=new Date().getTime()-Fr.current;U.current=U.current-St}Jn.current=new Date().getTime()})():U.current!==1/0&&(Fr.current=new Date().getTime(),Je=setTimeout(()=>{var St;(St=y.onAutoClose)==null||St.call(y,y),Rn()},U.current)),()=>clearTimeout(Je)},[C,E,y,fe,B,js,Rn]),ve.useEffect(()=>{y.delete&&Rn()},[Rn,y.delete]);function ga(){var Je,St,It;return ne!=null&&ne.loading?ve.createElement("div",{className:ls(Z==null?void 0:Z.loader,(Je=y==null?void 0:y.classNames)==null?void 0:Je.loader,"sonner-loader"),"data-visible":fe==="loading"},ne.loading):ue?ve.createElement("div",{className:ls(Z==null?void 0:Z.loader,(St=y==null?void 0:y.classNames)==null?void 0:St.loader,"sonner-loader"),"data-visible":fe==="loading"},ue):ve.createElement(D2,{className:ls(Z==null?void 0:Z.loader,(It=y==null?void 0:y.classNames)==null?void 0:It.loader),visible:fe==="loading"})}return ve.createElement("li",{tabIndex:0,ref:se,className:ls(H,et,Z==null?void 0:Z.toast,(e=y==null?void 0:y.classNames)==null?void 0:e.toast,Z==null?void 0:Z.default,Z==null?void 0:Z[fe],(t=y==null?void 0:y.classNames)==null?void 0:t[fe]),"data-sonner-toast":"","data-rich-colors":(r=y.richColors)!=null?r:_,"data-styled":!(y.jsx||y.unstyled||v),"data-mounted":Ie,"data-promise":!!y.promise,"data-swiped":ys,"data-removed":Ze,"data-visible":Ee,"data-y-position":vs,"data-x-position":xs,"data-index":R,"data-front":Te,"data-swiping":er,"data-dismissible":_e,"data-type":fe,"data-invert":$n,"data-swipe-out":fr,"data-swipe-direction":ge,"data-expanded":!!(C||W&&Ie),style:{"--index":R,"--toasts-before":R,"--z-index":k.length-R,"--offset":`${Ze?zt:zr.current}px`,"--initial-height":W?"auto":`${Mr}px`,...F,...y.style},onDragEnd:()=>{Ht(!1),pe(null),tn.current=null},onPointerDown:Je=>{fn||!_e||(Y.current=new Date,nr(zr.current),Je.target.setPointerCapture(Je.pointerId),Je.target.tagName!=="BUTTON"&&(Ht(!0),tn.current={x:Je.clientX,y:Je.clientY}))},onPointerUp:()=>{var Je,St,It,yr;if(fr||!_e)return;tn.current=null;let Wr=Number(((Je=se.current)==null?void 0:Je.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Yr=Number(((St=se.current)==null?void 0:St.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),j=new Date().getTime()-((It=Y.current)==null?void 0:It.getTime()),z=de==="x"?Wr:Yr,te=Math.abs(z)/j;if(Math.abs(z)>=X2||te>.11){nr(zr.current),(yr=y.onDismiss)==null||yr.call(y,y),we(de==="x"?Wr>0?"right":"left":Yr>0?"down":"up"),Rn(),cn(!0),Xe(!1);return}Ht(!1),pe(null)},onPointerMove:Je=>{var St,It,yr,Wr;if(!tn.current||!_e||((St=window.getSelection())==null?void 0:St.toString().length)>0)return;let Yr=Je.clientY-tn.current.y,j=Je.clientX-tn.current.x,z=(It=n.swipeDirections)!=null?It:J2(ce);!de&&(Math.abs(j)>1||Math.abs(Yr)>1)&&pe(Math.abs(j)>Math.abs(Yr)?"x":"y");let te={x:0,y:0};de==="y"?(z.includes("top")||z.includes("bottom"))&&(z.includes("top")&&Yr<0||z.includes("bottom")&&Yr>0)&&(te.y=Yr):de==="x"&&(z.includes("left")||z.includes("right"))&&(z.includes("left")&&j<0||z.includes("right")&&j>0)&&(te.x=j),(Math.abs(te.x)>0||Math.abs(te.y)>0)&&Xe(!0),(yr=se.current)==null||yr.style.setProperty("--swipe-amount-x",`${te.x}px`),(Wr=se.current)==null||Wr.style.setProperty("--swipe-amount-y",`${te.y}px`)}},Wt&&!y.jsx?ve.createElement("button",{"aria-label":P,"data-disabled":fn,"data-close-button":!0,onClick:fn||!_e?()=>{}:()=>{var Je;Rn(),(Je=y.onDismiss)==null||Je.call(y,y)},className:ls(Z==null?void 0:Z.closeButton,(s=y==null?void 0:y.classNames)==null?void 0:s.closeButton)},(i=ne==null?void 0:ne.close)!=null?i:F2):null,y.jsx||D.isValidElement(y.title)?y.jsx?y.jsx:typeof y.title=="function"?y.title():y.title:ve.createElement(ve.Fragment,null,fe||y.icon||y.promise?ve.createElement("div",{"data-icon":"",className:ls(Z==null?void 0:Z.icon,(o=y==null?void 0:y.classNames)==null?void 0:o.icon)},y.promise||y.type==="loading"&&!y.icon?y.icon||ga():null,y.type!=="loading"?y.icon||(ne==null?void 0:ne[fe])||k2(fe):null):null,ve.createElement("div",{"data-content":"",className:ls(Z==null?void 0:Z.content,(u=y==null?void 0:y.classNames)==null?void 0:u.content)},ve.createElement("div",{"data-title":"",className:ls(Z==null?void 0:Z.title,(d=y==null?void 0:y.classNames)==null?void 0:d.title)},typeof y.title=="function"?y.title():y.title),y.description?ve.createElement("div",{"data-description":"",className:ls(ie,tt,Z==null?void 0:Z.description,(c=y==null?void 0:y.classNames)==null?void 0:c.description)},typeof y.description=="function"?y.description():y.description):null),D.isValidElement(y.cancel)?y.cancel:y.cancel&&kd(y.cancel)?ve.createElement("button",{"data-button":!0,"data-cancel":!0,style:y.cancelButtonStyle||O,onClick:Je=>{var St,It;kd(y.cancel)&&_e&&((It=(St=y.cancel).onClick)==null||It.call(St,Je),Rn())},className:ls(Z==null?void 0:Z.cancelButton,(h=y==null?void 0:y.classNames)==null?void 0:h.cancelButton)},y.cancel.label):null,D.isValidElement(y.action)?y.action:y.action&&kd(y.action)?ve.createElement("button",{"data-button":!0,"data-action":!0,style:y.actionButtonStyle||q,onClick:Je=>{var St,It;kd(y.action)&&((It=(St=y.action).onClick)==null||It.call(St,Je),!Je.defaultPrevented&&Rn())},className:ls(Z==null?void 0:Z.actionButton,(m=y==null?void 0:y.classNames)==null?void 0:m.actionButton)},y.action.label):null))};function RS(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function tU(n,e){let t={};return[n,e].forEach((r,s)=>{let i=s===1,o=i?"--mobile-offset":"--offset",u=i?Y2:W2;function d(c){["top","right","bottom","left"].forEach(h=>{t[`${o}-${h}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?d(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?t[`${o}-${c}`]=u:t[`${o}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):d(u)}),t}var rU=D.forwardRef(function(n,e){let{invert:t,position:r="bottom-right",hotkey:s=["altKey","KeyT"],expand:i,closeButton:o,className:u,offset:d,mobileOffset:c,theme:h="light",richColors:m,duration:g,style:y,visibleToasts:v=z2,toastOptions:E,dir:S=RS(),gap:A=Q2,loadingIcon:I,icons:R,containerAriaLabel:k="Notifications",pauseWhenPageIsHidden:C}=n,[V,_]=ve.useState([]),N=ve.useMemo(()=>Array.from(new Set([r].concat(V.filter(B=>B.position).map(B=>B.position)))),[V,r]),[F,O]=ve.useState([]),[q,H]=ve.useState(!1),[ie,oe]=ve.useState(!1),[ce,ae]=ve.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ue=ve.useRef(null),W=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),Z=ve.useRef(null),ne=ve.useRef(!1),P=ve.useCallback(B=>{_(de=>{var pe;return(pe=de.find(ge=>ge.id===B.id))!=null&&pe.delete||bn.dismiss(B.id),de.filter(({id:ge})=>ge!==B.id)})},[]);return ve.useEffect(()=>bn.subscribe(B=>{if(B.dismiss){_(de=>de.map(pe=>pe.id===B.id?{...pe,delete:!0}:pe));return}setTimeout(()=>{tg.flushSync(()=>{_(de=>{let pe=de.findIndex(ge=>ge.id===B.id);return pe!==-1?[...de.slice(0,pe),{...de[pe],...B},...de.slice(pe+1)]:[B,...de]})})})}),[]),ve.useEffect(()=>{if(h!=="system"){ae(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ae("dark"):ae("light")),typeof window>"u")return;let B=window.matchMedia("(prefers-color-scheme: dark)");try{B.addEventListener("change",({matches:de})=>{ae(de?"dark":"light")})}catch{B.addListener(({matches:pe})=>{try{ae(pe?"dark":"light")}catch(ge){console.error(ge)}})}},[h]),ve.useEffect(()=>{V.length<=1&&H(!1)},[V]),ve.useEffect(()=>{let B=de=>{var pe,ge;s.every(we=>de[we]||de.code===we)&&(H(!0),(pe=ue.current)==null||pe.focus()),de.code==="Escape"&&(document.activeElement===ue.current||(ge=ue.current)!=null&&ge.contains(document.activeElement))&&H(!1)};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[s]),ve.useEffect(()=>{if(ue.current)return()=>{Z.current&&(Z.current.focus({preventScroll:!0}),Z.current=null,ne.current=!1)}},[ue.current]),ve.createElement("section",{ref:e,"aria-label":`${k} ${W}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},N.map((B,de)=>{var pe;let[ge,we]=B.split("-");return V.length?ve.createElement("ol",{key:B,dir:S==="auto"?RS():S,tabIndex:-1,ref:ue,className:u,"data-sonner-toaster":!0,"data-theme":ce,"data-y-position":ge,"data-lifted":q&&V.length>1&&!i,"data-x-position":we,style:{"--front-toast-height":`${((pe=F[0])==null?void 0:pe.height)||0}px`,"--width":`${q2}px`,"--gap":`${A}px`,...y,...tU(d,c)},onBlur:Ie=>{ne.current&&!Ie.currentTarget.contains(Ie.relatedTarget)&&(ne.current=!1,Z.current&&(Z.current.focus({preventScroll:!0}),Z.current=null))},onFocus:Ie=>{Ie.target instanceof HTMLElement&&Ie.target.dataset.dismissible==="false"||ne.current||(ne.current=!0,Z.current=Ie.relatedTarget)},onMouseEnter:()=>H(!0),onMouseMove:()=>H(!0),onMouseLeave:()=>{ie||H(!1)},onDragEnd:()=>H(!1),onPointerDown:Ie=>{Ie.target instanceof HTMLElement&&Ie.target.dataset.dismissible==="false"||oe(!0)},onPointerUp:()=>oe(!1)},V.filter(Ie=>!Ie.position&&de===0||Ie.position===B).map((Ie,Ge)=>{var Ze,vt;return ve.createElement(eU,{key:Ie.id,icons:R,index:Ge,toast:Ie,defaultRichColors:m,duration:(Ze=E==null?void 0:E.duration)!=null?Ze:g,className:E==null?void 0:E.className,descriptionClassName:E==null?void 0:E.descriptionClassName,invert:t,visibleToasts:v,closeButton:(vt=E==null?void 0:E.closeButton)!=null?vt:o,interacting:ie,position:B,style:E==null?void 0:E.style,unstyled:E==null?void 0:E.unstyled,classNames:E==null?void 0:E.classNames,cancelButtonStyle:E==null?void 0:E.cancelButtonStyle,actionButtonStyle:E==null?void 0:E.actionButtonStyle,removeToast:P,toasts:V.filter(er=>er.position==Ie.position),heights:F.filter(er=>er.position==Ie.position),setHeights:O,expandByDefault:i,gap:A,loadingIcon:I,expanded:q,pauseWhenPageIsHidden:C,swipeDirections:n.swipeDirections})})):null}))});function nU({children:n}){const[e]=D.useState(()=>new S_),t=ap(r=>r.theme);return D.useEffect(()=>{document.documentElement.classList.toggle("dark",t==="dark")},[t]),b.jsxs(T_,{client:e,children:[n,b.jsx(rU,{richColors:!0,position:"top-right"})]})}$A.createRoot(document.getElementById("root")).render(b.jsx(ve.StrictMode,{children:b.jsx(nU,{children:b.jsx(_2,{})})}));
